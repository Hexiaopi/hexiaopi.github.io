<!doctype html>
<html lang="zh-CN" data-theme="light">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <meta name="generator" content="VuePress 2.0.0-rc.9" />
    <meta name="theme" content="VuePress Theme Hope 2.0.0-rc.43" />
    <style>
      html {
        background: var(--bg-color, #fff);
      }

      html[data-theme="dark"] {
        background: var(--bg-color, #1d1e1f);
      }

      body {
        background: var(--bg-color);
      }
    </style>
    <script>
      const userMode = localStorage.getItem("vuepress-theme-hope-scheme");
      const systemDarkMode =
        window.matchMedia &&
        window.matchMedia("(prefers-color-scheme: dark)").matches;

      if (userMode === "dark" || (userMode !== "light" && systemDarkMode)) {
        document.documentElement.setAttribute("data-theme", "dark");
      }
    </script>
    <meta property="og:url" content="http://blog.cjhe.top/language/go/reprint/uber-guide.html"><meta property="og:site_name" content="ä¸ªäººåšå®¢"><meta property="og:title" content="Goè¯­è¨€ç¼–ç è§„èŒƒ"><meta property="og:description" content="ã€è½¬ã€‘åŸæ–‡é“¾æ¥"><meta property="og:type" content="article"><meta property="og:image" content="https://starchart.cc/xxjwxc/uber_go_guide_cn.svg"><meta property="og:locale" content="zh-CN"><meta property="og:updated_time" content="2024-05-15T10:01:59.000Z"><meta property="article:author" content="uber"><meta property="article:tag" content="Go"><meta property="article:tag" content="è§„èŒƒ"><meta property="article:published_time" content="2023-03-04T00:00:00.000Z"><meta property="article:modified_time" content="2024-05-15T10:01:59.000Z"><script type="application/ld+json">{"@context":"https://schema.org","@type":"Article","headline":"Goè¯­è¨€ç¼–ç è§„èŒƒ","image":["https://starchart.cc/xxjwxc/uber_go_guide_cn.svg"],"datePublished":"2023-03-04T00:00:00.000Z","dateModified":"2024-05-15T10:01:59.000Z","author":[{"@type":"Person","name":"uber"}]}</script><link rel="alternate" type="application/atom+xml" href="http://blog.cjhe.top/atom.xml" title="ä¸ªäººåšå®¢ Atom Feed"><link rel="alternate" type="application/json" href="http://blog.cjhe.top/feed.json" title="ä¸ªäººåšå®¢ JSON Feed"><link rel="alternate" type="application/rss+xml" href="http://blog.cjhe.top/rss.xml" title="ä¸ªäººåšå®¢ RSS Feed"><title>Goè¯­è¨€ç¼–ç è§„èŒƒ | ä¸ªäººåšå®¢</title><meta name="description" content="ã€è½¬ã€‘åŸæ–‡é“¾æ¥">
    <link rel="preload" href="/assets/style-Bz3ORIAB.css" as="style"><link rel="stylesheet" href="/assets/style-Bz3ORIAB.css">
    <link rel="modulepreload" href="/assets/app-CR0RWkma.js"><link rel="modulepreload" href="/assets/uber-guide.html-DaXF5UbU.js"><link rel="modulepreload" href="/assets/plugin-vue_export-helper-DlAUqK2U.js">
    <link rel="prefetch" href="/assets/CHANGELOG.html-DSC-ojp7.js" as="script"><link rel="prefetch" href="/assets/index.html-DkZyiKfW.js" as="script"><link rel="prefetch" href="/assets/intro.html-B7aRHX8V.js" as="script"><link rel="prefetch" href="/assets/slides.html-Bs93lq6R.js" as="script"><link rel="prefetch" href="/assets/limit.html-BB7pdoDx.js" as="script"><link rel="prefetch" href="/assets/recommend.html-C3pUOvBy.js" as="script"><link rel="prefetch" href="/assets/index.html-DvGpydgR.js" as="script"><link rel="prefetch" href="/assets/index.html-62MNKfSj.js" as="script"><link rel="prefetch" href="/assets/principle.html-DokNOQSw.js" as="script"><link rel="prefetch" href="/assets/quantity-code.html-CA1OshlB.js" as="script"><link rel="prefetch" href="/assets/recommend.html-CrMrgyLu.js" as="script"><link rel="prefetch" href="/assets/index.html-CAlYjcB4.js" as="script"><link rel="prefetch" href="/assets/index.html-BtGeWb7m.js" as="script"><link rel="prefetch" href="/assets/grafana.html-CJpCI5RS.js" as="script"><link rel="prefetch" href="/assets/promql.html-ykodMiUm.js" as="script"><link rel="prefetch" href="/assets/recommend.html-BhL90huY.js" as="script"><link rel="prefetch" href="/assets/index.html-VgPei2Bj.js" as="script"><link rel="prefetch" href="/assets/index.html-Yumk08sn.js" as="script"><link rel="prefetch" href="/assets/api.html-CQdBmZOA.js" as="script"><link rel="prefetch" href="/assets/branch.html-CqHMCuy9.js" as="script"><link rel="prefetch" href="/assets/commit.html--0gvHJum.js" as="script"><link rel="prefetch" href="/assets/directory.html-CTTly-z2.js" as="script"><link rel="prefetch" href="/assets/doc.html-D6tZxkxP.js" as="script"><link rel="prefetch" href="/assets/version.html-BvyRwj8x.js" as="script"><link rel="prefetch" href="/assets/12factors.html-BGWmK_Cf.js" as="script"><link rel="prefetch" href="/assets/index.html-BSRe7xqw.js" as="script"><link rel="prefetch" href="/assets/how-to-get-rich-without-getting-lucky.html-CBDywOZK.js" as="script"><link rel="prefetch" href="/assets/how-to-live-longer.html-D40B_J9X.js" as="script"><link rel="prefetch" href="/assets/ca.html-BUTTf6wX.js" as="script"><link rel="prefetch" href="/assets/confd.html-Cfyq0uBV.js" as="script"><link rel="prefetch" href="/assets/recommend.html-D42y5MKY.js" as="script"><link rel="prefetch" href="/assets/vscode-leetcode.html-Cdw3sNSK.js" as="script"><link rel="prefetch" href="/assets/binary-search-tree.html-C2IhzB0K.js" as="script"><link rel="prefetch" href="/assets/binary-tree.html-BC-CQJhp.js" as="script"><link rel="prefetch" href="/assets/index.html-DKsm8Qsy.js" as="script"><link rel="prefetch" href="/assets/minio-monitor.html-CkoSM5R1.js" as="script"><link rel="prefetch" href="/assets/index.html-BS33aLmN.js" as="script"><link rel="prefetch" href="/assets/mongodb-exporter.html-DelLyKJa.js" as="script"><link rel="prefetch" href="/assets/index.html-BeIOECsT.js" as="script"><link rel="prefetch" href="/assets/develop-standard.html-DEUTovKB.js" as="script"><link rel="prefetch" href="/assets/engine.html-CpWeBl1V.js" as="script"><link rel="prefetch" href="/assets/idx.html-Cz6I1sOo.js" as="script"><link rel="prefetch" href="/assets/join.html-BPRS5QsO.js" as="script"><link rel="prefetch" href="/assets/mysql-exporter.html-C6yqfAd_.js" as="script"><link rel="prefetch" href="/assets/read-process.html-C7oQjJfe.js" as="script"><link rel="prefetch" href="/assets/sql-order.html-URht9i4C.js" as="script"><link rel="prefetch" href="/assets/transaction.html-BXFjsMkN.js" as="script"><link rel="prefetch" href="/assets/write-process.html-4upvSBaR.js" as="script"><link rel="prefetch" href="/assets/index.html-DXHGJ6_D.js" as="script"><link rel="prefetch" href="/assets/nacos-monitor.html-B6bMUDj2.js" as="script"><link rel="prefetch" href="/assets/index.html-cfVP6-TZ.js" as="script"><link rel="prefetch" href="/assets/deadline-message.html-CzBKO04z.js" as="script"><link rel="prefetch" href="/assets/distribute-lock.html-_xvVjIHR.js" as="script"><link rel="prefetch" href="/assets/redis-exporter.html-BKWQisi-.js" as="script"><link rel="prefetch" href="/assets/index.html-B07KToeI.js" as="script"><link rel="prefetch" href="/assets/chain-of-responsibility.html-DpJCsqU8.js" as="script"><link rel="prefetch" href="/assets/command.html-DWLKZOcc.js" as="script"><link rel="prefetch" href="/assets/iterator.html-pT8qltVK.js" as="script"><link rel="prefetch" href="/assets/mediator.html-CyN8DqSX.js" as="script"><link rel="prefetch" href="/assets/memento.html-CgCWwG5V.js" as="script"><link rel="prefetch" href="/assets/observer.html-COQ538W9.js" as="script"><link rel="prefetch" href="/assets/state.html-DcjqUo5v.js" as="script"><link rel="prefetch" href="/assets/strategy.html-DQzhdbE0.js" as="script"><link rel="prefetch" href="/assets/template-method.html-yr_NbuEj.js" as="script"><link rel="prefetch" href="/assets/visitor.html-DlXsxRk2.js" as="script"><link rel="prefetch" href="/assets/index.html-DSV2dYSZ.js" as="script"><link rel="prefetch" href="/assets/exit.html--hr28RKg.js" as="script"><link rel="prefetch" href="/assets/fan-in-fan-out.html-BYERzRDw.js" as="script"><link rel="prefetch" href="/assets/pipeline.html-BcpzkzUd.js" as="script"><link rel="prefetch" href="/assets/producer-consumer.html-Bq7srDEA.js" as="script"><link rel="prefetch" href="/assets/index.html-B2bSOSYG.js" as="script"><link rel="prefetch" href="/assets/abstract-factory.html-DE1Wfhx4.js" as="script"><link rel="prefetch" href="/assets/builder.html-B-cPR6Ig.js" as="script"><link rel="prefetch" href="/assets/factory-compare.html-D66E8L-f.js" as="script"><link rel="prefetch" href="/assets/factory-method.html-DRXEiyNP.js" as="script"><link rel="prefetch" href="/assets/object-pool.html-N25wL55b.js" as="script"><link rel="prefetch" href="/assets/prototype.html-BgVWWXTb.js" as="script"><link rel="prefetch" href="/assets/simple-factory.html-DVyDLmsV.js" as="script"><link rel="prefetch" href="/assets/singleton.html-D9DDCVBs.js" as="script"><link rel="prefetch" href="/assets/index.html-Dq9d9CMi.js" as="script"><link rel="prefetch" href="/assets/option.html-CtifOB4E.js" as="script"><link rel="prefetch" href="/assets/index.html-BGARlABA.js" as="script"><link rel="prefetch" href="/assets/adapter.html-Bk9UB9iZ.js" as="script"><link rel="prefetch" href="/assets/bridge.html-ktBfabPO.js" as="script"><link rel="prefetch" href="/assets/composite.html-B-JqDVJx.js" as="script"><link rel="prefetch" href="/assets/decorator.html-CrHxedDa.js" as="script"><link rel="prefetch" href="/assets/facade.html-DN7I2i1h.js" as="script"><link rel="prefetch" href="/assets/flyweight.html-CpLe4DXd.js" as="script"><link rel="prefetch" href="/assets/proxy.html-k75stNr8.js" as="script"><link rel="prefetch" href="/assets/index.html-sxzdPdPI.js" as="script"><link rel="prefetch" href="/assets/recommand.html-CbF9Hxsh.js" as="script"><link rel="prefetch" href="/assets/shell-line-break.html-D4_qXQZX.js" as="script"><link rel="prefetch" href="/assets/index.html-Y_WdEZKt.js" as="script"><link rel="prefetch" href="/assets/cadvisor-k8s-deploy.html-Baliq4VH.js" as="script"><link rel="prefetch" href="/assets/chartmuseum.html-BvTCDkN0.js" as="script"><link rel="prefetch" href="/assets/helm-dashboard.html-B93lewnu.js" as="script"><link rel="prefetch" href="/assets/kube-state-metrics-k8s-deploy.html-DwnxZqxw.js" as="script"><link rel="prefetch" href="/assets/makefile-deploy.html-C3HuFYi7.js" as="script"><link rel="prefetch" href="/assets/node-exporter-k8s-deploy.html-BqErerlN.js" as="script"><link rel="prefetch" href="/assets/prometheus-k8s-deploy.html-XcGdzQSR.js" as="script"><link rel="prefetch" href="/assets/recommand.html-Dxzd5bC4.js" as="script"><link rel="prefetch" href="/assets/index.html-BZW1nFsf.js" as="script"><link rel="prefetch" href="/assets/index.html-Bp1W0AXb.js" as="script"><link rel="prefetch" href="/assets/HTTP.html-CriDdHlf.js" as="script"><link rel="prefetch" href="/assets/MQTT.html-DmzqCaH2.js" as="script"><link rel="prefetch" href="/assets/index.html-CYyN89NA.js" as="script"><link rel="prefetch" href="/assets/websocket.html-B-sUtka1.js" as="script"><link rel="prefetch" href="/assets/ICMP.html-DNjx3Mu4.js" as="script"><link rel="prefetch" href="/assets/index.html-CgR6Kpce.js" as="script"><link rel="prefetch" href="/assets/index.html-CR4oxStF.js" as="script"><link rel="prefetch" href="/assets/index.html-BjX7U4if.js" as="script"><link rel="prefetch" href="/assets/auth.html-Bsf0VQlu.js" as="script"><link rel="prefetch" href="/assets/index.html-BYWwpLGR.js" as="script"><link rel="prefetch" href="/assets/break.html-BAFheZH2.js" as="script"><link rel="prefetch" href="/assets/for-range.html-B5l030LT.js" as="script"><link rel="prefetch" href="/assets/gomaxprocs.html-DUCDClXx.js" as="script"><link rel="prefetch" href="/assets/goroutine.html-DYswJHcC.js" as="script"><link rel="prefetch" href="/assets/interface.html-9-4d9Cdd.js" as="script"><link rel="prefetch" href="/assets/memory-alignment.html-C8g7IRKq.js" as="script"><link rel="prefetch" href="/assets/mutex.html-D-kz2VSj.js" as="script"><link rel="prefetch" href="/assets/no-copy.html-D2sBYEjm.js" as="script"><link rel="prefetch" href="/assets/sync-map.html-CU9s-jEr.js" as="script"><link rel="prefetch" href="/assets/index.html-CTb7eq2E.js" as="script"><link rel="prefetch" href="/assets/array.html-CGhuhyC4.js" as="script"><link rel="prefetch" href="/assets/command.html-DTy8-nYo.js" as="script"><link rel="prefetch" href="/assets/constant.html-C9ObrH44.js" as="script"><link rel="prefetch" href="/assets/context.html-be4cJILw.js" as="script"><link rel="prefetch" href="/assets/data-type.html-DlB24MRi.js" as="script"><link rel="prefetch" href="/assets/defer.html-BC3RkSbd.js" as="script"><link rel="prefetch" href="/assets/enviroment.html-B9nYiedS.js" as="script"><link rel="prefetch" href="/assets/identifier.html-BiTTj6WF.js" as="script"><link rel="prefetch" href="/assets/iota.html-BYa1Jhpo.js" as="script"><link rel="prefetch" href="/assets/map.html-CTmKLQOk.js" as="script"><link rel="prefetch" href="/assets/operator.html-T8N9AeDl.js" as="script"><link rel="prefetch" href="/assets/package.html-CVETQhlC.js" as="script"><link rel="prefetch" href="/assets/recover.html-dcsYn4KO.js" as="script"><link rel="prefetch" href="/assets/slice.html-DJ3DExFO.js" as="script"><link rel="prefetch" href="/assets/string.html-izjG6yQO.js" as="script"><link rel="prefetch" href="/assets/variable.html-CNiRJMXM.js" as="script"><link rel="prefetch" href="/assets/index.html-D14Nrif9.js" as="script"><link rel="prefetch" href="/assets/article.html-Bx4JhbKi.js" as="script"><link rel="prefetch" href="/assets/blog.html-592u63pl.js" as="script"><link rel="prefetch" href="/assets/book.html-CMXEf60g.js" as="script"><link rel="prefetch" href="/assets/community.html-B7GaTRX8.js" as="script"><link rel="prefetch" href="/assets/example.html-CJXMB4RL.js" as="script"><link rel="prefetch" href="/assets/tool.html-BXvNiT0m.js" as="script"><link rel="prefetch" href="/assets/index.html-teUUiBCx.js" as="script"><link rel="prefetch" href="/assets/proverb.html-BL5znB9z.js" as="script"><link rel="prefetch" href="/assets/tencent-secguide.html-nsnMVZOE.js" as="script"><link rel="prefetch" href="/assets/zen.html-CUCu_1_Q.js" as="script"><link rel="prefetch" href="/assets/index.html-CIy4_1IK.js" as="script"><link rel="prefetch" href="/assets/flag.html-DnpEUjCb.js" as="script"><link rel="prefetch" href="/assets/index.html-Clg7Xzlz.js" as="script"><link rel="prefetch" href="/assets/mysql-test.html-Dz4FLrdK.js" as="script"><link rel="prefetch" href="/assets/index.html-CXiibSiR.js" as="script"><link rel="prefetch" href="/assets/pflag.html-CNUbrrSE.js" as="script"><link rel="prefetch" href="/assets/index.html-BvmX4eIo.js" as="script"><link rel="prefetch" href="/assets/communication.html-CMvxzj3k.js" as="script"><link rel="prefetch" href="/assets/404.html-DNEXEXCO.js" as="script"><link rel="prefetch" href="/assets/index.html-C1yWC15o.js" as="script"><link rel="prefetch" href="/assets/index.html-BQuexRnz.js" as="script"><link rel="prefetch" href="/assets/index.html-Bf07NmVH.js" as="script"><link rel="prefetch" href="/assets/index.html-DioV3s6i.js" as="script"><link rel="prefetch" href="/assets/index.html-CHgjsvfj.js" as="script"><link rel="prefetch" href="/assets/index.html-BvQuI3xZ.js" as="script"><link rel="prefetch" href="/assets/index.html-uIsXDfs4.js" as="script"><link rel="prefetch" href="/assets/index.html-OUjl26kY.js" as="script"><link rel="prefetch" href="/assets/index.html-Z6yXkfnM.js" as="script"><link rel="prefetch" href="/assets/index.html-D4NzrFaH.js" as="script"><link rel="prefetch" href="/assets/index.html-BoIHVXtC.js" as="script"><link rel="prefetch" href="/assets/index.html-B6eYCEnr.js" as="script"><link rel="prefetch" href="/assets/index.html-eQf33aZU.js" as="script"><link rel="prefetch" href="/assets/index.html-CyQKDHaD.js" as="script"><link rel="prefetch" href="/assets/index.html-OGP2tNft.js" as="script"><link rel="prefetch" href="/assets/index.html-DsBkJtqC.js" as="script"><link rel="prefetch" href="/assets/index.html-BJqUGUAn.js" as="script"><link rel="prefetch" href="/assets/index.html-Ca0Sote2.js" as="script"><link rel="prefetch" href="/assets/index.html-VjvOiso1.js" as="script"><link rel="prefetch" href="/assets/index.html-C1b9o703.js" as="script"><link rel="prefetch" href="/assets/index.html-jJbbbp9U.js" as="script"><link rel="prefetch" href="/assets/index.html-BQSxAHPq.js" as="script"><link rel="prefetch" href="/assets/index.html-BiOIDdeS.js" as="script"><link rel="prefetch" href="/assets/index.html-BfWV7AiE.js" as="script"><link rel="prefetch" href="/assets/index.html-BNmTAt9q.js" as="script"><link rel="prefetch" href="/assets/index.html-C2pdVDPM.js" as="script"><link rel="prefetch" href="/assets/index.html-O6AQe0fu.js" as="script"><link rel="prefetch" href="/assets/index.html-pq9-H9du.js" as="script"><link rel="prefetch" href="/assets/index.html-DbfzoPYu.js" as="script"><link rel="prefetch" href="/assets/index.html-qFu8tPgH.js" as="script"><link rel="prefetch" href="/assets/index.html-wjEickvp.js" as="script"><link rel="prefetch" href="/assets/index.html-WToDXQIe.js" as="script"><link rel="prefetch" href="/assets/index.html-DSypryDq.js" as="script"><link rel="prefetch" href="/assets/index.html-DTwBdfX0.js" as="script"><link rel="prefetch" href="/assets/index.html-BCkZJg75.js" as="script"><link rel="prefetch" href="/assets/index.html-BJ9qui4h.js" as="script"><link rel="prefetch" href="/assets/index.html-DbNpLWd6.js" as="script"><link rel="prefetch" href="/assets/index.html-C4Clq-k5.js" as="script"><link rel="prefetch" href="/assets/index.html-GnYCWfPo.js" as="script"><link rel="prefetch" href="/assets/index.html-BR2UcIJu.js" as="script"><link rel="prefetch" href="/assets/index.html-CJPO1KVS.js" as="script"><link rel="prefetch" href="/assets/index.html-D5am7_Jg.js" as="script"><link rel="prefetch" href="/assets/index.html-myAVdAPp.js" as="script"><link rel="prefetch" href="/assets/index.html-RRiIHru4.js" as="script"><link rel="prefetch" href="/assets/index.html-DCeO_kR3.js" as="script"><link rel="prefetch" href="/assets/index.html-DSXpFRI0.js" as="script"><link rel="prefetch" href="/assets/index.html-DSXpFRI0.js" as="script"><link rel="prefetch" href="/assets/index.html-ClxIMsc0.js" as="script"><link rel="prefetch" href="/assets/index.html-C9j1bG5d.js" as="script"><link rel="prefetch" href="/assets/index.html-DjEFut5i.js" as="script"><link rel="prefetch" href="/assets/index.html-9yWc9GzB.js" as="script"><link rel="prefetch" href="/assets/index.html-CQRAWgrP.js" as="script"><link rel="prefetch" href="/assets/index.html-BFdPR2NB.js" as="script"><link rel="prefetch" href="/assets/index.html-BEc16RjS.js" as="script"><link rel="prefetch" href="/assets/index.html-CIEaG3em.js" as="script"><link rel="prefetch" href="/assets/index.html-CQ9Sl3zH.js" as="script"><link rel="prefetch" href="/assets/index.html-B5DhMHpM.js" as="script"><link rel="prefetch" href="/assets/index.html-DZzIzipc.js" as="script"><link rel="prefetch" href="/assets/index.html-CV6dIiYR.js" as="script"><link rel="prefetch" href="/assets/index.html-qFu8tPgH.js" as="script"><link rel="prefetch" href="/assets/index.html-IPlymiaK.js" as="script"><link rel="prefetch" href="/assets/index.html-DzjuV4wb.js" as="script"><link rel="prefetch" href="/assets/index.html-C8847K66.js" as="script"><link rel="prefetch" href="/assets/index.html-DoJI_WBL.js" as="script"><link rel="prefetch" href="/assets/index.html-B712Cjx4.js" as="script"><link rel="prefetch" href="/assets/index.html-BJueEgWG.js" as="script"><link rel="prefetch" href="/assets/index.html-DytQ7Wxo.js" as="script"><link rel="prefetch" href="/assets/index.html-DfFzduIk.js" as="script"><link rel="prefetch" href="/assets/index.html-s8lUfYe_.js" as="script"><link rel="prefetch" href="/assets/index.html-Dfy1XLjQ.js" as="script"><link rel="prefetch" href="/assets/index.html-BP3meeul.js" as="script"><link rel="prefetch" href="/assets/index.html-CKEcbCYn.js" as="script"><link rel="prefetch" href="/assets/index.html-C2tAFbx1.js" as="script"><link rel="prefetch" href="/assets/index.html-DHeliI6p.js" as="script"><link rel="prefetch" href="/assets/index.html-DLRaTLWz.js" as="script"><link rel="prefetch" href="/assets/index.html-BkVZyeUi.js" as="script"><link rel="prefetch" href="/assets/index.html-D4zqwJOx.js" as="script"><link rel="prefetch" href="/assets/index.html-DX_Tb2yA.js" as="script"><link rel="prefetch" href="/assets/index.html-BpL4egy_.js" as="script"><link rel="prefetch" href="/assets/index.html-C7da1FBy.js" as="script"><link rel="prefetch" href="/assets/index.html-CIiTGv9s.js" as="script"><link rel="prefetch" href="/assets/index.html-C7r5lu2a.js" as="script"><link rel="prefetch" href="/assets/index.html-Dgm3b1uC.js" as="script"><link rel="prefetch" href="/assets/browser-D6eOinvE.js" as="script"><link rel="prefetch" href="/assets/giscus--_FS5kYt.js" as="script"><link rel="prefetch" href="/assets/index-wZ-hXvzw.js" as="script"><link rel="prefetch" href="/assets/reveal.esm-CYbl4_PU.js" as="script"><link rel="prefetch" href="/assets/markdown.esm-BG2Xu2Hd.js" as="script"><link rel="prefetch" href="/assets/highlight.esm-C34tS8ua.js" as="script"><link rel="prefetch" href="/assets/math.esm-DN7Rh_EM.js" as="script"><link rel="prefetch" href="/assets/search.esm-DuBqnxcF.js" as="script"><link rel="prefetch" href="/assets/notes.esm-DcquA2oP.js" as="script"><link rel="prefetch" href="/assets/zoom.esm-Ctj_eavO.js" as="script"><link rel="prefetch" href="/assets/photoswipe.esm-SzV8tJDW.js" as="script"><link rel="prefetch" href="/assets/SearchResult-yWUzf0J0.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><!--[--><span tabindex="-1"></span><a href="#main-content" class="vp-skip-link sr-only">è·³è‡³ä¸»è¦å…§å®¹</a><!--]--><div class="theme-container external-link-icon has-toc"><!--[--><header id="navbar" class="vp-navbar"><div class="vp-navbar-start"><button type="button" class="vp-toggle-sidebar-button" title="Toggle Sidebar"><span class="icon"></span></button><!----><!--[--><a class="route-link vp-brand" href="/"><img class="vp-nav-logo" src="/logo.png" alt><!----><span class="vp-site-name hide-in-pad">ä¸ªäººåšå®¢</span></a><!--]--><!----></div><div class="vp-navbar-center"><!----><!--[--><nav class="vp-nav-links"><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/" aria-label="åšå®¢ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>åšå®¢ä¸»é¡µ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/design-pattern/" aria-label="è®¾è®¡æ¨¡å¼"><span class="font-icon icon fa-fw fa-sm fas fa-palette" style=""></span>è®¾è®¡æ¨¡å¼<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link active vp-link" href="/language/" aria-label="ç¼–ç¨‹è¯­è¨€&amp;æ¡†æ¶"><span class="font-icon icon fa-fw fa-sm fas fa-language" style=""></span>ç¼–ç¨‹è¯­è¨€&amp;æ¡†æ¶<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/database/" aria-label="æ•°æ®å­˜å‚¨"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span>æ•°æ®å­˜å‚¨<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/network/" aria-label="ç½‘ç»œ"><span class="font-icon icon fa-fw fa-sm fas fa-network-wired" style=""></span>ç½‘ç»œ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/devops/" aria-label="devops"><span class="font-icon icon fa-fw fa-sm fas fa-rocket" style=""></span>devops<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/project-standard/" aria-label="é¡¹ç›®è§„èŒƒ"><span class="font-icon icon fa-fw fa-sm fas fa-list-check" style=""></span>é¡¹ç›®è§„èŒƒ<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/share/" aria-label="è½¬è½½"><span class="font-icon icon fa-fw fa-sm fas fa-share-square" style=""></span>è½¬è½½<!----></a></div><div class="vp-nav-item hide-in-mobile"><a class="route-link vp-link" href="/CHANGELOG.html" aria-label="å˜æ›´æ—¥å¿—"><span class="font-icon icon fa-fw fa-sm fas fa-clock" style=""></span>å˜æ›´æ—¥å¿—<!----></a></div></nav><!--]--><!----></div><div class="vp-navbar-end"><!----><!--[--><!----><!----><div class="vp-nav-item hide-in-mobile"><button type="button" class="vp-color-mode-switch" id="color-mode-switch"><svg xmlns="http://www.w3.org/2000/svg" class="icon auto-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="auto icon" name="auto" style="display:block;"><path d="M512 992C246.92 992 32 777.08 32 512S246.92 32 512 32s480 214.92 480 480-214.92 480-480 480zm0-840c-198.78 0-360 161.22-360 360 0 198.84 161.22 360 360 360s360-161.16 360-360c0-198.78-161.22-360-360-360zm0 660V212c165.72 0 300 134.34 300 300 0 165.72-134.28 300-300 300z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon dark-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="dark icon" name="dark" style="display:none;"><path d="M524.8 938.667h-4.267a439.893 439.893 0 0 1-313.173-134.4 446.293 446.293 0 0 1-11.093-597.334A432.213 432.213 0 0 1 366.933 90.027a42.667 42.667 0 0 1 45.227 9.386 42.667 42.667 0 0 1 10.24 42.667 358.4 358.4 0 0 0 82.773 375.893 361.387 361.387 0 0 0 376.747 82.774 42.667 42.667 0 0 1 54.187 55.04 433.493 433.493 0 0 1-99.84 154.88 438.613 438.613 0 0 1-311.467 128z"></path></svg><svg xmlns="http://www.w3.org/2000/svg" class="icon light-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="light icon" name="light" style="display:none;"><path d="M952 552h-80a40 40 0 0 1 0-80h80a40 40 0 0 1 0 80zM801.88 280.08a41 41 0 0 1-57.96-57.96l57.96-58a41.04 41.04 0 0 1 58 58l-58 57.96zM512 752a240 240 0 1 1 0-480 240 240 0 0 1 0 480zm0-560a40 40 0 0 1-40-40V72a40 40 0 0 1 80 0v80a40 40 0 0 1-40 40zm-289.88 88.08-58-57.96a41.04 41.04 0 0 1 58-58l57.96 58a41 41 0 0 1-57.96 57.96zM192 512a40 40 0 0 1-40 40H72a40 40 0 0 1 0-80h80a40 40 0 0 1 40 40zm30.12 231.92a41 41 0 0 1 57.96 57.96l-57.96 58a41.04 41.04 0 0 1-58-58l58-57.96zM512 832a40 40 0 0 1 40 40v80a40 40 0 0 1-80 0v-80a40 40 0 0 1 40-40zm289.88-88.08 58 57.96a41.04 41.04 0 0 1-58 58l-57.96-58a41 41 0 0 1 57.96-57.96z"></path></svg></button></div><!--[--><button type="button" class="search-pro-button" aria-label="æœç´¢"><svg xmlns="http://www.w3.org/2000/svg" class="icon search-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="search icon" name="search"><path d="M192 480a256 256 0 1 1 512 0 256 256 0 0 1-512 0m631.776 362.496-143.2-143.168A318.464 318.464 0 0 0 768 480c0-176.736-143.264-320-320-320S128 303.264 128 480s143.264 320 320 320a318.016 318.016 0 0 0 184.16-58.592l146.336 146.368c12.512 12.48 32.768 12.48 45.28 0 12.48-12.512 12.48-32.768 0-45.28"></path></svg><div class="search-pro-placeholder">æœç´¢</div><div class="search-pro-key-hints"><kbd class="search-pro-key">Ctrl</kbd><kbd class="search-pro-key">K</kbd></div></button><!--]--><!--]--><!----><button type="button" class="vp-toggle-navbar-button" aria-label="Toggle Navbar" aria-expanded="false" aria-controls="nav-screen"><span><span class="vp-top"></span><span class="vp-middle"></span><span class="vp-bottom"></span></span></button></div></header><!----><!--]--><!----><div class="toggle-sidebar-wrapper"><span class="arrow start"></span></div><aside id="sidebar" class="vp-sidebar"><!----><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/" aria-label="åšå®¢ä¸»é¡µ"><span class="font-icon icon fa-fw fa-sm fas fa-home" style=""></span>åšå®¢ä¸»é¡µ<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-palette" style=""></span><a class="route-link vp-link vp-sidebar-title" href="/design-pattern/" aria-label="è®¾è®¡æ¨¡å¼"><!---->è®¾è®¡æ¨¡å¼<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-language" style=""></span><a class="route-link active vp-link vp-sidebar-title" href="/language/" aria-label="ç¼–ç¨‹è¯­è¨€&amp;æ¡†æ¶"><!---->ç¼–ç¨‹è¯­è¨€&amp;æ¡†æ¶<!----></a><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/language/" aria-label="ç¼–ç¨‹è¯­è¨€&amp;æ¡†æ¶"><span class="font-icon icon fa-fw fa-sm fas fa-language" style=""></span>ç¼–ç¨‹è¯­è¨€&amp;æ¡†æ¶<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><img class="icon" src="/assets/icons/go.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">Goè¯­è¨€</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/language/go/" aria-label="Goè¯­è¨€"><img class="icon" src="/assets/icons/go.svg" alt aria-hidden no-view style="">Goè¯­è¨€<!----></a></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-place-of-worship" style=""></span><span class="vp-sidebar-title">GoåŸºç¡€</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-hand-holding-heart" style=""></span><span class="vp-sidebar-title">Goæ¨è</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-vial-circle-check" style=""></span><span class="vp-sidebar-title">Goæµ‹è¯•</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-paper-plane" style=""></span><span class="vp-sidebar-title">Goè¿›é˜¶</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-pizza-slice" style=""></span><span class="vp-sidebar-title">ä¸‰æ–¹åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-burger" style=""></span><span class="vp-sidebar-title">æ ‡å‡†åº“</span><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable active" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-share-square" style=""></span><span class="vp-sidebar-title">è½¬è½½</span><span class="vp-arrow down"></span></button><ul class="vp-sidebar-links"><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/language/go/reprint/" aria-label="è½¬è½½"><span class="font-icon icon fa-fw fa-sm fas fa-share-square" style=""></span>è½¬è½½<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/language/go/reprint/zen.html" aria-label="Goä¹‹ç¦…"><span class="font-icon icon fa-fw fa-sm fas fa-yin-yang" style=""></span>Goä¹‹ç¦…<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/language/go/reprint/tencent-secguide.html" aria-label="Goå®‰å…¨æŒ‡å—"><span class="font-icon icon fa-fw fa-sm fas fa-shield" style=""></span>Goå®‰å…¨æŒ‡å—<!----></a></li><li><a class="route-link vp-link vp-sidebar-link vp-sidebar-page" href="/language/go/reprint/proverb.html" aria-label="Goç®´è¨€"><span class="font-icon icon fa-fw fa-sm fas fa-spell-check" style=""></span>Goç®´è¨€<!----></a></li><li><a class="route-link active vp-link vp-sidebar-link vp-sidebar-page active" href="/language/go/reprint/uber-guide.html" aria-label="Goè¯­è¨€ç¼–ç è§„èŒƒ"><span class="font-icon icon fa-fw fa-sm fas fa-check-to-slot" style=""></span>Goè¯­è¨€ç¼–ç è§„èŒƒ<!----></a></li></ul></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><img class="icon" src="/assets/icons/vuejs.svg" alt aria-hidden no-view style=""><span class="vp-sidebar-title">Vueæ¡†æ¶</span><span class="vp-arrow end"></span></button><!----></section></li></ul></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-database" style=""></span><a class="route-link vp-link vp-sidebar-title" href="/database/" aria-label="æ•°æ®å­˜å‚¨"><!---->æ•°æ®å­˜å‚¨<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-network-wired" style=""></span><a class="route-link vp-link vp-sidebar-title" href="/network/" aria-label="ç½‘ç»œ"><!---->ç½‘ç»œ<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-rocket" style=""></span><a class="route-link vp-link vp-sidebar-title" href="/devops/" aria-label="devops"><!---->devops<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-list-check" style=""></span><a class="route-link vp-link vp-sidebar-title" href="/project-standard/" aria-label="é¡¹ç›®è§„èŒƒ"><!---->é¡¹ç›®è§„èŒƒ<!----></a><span class="vp-arrow end"></span></button><!----></section></li><li><section class="vp-sidebar-group"><button class="vp-sidebar-header clickable" type="button"><span class="font-icon icon fa-fw fa-sm fas fa-share-square" style=""></span><a class="route-link vp-link vp-sidebar-title" href="/share/" aria-label="è½¬è½½"><!---->è½¬è½½<!----></a><span class="vp-arrow end"></span></button><!----></section></li></ul><!----></aside><!--[--><main id="main-content" class="vp-page"><!--[--><!----><!----><nav class="vp-breadcrumb disable"></nav><div class="vp-page-title"><h1><span class="font-icon icon fa-fw fa-sm fas fa-check-to-slot" style=""></span>Goè¯­è¨€ç¼–ç è§„èŒƒ</h1><div class="page-info"><span class="page-author-info" aria-label="ä½œè€…ğŸ–Š" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon author-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="author icon" name="author"><path d="M649.6 633.6c86.4-48 147.2-144 147.2-249.6 0-160-128-288-288-288s-288 128-288 288c0 108.8 57.6 201.6 147.2 249.6-121.6 48-214.4 153.6-240 288-3.2 9.6 0 19.2 6.4 25.6 3.2 9.6 12.8 12.8 22.4 12.8h704c9.6 0 19.2-3.2 25.6-12.8 6.4-6.4 9.6-16 6.4-25.6-25.6-134.4-121.6-240-243.2-288z"></path></svg><span><span class="page-author-item">uber</span></span><span property="author" content="uber"></span></span><!----><span class="page-date-info" aria-label="å†™ä½œæ—¥æœŸğŸ“…" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon calendar-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="calendar icon" name="calendar"><path d="M716.4 110.137c0-18.753-14.72-33.473-33.472-33.473-18.753 0-33.473 14.72-33.473 33.473v33.473h66.993v-33.473zm-334.87 0c0-18.753-14.72-33.473-33.473-33.473s-33.52 14.72-33.52 33.473v33.473h66.993v-33.473zm468.81 33.52H716.4v100.465c0 18.753-14.72 33.473-33.472 33.473a33.145 33.145 0 01-33.473-33.473V143.657H381.53v100.465c0 18.753-14.72 33.473-33.473 33.473a33.145 33.145 0 01-33.473-33.473V143.657H180.6A134.314 134.314 0 0046.66 277.595v535.756A134.314 134.314 0 00180.6 947.289h669.74a134.36 134.36 0 00133.94-133.938V277.595a134.314 134.314 0 00-133.94-133.938zm33.473 267.877H147.126a33.145 33.145 0 01-33.473-33.473c0-18.752 14.72-33.473 33.473-33.473h736.687c18.752 0 33.472 14.72 33.472 33.473a33.145 33.145 0 01-33.472 33.473z"></path></svg><span><!----></span><meta property="datePublished" content="2023-03-04T00:00:00.000Z"></span><!----><span class="page-reading-time-info" aria-label="é˜…è¯»æ—¶é—´âŒ›" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon timer-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="timer icon" name="timer"><path d="M799.387 122.15c4.402-2.978 7.38-7.897 7.38-13.463v-1.165c0-8.933-7.38-16.312-16.312-16.312H256.33c-8.933 0-16.311 7.38-16.311 16.312v1.165c0 5.825 2.977 10.874 7.637 13.592 4.143 194.44 97.22 354.963 220.201 392.763-122.204 37.542-214.893 196.511-220.2 389.397-4.661 5.049-7.638 11.651-7.638 19.03v5.825h566.49v-5.825c0-7.379-2.849-13.981-7.509-18.9-5.049-193.016-97.867-351.985-220.2-389.527 123.24-37.67 216.446-198.453 220.588-392.892zM531.16 450.445v352.632c117.674 1.553 211.787 40.778 211.787 88.676H304.097c0-48.286 95.149-87.382 213.728-88.676V450.445c-93.077-3.107-167.901-81.297-167.901-177.093 0-8.803 6.99-15.793 15.793-15.793 8.803 0 15.794 6.99 15.794 15.793 0 80.261 63.69 145.635 142.01 145.635s142.011-65.374 142.011-145.635c0-8.803 6.99-15.793 15.794-15.793s15.793 6.99 15.793 15.793c0 95.019-73.789 172.82-165.96 177.093z"></path></svg><span>å¤§çº¦ 56 åˆ†é’Ÿ</span><meta property="timeRequired" content="PT56M"></span><span class="page-category-info" aria-label="åˆ†ç±»ğŸŒˆ" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon category-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="category icon" name="category"><path d="M148.41 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H148.41c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.311-40.31zM147.556 553.478H429.73c22.263 0 40.311 18.048 40.311 40.31v282.176c0 22.263-18.048 40.312-40.31 40.312H147.555c-22.263 0-40.311-18.049-40.311-40.312V593.79c0-22.263 18.048-40.311 40.31-40.311zM593.927 106.992h282.176c22.263 0 40.31 18.048 40.31 40.31V429.48c0 22.263-18.047 40.31-40.31 40.31H593.927c-22.263 0-40.311-18.047-40.311-40.31V147.302c0-22.263 18.048-40.31 40.31-40.31zM730.22 920.502H623.926c-40.925 0-74.22-33.388-74.22-74.425V623.992c0-41.038 33.387-74.424 74.425-74.424h222.085c41.038 0 74.424 33.226 74.424 74.067v114.233c0 10.244-8.304 18.548-18.547 18.548s-18.548-8.304-18.548-18.548V623.635c0-20.388-16.746-36.974-37.33-36.974H624.13c-20.585 0-37.331 16.747-37.331 37.33v222.086c0 20.585 16.654 37.331 37.126 37.331H730.22c10.243 0 18.547 8.304 18.547 18.547 0 10.244-8.304 18.547-18.547 18.547z"></path></svg><!--[--><span class="page-category-item color0 clickable" role="navigation">ç¼–ç¨‹è¯­è¨€</span><!--]--><meta property="articleSection" content="ç¼–ç¨‹è¯­è¨€"></span><span class="page-tag-info" aria-label="æ ‡ç­¾ğŸ·" data-balloon-pos="up"><svg xmlns="http://www.w3.org/2000/svg" class="icon tag-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="tag icon" name="tag"><path d="M939.902 458.563L910.17 144.567c-1.507-16.272-14.465-29.13-30.737-30.737L565.438 84.098h-.402c-3.215 0-5.726 1.005-7.634 2.913l-470.39 470.39a10.004 10.004 0 000 14.164l365.423 365.424c1.909 1.908 4.42 2.913 7.132 2.913s5.223-1.005 7.132-2.913l470.39-470.39c2.01-2.11 3.014-5.023 2.813-8.036zm-240.067-72.121c-35.458 0-64.286-28.828-64.286-64.286s28.828-64.285 64.286-64.285 64.286 28.828 64.286 64.285-28.829 64.286-64.286 64.286z"></path></svg><!--[--><span class="page-tag-item color2 clickable" role="navigation">Go</span><span class="page-tag-item color0 clickable" role="navigation">è§„èŒƒ</span><!--]--><meta property="keywords" content="Go,è§„èŒƒ"></span></div><hr></div><div class="vp-toc-placeholder"><aside id="toc"><!----><div class="vp-toc-header">æ­¤é¡µå†…å®¹<button type="button" class="print-button" title="æ‰“å°"><svg xmlns="http://www.w3.org/2000/svg" class="icon print-icon" viewBox="0 0 1024 1024" fill="currentColor" aria-label="print icon" name="print"><path d="M819.2 364.8h-44.8V128c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v236.8h-44.8C145.067 364.8 96 413.867 96 473.6v192c0 59.733 49.067 108.8 108.8 108.8h44.8V896c0 17.067 14.933 32 32 32h460.8c17.067 0 32-14.933 32-32V774.4h44.8c59.733 0 108.8-49.067 108.8-108.8v-192c0-59.733-49.067-108.8-108.8-108.8zM313.6 160h396.8v204.8H313.6V160zm396.8 704H313.6V620.8h396.8V864zM864 665.6c0 25.6-19.2 44.8-44.8 44.8h-44.8V588.8c0-17.067-14.933-32-32-32H281.6c-17.067 0-32 14.933-32 32v121.6h-44.8c-25.6 0-44.8-19.2-44.8-44.8v-192c0-25.6 19.2-44.8 44.8-44.8h614.4c25.6 0 44.8 19.2 44.8 44.8v192z"></path></svg></button><div class="arrow end"></div></div><div class="vp-toc-wrapper"><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç‰ˆæœ¬">ç‰ˆæœ¬</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç›®å½•">ç›®å½•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ä»‹ç»">ä»‹ç»</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æŒ‡å¯¼åŸåˆ™">æŒ‡å¯¼åŸåˆ™</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŒ‡å‘-interface-çš„æŒ‡é’ˆ">æŒ‡å‘ interface çš„æŒ‡é’ˆ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#interface-åˆç†æ€§éªŒè¯">Interface åˆç†æ€§éªŒè¯</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æ¥æ”¶å™¨-receiver-ä¸æ¥å£">æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é›¶å€¼-mutex-æ˜¯æœ‰æ•ˆçš„">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨è¾¹ç•Œå¤„æ‹·è´-slices-å’Œ-maps">åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº">ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#channel-çš„-size-è¦ä¹ˆæ˜¯-1-è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„">Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æšä¸¾ä»-1-å¼€å§‹">æšä¸¾ä» 1 å¼€å§‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-time-å¤„ç†æ—¶é—´">ä½¿ç”¨ time å¤„ç†æ—¶é—´</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#errors">Errors</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¤„ç†æ–­è¨€å¤±è´¥">å¤„ç†æ–­è¨€å¤±è´¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸è¦ä½¿ç”¨-panic">ä¸è¦ä½¿ç”¨ panic</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨-go-uber-org-atomic">ä½¿ç”¨ go.uber.org/atomic</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…å¯å˜å…¨å±€å˜é‡">é¿å…å¯å˜å…¨å±€å˜é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹">é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…ä½¿ç”¨å†…ç½®åç§°">é¿å…ä½¿ç”¨å†…ç½®åç§°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…ä½¿ç”¨-init">é¿å…ä½¿ç”¨ init()</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡">è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸»å‡½æ•°é€€å‡ºæ–¹å¼-exit">ä¸»å‡½æ•°é€€å‡ºæ–¹å¼ (Exit)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åœ¨åºåˆ—åŒ–ç»“æ„ä¸­ä½¿ç”¨å­—æ®µæ ‡è®°">åœ¨åºåˆ—åŒ–ç»“æ„ä¸­ä½¿ç”¨å­—æ®µæ ‡è®°</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸è¦ä¸€åŠ³æ°¸é€¸åœ°ä½¿ç”¨-goroutine">ä¸è¦ä¸€åŠ³æ°¸é€¸åœ°ä½¿ç”¨ goroutine</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#æ€§èƒ½">æ€§èƒ½</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt">ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢">é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æŒ‡å®šå®¹å™¨å®¹é‡">æŒ‡å®šå®¹å™¨å®¹é‡</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#è§„èŒƒ">è§„èŒƒ</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…è¿‡é•¿çš„è¡Œ">é¿å…è¿‡é•¿çš„è¡Œ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸€è‡´æ€§">ä¸€è‡´æ€§</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„">ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#import-åˆ†ç»„">import åˆ†ç»„</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŒ…å">åŒ…å</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‡½æ•°å">å‡½æ•°å</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯¼å…¥åˆ«å">å¯¼å…¥åˆ«å</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‡½æ•°åˆ†ç»„ä¸é¡ºåº">å‡½æ•°åˆ†ç»„ä¸é¡ºåº</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‡å°‘åµŒå¥—">å‡å°‘åµŒå¥—</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä¸å¿…è¦çš„-else">ä¸å¿…è¦çš„ else</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¡¶å±‚å˜é‡å£°æ˜">é¡¶å±‚å˜é‡å£°æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡-ä½¿ç”¨-ä½œä¸ºå‰ç¼€">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç»“æ„ä½“ä¸­çš„åµŒå…¥">ç»“æ„ä½“ä¸­çš„åµŒå…¥</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#æœ¬åœ°å˜é‡å£°æ˜">æœ¬åœ°å˜é‡å£°æ˜</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice">nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ç¼©å°å˜é‡ä½œç”¨åŸŸ">ç¼©å°å˜é‡ä½œç”¨åŸŸ</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®-avoid-naked-parameters">é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡® (Avoid Naked Parameters)</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼-é¿å…è½¬ä¹‰">ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆå§‹åŒ–ç»“æ„ä½“">åˆå§‹åŒ–ç»“æ„ä½“</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åˆå§‹åŒ–-maps">åˆå§‹åŒ– Maps</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å­—ç¬¦ä¸²-string-format">å­—ç¬¦ä¸² string format</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#å‘½å-printf-æ ·å¼çš„å‡½æ•°">å‘½å Printf æ ·å¼çš„å‡½æ•°</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#ç¼–ç¨‹æ¨¡å¼">ç¼–ç¨‹æ¨¡å¼</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#è¡¨é©±åŠ¨æµ‹è¯•">è¡¨é©±åŠ¨æµ‹è¯•</a></li><!----><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#åŠŸèƒ½é€‰é¡¹">åŠŸèƒ½é€‰é¡¹</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#linting">Linting</a></li><li><ul class="vp-toc-list"><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level3" href="#lint-runners">Lint Runners</a></li><!----><!--]--></ul></li><!--]--><!--[--><li class="vp-toc-item"><a class="route-link vp-toc-link level2" href="#stargazers-over-time">Stargazers over time</a></li><!----><!--]--></ul><div class="vp-toc-marker" style="top:-1.7rem;"></div></div><!----></aside></div><!----><div class="theme-hope-content"><p>ã€è½¬ã€‘<a href="https://github.com/xxjwxc/uber_go_guide_cn" target="_blank" rel="noopener noreferrer">åŸæ–‡é“¾æ¥</a></p><!-- more --><p>Uber Go è¯­è¨€ç¼–ç è§„èŒƒ</p><p><a href="https://www.uber.com/" target="_blank" rel="noopener noreferrer">Uber</a> æ˜¯ä¸€å®¶ç¾å›½ç¡…è°·çš„ç§‘æŠ€å…¬å¸ï¼Œä¹Ÿæ˜¯ Go è¯­è¨€çš„æ—©æœŸ adopterã€‚å…¶å¼€æºäº†å¾ˆå¤š golang é¡¹ç›®ï¼Œè¯¸å¦‚è¢« Gopher åœˆç†ŸçŸ¥çš„ <a href="https://github.com/uber-go/zap" target="_blank" rel="noopener noreferrer">zap</a>ã€<a href="https://github.com/jaegertracing/jaeger" target="_blank" rel="noopener noreferrer">jaeger</a> ç­‰ã€‚2018 å¹´å¹´æœ« Uber å°†å†…éƒ¨çš„ <a href="https://github.com/uber-go/guide" target="_blank" rel="noopener noreferrer">Go é£æ ¼è§„èŒƒ</a> å¼€æºåˆ° GitHubï¼Œç»è¿‡ä¸€å¹´çš„ç§¯ç´¯å’Œæ›´æ–°ï¼Œè¯¥è§„èŒƒå·²ç»åˆå…·è§„æ¨¡ï¼Œå¹¶å—åˆ°å¹¿å¤§ Gopher çš„å…³æ³¨ã€‚æœ¬æ–‡æ˜¯è¯¥è§„èŒƒçš„ä¸­æ–‡ç‰ˆæœ¬ã€‚æœ¬ç‰ˆæœ¬ä¼šæ ¹æ®åŸç‰ˆå®æ—¶æ›´æ–°ã€‚</p><h2 id="ç‰ˆæœ¬" tabindex="-1"><a class="header-anchor" href="#ç‰ˆæœ¬"><span>ç‰ˆæœ¬</span></a></h2><ul><li>å½“å‰æ›´æ–°ç‰ˆæœ¬ï¼š2022-10-19 ç‰ˆæœ¬åœ°å€ï¼š<a href="https://github.com/uber-go/guide/commit/4478e672bddf9d4f7ca4a561ab0779e08e469577" target="_blank" rel="noopener noreferrer">commit:#158</a></li><li>å¦‚æœæ‚¨å‘ç°ä»»ä½•æ›´æ–°ã€é—®é¢˜æˆ–æ”¹è¿›ï¼Œè¯·éšæ—¶ fork å’Œ PR</li><li>Please feel free to fork and PR if you find any updates, issues or improvement.</li></ul><h2 id="ç›®å½•" tabindex="-1"><a class="header-anchor" href="#ç›®å½•"><span>ç›®å½•</span></a></h2><ul><li><a href="#%E7%89%88%E6%9C%AC">ç‰ˆæœ¬</a></li><li><a href="#%E7%9B%AE%E5%BD%95">ç›®å½•</a></li><li><a href="#%E4%BB%8B%E7%BB%8D">ä»‹ç»</a></li><li><a href="#%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%99">æŒ‡å¯¼åŸåˆ™</a><ul><li><a href="#%E6%8C%87%E5%90%91-interface-%E7%9A%84%E6%8C%87%E9%92%88">æŒ‡å‘ interface çš„æŒ‡é’ˆ</a></li><li><a href="#interface-%E5%90%88%E7%90%86%E6%80%A7%E9%AA%8C%E8%AF%81">Interface åˆç†æ€§éªŒè¯</a></li><li><a href="#%E6%8E%A5%E6%94%B6%E5%99%A8-receiver-%E4%B8%8E%E6%8E%A5%E5%8F%A3">æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</a></li><li><a href="#%E9%9B%B6%E5%80%BC-mutex-%E6%98%AF%E6%9C%89%E6%95%88%E7%9A%84">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</a></li><li><a href="#%E5%9C%A8%E8%BE%B9%E7%95%8C%E5%A4%84%E6%8B%B7%E8%B4%9D-slices-%E5%92%8C-maps">åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</a><ul><li><a href="#%E6%8E%A5%E6%94%B6-slices-%E5%92%8C-maps">æ¥æ”¶ Slices å’Œ Maps</a></li><li><a href="#%E8%BF%94%E5%9B%9E-slices-%E6%88%96-maps">è¿”å› slices æˆ– maps</a></li></ul></li><li><a href="#%E4%BD%BF%E7%94%A8-defer-%E9%87%8A%E6%94%BE%E8%B5%84%E6%BA%90">ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</a></li><li><a href="#channel-%E7%9A%84-size-%E8%A6%81%E4%B9%88%E6%98%AF-1%E8%A6%81%E4%B9%88%E6%98%AF%E6%97%A0%E7%BC%93%E5%86%B2%E7%9A%84">Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</a></li><li><a href="#%E6%9E%9A%E4%B8%BE%E4%BB%8E-1-%E5%BC%80%E5%A7%8B">æšä¸¾ä» 1 å¼€å§‹</a></li><li><a href="#%E4%BD%BF%E7%94%A8-time-%E5%A4%84%E7%90%86%E6%97%B6%E9%97%B4">ä½¿ç”¨ time å¤„ç†æ—¶é—´</a><ul><li><a href="#%E4%BD%BF%E7%94%A8-timetime-%E8%A1%A8%E8%BE%BE%E7%9E%AC%E6%97%B6%E6%97%B6%E9%97%B4">ä½¿ç”¨ <code>time.Time</code> è¡¨è¾¾ç¬æ—¶æ—¶é—´</a></li><li><a href="#%E4%BD%BF%E7%94%A8-timeduration-%E8%A1%A8%E8%BE%BE%E6%97%B6%E9%97%B4%E6%AE%B5">ä½¿ç”¨ <code>time.Duration</code> è¡¨è¾¾æ—¶é—´æ®µ</a></li><li><a href="#%E5%AF%B9%E5%A4%96%E9%83%A8%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8-timetime-%E5%92%8C-timeduration">å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨ <code>time.Time</code> å’Œ <code>time.Duration</code></a></li></ul></li><li><a href="#errors">Errors</a><ul><li><a href="#%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B">é”™è¯¯ç±»å‹</a></li><li><a href="#%E9%94%99%E8%AF%AF%E5%8C%85%E8%A3%85">é”™è¯¯åŒ…è£…</a></li><li><a href="#%E9%94%99%E8%AF%AF%E5%91%BD%E5%90%8D">é”™è¯¯å‘½å</a></li></ul></li><li><a href="#%E5%A4%84%E7%90%86%E6%96%AD%E8%A8%80%E5%A4%B1%E8%B4%A5">å¤„ç†æ–­è¨€å¤±è´¥</a></li><li><a href="#%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-panic">ä¸è¦ä½¿ç”¨ panic</a></li><li><a href="#%E4%BD%BF%E7%94%A8-gouberorgatomic">ä½¿ç”¨ go.uber.org/atomic</a></li><li><a href="#%E9%81%BF%E5%85%8D%E5%8F%AF%E5%8F%98%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F">é¿å…å¯å˜å…¨å±€å˜é‡</a></li><li><a href="#%E9%81%BF%E5%85%8D%E5%9C%A8%E5%85%AC%E5%85%B1%E7%BB%93%E6%9E%84%E4%B8%AD%E5%B5%8C%E5%85%A5%E7%B1%BB%E5%9E%8B">é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</a></li><li><a href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E5%90%8D%E7%A7%B0">é¿å…ä½¿ç”¨å†…ç½®åç§°</a></li><li><a href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-init">é¿å…ä½¿ç”¨ <code>init()</code></a></li><li><a href="#%E8%BF%BD%E5%8A%A0%E6%97%B6%E4%BC%98%E5%85%88%E6%8C%87%E5%AE%9A%E5%88%87%E7%89%87%E5%AE%B9%E9%87%8F">è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡</a></li><li><a href="#%E4%B8%BB%E5%87%BD%E6%95%B0%E9%80%80%E5%87%BA%E6%96%B9%E5%BC%8F-exit">ä¸»å‡½æ•°é€€å‡ºæ–¹å¼ (Exit)</a><ul><li><a href="#%E4%B8%80%E6%AC%A1%E6%80%A7%E9%80%80%E5%87%BA">ä¸€æ¬¡æ€§é€€å‡º</a></li></ul></li><li><a href="#%E5%9C%A8%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%93%E6%9E%84%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%AD%97%E6%AE%B5%E6%A0%87%E8%AE%B0">åœ¨åºåˆ—åŒ–ç»“æ„ä¸­ä½¿ç”¨å­—æ®µæ ‡è®°</a></li><li><a href="#%E4%B8%8D%E8%A6%81%E4%B8%80%E5%8A%B3%E6%B0%B8%E9%80%B8%E5%9C%B0%E4%BD%BF%E7%94%A8-goroutine">ä¸è¦ä¸€åŠ³æ°¸é€¸åœ°ä½¿ç”¨ goroutine</a><ul><li><a href="#%E7%AD%89%E5%BE%85-goroutines-%E9%80%80%E5%87%BA">ç­‰å¾… goroutines é€€å‡º</a></li><li><a href="#%E4%B8%8D%E8%A6%81%E5%9C%A8-init-%E4%BD%BF%E7%94%A8-goroutines">ä¸è¦åœ¨ <code>init()</code> ä½¿ç”¨ goroutines</a></li></ul></li></ul></li><li><a href="#%E6%80%A7%E8%83%BD">æ€§èƒ½</a><ul><li><a href="#%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-strconv-%E8%80%8C%E4%B8%8D%E6%98%AF-fmt">ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</a></li><li><a href="#%E9%81%BF%E5%85%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%B0%E5%AD%97%E8%8A%82%E7%9A%84%E8%BD%AC%E6%8D%A2">é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E5%AE%B9%E5%99%A8%E5%AE%B9%E9%87%8F">æŒ‡å®šå®¹å™¨å®¹é‡</a><ul><li><a href="#%E6%8C%87%E5%AE%9Amap%E5%AE%B9%E9%87%8F%E6%8F%90%E7%A4%BA">æŒ‡å®šMapå®¹é‡æç¤º</a></li><li><a href="#%E6%8C%87%E5%AE%9A%E5%88%87%E7%89%87%E5%AE%B9%E9%87%8F">æŒ‡å®šåˆ‡ç‰‡å®¹é‡</a></li></ul></li></ul></li><li><a href="#%E8%A7%84%E8%8C%83">è§„èŒƒ</a><ul><li><a href="#%E9%81%BF%E5%85%8D%E8%BF%87%E9%95%BF%E7%9A%84%E8%A1%8C">é¿å…è¿‡é•¿çš„è¡Œ</a></li><li><a href="#%E4%B8%80%E8%87%B4%E6%80%A7">ä¸€è‡´æ€§</a></li><li><a href="#%E7%9B%B8%E4%BC%BC%E7%9A%84%E5%A3%B0%E6%98%8E%E6%94%BE%E5%9C%A8%E4%B8%80%E7%BB%84">ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</a></li><li><a href="#import-%E5%88%86%E7%BB%84">import åˆ†ç»„</a></li><li><a href="#%E5%8C%85%E5%90%8D">åŒ…å</a></li><li><a href="#%E5%87%BD%E6%95%B0%E5%90%8D">å‡½æ•°å</a></li><li><a href="#%E5%AF%BC%E5%85%A5%E5%88%AB%E5%90%8D">å¯¼å…¥åˆ«å</a></li><li><a href="#%E5%87%BD%E6%95%B0%E5%88%86%E7%BB%84%E4%B8%8E%E9%A1%BA%E5%BA%8F">å‡½æ•°åˆ†ç»„ä¸é¡ºåº</a></li><li><a href="#%E5%87%8F%E5%B0%91%E5%B5%8C%E5%A5%97">å‡å°‘åµŒå¥—</a></li><li><a href="#%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84-else">ä¸å¿…è¦çš„ else</a></li><li><a href="#%E9%A1%B6%E5%B1%82%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E">é¡¶å±‚å˜é‡å£°æ˜</a></li><li><a href="#%E5%AF%B9%E4%BA%8E%E6%9C%AA%E5%AF%BC%E5%87%BA%E7%9A%84%E9%A1%B6%E5%B1%82%E5%B8%B8%E9%87%8F%E5%92%8C%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8_%E4%BD%9C%E4%B8%BA%E5%89%8D%E7%BC%80">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</a></li><li><a href="#%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E7%9A%84%E5%B5%8C%E5%85%A5">ç»“æ„ä½“ä¸­çš„åµŒå…¥</a></li><li><a href="#%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E">æœ¬åœ°å˜é‡å£°æ˜</a></li><li><a href="#nil-%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9C%89%E6%95%88%E7%9A%84-slice">nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</a></li><li><a href="#%E7%BC%A9%E5%B0%8F%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F">ç¼©å°å˜é‡ä½œç”¨åŸŸ</a></li><li><a href="#%E9%81%BF%E5%85%8D%E5%8F%82%E6%95%B0%E8%AF%AD%E4%B9%89%E4%B8%8D%E6%98%8E%E7%A1%AE-avoid-naked-parameters">é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡® (Avoid Naked Parameters)</a></li><li><a href="#%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E5%80%BC%E9%81%BF%E5%85%8D%E8%BD%AC%E4%B9%89">ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</a></li><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%93%E6%9E%84%E4%BD%93">åˆå§‹åŒ–ç»“æ„ä½“</a><ul><li><a href="#%E4%BD%BF%E7%94%A8%E5%AD%97%E6%AE%B5%E5%90%8D%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%93%E6%9E%84">ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„</a></li><li><a href="#%E7%9C%81%E7%95%A5%E7%BB%93%E6%9E%84%E4%B8%AD%E7%9A%84%E9%9B%B6%E5%80%BC%E5%AD%97%E6%AE%B5">çœç•¥ç»“æ„ä¸­çš„é›¶å€¼å­—æ®µ</a></li><li><a href="#%E5%AF%B9%E9%9B%B6%E5%80%BC%E7%BB%93%E6%9E%84%E4%BD%BF%E7%94%A8-var">å¯¹é›¶å€¼ç»“æ„ä½¿ç”¨ <code>var</code></a></li><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96-struct-%E5%BC%95%E7%94%A8">åˆå§‹åŒ– Struct å¼•ç”¨</a></li></ul></li><li><a href="#%E5%88%9D%E5%A7%8B%E5%8C%96-maps">åˆå§‹åŒ– Maps</a></li><li><a href="#%E5%AD%97%E7%AC%A6%E4%B8%B2-string-format">å­—ç¬¦ä¸² string format</a></li><li><a href="#%E5%91%BD%E5%90%8D-printf-%E6%A0%B7%E5%BC%8F%E7%9A%84%E5%87%BD%E6%95%B0">å‘½å Printf æ ·å¼çš„å‡½æ•°</a></li></ul></li><li><a href="#%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F">ç¼–ç¨‹æ¨¡å¼</a><ul><li><a href="#%E8%A1%A8%E9%A9%B1%E5%8A%A8%E6%B5%8B%E8%AF%95">è¡¨é©±åŠ¨æµ‹è¯•</a></li><li><a href="#%E5%8A%9F%E8%83%BD%E9%80%89%E9%A1%B9">åŠŸèƒ½é€‰é¡¹</a></li></ul></li><li><a href="#linting">Linting</a><ul><li><a href="#lint-runners">Lint Runners</a></li></ul></li><li><a href="#stargazers-over-time">Stargazers over time</a></li></ul><h2 id="ä»‹ç»" tabindex="-1"><a class="header-anchor" href="#ä»‹ç»"><span>ä»‹ç»</span></a></h2><p>æ ·å¼ (style) æ˜¯æ”¯é…æˆ‘ä»¬ä»£ç çš„æƒ¯ä¾‹ã€‚æœ¯è¯­<code>æ ·å¼</code>æœ‰ç‚¹ç”¨è¯ä¸å½“ï¼Œå› ä¸ºè¿™äº›çº¦å®šæ¶µç›–çš„èŒƒå›´ä¸é™äºç”± gofmt æ›¿æˆ‘ä»¬å¤„ç†çš„æºæ–‡ä»¶æ ¼å¼ã€‚</p><p>æœ¬æŒ‡å—çš„ç›®çš„æ˜¯é€šè¿‡è¯¦ç»†æè¿°åœ¨ Uber ç¼–å†™ Go ä»£ç çš„æ³¨æ„äº‹é¡¹æ¥ç®¡ç†è¿™ç§å¤æ‚æ€§ã€‚è¿™äº›è§„åˆ™çš„å­˜åœ¨æ˜¯ä¸ºäº†ä½¿ä»£ç åº“æ˜“äºç®¡ç†ï¼ŒåŒæ—¶ä»ç„¶å…è®¸å·¥ç¨‹å¸ˆæ›´æœ‰æ•ˆåœ°ä½¿ç”¨ Go è¯­è¨€åŠŸèƒ½ã€‚</p><p>è¯¥æŒ‡å—æœ€åˆç”± <a href="https://github.com/prashantv" target="_blank" rel="noopener noreferrer">Prashant Varanasi</a> å’Œ <a href="https://github.com/nomis52" target="_blank" rel="noopener noreferrer">Simon Newton</a> ç¼–å†™ï¼Œç›®çš„æ˜¯ä½¿ä¸€äº›åŒäº‹èƒ½å¿«é€Ÿä½¿ç”¨ Goã€‚å¤šå¹´æ¥ï¼Œè¯¥æŒ‡å—å·²æ ¹æ®å…¶ä»–äººçš„åé¦ˆè¿›è¡Œäº†ä¿®æ”¹ã€‚</p><p>æœ¬æ–‡æ¡£è®°å½•äº†æˆ‘ä»¬åœ¨ Uber éµå¾ªçš„ Go ä»£ç ä¸­çš„æƒ¯ç”¨çº¦å®šã€‚å…¶ä¸­è®¸å¤šæ˜¯ Go çš„é€šç”¨å‡†åˆ™ï¼Œè€Œå…¶ä»–æ‰©å±•å‡†åˆ™ä¾èµ–äºä¸‹é¢å¤–éƒ¨çš„æŒ‡å—ï¼š</p><ol><li><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener noreferrer">Effective Go</a></li><li><a href="https://github.com/golang/go/wiki/CommonMistakes" target="_blank" rel="noopener noreferrer">Go Common Mistakes</a></li><li><a href="https://github.com/golang/go/wiki/CodeReviewComments" target="_blank" rel="noopener noreferrer">Go Code Review Comments</a></li></ol><p>æˆ‘ä»¬çš„ç›®æ ‡æ˜¯ä½¿ä»£ç ç¤ºä¾‹èƒ½å¤Ÿå‡†ç¡®åœ°ç”¨äºGoçš„ä¸¤ä¸ªå‘å¸ƒç‰ˆæœ¬ <a href="https://go.dev/doc/devel/release" target="_blank" rel="noopener noreferrer">releases</a>.</p><p>æ‰€æœ‰ä»£ç éƒ½åº”è¯¥é€šè¿‡<code>golint</code>å’Œ<code>go vet</code>çš„æ£€æŸ¥å¹¶æ— é”™è¯¯ã€‚æˆ‘ä»¬å»ºè®®æ‚¨å°†ç¼–è¾‘å™¨è®¾ç½®ä¸ºï¼š</p><ul><li>ä¿å­˜æ—¶è¿è¡Œ <code>goimports</code></li><li>è¿è¡Œ <code>golint</code> å’Œ <code>go vet</code> æ£€æŸ¥é”™è¯¯</li></ul><p>æ‚¨å¯ä»¥åœ¨ä»¥ä¸‹ Go ç¼–è¾‘å™¨å·¥å…·æ”¯æŒé¡µé¢ä¸­æ‰¾åˆ°æ›´ä¸ºè¯¦ç»†çš„ä¿¡æ¯ï¼š <a href="https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins" target="_blank" rel="noopener noreferrer">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p><h2 id="æŒ‡å¯¼åŸåˆ™" tabindex="-1"><a class="header-anchor" href="#æŒ‡å¯¼åŸåˆ™"><span>æŒ‡å¯¼åŸåˆ™</span></a></h2><h3 id="æŒ‡å‘-interface-çš„æŒ‡é’ˆ" tabindex="-1"><a class="header-anchor" href="#æŒ‡å‘-interface-çš„æŒ‡é’ˆ"><span>æŒ‡å‘ interface çš„æŒ‡é’ˆ</span></a></h3><p>æ‚¨å‡ ä¹ä¸éœ€è¦æŒ‡å‘æ¥å£ç±»å‹çš„æŒ‡é’ˆã€‚æ‚¨åº”è¯¥å°†æ¥å£ä½œä¸ºå€¼è¿›è¡Œä¼ é€’ï¼Œåœ¨è¿™æ ·çš„ä¼ é€’è¿‡ç¨‹ä¸­ï¼Œå®è´¨ä¸Šä¼ é€’çš„åº•å±‚æ•°æ®ä»ç„¶å¯ä»¥æ˜¯æŒ‡é’ˆã€‚</p><p>æ¥å£å®è´¨ä¸Šåœ¨åº•å±‚ç”¨ä¸¤ä¸ªå­—æ®µè¡¨ç¤ºï¼š</p><ol><li>ä¸€ä¸ªæŒ‡å‘æŸäº›ç‰¹å®šç±»å‹ä¿¡æ¯çš„æŒ‡é’ˆã€‚æ‚¨å¯ä»¥å°†å…¶è§†ä¸º&quot;type&quot;ã€‚</li><li>æ•°æ®æŒ‡é’ˆã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯æŒ‡é’ˆï¼Œåˆ™ç›´æ¥å­˜å‚¨ã€‚å¦‚æœå­˜å‚¨çš„æ•°æ®æ˜¯ä¸€ä¸ªå€¼ï¼Œåˆ™å­˜å‚¨æŒ‡å‘è¯¥å€¼çš„æŒ‡é’ˆã€‚</li></ol><p>å¦‚æœå¸Œæœ›æ¥å£æ–¹æ³•ä¿®æ”¹åŸºç¡€æ•°æ®ï¼Œåˆ™å¿…é¡»ä½¿ç”¨æŒ‡é’ˆä¼ é€’ (å°†å¯¹è±¡æŒ‡é’ˆèµ‹å€¼ç»™æ¥å£å˜é‡)ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> F <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> S1 <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s S1<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">type</span> S2 <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>S2<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token comment">// f1.f() æ— æ³•ä¿®æ”¹åº•å±‚æ•°æ®</span>
<span class="token comment">// f2.f() å¯ä»¥ä¿®æ”¹åº•å±‚æ•°æ®ï¼Œç»™æ¥å£å˜é‡ f2 èµ‹å€¼æ—¶ä½¿ç”¨çš„æ˜¯å¯¹è±¡æŒ‡é’ˆ</span>
<span class="token keyword">var</span> f1 F <span class="token operator">=</span> S1<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">var</span> f2 F <span class="token operator">=</span> <span class="token operator">&amp;</span>S2<span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="interface-åˆç†æ€§éªŒè¯" tabindex="-1"><a class="header-anchor" href="#interface-åˆç†æ€§éªŒè¯"><span>Interface åˆç†æ€§éªŒè¯</span></a></h3><p>åœ¨ç¼–è¯‘æ—¶éªŒè¯æ¥å£çš„ç¬¦åˆæ€§ã€‚è¿™åŒ…æ‹¬ï¼š</p><ul><li>å°†å®ç°ç‰¹å®šæ¥å£çš„å¯¼å‡ºç±»å‹ä½œä¸ºæ¥å£ API çš„ä¸€éƒ¨åˆ†è¿›è¡Œæ£€æŸ¥</li><li>å®ç°åŒä¸€æ¥å£çš„ (å¯¼å‡ºå’Œéå¯¼å‡º) ç±»å‹å±äºå®ç°ç±»å‹çš„é›†åˆ</li><li>ä»»ä½•è¿åæ¥å£åˆç†æ€§æ£€æŸ¥çš„åœºæ™¯ï¼Œéƒ½ä¼šç»ˆæ­¢ç¼–è¯‘ï¼Œå¹¶é€šçŸ¥ç»™ç”¨æˆ·</li></ul><p>è¡¥å……ï¼šä¸Šé¢ 3 æ¡æ˜¯ç¼–è¯‘å™¨å¯¹æ¥å£çš„æ£€æŸ¥æœºåˆ¶ï¼Œ å¤§ä½“æ„æ€æ˜¯é”™è¯¯ä½¿ç”¨æ¥å£ä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™ã€‚ æ‰€ä»¥å¯ä»¥åˆ©ç”¨è¿™ä¸ªæœºåˆ¶è®©éƒ¨åˆ†é—®é¢˜åœ¨ç¼–è¯‘æœŸæš´éœ²ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// å¦‚æœ Handler æ²¡æœ‰å®ç° http.Handlerï¼Œä¼šåœ¨è¿è¡Œæ—¶æŠ¥é”™</span>
<span class="token keyword">type</span> Handler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Handler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>
  w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span>
  r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Handler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç”¨äºè§¦å‘ç¼–è¯‘æœŸçš„æ¥å£çš„åˆç†æ€§æ£€æŸ¥æœºåˆ¶</span>
<span class="token comment">// å¦‚æœ Handler æ²¡æœ‰å®ç° http.Handlerï¼Œä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™</span>
<span class="token keyword">var</span> <span class="token boolean">_</span> http<span class="token punctuation">.</span>Handler <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token operator">*</span>Handler<span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token boolean">nil</span><span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h <span class="token operator">*</span>Handler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>
  w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span>
  r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¦‚æœ <code>*Handler</code> ä¸ <code>http.Handler</code> çš„æ¥å£ä¸åŒ¹é…ï¼Œ é‚£ä¹ˆè¯­å¥ <code>var _ http.Handler = (*Handler)(nil)</code> å°†æ— æ³•ç¼–è¯‘é€šè¿‡ã€‚</p><p>èµ‹å€¼çš„å³è¾¹åº”è¯¥æ˜¯æ–­è¨€ç±»å‹çš„é›¶å€¼ã€‚ å¯¹äºæŒ‡é’ˆç±»å‹ï¼ˆå¦‚ <code>*Handler</code>ï¼‰ã€åˆ‡ç‰‡å’Œæ˜ å°„ï¼Œè¿™æ˜¯ <code>nil</code>ï¼› å¯¹äºç»“æ„ç±»å‹ï¼Œè¿™æ˜¯ç©ºç»“æ„ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> LogHandler <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  h   http<span class="token punctuation">.</span>Handler
  log <span class="token operator">*</span>zap<span class="token punctuation">.</span>Logger
<span class="token punctuation">}</span>
<span class="token keyword">var</span> <span class="token boolean">_</span> http<span class="token punctuation">.</span>Handler <span class="token operator">=</span> LogHandler<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>h LogHandler<span class="token punctuation">)</span> <span class="token function">ServeHTTP</span><span class="token punctuation">(</span>
  w http<span class="token punctuation">.</span>ResponseWriter<span class="token punctuation">,</span>
  r <span class="token operator">*</span>http<span class="token punctuation">.</span>Request<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="æ¥æ”¶å™¨-receiver-ä¸æ¥å£" tabindex="-1"><a class="header-anchor" href="#æ¥æ”¶å™¨-receiver-ä¸æ¥å£"><span>æ¥æ”¶å™¨ (receiver) ä¸æ¥å£</span></a></h3><p>ä½¿ç”¨å€¼æ¥æ”¶å™¨çš„æ–¹æ³•æ—¢å¯ä»¥é€šè¿‡å€¼è°ƒç”¨ï¼Œä¹Ÿå¯ä»¥é€šè¿‡æŒ‡é’ˆè°ƒç”¨ã€‚</p><p>å¸¦æŒ‡é’ˆæ¥æ”¶å™¨çš„æ–¹æ³•åªèƒ½é€šè¿‡æŒ‡é’ˆæˆ– <a href="https://golang.org/ref/spec#Method_values" target="_blank" rel="noopener noreferrer">addressable values</a> è°ƒç”¨ã€‚</p><p>ä¾‹å¦‚ï¼Œ</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> S <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  data <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s S<span class="token punctuation">)</span> <span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> s<span class="token punctuation">.</span>data
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>S<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>str <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  s<span class="token punctuation">.</span>data <span class="token operator">=</span> str
<span class="token punctuation">}</span>

sVals <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span>S<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">// ä½ é€šè¿‡å€¼åªèƒ½è°ƒç”¨ Read</span>
sVals<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// è¿™ä¸èƒ½ç¼–è¯‘é€šè¿‡ï¼š</span>
<span class="token comment">//  sVals[1].Write(&quot;test&quot;)</span>

sPtrs <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">int</span><span class="token punctuation">]</span><span class="token operator">*</span>S<span class="token punctuation">{</span><span class="token number">1</span><span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token string">&quot;A&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

<span class="token comment">// é€šè¿‡æŒ‡é’ˆæ—¢å¯ä»¥è°ƒç”¨ Readï¼Œä¹Ÿå¯ä»¥è°ƒç”¨ Write æ–¹æ³•</span>
sPtrs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
sPtrs<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">]</span><span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>ç±»ä¼¼çš„ï¼Œå³ä½¿æ–¹æ³•æœ‰äº†å€¼æ¥æ”¶å™¨ï¼Œä¹ŸåŒæ ·å¯ä»¥ç”¨æŒ‡é’ˆæ¥æ”¶å™¨æ¥æ»¡è¶³æ¥å£ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> F <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> S1 <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s S1<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">type</span> S2 <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>S2<span class="token punctuation">)</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>

s1Val <span class="token operator">:=</span> S1<span class="token punctuation">{</span><span class="token punctuation">}</span>
s1Ptr <span class="token operator">:=</span> <span class="token operator">&amp;</span>S1<span class="token punctuation">{</span><span class="token punctuation">}</span>
s2Val <span class="token operator">:=</span> S2<span class="token punctuation">{</span><span class="token punctuation">}</span>
s2Ptr <span class="token operator">:=</span> <span class="token operator">&amp;</span>S2<span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">var</span> i F
i <span class="token operator">=</span> s1Val
i <span class="token operator">=</span> s1Ptr
i <span class="token operator">=</span> s2Ptr

<span class="token comment">//  ä¸‹é¢ä»£ç æ— æ³•é€šè¿‡ç¼–è¯‘ã€‚å› ä¸º s2Val æ˜¯ä¸€ä¸ªå€¼ï¼Œè€Œ S2 çš„ f æ–¹æ³•ä¸­æ²¡æœ‰ä½¿ç”¨å€¼æ¥æ”¶å™¨</span>
<span class="token comment">//   i = s2Val</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><a href="https://golang.org/doc/effective_go.html" target="_blank" rel="noopener noreferrer">Effective Go</a> ä¸­æœ‰ä¸€æ®µå…³äº <a href="https://golang.org/doc/effective_go.html#pointers_vs_values" target="_blank" rel="noopener noreferrer">pointers vs. values</a> çš„ç²¾å½©è®²è§£ã€‚</p><p>è¡¥å……ï¼š</p><ul><li>ä¸€ä¸ªç±»å‹å¯ä»¥æœ‰å€¼æ¥æ”¶å™¨æ–¹æ³•é›†å’ŒæŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›† <ul><li>å€¼æ¥æ”¶å™¨æ–¹æ³•é›†æ˜¯æŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†çš„å­é›†ï¼Œåä¹‹ä¸æ˜¯</li></ul></li><li>è§„åˆ™ <ul><li>å€¼å¯¹è±¡åªå¯ä»¥ä½¿ç”¨å€¼æ¥æ”¶å™¨æ–¹æ³•é›†</li><li>æŒ‡é’ˆå¯¹è±¡å¯ä»¥ä½¿ç”¨ å€¼æ¥æ”¶å™¨æ–¹æ³•é›† + æŒ‡é’ˆæ¥æ”¶å™¨æ–¹æ³•é›†</li></ul></li><li>æ¥å£çš„åŒ¹é… (æˆ–è€…å«å®ç°) <ul><li>ç±»å‹å®ç°äº†æ¥å£çš„æ‰€æœ‰æ–¹æ³•ï¼Œå«åŒ¹é…</li><li>å…·ä½“çš„è®²ï¼Œè¦ä¹ˆæ˜¯ç±»å‹çš„å€¼æ–¹æ³•é›†åŒ¹é…æ¥å£ï¼Œè¦ä¹ˆæ˜¯æŒ‡é’ˆæ–¹æ³•é›†åŒ¹é…æ¥å£</li></ul></li></ul><p>å…·ä½“çš„åŒ¹é…åˆ†ä¸¤ç§ï¼š</p><ul><li>å€¼æ–¹æ³•é›†å’Œæ¥å£åŒ¹é… <ul><li>ç»™æ¥å£å˜é‡èµ‹å€¼çš„ä¸ç®¡æ˜¯å€¼è¿˜æ˜¯æŒ‡é’ˆå¯¹è±¡ï¼Œéƒ½ okï¼Œå› ä¸ºéƒ½åŒ…å«å€¼æ–¹æ³•é›†</li></ul></li><li>æŒ‡é’ˆæ–¹æ³•é›†å’Œæ¥å£åŒ¹é… <ul><li>åªèƒ½å°†æŒ‡é’ˆå¯¹è±¡èµ‹å€¼ç»™æ¥å£å˜é‡ï¼Œå› ä¸ºåªæœ‰æŒ‡é’ˆæ–¹æ³•é›†å’Œæ¥å£åŒ¹é…</li><li>å¦‚æœå°†å€¼å¯¹è±¡èµ‹å€¼ç»™æ¥å£å˜é‡ï¼Œä¼šåœ¨ç¼–è¯‘æœŸæŠ¥é”™ (ä¼šè§¦å‘æ¥å£åˆç†æ€§æ£€æŸ¥æœºåˆ¶)</li></ul></li></ul><p>ä¸ºå•¥ i = s2Val ä¼šæŠ¥é”™ï¼Œå› ä¸ºå€¼æ–¹æ³•é›†å’Œæ¥å£ä¸åŒ¹é…ã€‚</p><h3 id="é›¶å€¼-mutex-æ˜¯æœ‰æ•ˆçš„" tabindex="-1"><a class="header-anchor" href="#é›¶å€¼-mutex-æ˜¯æœ‰æ•ˆçš„"><span>é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</span></a></h3><p>é›¶å€¼ <code>sync.Mutex</code> å’Œ <code>sync.RWMutex</code> æ˜¯æœ‰æ•ˆçš„ã€‚æ‰€ä»¥æŒ‡å‘ mutex çš„æŒ‡é’ˆåŸºæœ¬æ˜¯ä¸å¿…è¦çš„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>mu <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>sync<span class="token punctuation">.</span>Mutex<span class="token punctuation">)</span>
mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> mu sync<span class="token punctuation">.</span>Mutex
mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¦‚æœä½ ä½¿ç”¨ç»“æ„ä½“æŒ‡é’ˆï¼Œmutex åº”è¯¥ä½œä¸ºç»“æ„ä½“çš„éæŒ‡é’ˆå­—æ®µã€‚å³ä½¿è¯¥ç»“æ„ä½“ä¸è¢«å¯¼å‡ºï¼Œä¹Ÿä¸è¦ç›´æ¥æŠŠ mutex åµŒå…¥åˆ°ç»“æ„ä½“ä¸­ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> SMap <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  sync<span class="token punctuation">.</span>Mutex

  data <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewSMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>SMap <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>SMap<span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>SMap<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  m<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> m<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> m<span class="token punctuation">.</span>data<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> SMap <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  mu sync<span class="token punctuation">.</span>Mutex

  data <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">NewSMap</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>SMap <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>SMap<span class="token punctuation">{</span>
    data<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>m <span class="token operator">*</span>SMap<span class="token punctuation">)</span> <span class="token function">Get</span><span class="token punctuation">(</span>k <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> m<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> m<span class="token punctuation">.</span>data<span class="token punctuation">[</span>k<span class="token punctuation">]</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><p><code>Mutex</code> å­—æ®µï¼Œ <code>Lock</code> å’Œ <code>Unlock</code> æ–¹æ³•æ˜¯ <code>SMap</code> å¯¼å‡ºçš„ API ä¸­ä¸åˆ»æ„è¯´æ˜çš„ä¸€éƒ¨åˆ†ã€‚</p></td><td><p>mutex åŠå…¶æ–¹æ³•æ˜¯ <code>SMap</code> çš„å®ç°ç»†èŠ‚ï¼Œå¯¹å…¶è°ƒç”¨è€…ä¸å¯è§ã€‚</p></td></tr></tbody></table><h3 id="åœ¨è¾¹ç•Œå¤„æ‹·è´-slices-å’Œ-maps" tabindex="-1"><a class="header-anchor" href="#åœ¨è¾¹ç•Œå¤„æ‹·è´-slices-å’Œ-maps"><span>åœ¨è¾¹ç•Œå¤„æ‹·è´ Slices å’Œ Maps</span></a></h3><p>slices å’Œ maps åŒ…å«äº†æŒ‡å‘åº•å±‚æ•°æ®çš„æŒ‡é’ˆï¼Œå› æ­¤åœ¨éœ€è¦å¤åˆ¶å®ƒä»¬æ—¶è¦ç‰¹åˆ«æ³¨æ„ã€‚</p><h4 id="æ¥æ”¶-slices-å’Œ-maps" tabindex="-1"><a class="header-anchor" href="#æ¥æ”¶-slices-å’Œ-maps"><span>æ¥æ”¶ Slices å’Œ Maps</span></a></h4><p>è¯·è®°ä½ï¼Œå½“ map æˆ– slice ä½œä¸ºå‡½æ•°å‚æ•°ä¼ å…¥æ—¶ï¼Œå¦‚æœæ‚¨å­˜å‚¨äº†å¯¹å®ƒä»¬çš„å¼•ç”¨ï¼Œåˆ™ç”¨æˆ·å¯ä»¥å¯¹å…¶è¿›è¡Œä¿®æ”¹ã€‚</p><table><thead><tr><th>Bad</th> <th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>Driver<span class="token punctuation">)</span> <span class="token function">SetTrips</span><span class="token punctuation">(</span>trips <span class="token punctuation">[</span><span class="token punctuation">]</span>Trip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  d<span class="token punctuation">.</span>trips <span class="token operator">=</span> trips
<span class="token punctuation">}</span>

trips <span class="token operator">:=</span> <span class="token operator">...</span>
d1<span class="token punctuation">.</span><span class="token function">SetTrips</span><span class="token punctuation">(</span>trips<span class="token punctuation">)</span>

<span class="token comment">// ä½ æ˜¯è¦ä¿®æ”¹ d1.trips å—ï¼Ÿ</span>
trips<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>d <span class="token operator">*</span>Driver<span class="token punctuation">)</span> <span class="token function">SetTrips</span><span class="token punctuation">(</span>trips <span class="token punctuation">[</span><span class="token punctuation">]</span>Trip<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  d<span class="token punctuation">.</span>trips <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>Trip<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>trips<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token function">copy</span><span class="token punctuation">(</span>d<span class="token punctuation">.</span>trips<span class="token punctuation">,</span> trips<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

trips <span class="token operator">:=</span> <span class="token operator">...</span>
d1<span class="token punctuation">.</span><span class="token function">SetTrips</span><span class="token punctuation">(</span>trips<span class="token punctuation">)</span>

<span class="token comment">// è¿™é‡Œæˆ‘ä»¬ä¿®æ”¹ trips[0]ï¼Œä½†ä¸ä¼šå½±å“åˆ° d1.trips</span>
trips<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token operator">...</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h4 id="è¿”å›-slices-æˆ–-maps" tabindex="-1"><a class="header-anchor" href="#è¿”å›-slices-æˆ–-maps"><span>è¿”å› slices æˆ– maps</span></a></h4><p>åŒæ ·ï¼Œè¯·æ³¨æ„ç”¨æˆ·å¯¹æš´éœ²å†…éƒ¨çŠ¶æ€çš„ map æˆ– slice çš„ä¿®æ”¹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Stats <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  mu sync<span class="token punctuation">.</span>Mutex

  counters <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token comment">// Snapshot è¿”å›å½“å‰çŠ¶æ€ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>Stats<span class="token punctuation">)</span> <span class="token function">Snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span>
  s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token keyword">return</span> s<span class="token punctuation">.</span>counters
<span class="token punctuation">}</span>

<span class="token comment">// snapshot ä¸å†å—äº’æ–¥é”ä¿æŠ¤</span>
<span class="token comment">// å› æ­¤å¯¹ snapshot çš„ä»»ä½•è®¿é—®éƒ½å°†å—åˆ°æ•°æ®ç«äº‰çš„å½±å“</span>
<span class="token comment">// å½±å“ stats.counters</span>
snapshot <span class="token operator">:=</span> stats<span class="token punctuation">.</span><span class="token function">Snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Stats <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  mu sync<span class="token punctuation">.</span>Mutex

  counters <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>Stats<span class="token punctuation">)</span> <span class="token function">Snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span> <span class="token punctuation">{</span>
  s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">defer</span> s<span class="token punctuation">.</span>mu<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

  result <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>counters<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> k<span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> s<span class="token punctuation">.</span>counters <span class="token punctuation">{</span>
    result<span class="token punctuation">[</span>k<span class="token punctuation">]</span> <span class="token operator">=</span> v
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> result
<span class="token punctuation">}</span>

<span class="token comment">// snapshot ç°åœ¨æ˜¯ä¸€ä¸ªæ‹·è´</span>
snapshot <span class="token operator">:=</span> stats<span class="token punctuation">.</span><span class="token function">Snapshot</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-defer-é‡Šæ”¾èµ„æº"><span>ä½¿ç”¨ defer é‡Šæ”¾èµ„æº</span></a></h3><p>ä½¿ç”¨ defer é‡Šæ”¾èµ„æºï¼Œè¯¸å¦‚æ–‡ä»¶å’Œé”ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>p<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> p<span class="token punctuation">.</span>count <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>
  p<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> p<span class="token punctuation">.</span>count
<span class="token punctuation">}</span>

p<span class="token punctuation">.</span>count<span class="token operator">++</span>
newCount <span class="token operator">:=</span> p<span class="token punctuation">.</span>count
p<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">return</span> newCount

<span class="token comment">// å½“æœ‰å¤šä¸ª return åˆ†æ”¯æ—¶ï¼Œå¾ˆå®¹æ˜“é—å¿˜ unlock</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>p<span class="token punctuation">.</span><span class="token function">Lock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">defer</span> p<span class="token punctuation">.</span><span class="token function">Unlock</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">if</span> p<span class="token punctuation">.</span>count <span class="token operator">&lt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> p<span class="token punctuation">.</span>count
<span class="token punctuation">}</span>

p<span class="token punctuation">.</span>count<span class="token operator">++</span>
<span class="token keyword">return</span> p<span class="token punctuation">.</span>count

<span class="token comment">// æ›´å¯è¯»</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>Defer çš„å¼€é”€éå¸¸å°ï¼Œåªæœ‰åœ¨æ‚¨å¯ä»¥è¯æ˜å‡½æ•°æ‰§è¡Œæ—¶é—´å¤„äºçº³ç§’çº§çš„ç¨‹åº¦æ—¶ï¼Œæ‰åº”é¿å…è¿™æ ·åšã€‚ä½¿ç”¨ defer æå‡å¯è¯»æ€§æ˜¯å€¼å¾—çš„ï¼Œå› ä¸ºä½¿ç”¨å®ƒä»¬çš„æˆæœ¬å¾®ä¸è¶³é“ã€‚å°¤å…¶é€‚ç”¨äºé‚£äº›ä¸ä»…ä»…æ˜¯ç®€å•å†…å­˜è®¿é—®çš„è¾ƒå¤§çš„æ–¹æ³•ï¼Œåœ¨è¿™äº›æ–¹æ³•ä¸­å…¶ä»–è®¡ç®—çš„èµ„æºæ¶ˆè€—è¿œè¶…è¿‡ <code>defer</code>ã€‚</p><h3 id="channel-çš„-size-è¦ä¹ˆæ˜¯-1-è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„" tabindex="-1"><a class="header-anchor" href="#channel-çš„-size-è¦ä¹ˆæ˜¯-1-è¦ä¹ˆæ˜¯æ— ç¼“å†²çš„"><span>Channel çš„ size è¦ä¹ˆæ˜¯ 1ï¼Œè¦ä¹ˆæ˜¯æ— ç¼“å†²çš„</span></a></h3><p>channel é€šå¸¸ size åº”ä¸º 1 æˆ–æ˜¯æ— ç¼“å†²çš„ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œchannel æ˜¯æ— ç¼“å†²çš„ï¼Œå…¶ size ä¸ºé›¶ã€‚ä»»ä½•å…¶ä»–å°ºå¯¸éƒ½å¿…é¡»ç»è¿‡ä¸¥æ ¼çš„å®¡æŸ¥ã€‚æˆ‘ä»¬éœ€è¦è€ƒè™‘å¦‚ä½•ç¡®å®šå¤§å°ï¼Œè€ƒè™‘æ˜¯ä»€ä¹ˆé˜»æ­¢äº† channel åœ¨é«˜è´Ÿè½½ä¸‹å’Œé˜»å¡å†™æ—¶çš„å†™å…¥ï¼Œä»¥åŠå½“è¿™ç§æƒ…å†µå‘ç”Ÿæ—¶ç³»ç»Ÿé€»è¾‘æœ‰å“ªäº›å˜åŒ–ã€‚(ç¿»è¯‘è§£é‡Šï¼šæŒ‰ç…§åŸæ–‡æ„æ€æ˜¯éœ€è¦ç•Œå®šé€šé“è¾¹ç•Œï¼Œç«æ€æ¡ä»¶ï¼Œä»¥åŠé€»è¾‘ä¸Šä¸‹æ–‡æ¢³ç†)</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// åº”è¯¥è¶³ä»¥æ»¡è¶³ä»»ä½•æƒ…å†µï¼</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">64</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// å¤§å°ï¼š1</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token comment">// æˆ–è€…</span>
<span class="token comment">// æ— ç¼“å†² channelï¼Œå¤§å°ä¸º 0</span>
c <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token builtin">int</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="æšä¸¾ä»-1-å¼€å§‹" tabindex="-1"><a class="header-anchor" href="#æšä¸¾ä»-1-å¼€å§‹"><span>æšä¸¾ä» 1 å¼€å§‹</span></a></h3><p>åœ¨ Go ä¸­å¼•å…¥æšä¸¾çš„æ ‡å‡†æ–¹æ³•æ˜¯å£°æ˜ä¸€ä¸ªè‡ªå®šä¹‰ç±»å‹å’Œä¸€ä¸ªä½¿ç”¨äº† iota çš„ const ç»„ã€‚ç”±äºå˜é‡çš„é»˜è®¤å€¼ä¸º 0ï¼Œå› æ­¤é€šå¸¸åº”ä»¥éé›¶å€¼å¼€å¤´æšä¸¾ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Operation <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  Add Operation <span class="token operator">=</span> <span class="token boolean">iota</span>
  Subtract
  Multiply
<span class="token punctuation">)</span>

<span class="token comment">// Add=0, Subtract=1, Multiply=2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Operation <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  Add Operation <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>
  Subtract
  Multiply
<span class="token punctuation">)</span>

<span class="token comment">// Add=1, Subtract=2, Multiply=3</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œä½¿ç”¨é›¶å€¼æ˜¯æœ‰æ„ä¹‰çš„ï¼ˆæšä¸¾ä»é›¶å¼€å§‹ï¼‰ï¼Œä¾‹å¦‚ï¼Œå½“é›¶å€¼æ˜¯ç†æƒ³çš„é»˜è®¤è¡Œä¸ºæ—¶ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> LogOutput <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  LogToStdout LogOutput <span class="token operator">=</span> <span class="token boolean">iota</span>
  LogToFile
  LogToRemote
<span class="token punctuation">)</span>

<span class="token comment">// LogToStdout=0, LogToFile=1, LogToRemote=2</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨-time-å¤„ç†æ—¶é—´" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-time-å¤„ç†æ—¶é—´"><span>ä½¿ç”¨ time å¤„ç†æ—¶é—´</span></a></h3><p>æ—¶é—´å¤„ç†å¾ˆå¤æ‚ã€‚å…³äºæ—¶é—´çš„é”™è¯¯å‡è®¾é€šå¸¸åŒ…æ‹¬ä»¥ä¸‹å‡ ç‚¹ã€‚</p><ol><li>ä¸€å¤©æœ‰ 24 å°æ—¶</li><li>ä¸€å°æ—¶æœ‰ 60 åˆ†é’Ÿ</li><li>ä¸€å‘¨æœ‰ä¸ƒå¤©</li><li>ä¸€å¹´ 365 å¤©</li><li><a href="https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time" target="_blank" rel="noopener noreferrer">è¿˜æœ‰æ›´å¤š</a></li></ol><p>ä¾‹å¦‚ï¼Œ<em>1</em> è¡¨ç¤ºåœ¨ä¸€ä¸ªæ—¶é—´ç‚¹ä¸ŠåŠ ä¸Š 24 å°æ—¶å¹¶ä¸æ€»æ˜¯äº§ç”Ÿä¸€ä¸ªæ–°çš„æ—¥å†æ—¥ã€‚</p><p>å› æ­¤ï¼Œåœ¨å¤„ç†æ—¶é—´æ—¶å§‹ç»ˆä½¿ç”¨ <a href="https://golang.org/pkg/time/" target="_blank" rel="noopener noreferrer"><code>&quot;time&quot;</code></a> åŒ…ï¼Œå› ä¸ºå®ƒæœ‰åŠ©äºä»¥æ›´å®‰å…¨ã€æ›´å‡†ç¡®çš„æ–¹å¼å¤„ç†è¿™äº›ä¸æ­£ç¡®çš„å‡è®¾ã€‚</p><h4 id="ä½¿ç”¨-time-time-è¡¨è¾¾ç¬æ—¶æ—¶é—´" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-time-time-è¡¨è¾¾ç¬æ—¶æ—¶é—´"><span>ä½¿ç”¨ <code>time.Time</code> è¡¨è¾¾ç¬æ—¶æ—¶é—´</span></a></h4><p>åœ¨å¤„ç†æ—¶é—´çš„ç¬é—´æ—¶ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Time" target="_blank" rel="noopener noreferrer"><code>time.Time</code></a>ï¼Œåœ¨æ¯”è¾ƒã€æ·»åŠ æˆ–å‡å»æ—¶é—´æ—¶ä½¿ç”¨ <code>time.Time</code> ä¸­çš„æ–¹æ³•ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">isActive</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> start<span class="token punctuation">,</span> stop <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> start <span class="token operator">&lt;=</span> now <span class="token operator">&amp;&amp;</span> now <span class="token operator">&lt;</span> stop
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">isActive</span><span class="token punctuation">(</span>now<span class="token punctuation">,</span> start<span class="token punctuation">,</span> stop time<span class="token punctuation">.</span>Time<span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">(</span>start<span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span> <span class="token operator">||</span> start<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>now<span class="token punctuation">)</span><span class="token punctuation">)</span> <span class="token operator">&amp;&amp;</span> now<span class="token punctuation">.</span><span class="token function">Before</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h4 id="ä½¿ç”¨-time-duration-è¡¨è¾¾æ—¶é—´æ®µ" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-time-duration-è¡¨è¾¾æ—¶é—´æ®µ"><span>ä½¿ç”¨ <code>time.Duration</code> è¡¨è¾¾æ—¶é—´æ®µ</span></a></h4><p>åœ¨å¤„ç†æ—¶é—´æ®µæ—¶ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Duration" target="_blank" rel="noopener noreferrer"><code>time.Duration</code></a> .</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">poll</span><span class="token punctuation">(</span>delay <span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>time<span class="token punctuation">.</span><span class="token function">Duration</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Millisecond<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span> <span class="token comment">// æ˜¯å‡ ç§’é’Ÿè¿˜æ˜¯å‡ æ¯«ç§’ï¼Ÿ</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">poll</span><span class="token punctuation">(</span>delay time<span class="token punctuation">.</span>Duration<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token function">poll</span><span class="token punctuation">(</span><span class="token number">10</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å›åˆ°ç¬¬ä¸€ä¸ªä¾‹å­ï¼Œåœ¨ä¸€ä¸ªæ—¶é—´ç¬é—´åŠ ä¸Š 24 å°æ—¶ï¼Œæˆ‘ä»¬ç”¨äºæ·»åŠ æ—¶é—´çš„æ–¹æ³•å–å†³äºæ„å›¾ã€‚å¦‚æœæˆ‘ä»¬æƒ³è¦ä¸‹ä¸€ä¸ªæ—¥å†æ—¥ (å½“å‰å¤©çš„ä¸‹ä¸€å¤©) çš„åŒä¸€ä¸ªæ—¶é—´ç‚¹ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Time.AddDate" target="_blank" rel="noopener noreferrer"><code>Time.AddDate</code></a>ã€‚ä½†æ˜¯ï¼Œå¦‚æœæˆ‘ä»¬æƒ³ä¿è¯æŸä¸€æ—¶åˆ»æ¯”å‰ä¸€æ—¶åˆ»æ™š 24 å°æ—¶ï¼Œæˆ‘ä»¬åº”è¯¥ä½¿ç”¨ <a href="https://golang.org/pkg/time/#Time.Add" target="_blank" rel="noopener noreferrer"><code>Time.Add</code></a>ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>newDay <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">AddDate</span><span class="token punctuation">(</span><span class="token number">0</span> <span class="token comment">/* years */</span><span class="token punctuation">,</span> <span class="token number">0</span> <span class="token comment">/* months */</span><span class="token punctuation">,</span> <span class="token number">1</span> <span class="token comment">/* days */</span><span class="token punctuation">)</span>
maybeNewDay <span class="token operator">:=</span> t<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">24</span> <span class="token operator">*</span> time<span class="token punctuation">.</span>Hour<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨-time-time-å’Œ-time-duration" tabindex="-1"><a class="header-anchor" href="#å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨-time-time-å’Œ-time-duration"><span>å¯¹å¤–éƒ¨ç³»ç»Ÿä½¿ç”¨ <code>time.Time</code> å’Œ <code>time.Duration</code></span></a></h4><p>å°½å¯èƒ½åœ¨ä¸å¤–éƒ¨ç³»ç»Ÿçš„äº¤äº’ä¸­ä½¿ç”¨ <code>time.Duration</code> å’Œ <code>time.Time</code> ä¾‹å¦‚ :</p><ul><li><p>Command-line æ ‡å¿—: <a href="https://golang.org/pkg/flag/" target="_blank" rel="noopener noreferrer"><code>flag</code></a> é€šè¿‡ <a href="https://golang.org/pkg/time/#ParseDuration" target="_blank" rel="noopener noreferrer"><code>time.ParseDuration</code></a> æ”¯æŒ <code>time.Duration</code></p></li><li><p>JSON: <a href="https://golang.org/pkg/encoding/json/" target="_blank" rel="noopener noreferrer"><code>encoding/json</code></a> é€šè¿‡å…¶ <a href="https://golang.org/pkg/time/#Time.UnmarshalJSON" target="_blank" rel="noopener noreferrer"><code>UnmarshalJSON</code> method</a> æ–¹æ³•æ”¯æŒå°† <code>time.Time</code> ç¼–ç ä¸º <a href="https://tools.ietf.org/html/rfc3339" target="_blank" rel="noopener noreferrer">RFC 3339</a> å­—ç¬¦ä¸²</p></li><li><p>SQL: <a href="https://golang.org/pkg/database/sql/" target="_blank" rel="noopener noreferrer"><code>database/sql</code></a> æ”¯æŒå°† <code>DATETIME</code> æˆ– <code>TIMESTAMP</code> åˆ—è½¬æ¢ä¸º <code>time.Time</code>ï¼Œå¦‚æœåº•å±‚é©±åŠ¨ç¨‹åºæ”¯æŒåˆ™è¿”å›</p></li><li><p>YAML: <a href="https://godoc.org/gopkg.in/yaml.v2" target="_blank" rel="noopener noreferrer"><code>gopkg.in/yaml.v2</code></a> æ”¯æŒå°† <code>time.Time</code> ä½œä¸º <a href="https://tools.ietf.org/html/rfc3339" target="_blank" rel="noopener noreferrer">RFC 3339</a> å­—ç¬¦ä¸²ï¼Œå¹¶é€šè¿‡ <a href="https://golang.org/pkg/time/#ParseDuration" target="_blank" rel="noopener noreferrer"><code>time.ParseDuration</code></a> æ”¯æŒ <code>time.Duration</code>ã€‚</p></li></ul><p>å½“ä¸èƒ½åœ¨è¿™äº›äº¤äº’ä¸­ä½¿ç”¨ <code>time.Duration</code> æ—¶ï¼Œè¯·ä½¿ç”¨ <code>int</code> æˆ– <code>float64</code>ï¼Œå¹¶åœ¨å­—æ®µåç§°ä¸­åŒ…å«å•ä½ã€‚</p><p>ä¾‹å¦‚ï¼Œç”±äº <code>encoding/json</code> ä¸æ”¯æŒ <code>time.Duration</code>ï¼Œå› æ­¤è¯¥å•ä½åŒ…å«åœ¨å­—æ®µçš„åç§°ä¸­ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// {&quot;interval&quot;: 2}</span>
<span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Interval <span class="token builtin">int</span> <span class="token string">`json:&quot;interval&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// {&quot;intervalMillis&quot;: 2000}</span>
<span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  IntervalMillis <span class="token builtin">int</span> <span class="token string">`json:&quot;intervalMillis&quot;`</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å½“åœ¨è¿™äº›äº¤äº’ä¸­ä¸èƒ½ä½¿ç”¨ <code>time.Time</code> æ—¶ï¼Œé™¤éè¾¾æˆä¸€è‡´ï¼Œå¦åˆ™ä½¿ç”¨ <code>string</code> å’Œ <a href="https://tools.ietf.org/html/rfc3339" target="_blank" rel="noopener noreferrer">RFC 3339</a> ä¸­å®šä¹‰çš„æ ¼å¼æ—¶é—´æˆ³ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œ<a href="https://golang.org/pkg/time/#Time.UnmarshalText" target="_blank" rel="noopener noreferrer"><code>Time.UnmarshalText</code></a> ä½¿ç”¨æ­¤æ ¼å¼ï¼Œå¹¶å¯é€šè¿‡ <a href="https://golang.org/pkg/time/#RFC3339" target="_blank" rel="noopener noreferrer"><code>time.RFC3339</code></a> åœ¨ <code>Time.Format</code> å’Œ <code>time.Parse</code> ä¸­ä½¿ç”¨ã€‚</p><p>å°½ç®¡è¿™åœ¨å®è·µä¸­å¹¶ä¸æˆé—®é¢˜ï¼Œä½†è¯·è®°ä½ï¼Œ<code>&quot;time&quot;</code> åŒ…ä¸æ”¯æŒè§£æé—°ç§’æ—¶é—´æˆ³ï¼ˆ<a href="https://github.com/golang/go/issues/8728" target="_blank" rel="noopener noreferrer">8728</a>ï¼‰ï¼Œä¹Ÿä¸åœ¨è®¡ç®—ä¸­è€ƒè™‘é—°ç§’ï¼ˆ<a href="https://github.com/golang/go/issues/15190" target="_blank" rel="noopener noreferrer">15190</a>ï¼‰ã€‚å¦‚æœæ‚¨æ¯”è¾ƒä¸¤ä¸ªæ—¶é—´ç¬é—´ï¼Œåˆ™å·®å¼‚å°†ä¸åŒ…æ‹¬è¿™ä¸¤ä¸ªç¬é—´ä¹‹é—´å¯èƒ½å‘ç”Ÿçš„é—°ç§’ã€‚</p><!-- TODO: section on String methods for enums --><h3 id="errors" tabindex="-1"><a class="header-anchor" href="#errors"><span>Errors</span></a></h3><h4 id="é”™è¯¯ç±»å‹" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯ç±»å‹"><span>é”™è¯¯ç±»å‹</span></a></h4><p>å£°æ˜é”™è¯¯çš„é€‰é¡¹å¾ˆå°‘ã€‚ åœ¨é€‰æ‹©æœ€é€‚åˆæ‚¨çš„ç”¨ä¾‹çš„é€‰é¡¹ä¹‹å‰ï¼Œè¯·è€ƒè™‘ä»¥ä¸‹äº‹é¡¹ã€‚</p><ul><li>è°ƒç”¨è€…æ˜¯å¦éœ€è¦åŒ¹é…é”™è¯¯ä»¥ä¾¿ä»–ä»¬å¯ä»¥å¤„ç†å®ƒï¼Ÿ å¦‚æœæ˜¯ï¼Œæˆ‘ä»¬å¿…é¡»é€šè¿‡å£°æ˜é¡¶çº§é”™è¯¯å˜é‡æˆ–è‡ªå®šä¹‰ç±»å‹æ¥æ”¯æŒ <a href="https://golang.org/pkg/errors/#Is" target="_blank" rel="noopener noreferrer"><code>errors.Is</code></a> æˆ– <a href="https://golang.org/pkg/errors/#As" target="_blank" rel="noopener noreferrer"><code>errors.As</code></a> å‡½æ•°ã€‚</li><li>é”™è¯¯æ¶ˆæ¯æ˜¯å¦ä¸ºé™æ€å­—ç¬¦ä¸²ï¼Œè¿˜æ˜¯éœ€è¦ä¸Šä¸‹æ–‡ä¿¡æ¯çš„åŠ¨æ€å­—ç¬¦ä¸²ï¼Ÿ å¦‚æœæ˜¯é™æ€å­—ç¬¦ä¸²ï¼Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨ <a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener noreferrer"><code>errors.New</code></a>ï¼Œä½†å¯¹äºåè€…ï¼Œæˆ‘ä»¬å¿…é¡»ä½¿ç”¨ <a href="https://golang.org/pkg/fmt/#Errorf" target="_blank" rel="noopener noreferrer"><code>fmt.Errorf</code></a> æˆ–è‡ªå®šä¹‰é”™è¯¯ç±»å‹ã€‚</li><li>æˆ‘ä»¬æ˜¯å¦æ­£åœ¨ä¼ é€’ç”±ä¸‹æ¸¸å‡½æ•°è¿”å›çš„æ–°é”™è¯¯ï¼Ÿ å¦‚æœæ˜¯è¿™æ ·ï¼Œè¯·å‚é˜…<a href="#%E9%94%99%E8%AF%AF%E5%8C%85%E8%A3%85">é”™è¯¯åŒ…è£…éƒ¨åˆ†</a>ã€‚</li></ul><table><thead><tr><th>é”™è¯¯åŒ¹é…ï¼Ÿ</th><th>é”™è¯¯æ¶ˆæ¯</th><th>æŒ‡å¯¼</th></tr></thead><tbody><tr><td>No</td><td>static</td><td><a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener noreferrer"><code>errors.New</code></a></td></tr><tr><td>No</td><td>dynamic</td><td><a href="https://golang.org/pkg/fmt/#Errorf" target="_blank" rel="noopener noreferrer"><code>fmt.Errorf</code></a></td></tr><tr><td>Yes</td><td>static</td><td>top-level <code>var</code> with <a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener noreferrer"><code>errors.New</code></a></td></tr><tr><td>Yes</td><td>dynamic</td><td>custom <code>error</code> type</td></tr></tbody></table><p>ä¾‹å¦‚ï¼Œ ä½¿ç”¨ <a href="https://golang.org/pkg/errors/#New" target="_blank" rel="noopener noreferrer"><code>errors.New</code></a> è¡¨ç¤ºå¸¦æœ‰é™æ€å­—ç¬¦ä¸²çš„é”™è¯¯ã€‚ å¦‚æœè°ƒç”¨è€…éœ€è¦åŒ¹é…å¹¶å¤„ç†æ­¤é”™è¯¯ï¼Œåˆ™å°†æ­¤é”™è¯¯å¯¼å‡ºä¸ºå˜é‡ä»¥æ”¯æŒå°†å…¶ä¸ <code>errors.Is</code> åŒ¹é…ã€‚</p><table><thead><tr><th>æ— é”™è¯¯åŒ¹é…</th><th>é”™è¯¯åŒ¹é…</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// package foo</span>

<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;could not open&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// package bar</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> foo<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token comment">// Can&#39;t handle the error.</span>
  <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;unknown error&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// package foo</span>

<span class="token keyword">var</span> ErrCouldNotOpen <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;could not open&quot;</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> ErrCouldNotOpen
<span class="token punctuation">}</span>

<span class="token comment">// package bar</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> foo<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">Is</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> foo<span class="token punctuation">.</span>ErrCouldNotOpen<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// handle the error</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;unknown error&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¯¹äºåŠ¨æ€å­—ç¬¦ä¸²çš„é”™è¯¯ï¼Œ å¦‚æœè°ƒç”¨è€…ä¸éœ€è¦åŒ¹é…å®ƒï¼Œåˆ™ä½¿ç”¨ <a href="https://golang.org/pkg/fmt/#Errorf" target="_blank" rel="noopener noreferrer"><code>fmt.Errorf</code></a>ï¼Œ å¦‚æœè°ƒç”¨è€…ç¡®å®éœ€è¦åŒ¹é…å®ƒï¼Œåˆ™è‡ªå®šä¹‰ <code>error</code>ã€‚</p><table><thead><tr><th>æ— é”™è¯¯åŒ¹é…</th><th>é”™è¯¯åŒ¹é…</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// package foo</span>

<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>file <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span><span class="token string">&quot;file %q not found&quot;</span><span class="token punctuation">,</span> file<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// package bar</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> foo<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;testfile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token comment">// Can&#39;t handle the error.</span>
  <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;unknown error&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// package foo</span>

<span class="token keyword">type</span> NotFoundError <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  File <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>NotFoundError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;file %q not found&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>File<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>file <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>NotFoundError<span class="token punctuation">{</span>File<span class="token punctuation">:</span> file<span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token comment">// package bar</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> foo<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span><span class="token string">&quot;testfile.txt&quot;</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> notFound <span class="token operator">*</span>NotFoundError
  <span class="token keyword">if</span> errors<span class="token punctuation">.</span><span class="token function">As</span><span class="token punctuation">(</span>err<span class="token punctuation">,</span> <span class="token operator">&amp;</span>notFound<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// handle the error</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;unknown error&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>è¯·æ³¨æ„ï¼Œå¦‚æœæ‚¨ä»åŒ…ä¸­å¯¼å‡ºé”™è¯¯å˜é‡æˆ–ç±»å‹ï¼Œ å®ƒä»¬å°†æˆä¸ºåŒ…çš„å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚</p><h4 id="é”™è¯¯åŒ…è£…" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯åŒ…è£…"><span>é”™è¯¯åŒ…è£…</span></a></h4><p>å¦‚æœè°ƒç”¨å…¶ä»–æ–¹æ³•æ—¶å‡ºç°é”™è¯¯, é€šå¸¸æœ‰ä¸‰ç§å¤„ç†æ–¹å¼å¯ä»¥é€‰æ‹©ï¼š</p><ul><li>å°†åŸå§‹é”™è¯¯åŸæ ·è¿”å›</li><li>ä½¿ç”¨ <code>fmt.Errorf</code> æ­é… <code>%w</code> å°†é”™è¯¯æ·»åŠ è¿›ä¸Šä¸‹æ–‡åè¿”å›</li><li>ä½¿ç”¨ <code>fmt.Errorf</code> æ­é… <code>%v</code> å°†é”™è¯¯æ·»åŠ è¿›ä¸Šä¸‹æ–‡åè¿”å›</li></ul><p>å¦‚æœæ²¡æœ‰è¦æ·»åŠ çš„å…¶ä»–ä¸Šä¸‹æ–‡ï¼Œåˆ™æŒ‰åŸæ ·è¿”å›åŸå§‹é”™è¯¯ã€‚ è¿™å°†ä¿ç•™åŸå§‹é”™è¯¯ç±»å‹å’Œæ¶ˆæ¯ã€‚ è¿™éå¸¸é€‚åˆåº•å±‚é”™è¯¯æ¶ˆæ¯æœ‰è¶³å¤Ÿçš„ä¿¡æ¯æ¥è¿½è¸ªå®ƒæ¥è‡ªå“ªé‡Œçš„é”™è¯¯ã€‚</p><p>å¦åˆ™ï¼Œå°½å¯èƒ½åœ¨é”™è¯¯æ¶ˆæ¯ä¸­æ·»åŠ ä¸Šä¸‹æ–‡ è¿™æ ·å°±ä¸ä¼šå‡ºç°è¯¸å¦‚â€œè¿æ¥è¢«æ‹’ç»â€ä¹‹ç±»çš„æ¨¡ç³Šé”™è¯¯ï¼Œ æ‚¨ä¼šæ”¶åˆ°æ›´å¤šæœ‰ç”¨çš„é”™è¯¯ï¼Œä¾‹å¦‚â€œè°ƒç”¨æœåŠ¡ fooï¼šè¿æ¥è¢«æ‹’ç»â€ã€‚</p><p>ä½¿ç”¨ <code>fmt.Errorf</code> ä¸ºä½ çš„é”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡ï¼Œ æ ¹æ®è°ƒç”¨è€…æ˜¯å¦åº”è¯¥èƒ½å¤ŸåŒ¹é…å’Œæå–æ ¹æœ¬åŸå› ï¼Œåœ¨ <code>%w</code> æˆ– <code>%v</code> åŠ¨è¯ä¹‹é—´è¿›è¡Œé€‰æ‹©ã€‚</p><ul><li>å¦‚æœè°ƒç”¨è€…åº”è¯¥å¯ä»¥è®¿é—®åº•å±‚é”™è¯¯ï¼Œè¯·ä½¿ç”¨ <code>%w</code>ã€‚ å¯¹äºå¤§å¤šæ•°åŒ…è£…é”™è¯¯ï¼Œè¿™æ˜¯ä¸€ä¸ªå¾ˆå¥½çš„é»˜è®¤å€¼ï¼Œ ä½†è¯·æ³¨æ„ï¼Œè°ƒç”¨è€…å¯èƒ½ä¼šå¼€å§‹ä¾èµ–æ­¤è¡Œä¸ºã€‚å› æ­¤ï¼Œå¯¹äºåŒ…è£…é”™è¯¯æ˜¯å·²çŸ¥<code>var</code>æˆ–ç±»å‹çš„æƒ…å†µï¼Œè¯·å°†å…¶ä½œä¸ºå‡½æ•°å¥‘çº¦çš„ä¸€éƒ¨åˆ†è¿›è¡Œè®°å½•å’Œæµ‹è¯•ã€‚</li><li>ä½¿ç”¨ <code>%v</code> æ¥æ··æ·†åº•å±‚é”™è¯¯ã€‚ è°ƒç”¨è€…å°†æ— æ³•åŒ¹é…å®ƒï¼Œä½†å¦‚æœéœ€è¦ï¼Œæ‚¨å¯ä»¥åœ¨å°†æ¥åˆ‡æ¢åˆ° <code>%w</code>ã€‚</li></ul><p>åœ¨ä¸ºè¿”å›çš„é”™è¯¯æ·»åŠ ä¸Šä¸‹æ–‡æ—¶ï¼Œé€šè¿‡é¿å…ä½¿ç”¨&quot;failed to&quot;ä¹‹ç±»çš„çŸ­è¯­æ¥ä¿æŒä¸Šä¸‹æ–‡ç®€æ´ï¼Œå½“é”™è¯¯é€šè¿‡å †æ ˆå‘ä¸Šæ¸—é€æ—¶ï¼Œå®ƒä¼šä¸€å±‚ä¸€å±‚è¢«å †ç§¯èµ·æ¥ï¼š</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>s<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>
        <span class="token string">&quot;failed to create new store: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>s<span class="token punctuation">,</span> err <span class="token operator">:=</span> store<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Errorf</span><span class="token punctuation">(</span>
        <span class="token string">&quot;new store: %w&quot;</span><span class="token punctuation">,</span> err<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>failed to x: failed to y: failed to create new store: the error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>x: y: new store: the error
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><p>ç„¶è€Œï¼Œä¸€æ—¦é”™è¯¯è¢«å‘é€åˆ°å¦ä¸€ä¸ªç³»ç»Ÿï¼Œåº”è¯¥æ¸…æ¥šæ¶ˆæ¯æ˜¯ä¸€ä¸ªé”™è¯¯ï¼ˆä¾‹å¦‚<code>err</code> æ ‡ç­¾æˆ–æ—¥å¿—ä¸­çš„&quot;Failed&quot;å‰ç¼€ï¼‰ã€‚</p><p>å¦è§ <a href="https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully" target="_blank" rel="noopener noreferrer">ä¸è¦åªæ£€æŸ¥é”™è¯¯ï¼Œä¼˜é›…åœ°å¤„ç†å®ƒä»¬</a>ã€‚</p><h4 id="é”™è¯¯å‘½å" tabindex="-1"><a class="header-anchor" href="#é”™è¯¯å‘½å"><span>é”™è¯¯å‘½å</span></a></h4><p>å¯¹äºå­˜å‚¨ä¸ºå…¨å±€å˜é‡çš„é”™è¯¯å€¼ï¼Œ æ ¹æ®æ˜¯å¦å¯¼å‡ºï¼Œä½¿ç”¨å‰ç¼€ <code>Err</code> æˆ– <code>err</code>ã€‚ è¯·çœ‹æŒ‡å— <a href="#%E5%AF%B9%E4%BA%8E%E6%9C%AA%E5%AF%BC%E5%87%BA%E7%9A%84%E9%A1%B6%E5%B1%82%E5%B8%B8%E9%87%8F%E5%92%8C%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8_%E4%BD%9C%E4%B8%BA%E5%89%8D%E7%BC%80">å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</a>ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  <span class="token comment">// å¯¼å‡ºä»¥ä¸‹ä¸¤ä¸ªé”™è¯¯ï¼Œä»¥ä¾¿æ­¤åŒ…çš„ç”¨æˆ·å¯ä»¥å°†å®ƒä»¬ä¸ errors.Is è¿›è¡ŒåŒ¹é…ã€‚</span>

  ErrBrokenLink <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;link is broken&quot;</span><span class="token punctuation">)</span>
  ErrCouldNotOpen <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;could not open&quot;</span><span class="token punctuation">)</span>

  <span class="token comment">// è¿™ä¸ªé”™è¯¯æ²¡æœ‰è¢«å¯¼å‡ºï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©å®ƒæˆä¸ºæˆ‘ä»¬å…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬å¯èƒ½ä»ç„¶åœ¨å¸¦æœ‰é”™è¯¯çš„åŒ…å†…ä½¿ç”¨å®ƒã€‚</span>

  errNotFound <span class="token operator">=</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;not found&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¯¹äºè‡ªå®šä¹‰é”™è¯¯ç±»å‹ï¼Œè¯·æ”¹ç”¨åç¼€ <code>Error</code>ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// åŒæ ·ï¼Œè¿™ä¸ªé”™è¯¯è¢«å¯¼å‡ºï¼Œä»¥ä¾¿è¿™ä¸ªåŒ…çš„ç”¨æˆ·å¯ä»¥å°†å®ƒä¸ errors.As åŒ¹é…ã€‚</span>

<span class="token keyword">type</span> NotFoundError <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  File <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>NotFoundError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;file %q not found&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>File<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// å¹¶ä¸”è¿™ä¸ªé”™è¯¯æ²¡æœ‰è¢«å¯¼å‡ºï¼Œå› ä¸ºæˆ‘ä»¬ä¸æƒ³è®©å®ƒæˆä¸ºå…¬å…± API çš„ä¸€éƒ¨åˆ†ã€‚ æˆ‘ä»¬ä»ç„¶å¯ä»¥åœ¨å¸¦æœ‰ errors.As çš„åŒ…ä¸­ä½¿ç”¨å®ƒã€‚</span>
<span class="token keyword">type</span> resolveError <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Path <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>e <span class="token operator">*</span>resolveError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> fmt<span class="token punctuation">.</span><span class="token function">Sprintf</span><span class="token punctuation">(</span><span class="token string">&quot;resolve %q&quot;</span><span class="token punctuation">,</span> e<span class="token punctuation">.</span>Path<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¤„ç†æ–­è¨€å¤±è´¥" tabindex="-1"><a class="header-anchor" href="#å¤„ç†æ–­è¨€å¤±è´¥"><span>å¤„ç†æ–­è¨€å¤±è´¥</span></a></h3><p><a href="https://golang.org/ref/spec#Type_assertions" target="_blank" rel="noopener noreferrer">ç±»å‹æ–­è¨€</a> å°†ä¼šåœ¨æ£€æµ‹åˆ°ä¸æ­£ç¡®çš„ç±»å‹æ—¶ï¼Œä»¥å•ä¸€è¿”å›å€¼å½¢å¼è¿”å› panicã€‚ å› æ­¤ï¼Œè¯·å§‹ç»ˆä½¿ç”¨â€œé€—å· okâ€ä¹ è¯­ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>t <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>t<span class="token punctuation">,</span> ok <span class="token operator">:=</span> i<span class="token punctuation">.</span><span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> <span class="token operator">!</span>ok <span class="token punctuation">{</span>
  <span class="token comment">// ä¼˜é›…åœ°å¤„ç†é”™è¯¯</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><!-- TODO: There are a few situations where the single assignment form is
fine. --><h3 id="ä¸è¦ä½¿ç”¨-panic" tabindex="-1"><a class="header-anchor" href="#ä¸è¦ä½¿ç”¨-panic"><span>ä¸è¦ä½¿ç”¨ panic</span></a></h3><p>åœ¨ç”Ÿäº§ç¯å¢ƒä¸­è¿è¡Œçš„ä»£ç å¿…é¡»é¿å…å‡ºç° panicã€‚panic æ˜¯ <a href="https://en.wikipedia.org/wiki/Cascading_failure" target="_blank" rel="noopener noreferrer">çº§è”å¤±è´¥</a> çš„ä¸»è¦æ ¹æº ã€‚å¦‚æœå‘ç”Ÿé”™è¯¯ï¼Œè¯¥å‡½æ•°å¿…é¡»è¿”å›é”™è¯¯ï¼Œå¹¶å…è®¸è°ƒç”¨æ–¹å†³å®šå¦‚ä½•å¤„ç†å®ƒã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">run</span><span class="token punctuation">(</span>args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;an argument is required&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">run</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">run</span><span class="token punctuation">(</span>args <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;an argument is required&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">run</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    fmt<span class="token punctuation">.</span><span class="token function">Fprintln</span><span class="token punctuation">(</span>os<span class="token punctuation">.</span>Stderr<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    os<span class="token punctuation">.</span><span class="token function">Exit</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>panic/recover ä¸æ˜¯é”™è¯¯å¤„ç†ç­–ç•¥ã€‚ä»…å½“å‘ç”Ÿä¸å¯æ¢å¤çš„äº‹æƒ…ï¼ˆä¾‹å¦‚ï¼šnil å¼•ç”¨ï¼‰æ—¶ï¼Œç¨‹åºæ‰å¿…é¡» panicã€‚ç¨‹åºåˆå§‹åŒ–æ˜¯ä¸€ä¸ªä¾‹å¤–ï¼šç¨‹åºå¯åŠ¨æ—¶åº”ä½¿ç¨‹åºä¸­æ­¢çš„ä¸è‰¯æƒ…å†µå¯èƒ½ä¼šå¼•èµ· panicã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> _statusTemplate <span class="token operator">=</span> template<span class="token punctuation">.</span><span class="token function">Must</span><span class="token punctuation">(</span>template<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;name&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span><span class="token function">Parse</span><span class="token punctuation">(</span><span class="token string">&quot;_statusHTML&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å³ä½¿åœ¨æµ‹è¯•ä»£ç ä¸­ï¼Œä¹Ÿä¼˜å…ˆä½¿ç”¨<code>t.Fatal</code>æˆ–è€…<code>t.FailNow</code>è€Œä¸æ˜¯ panic æ¥ç¡®ä¿å¤±è´¥è¢«æ ‡è®°ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// func TestFoo(t *testing.T)</span>

f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">CreateTemp</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token function">panic</span><span class="token punctuation">(</span><span class="token string">&quot;failed to set up test&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// func TestFoo(t *testing.T)</span>

f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">CreateTemp</span><span class="token punctuation">(</span><span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  t<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;failed to set up test&quot;</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><!-- TODO: Explain how to use _test packages. --><h3 id="ä½¿ç”¨-go-uber-org-atomic" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨-go-uber-org-atomic"><span>ä½¿ç”¨ go.uber.org/atomic</span></a></h3><p>ä½¿ç”¨ <a href="https://golang.org/pkg/sync/atomic/" target="_blank" rel="noopener noreferrer">sync/atomic</a> åŒ…çš„åŸå­æ“ä½œå¯¹åŸå§‹ç±»å‹ (<code>int32</code>, <code>int64</code>ç­‰ï¼‰è¿›è¡Œæ“ä½œï¼Œå› ä¸ºå¾ˆå®¹æ˜“å¿˜è®°ä½¿ç”¨åŸå­æ“ä½œæ¥è¯»å–æˆ–ä¿®æ”¹å˜é‡ã€‚</p><p><a href="https://godoc.org/go.uber.org/atomic" target="_blank" rel="noopener noreferrer">go.uber.org/atomic</a> é€šè¿‡éšè—åŸºç¡€ç±»å‹ä¸ºè¿™äº›æ“ä½œå¢åŠ äº†ç±»å‹å®‰å…¨æ€§ã€‚æ­¤å¤–ï¼Œå®ƒåŒ…æ‹¬ä¸€ä¸ªæ–¹ä¾¿çš„<code>atomic.Bool</code>ç±»å‹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  running <span class="token builtin">int32</span>  <span class="token comment">// atomic</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f<span class="token operator">*</span> foo<span class="token punctuation">)</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> atomic<span class="token punctuation">.</span><span class="token function">SwapInt32</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>f<span class="token punctuation">.</span>running<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
     <span class="token comment">// already runningâ€¦</span>
     <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// start the Foo</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>foo<span class="token punctuation">)</span> <span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> f<span class="token punctuation">.</span>running <span class="token operator">==</span> <span class="token number">1</span>  <span class="token comment">// race!</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  running atomic<span class="token punctuation">.</span>Bool
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>foo<span class="token punctuation">)</span> <span class="token function">start</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> f<span class="token punctuation">.</span>running<span class="token punctuation">.</span><span class="token function">Swap</span><span class="token punctuation">(</span><span class="token boolean">true</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
     <span class="token comment">// already runningâ€¦</span>
     <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// start the Foo</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f <span class="token operator">*</span>foo<span class="token punctuation">)</span> <span class="token function">isRunning</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> f<span class="token punctuation">.</span>running<span class="token punctuation">.</span><span class="token function">Load</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="é¿å…å¯å˜å…¨å±€å˜é‡" tabindex="-1"><a class="header-anchor" href="#é¿å…å¯å˜å…¨å±€å˜é‡"><span>é¿å…å¯å˜å…¨å±€å˜é‡</span></a></h3><p>ä½¿ç”¨é€‰æ‹©ä¾èµ–æ³¨å…¥æ–¹å¼é¿å…æ”¹å˜å…¨å±€å˜é‡ã€‚ æ—¢é€‚ç”¨äºå‡½æ•°æŒ‡é’ˆåˆé€‚ç”¨äºå…¶ä»–å€¼ç±»å‹</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// sign.go</span>
<span class="token keyword">var</span> _timeNow <span class="token operator">=</span> time<span class="token punctuation">.</span>Now
<span class="token keyword">func</span> <span class="token function">sign</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  now <span class="token operator">:=</span> <span class="token function">_timeNow</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">signWithTime</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> now<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// sign.go</span>
<span class="token keyword">type</span> signer <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  now <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">newSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>signer <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token operator">&amp;</span>signer<span class="token punctuation">{</span>
    now<span class="token punctuation">:</span> time<span class="token punctuation">.</span>Now<span class="token punctuation">,</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>signer<span class="token punctuation">)</span> <span class="token function">Sign</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  now <span class="token operator">:=</span> s<span class="token punctuation">.</span><span class="token function">now</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token function">signWithTime</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> now<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// sign_test.go</span>
<span class="token keyword">func</span> <span class="token function">TestSign</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  oldTimeNow <span class="token operator">:=</span> _timeNow
  _timeNow <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">{</span>
    <span class="token keyword">return</span> someFixedTime
  <span class="token punctuation">}</span>
  <span class="token keyword">defer</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span> _timeNow <span class="token operator">=</span> oldTimeNow <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> want<span class="token punctuation">,</span> <span class="token function">sign</span><span class="token punctuation">(</span>give<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// sign_test.go</span>
<span class="token keyword">func</span> <span class="token function">TestSigner</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  s <span class="token operator">:=</span> <span class="token function">newSigner</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  s<span class="token punctuation">.</span>now <span class="token operator">=</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> time<span class="token punctuation">.</span>Time <span class="token punctuation">{</span>
    <span class="token keyword">return</span> someFixedTime
  <span class="token punctuation">}</span>
  assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> want<span class="token punctuation">,</span> s<span class="token punctuation">.</span><span class="token function">Sign</span><span class="token punctuation">(</span>give<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹" tabindex="-1"><a class="header-anchor" href="#é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹"><span>é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</span></a></h3><p>è¿™äº›åµŒå…¥çš„ç±»å‹æ³„æ¼å®ç°ç»†èŠ‚ã€ç¦æ­¢ç±»å‹æ¼”åŒ–å’Œæ¨¡ç³Šçš„æ–‡æ¡£ã€‚</p><p>å‡è®¾æ‚¨ä½¿ç”¨å…±äº«çš„ <code>AbstractList</code> å®ç°äº†å¤šç§åˆ—è¡¨ç±»å‹ï¼Œè¯·é¿å…åœ¨å…·ä½“çš„åˆ—è¡¨å®ç°ä¸­åµŒå…¥ <code>AbstractList</code>ã€‚ ç›¸åï¼Œåªéœ€æ‰‹åŠ¨å°†æ–¹æ³•å†™å…¥å…·ä½“çš„åˆ—è¡¨ï¼Œè¯¥åˆ—è¡¨å°†å§”æ‰˜ç»™æŠ½è±¡åˆ—è¡¨ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> AbstractList <span class="token keyword">struct</span> <span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// æ·»åŠ å°†å®ä½“æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>AbstractList<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>e Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç§»é™¤ä»åˆ—è¡¨ä¸­ç§»é™¤å®ä½“ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>AbstractList<span class="token punctuation">)</span> <span class="token function">Remove</span><span class="token punctuation">(</span>e Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="token keyword">type</span> ConcreteList <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  <span class="token operator">*</span>AbstractList
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="token keyword">type</span> ConcreteList <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  list <span class="token operator">*</span>AbstractList
<span class="token punctuation">}</span>
<span class="token comment">// æ·»åŠ å°†å®ä½“æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>ConcreteList<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>e Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  l<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç§»é™¤ä»åˆ—è¡¨ä¸­ç§»é™¤å®ä½“ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>ConcreteList<span class="token punctuation">)</span> <span class="token function">Remove</span><span class="token punctuation">(</span>e Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  l<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>Go å…è®¸ <a href="https://golang.org/doc/effective_go.html#embedding" target="_blank" rel="noopener noreferrer">ç±»å‹åµŒå…¥</a> ä½œä¸ºç»§æ‰¿å’Œç»„åˆä¹‹é—´çš„æŠ˜è¡·ã€‚å¤–éƒ¨ç±»å‹è·å–åµŒå…¥ç±»å‹çš„æ–¹æ³•çš„éšå¼å‰¯æœ¬ã€‚é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™äº›æ–¹æ³•å§”æ‰˜ç»™åµŒå…¥å®ä¾‹çš„åŒä¸€æ–¹æ³•ã€‚</p><p>ç»“æ„è¿˜è·å¾—ä¸ç±»å‹åŒåçš„å­—æ®µã€‚ æ‰€ä»¥ï¼Œå¦‚æœåµŒå…¥çš„ç±»å‹æ˜¯ publicï¼Œé‚£ä¹ˆå­—æ®µæ˜¯ publicã€‚ä¸ºäº†ä¿æŒå‘åå…¼å®¹æ€§ï¼Œå¤–éƒ¨ç±»å‹çš„æ¯ä¸ªæœªæ¥ç‰ˆæœ¬éƒ½å¿…é¡»ä¿ç•™åµŒå…¥ç±»å‹ã€‚</p><p>å¾ˆå°‘éœ€è¦åµŒå…¥ç±»å‹ã€‚ è¿™æ˜¯ä¸€ç§æ–¹ä¾¿ï¼Œå¯ä»¥å¸®åŠ©æ‚¨é¿å…ç¼–å†™å†—é•¿çš„å§”æ‰˜æ–¹æ³•ã€‚</p><p>å³ä½¿åµŒå…¥å…¼å®¹çš„æŠ½è±¡åˆ—è¡¨ <em>interface</em>ï¼Œè€Œä¸æ˜¯ç»“æ„ä½“ï¼Œè¿™å°†ä¸ºå¼€å‘äººå‘˜æä¾›æ›´å¤§çš„çµæ´»æ€§æ¥æ”¹å˜æœªæ¥ï¼Œä½†ä»ç„¶æ³„éœ²äº†å…·ä½“åˆ—è¡¨ä½¿ç”¨æŠ½è±¡å®ç°çš„ç»†èŠ‚ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// AbstractList æ˜¯å„ç§å®ä½“åˆ—è¡¨çš„é€šç”¨å®ç°ã€‚</span>
<span class="token keyword">type</span> AbstractList <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">Add</span><span class="token punctuation">(</span>Entity<span class="token punctuation">)</span>
  <span class="token function">Remove</span><span class="token punctuation">(</span>Entity<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="token keyword">type</span> ConcreteList <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  AbstractList
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// ConcreteList æ˜¯ä¸€ä¸ªå®ä½“åˆ—è¡¨ã€‚</span>
<span class="token keyword">type</span> ConcreteList <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  list AbstractList
<span class="token punctuation">}</span>
<span class="token comment">// æ·»åŠ å°†å®ä½“æ·»åŠ åˆ°åˆ—è¡¨ä¸­ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>ConcreteList<span class="token punctuation">)</span> <span class="token function">Add</span><span class="token punctuation">(</span>e Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  l<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token comment">// ç§»é™¤ä»åˆ—è¡¨ä¸­ç§»é™¤å®ä½“ã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>l <span class="token operator">*</span>ConcreteList<span class="token punctuation">)</span> <span class="token function">Remove</span><span class="token punctuation">(</span>e Entity<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  l<span class="token punctuation">.</span>list<span class="token punctuation">.</span><span class="token function">Remove</span><span class="token punctuation">(</span>e<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>æ— è®ºæ˜¯ä½¿ç”¨åµŒå…¥ç»“æ„è¿˜æ˜¯åµŒå…¥æ¥å£ï¼Œéƒ½ä¼šé™åˆ¶ç±»å‹çš„æ¼”åŒ–ã€‚</p><ul><li>å‘åµŒå…¥æ¥å£æ·»åŠ æ–¹æ³•æ˜¯ä¸€ä¸ªç ´åæ€§çš„æ”¹å˜ã€‚</li><li>ä»åµŒå…¥ç»“æ„ä½“åˆ é™¤æ–¹æ³•æ˜¯ä¸€ä¸ªç ´åæ€§æ”¹å˜ã€‚</li><li>åˆ é™¤åµŒå…¥ç±»å‹æ˜¯ä¸€ä¸ªç ´åæ€§çš„æ”¹å˜ã€‚</li><li>å³ä½¿ä½¿ç”¨æ»¡è¶³ç›¸åŒæ¥å£çš„ç±»å‹æ›¿æ¢åµŒå…¥ç±»å‹ï¼Œä¹Ÿæ˜¯ä¸€ä¸ªç ´åæ€§çš„æ”¹å˜ã€‚</li></ul><p>å°½ç®¡ç¼–å†™è¿™äº›å§”æ‰˜æ–¹æ³•æ˜¯ä¹å‘³çš„ï¼Œä½†æ˜¯é¢å¤–çš„å·¥ä½œéšè—äº†å®ç°ç»†èŠ‚ï¼Œç•™ä¸‹äº†æ›´å¤šçš„æ›´æ”¹æœºä¼šï¼Œè¿˜æ¶ˆé™¤äº†åœ¨æ–‡æ¡£ä¸­å‘ç°å®Œæ•´åˆ—è¡¨æ¥å£çš„é—´æ¥æ€§æ“ä½œã€‚</p><h3 id="é¿å…ä½¿ç”¨å†…ç½®åç§°" tabindex="-1"><a class="header-anchor" href="#é¿å…ä½¿ç”¨å†…ç½®åç§°"><span>é¿å…ä½¿ç”¨å†…ç½®åç§°</span></a></h3><p>Go <a href="https://golang.org/ref/spec" target="_blank" rel="noopener noreferrer">è¯­è¨€è§„èŒƒ</a> æ¦‚è¿°äº†å‡ ä¸ªå†…ç½®çš„ï¼Œ ä¸åº”åœ¨ Go é¡¹ç›®ä¸­ä½¿ç”¨çš„ <a href="https://golang.org/ref/spec#Predeclared_identifiers" target="_blank" rel="noopener noreferrer">é¢„å…ˆå£°æ˜çš„æ ‡è¯†ç¬¦</a>ã€‚</p><p>æ ¹æ®ä¸Šä¸‹æ–‡çš„ä¸åŒï¼Œå°†è¿™äº›æ ‡è¯†ç¬¦ä½œä¸ºåç§°é‡å¤ä½¿ç”¨ï¼Œ å°†åœ¨å½“å‰ä½œç”¨åŸŸï¼ˆæˆ–ä»»ä½•åµŒå¥—ä½œç”¨åŸŸï¼‰ä¸­éšè—åŸå§‹æ ‡è¯†ç¬¦ï¼Œæˆ–è€…æ··æ·†ä»£ç ã€‚ åœ¨æœ€å¥½çš„æƒ…å†µä¸‹ï¼Œç¼–è¯‘å™¨ä¼šæŠ¥é”™ï¼›åœ¨æœ€åçš„æƒ…å†µä¸‹ï¼Œè¿™æ ·çš„ä»£ç å¯èƒ½ä¼šå¼•å…¥æ½œåœ¨çš„ã€éš¾ä»¥æ¢å¤çš„é”™è¯¯ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token builtin">error</span> <span class="token builtin">string</span>
<span class="token comment">// `error` ä½œç”¨åŸŸéšå¼è¦†ç›–</span>

<span class="token comment">// or</span>

<span class="token keyword">func</span> <span class="token function">handleErrorMessage</span><span class="token punctuation">(</span><span class="token builtin">error</span> <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// `error` ä½œç”¨åŸŸéšå¼è¦†ç›–</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> errorMessage <span class="token builtin">string</span>
<span class="token comment">// `error` æŒ‡å‘å†…ç½®çš„éè¦†ç›–</span>

<span class="token comment">// or</span>

<span class="token keyword">func</span> <span class="token function">handleErrorMessage</span><span class="token punctuation">(</span>msg <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// `error` æŒ‡å‘å†…ç½®çš„éè¦†ç›–</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// è™½ç„¶è¿™äº›å­—æ®µåœ¨æŠ€æœ¯ä¸Šä¸æ„æˆé˜´å½±ï¼Œä½†`error`æˆ–`string`å­—ç¬¦ä¸²çš„é‡æ˜ å°„ç°åœ¨æ˜¯ä¸æ˜ç¡®çš„ã€‚</span>
    <span class="token builtin">error</span>  <span class="token builtin">error</span>
    <span class="token builtin">string</span> <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f Foo<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token comment">// `error` å’Œ `f.error` åœ¨è§†è§‰ä¸Šæ˜¯ç›¸ä¼¼çš„</span>
    <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token builtin">error</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f Foo<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token comment">// `string` and `f.string` åœ¨è§†è§‰ä¸Šæ˜¯ç›¸ä¼¼çš„</span>
    <span class="token keyword">return</span> f<span class="token punctuation">.</span><span class="token builtin">string</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// `error` and `string` ç°åœ¨æ˜¯æ˜ç¡®çš„ã€‚</span>
    err <span class="token builtin">error</span>
    str <span class="token builtin">string</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f Foo<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> f<span class="token punctuation">.</span>err
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>f Foo<span class="token punctuation">)</span> <span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> f<span class="token punctuation">.</span>str
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>æ³¨æ„ï¼Œç¼–è¯‘å™¨åœ¨ä½¿ç”¨é¢„å…ˆåˆ†éš”çš„æ ‡è¯†ç¬¦æ—¶ä¸ä¼šç”Ÿæˆé”™è¯¯ï¼Œ ä½†æ˜¯è¯¸å¦‚<code>go vet</code>ä¹‹ç±»çš„å·¥å…·ä¼šæ­£ç¡®åœ°æŒ‡å‡ºè¿™äº›å’Œå…¶ä»–æƒ…å†µä¸‹çš„éšå¼é—®é¢˜ã€‚</p><h3 id="é¿å…ä½¿ç”¨-init" tabindex="-1"><a class="header-anchor" href="#é¿å…ä½¿ç”¨-init"><span>é¿å…ä½¿ç”¨ <code>init()</code></span></a></h3><p>å°½å¯èƒ½é¿å…ä½¿ç”¨<code>init()</code>ã€‚å½“<code>init()</code>æ˜¯ä¸å¯é¿å…æˆ–å¯å–çš„ï¼Œä»£ç åº”å…ˆå°è¯•ï¼š</p><ol><li>æ— è®ºç¨‹åºç¯å¢ƒæˆ–è°ƒç”¨å¦‚ä½•ï¼Œéƒ½è¦å®Œå…¨ç¡®å®šã€‚</li><li>é¿å…ä¾èµ–äºå…¶ä»–<code>init()</code>å‡½æ•°çš„é¡ºåºæˆ–å‰¯ä½œç”¨ã€‚è™½ç„¶<code>init()</code>é¡ºåºæ˜¯æ˜ç¡®çš„ï¼Œä½†ä»£ç å¯ä»¥æ›´æ”¹ï¼Œ å› æ­¤<code>init()</code>å‡½æ•°ä¹‹é—´çš„å…³ç³»å¯èƒ½ä¼šä½¿ä»£ç å˜å¾—è„†å¼±å’Œå®¹æ˜“å‡ºé”™ã€‚</li><li>é¿å…è®¿é—®æˆ–æ“ä½œå…¨å±€æˆ–ç¯å¢ƒçŠ¶æ€ï¼Œå¦‚æœºå™¨ä¿¡æ¯ã€ç¯å¢ƒå˜é‡ã€å·¥ä½œç›®å½•ã€ç¨‹åºå‚æ•°/è¾“å…¥ç­‰ã€‚</li><li>é¿å…<code>I/O</code>ï¼ŒåŒ…æ‹¬æ–‡ä»¶ç³»ç»Ÿã€ç½‘ç»œå’Œç³»ç»Ÿè°ƒç”¨ã€‚</li></ol><p>ä¸èƒ½æ»¡è¶³è¿™äº›è¦æ±‚çš„ä»£ç å¯èƒ½å±äºè¦ä½œä¸º<code>main()</code>è°ƒç”¨çš„ä¸€éƒ¨åˆ†ï¼ˆæˆ–ç¨‹åºç”Ÿå‘½å‘¨æœŸä¸­çš„å…¶ä»–åœ°æ–¹ï¼‰ï¼Œ æˆ–è€…ä½œä¸º<code>main()</code>æœ¬èº«çš„ä¸€éƒ¨åˆ†å†™å…¥ã€‚ç‰¹åˆ«æ˜¯ï¼Œæ‰“ç®—ç”±å…¶ä»–ç¨‹åºä½¿ç”¨çš„åº“åº”è¯¥ç‰¹åˆ«æ³¨æ„å®Œå…¨ç¡®å®šæ€§ï¼Œ è€Œä¸æ˜¯æ‰§è¡Œâ€œinit magicâ€</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Foo <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> _defaultFoo Foo
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    _defaultFoo <span class="token operator">=</span> Foo<span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> _defaultFoo <span class="token operator">=</span> Foo<span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token comment">// orï¼Œä¸ºäº†æ›´å¥½çš„å¯æµ‹è¯•æ€§ï¼š</span>
<span class="token keyword">var</span> _defaultFoo <span class="token operator">=</span> <span class="token function">defaultFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">func</span> <span class="token function">defaultFoo</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Foo <span class="token punctuation">{</span>
    <span class="token keyword">return</span> Foo<span class="token punctuation">{</span>
        <span class="token comment">// ...</span>
    <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">var</span> _config Config
<span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bad: åŸºäºå½“å‰ç›®å½•</span>
    cwd<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Getwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// Bad: I/O</span>
    raw<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> <span class="token string">&quot;config&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;config.yaml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    yaml<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>raw<span class="token punctuation">,</span> <span class="token operator">&amp;</span>_config<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Config <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">loadConfig</span><span class="token punctuation">(</span><span class="token punctuation">)</span> Config <span class="token punctuation">{</span>
    cwd<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Getwd</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// handle err</span>
    raw<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>
        path<span class="token punctuation">.</span><span class="token function">Join</span><span class="token punctuation">(</span>cwd<span class="token punctuation">,</span> <span class="token string">&quot;config&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;config.yaml&quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">)</span>
    <span class="token comment">// handle err</span>
    <span class="token keyword">var</span> config Config
    yaml<span class="token punctuation">.</span><span class="token function">Unmarshal</span><span class="token punctuation">(</span>raw<span class="token punctuation">,</span> <span class="token operator">&amp;</span>config<span class="token punctuation">)</span>
    <span class="token keyword">return</span> config
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>è€ƒè™‘åˆ°ä¸Šè¿°æƒ…å†µï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code>init()</code>å¯èƒ½æ›´å¯å–æˆ–æ˜¯å¿…è¦çš„ï¼Œå¯èƒ½åŒ…æ‹¬ï¼š</p><ul><li><p>ä¸èƒ½è¡¨ç¤ºä¸ºå•ä¸ªèµ‹å€¼çš„å¤æ‚è¡¨è¾¾å¼ã€‚</p></li><li><p>å¯æ’å…¥çš„é’©å­ï¼Œå¦‚<code>database/sql</code>ã€ç¼–ç ç±»å‹æ³¨å†Œè¡¨ç­‰ã€‚</p></li><li><p>å¯¹ <a href="https://cloud.google.com/functions/docs/bestpractices/tips#use_global_variables_to_reuse_objects_in_future_invocations" target="_blank" rel="noopener noreferrer">Google Cloud Functions</a> å’Œå…¶ä»–å½¢å¼çš„ç¡®å®šæ€§é¢„è®¡ç®—çš„ä¼˜åŒ–ã€‚</p></li></ul><h3 id="è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡" tabindex="-1"><a class="header-anchor" href="#è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡"><span>è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡</span></a></h3><p>è¿½åŠ æ—¶ä¼˜å…ˆæŒ‡å®šåˆ‡ç‰‡å®¹é‡</p><p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨åˆå§‹åŒ–è¦è¿½åŠ çš„åˆ‡ç‰‡æ—¶ä¸º<code>make()</code>æä¾›ä¸€ä¸ªå®¹é‡å€¼ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> n<span class="token operator">++</span> <span class="token punctuation">{</span>
  data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> n<span class="token operator">++</span> <span class="token punctuation">{</span>
  data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
  <span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkBad-4    100000000    2.48s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkGood-4   100000000    0.21s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="ä¸»å‡½æ•°é€€å‡ºæ–¹å¼-exit" tabindex="-1"><a class="header-anchor" href="#ä¸»å‡½æ•°é€€å‡ºæ–¹å¼-exit"><span>ä¸»å‡½æ•°é€€å‡ºæ–¹å¼ (Exit)</span></a></h3><p>Go ç¨‹åºä½¿ç”¨ <a href="https://golang.org/pkg/os/#Exit" target="_blank" rel="noopener noreferrer"><code>os.Exit</code></a> æˆ–è€… <a href="https://golang.org/pkg/log/#Fatal" target="_blank" rel="noopener noreferrer"><code>log.Fatal*</code></a> ç«‹å³é€€å‡º (ä½¿ç”¨<code>panic</code>ä¸æ˜¯é€€å‡ºç¨‹åºçš„å¥½æ–¹æ³•ï¼Œè¯· <a href="#%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-panic">ä¸è¦ä½¿ç”¨ panic</a>ã€‚)</p><p><strong>ä»…åœ¨<code>main()</code></strong> ä¸­è°ƒç”¨å…¶ä¸­ä¸€ä¸ª <code>os.Exit</code> æˆ–è€… <code>log.Fatal*</code>ã€‚æ‰€æœ‰å…¶ä»–å‡½æ•°åº”å°†é”™è¯¯è¿”å›åˆ°ä¿¡å·å¤±è´¥ä¸­ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  body <span class="token operator">:=</span> <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">readFile</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  b<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  body<span class="token punctuation">,</span> err <span class="token operator">:=</span> <span class="token function">readFile</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>body<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">readFile</span><span class="token punctuation">(</span>path <span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">string</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>path<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
  <span class="token punctuation">}</span>
  b<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> err
  <span class="token punctuation">}</span>
  <span class="token keyword">return</span> <span class="token function">string</span><span class="token punctuation">(</span>b<span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>åŸåˆ™ä¸Šï¼šé€€å‡ºçš„å…·æœ‰å¤šç§åŠŸèƒ½çš„ç¨‹åºå­˜åœ¨ä¸€äº›é—®é¢˜ï¼š</p><ul><li>ä¸æ˜æ˜¾çš„æ§åˆ¶æµï¼šä»»ä½•å‡½æ•°éƒ½å¯ä»¥é€€å‡ºç¨‹åºï¼Œå› æ­¤å¾ˆéš¾å¯¹æ§åˆ¶æµè¿›è¡Œæ¨ç†ã€‚</li><li>éš¾ä»¥æµ‹è¯•ï¼šé€€å‡ºç¨‹åºçš„å‡½æ•°ä¹Ÿå°†é€€å‡ºè°ƒç”¨å®ƒçš„æµ‹è¯•ã€‚è¿™ä½¿å¾—å‡½æ•°å¾ˆéš¾æµ‹è¯•ï¼Œå¹¶å¼•å…¥äº†è·³è¿‡ <code>go test</code> å°šæœªè¿è¡Œçš„å…¶ä»–æµ‹è¯•çš„é£é™©ã€‚</li><li>è·³è¿‡æ¸…ç†ï¼šå½“å‡½æ•°é€€å‡ºç¨‹åºæ—¶ï¼Œä¼šè·³è¿‡å·²ç»è¿›å…¥<code>defer</code>é˜Ÿåˆ—é‡Œçš„å‡½æ•°è°ƒç”¨ã€‚è¿™å¢åŠ äº†è·³è¿‡é‡è¦æ¸…ç†ä»»åŠ¡çš„é£é™©ã€‚</li></ul><h4 id="ä¸€æ¬¡æ€§é€€å‡º" tabindex="-1"><a class="header-anchor" href="#ä¸€æ¬¡æ€§é€€å‡º"><span>ä¸€æ¬¡æ€§é€€å‡º</span></a></h4><p>å¦‚æœå¯èƒ½çš„è¯ï¼Œä½ çš„<code>mainï¼ˆï¼‰</code>å‡½æ•°ä¸­ <strong>æœ€å¤šä¸€æ¬¡</strong> è°ƒç”¨ <code>os.Exit</code>æˆ–è€…<code>log.Fatal</code>ã€‚å¦‚æœæœ‰å¤šä¸ªé”™è¯¯åœºæ™¯åœæ­¢ç¨‹åºæ‰§è¡Œï¼Œè¯·å°†è¯¥é€»è¾‘æ”¾åœ¨å•ç‹¬çš„å‡½æ•°ä¸‹å¹¶ä»ä¸­è¿”å›é”™è¯¯ã€‚ è¿™ä¼šç¼©çŸ­ <code>main()</code> å‡½æ•°ï¼Œå¹¶å°†æ‰€æœ‰å…³é”®ä¸šåŠ¡é€»è¾‘æ”¾å…¥ä¸€ä¸ªå•ç‹¬çš„ã€å¯æµ‹è¯•çš„å‡½æ•°ä¸­ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  args <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span><span class="token string">&quot;missing file&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  name <span class="token operator">:=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token comment">// å¦‚æœæˆ‘ä»¬è°ƒç”¨ log.Fatal åœ¨è¿™æ¡çº¿ä¹‹å</span>
  <span class="token comment">// f.Close å°†ä¼šè¢«æ‰§è¡Œã€‚</span>
  b<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">package</span> main
<span class="token keyword">func</span> <span class="token function">main</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Fatal</span><span class="token punctuation">(</span>err<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">run</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">error</span> <span class="token punctuation">{</span>
  args <span class="token operator">:=</span> os<span class="token punctuation">.</span>Args<span class="token punctuation">[</span><span class="token number">1</span><span class="token punctuation">:</span><span class="token punctuation">]</span>
  <span class="token keyword">if</span> <span class="token function">len</span><span class="token punctuation">(</span>args<span class="token punctuation">)</span> <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> errors<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token string">&quot;missing file&quot;</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
  name <span class="token operator">:=</span> args<span class="token punctuation">[</span><span class="token number">0</span><span class="token punctuation">]</span>
  f<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>
  <span class="token keyword">defer</span> f<span class="token punctuation">.</span><span class="token function">Close</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  b<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadAll</span><span class="token punctuation">(</span>f<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="åœ¨åºåˆ—åŒ–ç»“æ„ä¸­ä½¿ç”¨å­—æ®µæ ‡è®°" tabindex="-1"><a class="header-anchor" href="#åœ¨åºåˆ—åŒ–ç»“æ„ä¸­ä½¿ç”¨å­—æ®µæ ‡è®°"><span>åœ¨åºåˆ—åŒ–ç»“æ„ä¸­ä½¿ç”¨å­—æ®µæ ‡è®°</span></a></h3><p>ä»»ä½•åºåˆ—åŒ–åˆ°JSONã€YAMLã€ï¼Œ æˆ–å…¶ä»–æ”¯æŒåŸºäºæ ‡è®°çš„å­—æ®µå‘½åçš„æ ¼å¼åº”ä½¿ç”¨ç›¸å…³æ ‡è®°è¿›è¡Œæ³¨é‡Šã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Stock <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Price <span class="token builtin">int</span>
  Name  <span class="token builtin">string</span>
<span class="token punctuation">}</span>
bytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>Stock<span class="token punctuation">{</span>
  Price<span class="token punctuation">:</span> <span class="token number">137</span><span class="token punctuation">,</span>
  Name<span class="token punctuation">:</span>  <span class="token string">&quot;UBER&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Stock <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Price <span class="token builtin">int</span>    <span class="token string">`json:&quot;price&quot;`</span>
  Name  <span class="token builtin">string</span> <span class="token string">`json:&quot;name&quot;`</span>
  <span class="token comment">// Safe to rename Name to Symbol.</span>
<span class="token punctuation">}</span>
bytes<span class="token punctuation">,</span> err <span class="token operator">:=</span> json<span class="token punctuation">.</span><span class="token function">Marshal</span><span class="token punctuation">(</span>Stock<span class="token punctuation">{</span>
  Price<span class="token punctuation">:</span> <span class="token number">137</span><span class="token punctuation">,</span>
  Name<span class="token punctuation">:</span>  <span class="token string">&quot;UBER&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>ç†è®ºä¸Šï¼š ç»“æ„çš„åºåˆ—åŒ–å½¢å¼æ˜¯ä¸åŒç³»ç»Ÿä¹‹é—´çš„å¥‘çº¦ã€‚ å¯¹åºåˆ—åŒ–è¡¨å•ç»“æ„ï¼ˆåŒ…æ‹¬å­—æ®µåï¼‰çš„æ›´æ”¹ä¼šç ´åæ­¤çº¦å®šã€‚åœ¨æ ‡è®°ä¸­æŒ‡å®šå­—æ®µåä½¿çº¦å®šæ˜ç¡®ï¼Œ å®ƒè¿˜å¯ä»¥é€šè¿‡é‡æ„æˆ–é‡å‘½åå­—æ®µæ¥é˜²æ­¢æ„å¤–è¿åçº¦å®šã€‚</p><h3 id="ä¸è¦ä¸€åŠ³æ°¸é€¸åœ°ä½¿ç”¨-goroutine" tabindex="-1"><a class="header-anchor" href="#ä¸è¦ä¸€åŠ³æ°¸é€¸åœ°ä½¿ç”¨-goroutine"><span>ä¸è¦ä¸€åŠ³æ°¸é€¸åœ°ä½¿ç”¨ goroutine</span></a></h3><p>Goroutines æ˜¯è½»é‡çº§çš„ï¼Œä½†å®ƒä»¬ä¸æ˜¯å…è´¹çš„ï¼š è‡³å°‘ï¼Œå®ƒä»¬ä¼šä¸ºå †æ ˆå’Œ CPU çš„è°ƒåº¦æ¶ˆè€—å†…å­˜ã€‚ è™½ç„¶è¿™äº›æˆæœ¬å¯¹äº Goroutines çš„ä½¿ç”¨æ¥è¯´å¾ˆå°ï¼Œä½†å½“å®ƒä»¬åœ¨æ²¡æœ‰å—æ§ç”Ÿå‘½å‘¨æœŸçš„æƒ…å†µä¸‹å¤§é‡ç”Ÿæˆæ—¶ä¼šå¯¼è‡´ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚ å…·æœ‰éæ‰˜ç®¡ç”Ÿå‘½å‘¨æœŸçš„ Goroutines ä¹Ÿå¯èƒ½å¯¼è‡´å…¶ä»–é—®é¢˜ï¼Œä¾‹å¦‚é˜²æ­¢æœªä½¿ç”¨çš„å¯¹è±¡è¢«åƒåœ¾å›æ”¶å¹¶ä¿ç•™ä¸å†ä½¿ç”¨çš„èµ„æºã€‚</p><p>å› æ­¤ï¼Œä¸è¦åœ¨ä»£ç ä¸­æ³„æ¼ goroutineã€‚ ä½¿ç”¨ <a href="https://pkg.go.dev/go.uber.org/goleak" target="_blank" rel="noopener noreferrer">go.uber.org/goleak</a> æ¥æµ‹è¯•å¯èƒ½äº§ç”Ÿ goroutine çš„åŒ…å†…çš„ goroutine æ³„æ¼ã€‚</p><p>ä¸€èˆ¬æ¥è¯´ï¼Œæ¯ä¸ª goroutine:</p><ul><li>å¿…é¡»æœ‰ä¸€ä¸ªå¯é¢„æµ‹çš„åœæ­¢è¿è¡Œæ—¶é—´ï¼› æˆ–è€…</li><li>å¿…é¡»æœ‰ä¸€ç§æ–¹æ³•å¯ä»¥å‘ goroutine å‘å‡ºä¿¡å·å®ƒåº”è¯¥åœæ­¢</li></ul><p>åœ¨è¿™ä¸¤ç§æƒ…å†µä¸‹ï¼Œéƒ½å¿…é¡»æœ‰ä¸€ç§æ–¹å¼ä»£ç æ¥é˜»å¡å¹¶ç­‰å¾… goroutine å®Œæˆã€‚</p><p>For example:</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    time<span class="token punctuation">.</span><span class="token function">Sleep</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  stop <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// å‘Šè¯‰ goroutine åœæ­¢</span>
  done <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span> <span class="token comment">// å‘Šè¯‰æˆ‘ä»¬ goroutine é€€å‡ºäº†</span>
<span class="token punctuation">)</span>
<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>
  ticker <span class="token operator">:=</span> time<span class="token punctuation">.</span><span class="token function">NewTicker</span><span class="token punctuation">(</span>delay<span class="token punctuation">)</span>
  <span class="token keyword">defer</span> ticker<span class="token punctuation">.</span><span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token keyword">select</span> <span class="token punctuation">{</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>tick<span class="token punctuation">.</span>C<span class="token punctuation">:</span>
      <span class="token function">flush</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>stop<span class="token punctuation">:</span>
      <span class="token keyword">return</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// å…¶å®ƒ...</span>
<span class="token function">close</span><span class="token punctuation">(</span>stop<span class="token punctuation">)</span>  <span class="token comment">// æŒ‡ç¤º goroutine åœæ­¢</span>
<span class="token operator">&lt;-</span>done       <span class="token comment">// and wait for it to exit</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><p>æ²¡æœ‰åŠæ³•é˜»æ­¢è¿™ä¸ª goroutineã€‚è¿™å°†ä¸€ç›´è¿è¡Œåˆ°åº”ç”¨ç¨‹åºé€€å‡ºã€‚</p></td><td><p>è¿™ä¸ª goroutine å¯ä»¥ç”¨ <code>close(stop)</code>, æˆ‘ä»¬å¯ä»¥ç­‰å¾…å®ƒé€€å‡º <code>&lt;-done</code>.</p></td></tr></tbody></table><h4 id="ç­‰å¾…-goroutines-é€€å‡º" tabindex="-1"><a class="header-anchor" href="#ç­‰å¾…-goroutines-é€€å‡º"><span>ç­‰å¾… goroutines é€€å‡º</span></a></h4><p>ç»™å®šä¸€ä¸ªç”±ç³»ç»Ÿç”Ÿæˆçš„ goroutineï¼Œ å¿…é¡»æœ‰ä¸€ç§æ–¹æ¡ˆèƒ½ç­‰å¾… goroutine çš„é€€å‡ºã€‚ æœ‰ä¸¤ç§å¸¸ç”¨çš„æ–¹æ³•å¯ä»¥åšåˆ°è¿™ä¸€ç‚¹ï¼š</p><ul><li><p>ä½¿ç”¨ <code>sync.WaitGroup</code>. å¦‚æœæ‚¨è¦ç­‰å¾…å¤šä¸ª goroutineï¼Œè¯·æ‰§è¡Œæ­¤æ“ä½œ</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> wg sync<span class="token punctuation">.</span>WaitGroup
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  wg<span class="token punctuation">.</span><span class="token function">Add</span><span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">)</span>
  <span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    <span class="token keyword">defer</span> wg<span class="token punctuation">.</span><span class="token function">Done</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token comment">// To wait for all to finish:</span>
wg<span class="token punctuation">.</span><span class="token function">Wait</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li><li><p>æ·»åŠ å¦ä¸€ä¸ª <code>chan struct{}</code>ï¼Œgoroutine å®Œæˆåä¼šå…³é—­å®ƒã€‚ å¦‚æœåªæœ‰ä¸€ä¸ª goroutineï¼Œè¯·æ‰§è¡Œæ­¤æ“ä½œã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>done <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token keyword">go</span> <span class="token keyword">func</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>done<span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">// To wait for the goroutine to finish:</span>
<span class="token operator">&lt;-</span>done
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></li></ul><h4 id="ä¸è¦åœ¨-init-ä½¿ç”¨-goroutines" tabindex="-1"><a class="header-anchor" href="#ä¸è¦åœ¨-init-ä½¿ç”¨-goroutines"><span>ä¸è¦åœ¨ <code>init()</code> ä½¿ç”¨ goroutines</span></a></h4><p><code>init()</code> å‡½æ•°ä¸åº”è¯¥äº§ç”Ÿ goroutinesã€‚ å¦è¯·å‚é˜… <a href="#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-init">é¿å…ä½¿ç”¨ init()</a>ã€‚</p><p>å¦‚æœä¸€ä¸ªåŒ…éœ€è¦ä¸€ä¸ªåå° goroutineï¼Œ å®ƒå¿…é¡»å…¬å¼€ä¸€ä¸ªè´Ÿè´£ç®¡ç† goroutine ç”Ÿå‘½å‘¨æœŸçš„å¯¹è±¡ã€‚ è¯¥å¯¹è±¡å¿…é¡»æä¾›ä¸€ä¸ªæ–¹æ³•ï¼ˆ<code>Close</code>ã€<code>Stop</code>ã€<code>Shutdown</code> ç­‰ï¼‰æ¥æŒ‡ç¤ºåå° goroutine åœæ­¢å¹¶ç­‰å¾…å®ƒçš„é€€å‡ºã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">init</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">go</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Worker <span class="token keyword">struct</span><span class="token punctuation">{</span> <span class="token comment">/* ... */</span> <span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token function">NewWorker</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token operator">*</span>Worker <span class="token punctuation">{</span>
  w <span class="token operator">:=</span> <span class="token operator">&amp;</span>Worker<span class="token punctuation">{</span>
    stop<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    done<span class="token punctuation">:</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">chan</span> <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span>
  <span class="token keyword">go</span> w<span class="token punctuation">.</span><span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>w <span class="token operator">*</span>Worker<span class="token punctuation">)</span> <span class="token function">doWork</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">defer</span> <span class="token function">close</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>done<span class="token punctuation">)</span>
  <span class="token keyword">for</span> <span class="token punctuation">{</span>
    <span class="token comment">// ...</span>
    <span class="token keyword">case</span> <span class="token operator">&lt;-</span>w<span class="token punctuation">.</span>stop<span class="token punctuation">:</span>
      <span class="token keyword">return</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
<span class="token comment">// Shutdown å‘Šè¯‰ worker åœæ­¢</span>
<span class="token comment">// å¹¶ç­‰å¾…å®ƒå®Œæˆã€‚</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>w <span class="token operator">*</span>Worker<span class="token punctuation">)</span> <span class="token function">Shutdown</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token function">close</span><span class="token punctuation">(</span>w<span class="token punctuation">.</span>stop<span class="token punctuation">)</span>
  <span class="token operator">&lt;-</span>w<span class="token punctuation">.</span>done
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><p>å½“ç”¨æˆ·å¯¼å‡ºè¿™ä¸ªåŒ…æ—¶ï¼Œæ— æ¡ä»¶åœ°ç”Ÿæˆä¸€ä¸ªåå° goroutineã€‚ ç”¨æˆ·æ— æ³•æ§åˆ¶ goroutine æˆ–åœæ­¢å®ƒçš„æ–¹æ³•ã€‚</p></td><td><p>ä»…å½“ç”¨æˆ·è¯·æ±‚æ—¶æ‰ç”Ÿæˆå·¥ä½œäººå‘˜ã€‚ æä¾›ä¸€ç§å…³é—­å·¥ä½œå™¨çš„æ–¹æ³•ï¼Œä»¥ä¾¿ç”¨æˆ·å¯ä»¥é‡Šæ”¾å·¥ä½œå™¨ä½¿ç”¨çš„èµ„æºã€‚</p><p>è¯·æ³¨æ„ï¼Œå¦‚æœå·¥ä½œäººå‘˜ç®¡ç†å¤šä¸ª goroutineï¼Œåˆ™åº”ä½¿ç”¨<code>WaitGroup</code>ã€‚ è¯·å‚é˜… <a href="#%E7%AD%89%E5%BE%85-goroutines-%E9%80%80%E5%87%BA">ç­‰å¾… goroutines é€€å‡º</a>ã€‚</p></td></tr></tbody></table><h2 id="æ€§èƒ½" tabindex="-1"><a class="header-anchor" href="#æ€§èƒ½"><span>æ€§èƒ½</span></a></h2><p>æ€§èƒ½æ–¹é¢çš„ç‰¹å®šå‡†åˆ™åªé€‚ç”¨äºé«˜é¢‘åœºæ™¯ã€‚</p><h3 id="ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt" tabindex="-1"><a class="header-anchor" href="#ä¼˜å…ˆä½¿ç”¨-strconv-è€Œä¸æ˜¯-fmt"><span>ä¼˜å…ˆä½¿ç”¨ strconv è€Œä¸æ˜¯ fmt</span></a></h3><p>å°†åŸè¯­è½¬æ¢ä¸ºå­—ç¬¦ä¸²æˆ–ä»å­—ç¬¦ä¸²è½¬æ¢æ—¶ï¼Œ<code>strconv</code>é€Ÿåº¦æ¯”<code>fmt</code>å¿«ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  s <span class="token operator">:=</span> fmt<span class="token punctuation">.</span><span class="token function">Sprint</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  s <span class="token operator">:=</span> strconv<span class="token punctuation">.</span><span class="token function">Itoa</span><span class="token punctuation">(</span>rand<span class="token punctuation">.</span><span class="token function">Int</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkFmtSprint-4    143 ns/op    2 allocs/op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkStrconv-4    64.2 ns/op    1 allocs/op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢" tabindex="-1"><a class="header-anchor" href="#é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢"><span>é¿å…å­—ç¬¦ä¸²åˆ°å­—èŠ‚çš„è½¬æ¢</span></a></h3><p>ä¸è¦åå¤ä»å›ºå®šå­—ç¬¦ä¸²åˆ›å»ºå­—èŠ‚ sliceã€‚ç›¸åï¼Œè¯·æ‰§è¡Œä¸€æ¬¡è½¬æ¢å¹¶æ•è·ç»“æœã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>data <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token function">byte</span><span class="token punctuation">(</span><span class="token string">&quot;Hello world&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> i <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> i <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> i<span class="token operator">++</span> <span class="token punctuation">{</span>
  w<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkBad-4   50000000   22.2 ns/op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkGood-4  500000000   3.25 ns/op
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="æŒ‡å®šå®¹å™¨å®¹é‡" tabindex="-1"><a class="header-anchor" href="#æŒ‡å®šå®¹å™¨å®¹é‡"><span>æŒ‡å®šå®¹å™¨å®¹é‡</span></a></h3><p>å°½å¯èƒ½æŒ‡å®šå®¹å™¨å®¹é‡ï¼Œä»¥ä¾¿ä¸ºå®¹å™¨é¢„å…ˆåˆ†é…å†…å­˜ã€‚è¿™å°†åœ¨æ·»åŠ å…ƒç´ æ—¶æœ€å°åŒ–åç»­åˆ†é…ï¼ˆé€šè¿‡å¤åˆ¶å’Œè°ƒæ•´å®¹å™¨å¤§å°ï¼‰ã€‚</p><h4 id="æŒ‡å®šmapå®¹é‡æç¤º" tabindex="-1"><a class="header-anchor" href="#æŒ‡å®šmapå®¹é‡æç¤º"><span>æŒ‡å®šMapå®¹é‡æç¤º</span></a></h4><p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨ä½¿ç”¨ <code>make()</code> åˆå§‹åŒ–çš„æ—¶å€™æä¾›å®¹é‡ä¿¡æ¯</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2<span class="token punctuation">,</span> hint<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å‘<code>make()</code>æä¾›å®¹é‡æç¤ºä¼šåœ¨åˆå§‹åŒ–æ—¶å°è¯•è°ƒæ•´ map çš„å¤§å°ï¼Œè¿™å°†å‡å°‘åœ¨å°†å…ƒç´ æ·»åŠ åˆ° map æ—¶ä¸º map é‡æ–°åˆ†é…å†…å­˜ã€‚</p><p>æ³¨æ„ï¼Œä¸ slices ä¸åŒã€‚map capacity æç¤ºå¹¶ä¸ä¿è¯å®Œå…¨çš„æŠ¢å å¼åˆ†é…ï¼Œè€Œæ˜¯ç”¨äºä¼°è®¡æ‰€éœ€çš„ hashmap bucket çš„æ•°é‡ã€‚ å› æ­¤ï¼Œåœ¨å°†å…ƒç´ æ·»åŠ åˆ° map æ—¶ï¼Œç”šè‡³åœ¨æŒ‡å®š map å®¹é‡æ—¶ï¼Œä»å¯èƒ½å‘ç”Ÿåˆ†é…ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>os<span class="token punctuation">.</span>FileInfo<span class="token punctuation">)</span>

files<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span><span class="token string">&quot;./files&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span>
    m<span class="token punctuation">[</span>f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> f
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>
files<span class="token punctuation">,</span> <span class="token boolean">_</span> <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadDir</span><span class="token punctuation">(</span><span class="token string">&quot;./files&quot;</span><span class="token punctuation">)</span>

m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span><span class="token builtin">string</span><span class="token punctuation">]</span>os<span class="token punctuation">.</span>FileInfo<span class="token punctuation">,</span> <span class="token function">len</span><span class="token punctuation">(</span>files<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> f <span class="token operator">:=</span> <span class="token keyword">range</span> files <span class="token punctuation">{</span>
    m<span class="token punctuation">[</span>f<span class="token punctuation">.</span><span class="token function">Name</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> f
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><p><code>m</code> æ˜¯åœ¨æ²¡æœ‰å¤§å°æç¤ºçš„æƒ…å†µä¸‹åˆ›å»ºçš„ï¼› åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å¤šåˆ†é…ã€‚</p></td><td><p><code>m</code> æ˜¯æœ‰å¤§å°æç¤ºåˆ›å»ºçš„ï¼›åœ¨è¿è¡Œæ—¶å¯èƒ½ä¼šæœ‰æ›´å°‘çš„åˆ†é…ã€‚</p></td></tr></tbody></table><h4 id="æŒ‡å®šåˆ‡ç‰‡å®¹é‡" tabindex="-1"><a class="header-anchor" href="#æŒ‡å®šåˆ‡ç‰‡å®¹é‡"><span>æŒ‡å®šåˆ‡ç‰‡å®¹é‡</span></a></h4><p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œåœ¨ä½¿ç”¨<code>make()</code>åˆå§‹åŒ–åˆ‡ç‰‡æ—¶æä¾›å®¹é‡ä¿¡æ¯ï¼Œç‰¹åˆ«æ˜¯åœ¨è¿½åŠ åˆ‡ç‰‡æ—¶ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span>T<span class="token punctuation">,</span> length<span class="token punctuation">,</span> capacity<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>ä¸ maps ä¸åŒï¼Œslice capacity ä¸æ˜¯ä¸€ä¸ªæç¤ºï¼šç¼–è¯‘å™¨å°†ä¸ºæä¾›ç»™<code>make()</code>çš„ slice çš„å®¹é‡åˆ†é…è¶³å¤Ÿçš„å†…å­˜ï¼Œ è¿™æ„å‘³ç€åç»­çš„ append()`æ“ä½œå°†å¯¼è‡´é›¶åˆ†é…ï¼ˆç›´åˆ° slice çš„é•¿åº¦ä¸å®¹é‡åŒ¹é…ï¼Œåœ¨æ­¤ä¹‹åï¼Œä»»ä½• append éƒ½å¯èƒ½è°ƒæ•´å¤§å°ä»¥å®¹çº³å…¶ä»–å…ƒç´ ï¼‰ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> n<span class="token operator">++</span> <span class="token punctuation">{</span>
  data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> n <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> n <span class="token operator">&lt;</span> b<span class="token punctuation">.</span>N<span class="token punctuation">;</span> n<span class="token operator">++</span> <span class="token punctuation">{</span>
  data <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> size<span class="token punctuation">)</span>
  <span class="token keyword">for</span> k <span class="token operator">:=</span> <span class="token number">0</span><span class="token punctuation">;</span> k <span class="token operator">&lt;</span> size<span class="token punctuation">;</span> k<span class="token operator">++</span><span class="token punctuation">{</span>
    data <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>data<span class="token punctuation">,</span> k<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkBad-4    100000000    2.48s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-text line-numbers-mode" data-ext="text" data-title="text"><pre class="language-text"><code>BenchmarkGood-4   100000000    0.21s
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><h2 id="è§„èŒƒ" tabindex="-1"><a class="header-anchor" href="#è§„èŒƒ"><span>è§„èŒƒ</span></a></h2><h3 id="é¿å…è¿‡é•¿çš„è¡Œ" tabindex="-1"><a class="header-anchor" href="#é¿å…è¿‡é•¿çš„è¡Œ"><span>é¿å…è¿‡é•¿çš„è¡Œ</span></a></h3><p>é¿å…ä½¿ç”¨éœ€è¦è¯»è€…æ°´å¹³æ»šåŠ¨æˆ–è¿‡åº¦è½¬åŠ¨å¤´éƒ¨çš„ä»£ç è¡Œã€‚</p><p>æˆ‘ä»¬å»ºè®®å°†è¡Œé•¿åº¦é™åˆ¶ä¸º <strong>99 characters</strong> (99 ä¸ªå­—ç¬¦). ä½œè€…åº”è¯¥åœ¨è¾¾åˆ°è¿™ä¸ªé™åˆ¶ä¹‹å‰æ¢è¡Œï¼Œ ä½†è¿™ä¸æ˜¯ç¡¬æ€§é™åˆ¶ã€‚ å…è®¸ä»£ç è¶…è¿‡æ­¤é™åˆ¶ã€‚</p><h3 id="ä¸€è‡´æ€§" tabindex="-1"><a class="header-anchor" href="#ä¸€è‡´æ€§"><span>ä¸€è‡´æ€§</span></a></h3><p>æœ¬æ–‡ä¸­æ¦‚è¿°çš„ä¸€äº›æ ‡å‡†éƒ½æ˜¯å®¢è§‚æ€§çš„è¯„ä¼°ï¼Œæ˜¯æ ¹æ®åœºæ™¯ã€ä¸Šä¸‹æ–‡ã€æˆ–è€…ä¸»è§‚æ€§çš„åˆ¤æ–­ï¼›</p><p>ä½†æ˜¯æœ€é‡è¦çš„æ˜¯ï¼Œ<strong>ä¿æŒä¸€è‡´</strong>.</p><p>ä¸€è‡´æ€§çš„ä»£ç æ›´å®¹æ˜“ç»´æŠ¤ã€æ˜¯æ›´åˆç†çš„ã€éœ€è¦æ›´å°‘çš„å­¦ä¹ æˆæœ¬ã€å¹¶ä¸”éšç€æ–°çš„çº¦å®šå‡ºç°æˆ–è€…å‡ºç°é”™è¯¯åæ›´å®¹æ˜“è¿ç§»ã€æ›´æ–°ã€ä¿®å¤ bug</p><p>ç›¸åï¼Œåœ¨ä¸€ä¸ªä»£ç åº“ä¸­åŒ…å«å¤šä¸ªå®Œå…¨ä¸åŒæˆ–å†²çªçš„ä»£ç é£æ ¼ä¼šå¯¼è‡´ç»´æŠ¤æˆæœ¬å¼€é”€ã€ä¸ç¡®å®šæ€§å’Œè®¤çŸ¥åå·®ã€‚æ‰€æœ‰è¿™äº›éƒ½ä¼šç›´æ¥å¯¼è‡´é€Ÿåº¦é™ä½ã€ä»£ç å®¡æŸ¥ç—›è‹¦ã€è€Œä¸”å¢åŠ  bug æ•°é‡ã€‚</p><p>å°†è¿™äº›æ ‡å‡†åº”ç”¨äºä»£ç åº“æ—¶ï¼Œå»ºè®®åœ¨ packageï¼ˆæˆ–æ›´å¤§ï¼‰çº§åˆ«è¿›è¡Œæ›´æ”¹ï¼Œå­åŒ…çº§åˆ«çš„åº”ç”¨ç¨‹åºé€šè¿‡å°†å¤šä¸ªæ ·å¼å¼•å…¥åˆ°åŒä¸€ä»£ç ä¸­ï¼Œè¿åäº†ä¸Šè¿°å…³æ³¨ç‚¹ã€‚</p><h3 id="ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„" tabindex="-1"><a class="header-anchor" href="#ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„"><span>ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ç»„</span></a></h3><p>Go è¯­è¨€æ”¯æŒå°†ç›¸ä¼¼çš„å£°æ˜æ”¾åœ¨ä¸€ä¸ªç»„å†…ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token string">&quot;a&quot;</span>
<span class="token keyword">import</span> <span class="token string">&quot;b&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;a&quot;</span>
  <span class="token string">&quot;b&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>è¿™åŒæ ·é€‚ç”¨äºå¸¸é‡ã€å˜é‡å’Œç±»å‹å£°æ˜ï¼š</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>
<span class="token keyword">const</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">const</span> b <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">var</span> a <span class="token operator">=</span> <span class="token number">1</span>
<span class="token keyword">var</span> b <span class="token operator">=</span> <span class="token number">2</span>

<span class="token keyword">type</span> Area <span class="token builtin">float64</span>
<span class="token keyword">type</span> Volume <span class="token builtin">float64</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">const</span> <span class="token punctuation">(</span>
  a <span class="token operator">=</span> <span class="token number">1</span>
  b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token keyword">var</span> <span class="token punctuation">(</span>
  a <span class="token operator">=</span> <span class="token number">1</span>
  b <span class="token operator">=</span> <span class="token number">2</span>
<span class="token punctuation">)</span>

<span class="token keyword">type</span> <span class="token punctuation">(</span>
  Area <span class="token builtin">float64</span>
  Volume <span class="token builtin">float64</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>ä»…å°†ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚ä¸è¦å°†ä¸ç›¸å…³çš„å£°æ˜æ”¾åœ¨ä¸€ç»„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Operation <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  Add Operation <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>
  Subtract
  Multiply
  EnvVar <span class="token operator">=</span> <span class="token string">&quot;MY_ENV&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Operation <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  Add Operation <span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>
  Subtract
  Multiply
<span class="token punctuation">)</span>

<span class="token keyword">const</span> EnvVar <span class="token operator">=</span> <span class="token string">&quot;MY_ENV&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>åˆ†ç»„ä½¿ç”¨çš„ä½ç½®æ²¡æœ‰é™åˆ¶ï¼Œä¾‹å¦‚ï¼šä½ å¯ä»¥åœ¨å‡½æ•°å†…éƒ¨ä½¿ç”¨å®ƒä»¬ï¼š</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  red <span class="token operator">:=</span> color<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span>
  green <span class="token operator">:=</span> color<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">0x00ff00</span><span class="token punctuation">)</span>
  blue <span class="token operator">:=</span> color<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">0x0000ff</span><span class="token punctuation">)</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token punctuation">(</span>
    red   <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">0xff0000</span><span class="token punctuation">)</span>
    green <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">0x00ff00</span><span class="token punctuation">)</span>
    blue  <span class="token operator">=</span> color<span class="token punctuation">.</span><span class="token function">New</span><span class="token punctuation">(</span><span class="token number">0x0000ff</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

  <span class="token operator">...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>ä¾‹å¤–ï¼šå¦‚æœå˜é‡å£°æ˜ä¸å…¶ä»–å˜é‡ç›¸é‚»ï¼Œåˆ™åº”å°†å˜é‡å£°æ˜ï¼ˆå°¤å…¶æ˜¯å‡½æ•°å†…éƒ¨çš„å£°æ˜ï¼‰åˆ†ç»„åœ¨ä¸€èµ·ã€‚å¯¹ä¸€èµ·å£°æ˜çš„å˜é‡æ‰§è¡Œæ­¤æ“ä½œï¼Œå³ä½¿å®ƒä»¬ä¸ç›¸å…³ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>client<span class="token punctuation">)</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  caller <span class="token operator">:=</span> c<span class="token punctuation">.</span>name
  format <span class="token operator">:=</span> <span class="token string">&quot;json&quot;</span>
  timeout <span class="token operator">:=</span> <span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second
  <span class="token keyword">var</span> err <span class="token builtin">error</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>c <span class="token operator">*</span>client<span class="token punctuation">)</span> <span class="token function">request</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> <span class="token punctuation">(</span>
    caller  <span class="token operator">=</span> c<span class="token punctuation">.</span>name
    format  <span class="token operator">=</span> <span class="token string">&quot;json&quot;</span>
    timeout <span class="token operator">=</span> <span class="token number">5</span><span class="token operator">*</span>time<span class="token punctuation">.</span>Second
    err <span class="token builtin">error</span>
  <span class="token punctuation">)</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="import-åˆ†ç»„" tabindex="-1"><a class="header-anchor" href="#import-åˆ†ç»„"><span>import åˆ†ç»„</span></a></h3><p>å¯¼å…¥åº”è¯¥åˆ†ä¸ºä¸¤ç»„ï¼š</p><ul><li>æ ‡å‡†åº“</li><li>å…¶ä»–åº“</li></ul><p>é»˜è®¤æƒ…å†µä¸‹ï¼Œè¿™æ˜¯ goimports åº”ç”¨çš„åˆ†ç»„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;os&quot;</span>
  <span class="token string">&quot;go.uber.org/atomic&quot;</span>
  <span class="token string">&quot;golang.org/x/sync/errgroup&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;os&quot;</span>

  <span class="token string">&quot;go.uber.org/atomic&quot;</span>
  <span class="token string">&quot;golang.org/x/sync/errgroup&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="åŒ…å" tabindex="-1"><a class="header-anchor" href="#åŒ…å"><span>åŒ…å</span></a></h3><p>å½“å‘½ååŒ…æ—¶ï¼Œè¯·æŒ‰ä¸‹é¢è§„åˆ™é€‰æ‹©ä¸€ä¸ªåç§°ï¼š</p><ul><li>å…¨éƒ¨å°å†™ã€‚æ²¡æœ‰å¤§å†™æˆ–ä¸‹åˆ’çº¿ã€‚</li><li>å¤§å¤šæ•°ä½¿ç”¨å‘½åå¯¼å…¥çš„æƒ…å†µä¸‹ï¼Œä¸éœ€è¦é‡å‘½åã€‚</li><li>ç®€çŸ­è€Œç®€æ´ã€‚è¯·è®°ä½ï¼Œåœ¨æ¯ä¸ªä½¿ç”¨çš„åœ°æ–¹éƒ½å®Œæ•´æ ‡è¯†äº†è¯¥åç§°ã€‚</li><li>ä¸ç”¨å¤æ•°ã€‚ä¾‹å¦‚<code>net/url</code>ï¼Œè€Œä¸æ˜¯<code>net/urls</code>ã€‚</li><li>ä¸è¦ç”¨â€œcommonâ€ï¼Œâ€œutilâ€ï¼Œâ€œsharedâ€æˆ–â€œlibâ€ã€‚è¿™äº›æ˜¯ä¸å¥½çš„ï¼Œä¿¡æ¯é‡ä¸è¶³çš„åç§°ã€‚</li></ul><p>å¦è¯·å‚é˜… <a href="https://blog.golang.org/package-names" target="_blank" rel="noopener noreferrer">Go åŒ…å‘½åè§„åˆ™</a> å’Œ <a href="https://rakyll.org/style-packages/" target="_blank" rel="noopener noreferrer">Go åŒ…æ ·å¼æŒ‡å—</a>.</p><h3 id="å‡½æ•°å" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°å"><span>å‡½æ•°å</span></a></h3><p>æˆ‘ä»¬éµå¾ª Go ç¤¾åŒºå…³äºä½¿ç”¨ <a href="https://golang.org/doc/effective_go.html#mixed-caps" target="_blank" rel="noopener noreferrer">MixedCaps ä½œä¸ºå‡½æ•°å</a> çš„çº¦å®šã€‚æœ‰ä¸€ä¸ªä¾‹å¤–ï¼Œä¸ºäº†å¯¹ç›¸å…³çš„æµ‹è¯•ç”¨ä¾‹è¿›è¡Œåˆ†ç»„ï¼Œå‡½æ•°åå¯èƒ½åŒ…å«ä¸‹åˆ’çº¿ï¼Œå¦‚ï¼š<code>TestMyFunction_WhatIsBeingTested</code>.</p><h3 id="å¯¼å…¥åˆ«å" tabindex="-1"><a class="header-anchor" href="#å¯¼å…¥åˆ«å"><span>å¯¼å…¥åˆ«å</span></a></h3><p>å¦‚æœç¨‹åºåŒ…åç§°ä¸å¯¼å…¥è·¯å¾„çš„æœ€åä¸€ä¸ªå…ƒç´ ä¸åŒ¹é…ï¼Œåˆ™å¿…é¡»ä½¿ç”¨å¯¼å…¥åˆ«åã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;net/http&quot;</span>

  client <span class="token string">&quot;example.com/client-go&quot;</span>
  trace <span class="token string">&quot;example.com/trace/v2&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨æ‰€æœ‰å…¶ä»–æƒ…å†µä¸‹ï¼Œé™¤éå¯¼å…¥ä¹‹é—´æœ‰ç›´æ¥å†²çªï¼Œå¦åˆ™åº”é¿å…å¯¼å…¥åˆ«åã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;os&quot;</span>

  nettrace <span class="token string">&quot;golang.net/x/trace&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">import</span> <span class="token punctuation">(</span>
  <span class="token string">&quot;fmt&quot;</span>
  <span class="token string">&quot;os&quot;</span>
  <span class="token string">&quot;runtime/trace&quot;</span>

  nettrace <span class="token string">&quot;golang.net/x/trace&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="å‡½æ•°åˆ†ç»„ä¸é¡ºåº" tabindex="-1"><a class="header-anchor" href="#å‡½æ•°åˆ†ç»„ä¸é¡ºåº"><span>å‡½æ•°åˆ†ç»„ä¸é¡ºåº</span></a></h3><ul><li>å‡½æ•°åº”æŒ‰ç²—ç•¥çš„è°ƒç”¨é¡ºåºæ’åºã€‚</li><li>åŒä¸€æ–‡ä»¶ä¸­çš„å‡½æ•°åº”æŒ‰æ¥æ”¶è€…åˆ†ç»„ã€‚</li></ul><p>å› æ­¤ï¼Œå¯¼å‡ºçš„å‡½æ•°åº”å…ˆå‡ºç°åœ¨æ–‡ä»¶ä¸­ï¼Œæ”¾åœ¨<code>struct</code>, <code>const</code>, <code>var</code>å®šä¹‰çš„åé¢ã€‚</p><p>åœ¨å®šä¹‰ç±»å‹ä¹‹åï¼Œä½†åœ¨æ¥æ”¶è€…çš„å…¶ä½™æ–¹æ³•ä¹‹å‰ï¼Œå¯èƒ½ä¼šå‡ºç°ä¸€ä¸ª <code>newXYZ()</code>/<code>NewXYZ()</code></p><p>ç”±äºå‡½æ•°æ˜¯æŒ‰æ¥æ”¶è€…åˆ†ç»„çš„ï¼Œå› æ­¤æ™®é€šå·¥å…·å‡½æ•°åº”åœ¨æ–‡ä»¶æœ«å°¾å‡ºç°ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>something<span class="token punctuation">)</span> <span class="token function">Cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">calcCost</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>weights<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> something <span class="token keyword">struct</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">calcCost</span><span class="token punctuation">(</span>n <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>something<span class="token punctuation">)</span> <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>something <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>something<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> something <span class="token keyword">struct</span><span class="token punctuation">{</span> <span class="token operator">...</span> <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">newSomething</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token operator">*</span>something <span class="token punctuation">{</span>
    <span class="token keyword">return</span> <span class="token operator">&amp;</span>something<span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>something<span class="token punctuation">)</span> <span class="token function">Cost</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">calcCost</span><span class="token punctuation">(</span>s<span class="token punctuation">.</span>weights<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>s <span class="token operator">*</span>something<span class="token punctuation">)</span> <span class="token function">Stop</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">calcCost</span><span class="token punctuation">(</span>n <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token builtin">int</span> <span class="token punctuation">{</span><span class="token operator">...</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="å‡å°‘åµŒå¥—" tabindex="-1"><a class="header-anchor" href="#å‡å°‘åµŒå¥—"><span>å‡å°‘åµŒå¥—</span></a></h3><p>ä»£ç åº”é€šè¿‡å°½å¯èƒ½å…ˆå¤„ç†é”™è¯¯æƒ…å†µ/ç‰¹æ®Šæƒ…å†µå¹¶å°½æ—©è¿”å›æˆ–ç»§ç»­å¾ªç¯æ¥å‡å°‘åµŒå¥—ã€‚å‡å°‘åµŒå¥—å¤šä¸ªçº§åˆ«çš„ä»£ç çš„ä»£ç é‡ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data <span class="token punctuation">{</span>
  <span class="token keyword">if</span> v<span class="token punctuation">.</span>F1 <span class="token operator">==</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    v <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
    <span class="token keyword">if</span> err <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
      v<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
      <span class="token keyword">return</span> err
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid v: %v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> data <span class="token punctuation">{</span>
  <span class="token keyword">if</span> v<span class="token punctuation">.</span>F1 <span class="token operator">!=</span> <span class="token number">1</span> <span class="token punctuation">{</span>
    log<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span><span class="token string">&quot;Invalid v: %v&quot;</span><span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token keyword">continue</span>
  <span class="token punctuation">}</span>

  v <span class="token operator">=</span> <span class="token function">process</span><span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">:=</span> v<span class="token punctuation">.</span><span class="token function">Call</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>
  v<span class="token punctuation">.</span><span class="token function">Send</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="ä¸å¿…è¦çš„-else" tabindex="-1"><a class="header-anchor" href="#ä¸å¿…è¦çš„-else"><span>ä¸å¿…è¦çš„ else</span></a></h3><p>å¦‚æœåœ¨ if çš„ä¸¤ä¸ªåˆ†æ”¯ä¸­éƒ½è®¾ç½®äº†å˜é‡ï¼Œåˆ™å¯ä»¥å°†å…¶æ›¿æ¢ä¸ºå•ä¸ª ifã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> a <span class="token builtin">int</span>
<span class="token keyword">if</span> b <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">100</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">10</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>a <span class="token operator">:=</span> <span class="token number">10</span>
<span class="token keyword">if</span> b <span class="token punctuation">{</span>
  a <span class="token operator">=</span> <span class="token number">100</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="é¡¶å±‚å˜é‡å£°æ˜" tabindex="-1"><a class="header-anchor" href="#é¡¶å±‚å˜é‡å£°æ˜"><span>é¡¶å±‚å˜é‡å£°æ˜</span></a></h3><p>åœ¨é¡¶å±‚ï¼Œä½¿ç”¨æ ‡å‡†<code>var</code>å…³é”®å­—ã€‚è¯·å‹¿æŒ‡å®šç±»å‹ï¼Œé™¤éå®ƒä¸è¡¨è¾¾å¼çš„ç±»å‹ä¸åŒã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> _s <span class="token builtin">string</span> <span class="token operator">=</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> _s <span class="token operator">=</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// ç”±äº F å·²ç»æ˜ç¡®äº†è¿”å›ä¸€ä¸ªå­—ç¬¦ä¸²ç±»å‹ï¼Œå› æ­¤æˆ‘ä»¬æ²¡æœ‰å¿…è¦æ˜¾å¼æŒ‡å®š_s çš„ç±»å‹</span>
<span class="token comment">// è¿˜æ˜¯é‚£ç§ç±»å‹</span>

<span class="token keyword">func</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;A&quot;</span> <span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¦‚æœè¡¨è¾¾å¼çš„ç±»å‹ä¸æ‰€éœ€çš„ç±»å‹ä¸å®Œå…¨åŒ¹é…ï¼Œè¯·æŒ‡å®šç±»å‹ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> myError <span class="token keyword">struct</span><span class="token punctuation">{</span><span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>myError<span class="token punctuation">)</span> <span class="token function">Error</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token builtin">string</span> <span class="token punctuation">{</span> <span class="token keyword">return</span> <span class="token string">&quot;error&quot;</span> <span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span> myError <span class="token punctuation">{</span> <span class="token keyword">return</span> myError<span class="token punctuation">{</span><span class="token punctuation">}</span> <span class="token punctuation">}</span>

<span class="token keyword">var</span> _e <span class="token builtin">error</span> <span class="token operator">=</span> <span class="token function">F</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token comment">// F è¿”å›ä¸€ä¸ª myError ç±»å‹çš„å®ä¾‹ï¼Œä½†æ˜¯æˆ‘ä»¬è¦ error ç±»å‹</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡-ä½¿ç”¨-ä½œä¸ºå‰ç¼€" tabindex="-1"><a class="header-anchor" href="#å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡-ä½¿ç”¨-ä½œä¸ºå‰ç¼€"><span>å¯¹äºæœªå¯¼å‡ºçš„é¡¶å±‚å¸¸é‡å’Œå˜é‡ï¼Œä½¿ç”¨_ä½œä¸ºå‰ç¼€</span></a></h3><p>åœ¨æœªå¯¼å‡ºçš„é¡¶çº§<code>vars</code>å’Œ<code>consts</code>ï¼Œ å‰é¢åŠ ä¸Šå‰ç¼€_ï¼Œä»¥ä½¿å®ƒä»¬åœ¨ä½¿ç”¨æ—¶æ˜ç¡®è¡¨ç¤ºå®ƒä»¬æ˜¯å…¨å±€ç¬¦å·ã€‚</p><p>åŸºæœ¬ä¾æ®ï¼šé¡¶çº§å˜é‡å’Œå¸¸é‡å…·æœ‰åŒ…èŒƒå›´ä½œç”¨åŸŸã€‚ä½¿ç”¨é€šç”¨åç§°å¯èƒ½å¾ˆå®¹æ˜“åœ¨å…¶ä»–æ–‡ä»¶ä¸­æ„å¤–ä½¿ç”¨é”™è¯¯çš„å€¼ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// foo.go</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  defaultPort <span class="token operator">=</span> <span class="token number">8080</span>
  defaultUser <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span>
<span class="token punctuation">)</span>

<span class="token comment">// bar.go</span>

<span class="token keyword">func</span> <span class="token function">Bar</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  defaultPort <span class="token operator">:=</span> <span class="token number">9090</span>
  <span class="token operator">...</span>
  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span><span class="token string">&quot;Default port&quot;</span><span class="token punctuation">,</span> defaultPort<span class="token punctuation">)</span>

  <span class="token comment">// We will not see a compile error if the first line of</span>
  <span class="token comment">// Bar() is deleted.</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// foo.go</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  _defaultPort <span class="token operator">=</span> <span class="token number">8080</span>
  _defaultUser <span class="token operator">=</span> <span class="token string">&quot;user&quot;</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p><strong>ä¾‹å¤–</strong>ï¼šæœªå¯¼å‡ºçš„é”™è¯¯å€¼å¯ä»¥ä½¿ç”¨ä¸å¸¦ä¸‹åˆ’çº¿çš„å‰ç¼€ <code>err</code>ã€‚ å‚è§<a href="#%E9%94%99%E8%AF%AF%E5%91%BD%E5%90%8D">é”™è¯¯å‘½å</a>ã€‚</p><h3 id="ç»“æ„ä½“ä¸­çš„åµŒå…¥" tabindex="-1"><a class="header-anchor" href="#ç»“æ„ä½“ä¸­çš„åµŒå…¥"><span>ç»“æ„ä½“ä¸­çš„åµŒå…¥</span></a></h3><p>åµŒå…¥å¼ç±»å‹ï¼ˆä¾‹å¦‚ mutexï¼‰åº”ä½äºç»“æ„ä½“å†…çš„å­—æ®µåˆ—è¡¨çš„é¡¶éƒ¨ï¼Œå¹¶ä¸”å¿…é¡»æœ‰ä¸€ä¸ªç©ºè¡Œå°†åµŒå…¥å¼å­—æ®µä¸å¸¸è§„å­—æ®µåˆ†éš”å¼€ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  version <span class="token builtin">int</span>
  http<span class="token punctuation">.</span>Client
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  http<span class="token punctuation">.</span>Client

  version <span class="token builtin">int</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å†…åµŒåº”è¯¥æä¾›åˆ‡å®çš„å¥½å¤„ï¼Œæ¯”å¦‚ä»¥è¯­ä¹‰ä¸Šåˆé€‚çš„æ–¹å¼æ·»åŠ æˆ–å¢å¼ºåŠŸèƒ½ã€‚ å®ƒåº”è¯¥åœ¨å¯¹ç”¨æˆ·æ²¡æœ‰ä»»ä½•ä¸åˆ©å½±å“çš„æƒ…å†µä¸‹ä½¿ç”¨ã€‚ï¼ˆå¦è¯·å‚è§ï¼š<a href="#%E9%81%BF%E5%85%8D%E5%9C%A8%E5%85%AC%E5%85%B1%E7%BB%93%E6%9E%84%E4%B8%AD%E5%B5%8C%E5%85%A5%E7%B1%BB%E5%9E%8B">é¿å…åœ¨å…¬å…±ç»“æ„ä¸­åµŒå…¥ç±»å‹</a>ï¼‰ã€‚</p><p>ä¾‹å¤–ï¼šå³ä½¿åœ¨æœªå¯¼å‡ºç±»å‹ä¸­ï¼ŒMutex ä¹Ÿä¸åº”è¯¥ä½œä¸ºå†…åµŒå­—æ®µã€‚å¦è¯·å‚è§ï¼š<a href="#%E9%9B%B6%E5%80%BC-mutex-%E6%98%AF%E6%9C%89%E6%95%88%E7%9A%84">é›¶å€¼ Mutex æ˜¯æœ‰æ•ˆçš„</a>ã€‚</p><p>åµŒå…¥ <strong>ä¸åº”è¯¥</strong>:</p><ul><li>çº¯ç²¹æ˜¯ä¸ºäº†ç¾è§‚æˆ–æ–¹ä¾¿ã€‚</li><li>ä½¿å¤–éƒ¨ç±»å‹æ›´éš¾æ„é€ æˆ–ä½¿ç”¨ã€‚</li><li>å½±å“å¤–éƒ¨ç±»å‹çš„é›¶å€¼ã€‚å¦‚æœå¤–éƒ¨ç±»å‹æœ‰ä¸€ä¸ªæœ‰ç”¨çš„é›¶å€¼ï¼Œåˆ™åœ¨åµŒå…¥å†…éƒ¨ç±»å‹ä¹‹ååº”è¯¥ä»ç„¶æœ‰ä¸€ä¸ªæœ‰ç”¨çš„é›¶å€¼ã€‚</li><li>ä½œä¸ºåµŒå…¥å†…éƒ¨ç±»å‹çš„å‰¯ä½œç”¨ï¼Œä»å¤–éƒ¨ç±»å‹å…¬å¼€ä¸ç›¸å…³çš„å‡½æ•°æˆ–å­—æ®µã€‚</li><li>å…¬å¼€æœªå¯¼å‡ºçš„ç±»å‹ã€‚</li><li>å½±å“å¤–éƒ¨ç±»å‹çš„å¤åˆ¶å½¢å¼ã€‚</li><li>æ›´æ”¹å¤–éƒ¨ç±»å‹çš„ API æˆ–ç±»å‹è¯­ä¹‰ã€‚</li><li>åµŒå…¥å†…éƒ¨ç±»å‹çš„éè§„èŒƒå½¢å¼ã€‚</li><li>å…¬å¼€å¤–éƒ¨ç±»å‹çš„å®ç°è¯¦ç»†ä¿¡æ¯ã€‚</li><li>å…è®¸ç”¨æˆ·è§‚å¯Ÿæˆ–æ§åˆ¶ç±»å‹å†…éƒ¨ã€‚</li><li>é€šè¿‡åŒ…è£…çš„æ–¹å¼æ”¹å˜å†…éƒ¨å‡½æ•°çš„ä¸€èˆ¬è¡Œä¸ºï¼Œè¿™ç§åŒ…è£…æ–¹å¼ä¼šç»™ç”¨æˆ·å¸¦æ¥ä¸€äº›æ„æ–™ä¹‹å¤–æƒ…å†µã€‚</li></ul><p>ç®€å•åœ°è¯´ï¼Œæœ‰æ„è¯†åœ°å’Œæœ‰ç›®çš„åœ°åµŒå…¥ã€‚ä¸€ç§å¾ˆå¥½çš„æµ‹è¯•ä½“éªŒæ˜¯ï¼Œ &quot;æ˜¯å¦æ‰€æœ‰è¿™äº›å¯¼å‡ºçš„å†…éƒ¨æ–¹æ³•/å­—æ®µéƒ½å°†ç›´æ¥æ·»åŠ åˆ°å¤–éƒ¨ç±»å‹&quot; å¦‚æœç­”æ¡ˆæ˜¯<code>some</code>æˆ–<code>no</code>ï¼Œä¸è¦åµŒå…¥å†…éƒ¨ç±»å‹ - è€Œæ˜¯ä½¿ç”¨å­—æ®µã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> A <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bad: A.Lock() and A.Unlock() ç°åœ¨å¯ç”¨</span>
    <span class="token comment">// ä¸æä¾›ä»»ä½•åŠŸèƒ½æ€§å¥½å¤„ï¼Œå¹¶å…è®¸ç”¨æˆ·æ§åˆ¶æœ‰å…³ A çš„å†…éƒ¨ç»†èŠ‚ã€‚</span>
    sync<span class="token punctuation">.</span>Mutex
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> countingWriteCloser <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// Good: Write() åœ¨å¤–å±‚æä¾›ç”¨äºç‰¹å®šç›®çš„ï¼Œ</span>
    <span class="token comment">// å¹¶ä¸”å§”æ‰˜å·¥ä½œåˆ°å†…éƒ¨ç±»å‹çš„ Write() ä¸­ã€‚</span>
    io<span class="token punctuation">.</span>WriteCloser
    count <span class="token builtin">int</span>
<span class="token punctuation">}</span>
<span class="token keyword">func</span> <span class="token punctuation">(</span>w <span class="token operator">*</span>countingWriteCloser<span class="token punctuation">)</span> <span class="token function">Write</span><span class="token punctuation">(</span>bs <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">byte</span><span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token builtin">int</span><span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
    w<span class="token punctuation">.</span>count <span class="token operator">+=</span> <span class="token function">len</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span>
    <span class="token keyword">return</span> w<span class="token punctuation">.</span>WriteCloser<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span>bs<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Book <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// Bad: æŒ‡é’ˆæ›´æ”¹é›¶å€¼çš„æœ‰ç”¨æ€§</span>
    io<span class="token punctuation">.</span>ReadWriter
    <span class="token comment">// other fields</span>
<span class="token punctuation">}</span>
<span class="token comment">// later</span>
<span class="token keyword">var</span> b Book
b<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>  <span class="token comment">// panic: nil pointer</span>
b<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// panic: nil pointer</span>
b<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// panic: nil pointer</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Book <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    <span class="token comment">// Good: æœ‰ç”¨çš„é›¶å€¼</span>
    bytes<span class="token punctuation">.</span>Buffer
    <span class="token comment">// other fields</span>
<span class="token punctuation">}</span>
<span class="token comment">// later</span>
<span class="token keyword">var</span> b Book
b<span class="token punctuation">.</span><span class="token function">Read</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span>  <span class="token comment">// ok</span>
b<span class="token punctuation">.</span><span class="token function">String</span><span class="token punctuation">(</span><span class="token punctuation">)</span>   <span class="token comment">// ok</span>
b<span class="token punctuation">.</span><span class="token function">Write</span><span class="token punctuation">(</span><span class="token operator">...</span><span class="token punctuation">)</span> <span class="token comment">// ok</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    sync<span class="token punctuation">.</span>Mutex
    sync<span class="token punctuation">.</span>WaitGroup
    bytes<span class="token punctuation">.</span>Buffer
    url<span class="token punctuation">.</span>URL
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Client <span class="token keyword">struct</span> <span class="token punctuation">{</span>
    mtx sync<span class="token punctuation">.</span>Mutex
    wg  sync<span class="token punctuation">.</span>WaitGroup
    buf bytes<span class="token punctuation">.</span>Buffer
    url url<span class="token punctuation">.</span>URL
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="æœ¬åœ°å˜é‡å£°æ˜" tabindex="-1"><a class="header-anchor" href="#æœ¬åœ°å˜é‡å£°æ˜"><span>æœ¬åœ°å˜é‡å£°æ˜</span></a></h3><p>å¦‚æœå°†å˜é‡æ˜ç¡®è®¾ç½®ä¸ºæŸä¸ªå€¼ï¼Œåˆ™åº”ä½¿ç”¨çŸ­å˜é‡å£°æ˜å½¢å¼ (<code>:=</code>)ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> s <span class="token operator">=</span> <span class="token string">&quot;foo&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>s <span class="token operator">:=</span> <span class="token string">&quot;foo&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><p>ä½†æ˜¯ï¼Œåœ¨æŸäº›æƒ…å†µä¸‹ï¼Œ<code>var</code> ä½¿ç”¨å…³é”®å­—æ—¶é»˜è®¤å€¼ä¼šæ›´æ¸…æ™°ã€‚ä¾‹å¦‚ï¼Œ<a href="https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices" target="_blank" rel="noopener noreferrer">å£°æ˜ç©ºåˆ‡ç‰‡</a>ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span>list <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  filtered <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> list <span class="token punctuation">{</span>
    <span class="token keyword">if</span> v <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>
      filtered <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>filtered<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">f</span><span class="token punctuation">(</span>list <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token keyword">var</span> filtered <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>
  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> v <span class="token operator">:=</span> <span class="token keyword">range</span> list <span class="token punctuation">{</span>
    <span class="token keyword">if</span> v <span class="token operator">&gt;</span> <span class="token number">10</span> <span class="token punctuation">{</span>
      filtered <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>filtered<span class="token punctuation">,</span> v<span class="token punctuation">)</span>
    <span class="token punctuation">}</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice" tabindex="-1"><a class="header-anchor" href="#nil-æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„-slice"><span>nil æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„ slice</span></a></h3><p><code>nil</code> æ˜¯ä¸€ä¸ªæœ‰æ•ˆçš„é•¿åº¦ä¸º 0 çš„ sliceï¼Œè¿™æ„å‘³ç€ï¼Œ</p><ul><li><p>æ‚¨ä¸åº”æ˜ç¡®è¿”å›é•¿åº¦ä¸ºé›¶çš„åˆ‡ç‰‡ã€‚åº”è¯¥è¿”å›<code>nil</code> æ¥ä»£æ›¿ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">if</span> x <span class="token operator">==</span> <span class="token string">&quot;&quot;</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table></li><li><p>è¦æ£€æŸ¥åˆ‡ç‰‡æ˜¯å¦ä¸ºç©ºï¼Œè¯·å§‹ç»ˆä½¿ç”¨<code>len(s) == 0</code>ã€‚è€Œé <code>nil</code>ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> s <span class="token operator">==</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">func</span> <span class="token function">isEmpty</span><span class="token punctuation">(</span>s <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">string</span><span class="token punctuation">)</span> <span class="token builtin">bool</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">len</span><span class="token punctuation">(</span>s<span class="token punctuation">)</span> <span class="token operator">==</span> <span class="token number">0</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table></li><li><p>é›¶å€¼åˆ‡ç‰‡ï¼ˆç”¨<code>var</code>å£°æ˜çš„åˆ‡ç‰‡ï¼‰å¯ç«‹å³ä½¿ç”¨ï¼Œæ— éœ€è°ƒç”¨<code>make()</code>åˆ›å»ºã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>nums <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span><span class="token punctuation">{</span><span class="token punctuation">}</span>
<span class="token comment">// or, nums := make([]int)</span>

<span class="token keyword">if</span> add1 <span class="token punctuation">{</span>
  nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> add2 <span class="token punctuation">{</span>
  nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> nums <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token builtin">int</span>

<span class="token keyword">if</span> add1 <span class="token punctuation">{</span>
  nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">if</span> add2 <span class="token punctuation">{</span>
  nums <span class="token operator">=</span> <span class="token function">append</span><span class="token punctuation">(</span>nums<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table></li></ul><p>è®°ä½ï¼Œè™½ç„¶ nil åˆ‡ç‰‡æ˜¯æœ‰æ•ˆçš„åˆ‡ç‰‡ï¼Œä½†å®ƒä¸ç­‰äºé•¿åº¦ä¸º 0 çš„åˆ‡ç‰‡ï¼ˆä¸€ä¸ªä¸º nilï¼Œå¦ä¸€ä¸ªä¸æ˜¯ï¼‰ï¼Œå¹¶ä¸”åœ¨ä¸åŒçš„æƒ…å†µä¸‹ï¼ˆä¾‹å¦‚åºåˆ—åŒ–ï¼‰ï¼Œè¿™ä¸¤ä¸ªåˆ‡ç‰‡çš„å¤„ç†æ–¹å¼å¯èƒ½ä¸åŒã€‚</p><h3 id="ç¼©å°å˜é‡ä½œç”¨åŸŸ" tabindex="-1"><a class="header-anchor" href="#ç¼©å°å˜é‡ä½œç”¨åŸŸ"><span>ç¼©å°å˜é‡ä½œç”¨åŸŸ</span></a></h3><p>å¦‚æœæœ‰å¯èƒ½ï¼Œå°½é‡ç¼©å°å˜é‡ä½œç”¨èŒƒå›´ã€‚é™¤éå®ƒä¸ <a href="#%E5%87%8F%E5%B0%91%E5%B5%8C%E5%A5%97">å‡å°‘åµŒå¥—</a>çš„è§„åˆ™å†²çªã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">if</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">WriteFile</span><span class="token punctuation">(</span>name<span class="token punctuation">,</span> data<span class="token punctuation">,</span> <span class="token number">0644</span><span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
 <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¦‚æœéœ€è¦åœ¨ if ä¹‹å¤–ä½¿ç”¨å‡½æ•°è°ƒç”¨çš„ç»“æœï¼Œåˆ™ä¸åº”å°è¯•ç¼©å°èŒƒå›´ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">if</span> data<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">==</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  err <span class="token operator">=</span> cfg<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span>
  <span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
    <span class="token keyword">return</span> err
  <span class="token punctuation">}</span>

  fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
  <span class="token keyword">return</span> <span class="token boolean">nil</span>
<span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>data<span class="token punctuation">,</span> err <span class="token operator">:=</span> os<span class="token punctuation">.</span><span class="token function">ReadFile</span><span class="token punctuation">(</span>name<span class="token punctuation">)</span>
<span class="token keyword">if</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
   <span class="token keyword">return</span> err
<span class="token punctuation">}</span>

<span class="token keyword">if</span> err <span class="token operator">:=</span> cfg<span class="token punctuation">.</span><span class="token function">Decode</span><span class="token punctuation">(</span>data<span class="token punctuation">)</span><span class="token punctuation">;</span> err <span class="token operator">!=</span> <span class="token boolean">nil</span> <span class="token punctuation">{</span>
  <span class="token keyword">return</span> err
<span class="token punctuation">}</span>

fmt<span class="token punctuation">.</span><span class="token function">Println</span><span class="token punctuation">(</span>cfg<span class="token punctuation">)</span>
<span class="token keyword">return</span> <span class="token boolean">nil</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®-avoid-naked-parameters" tabindex="-1"><a class="header-anchor" href="#é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡®-avoid-naked-parameters"><span>é¿å…å‚æ•°è¯­ä¹‰ä¸æ˜ç¡® (Avoid Naked Parameters)</span></a></h3><p>å‡½æ•°è°ƒç”¨ä¸­çš„<code>æ„ä¹‰ä¸æ˜ç¡®çš„å‚æ•°</code>å¯èƒ½ä¼šæŸå®³å¯è¯»æ€§ã€‚å½“å‚æ•°åç§°çš„å«ä¹‰ä¸æ˜æ˜¾æ—¶ï¼Œè¯·ä¸ºå‚æ•°æ·»åŠ  C æ ·å¼æ³¨é‡Š (<code>/* ... */</code>)</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// func printInfo(name string, isLocal, done bool)</span>

<span class="token function">printInfo</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// func printInfo(name string, isLocal, done bool)</span>

<span class="token function">printInfo</span><span class="token punctuation">(</span><span class="token string">&quot;foo&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* isLocal */</span><span class="token punctuation">,</span> <span class="token boolean">true</span> <span class="token comment">/* done */</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¯¹äºä¸Šé¢çš„ç¤ºä¾‹ä»£ç ï¼Œè¿˜æœ‰ä¸€ç§æ›´å¥½çš„å¤„ç†æ–¹å¼æ˜¯å°†ä¸Šé¢çš„ <code>bool</code> ç±»å‹æ¢æˆè‡ªå®šä¹‰ç±»å‹ã€‚å°†æ¥ï¼Œè¯¥å‚æ•°å¯ä»¥æ”¯æŒä¸ä»…ä»…å±€é™äºä¸¤ä¸ªçŠ¶æ€ï¼ˆtrue/falseï¼‰ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> Region <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  UnknownRegion Region <span class="token operator">=</span> <span class="token boolean">iota</span>
  Local
<span class="token punctuation">)</span>

<span class="token keyword">type</span> Status <span class="token builtin">int</span>

<span class="token keyword">const</span> <span class="token punctuation">(</span>
  StatusReady Status<span class="token operator">=</span> <span class="token boolean">iota</span> <span class="token operator">+</span> <span class="token number">1</span>
  StatusDone
  <span class="token comment">// Maybe we will have a StatusInProgress in the future.</span>
<span class="token punctuation">)</span>

<span class="token keyword">func</span> <span class="token function">printInfo</span><span class="token punctuation">(</span>name <span class="token builtin">string</span><span class="token punctuation">,</span> region Region<span class="token punctuation">,</span> status Status<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼-é¿å…è½¬ä¹‰" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼-é¿å…è½¬ä¹‰"><span>ä½¿ç”¨åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼ï¼Œé¿å…è½¬ä¹‰</span></a></h3><p>Go æ”¯æŒä½¿ç”¨ <a href="https://golang.org/ref/spec#raw_string_lit" target="_blank" rel="noopener noreferrer">åŸå§‹å­—ç¬¦ä¸²å­—é¢å€¼</a>ï¼Œä¹Ÿå°±æ˜¯ &quot; ` &quot; æ¥è¡¨ç¤ºåŸç”Ÿå­—ç¬¦ä¸²ï¼Œåœ¨éœ€è¦è½¬ä¹‰çš„åœºæ™¯ä¸‹ï¼Œæˆ‘ä»¬åº”è¯¥å°½é‡ä½¿ç”¨è¿™ç§æ–¹æ¡ˆæ¥æ›¿æ¢ã€‚</p><p>å¯ä»¥è·¨è¶Šå¤šè¡Œå¹¶åŒ…å«å¼•å·ã€‚ä½¿ç”¨è¿™äº›å­—ç¬¦ä¸²å¯ä»¥é¿å…æ›´éš¾é˜…è¯»çš„æ‰‹å·¥è½¬ä¹‰çš„å­—ç¬¦ä¸²ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>wantError <span class="token operator">:=</span> <span class="token string">&quot;unknown name:\&quot;test\&quot;&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>wantError <span class="token operator">:=</span> <span class="token string">`unknown error:&quot;test&quot;`</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="åˆå§‹åŒ–ç»“æ„ä½“" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–ç»“æ„ä½“"><span>åˆå§‹åŒ–ç»“æ„ä½“</span></a></h3><h4 id="ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„" tabindex="-1"><a class="header-anchor" href="#ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„"><span>ä½¿ç”¨å­—æ®µååˆå§‹åŒ–ç»“æ„</span></a></h4><p>åˆå§‹åŒ–ç»“æ„æ—¶ï¼Œå‡ ä¹åº”è¯¥å§‹ç»ˆæŒ‡å®šå­—æ®µåã€‚ç›®å‰ç”± <a href="https://golang.org/cmd/vet/" target="_blank" rel="noopener noreferrer"><code>go vet</code></a> å¼ºåˆ¶æ‰§è¡Œã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>k <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Doe&quot;</span><span class="token punctuation">,</span> <span class="token boolean">true</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>k <span class="token operator">:=</span> User<span class="token punctuation">{</span>
    FirstName<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
    LastName<span class="token punctuation">:</span> <span class="token string">&quot;Doe&quot;</span><span class="token punctuation">,</span>
    Admin<span class="token punctuation">:</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>ä¾‹å¤–ï¼šå½“æœ‰ 3 ä¸ªæˆ–æ›´å°‘çš„å­—æ®µæ—¶ï¼Œæµ‹è¯•è¡¨ä¸­çš„å­—æ®µå<em>may</em>å¯ä»¥çœç•¥ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span>
  op Operation
  want <span class="token builtin">string</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token punctuation">{</span>Add<span class="token punctuation">,</span> <span class="token string">&quot;add&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>Subtract<span class="token punctuation">,</span> <span class="token string">&quot;subtract&quot;</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="çœç•¥ç»“æ„ä¸­çš„é›¶å€¼å­—æ®µ" tabindex="-1"><a class="header-anchor" href="#çœç•¥ç»“æ„ä¸­çš„é›¶å€¼å­—æ®µ"><span>çœç•¥ç»“æ„ä¸­çš„é›¶å€¼å­—æ®µ</span></a></h4><p>åˆå§‹åŒ–å…·æœ‰å­—æ®µåçš„ç»“æ„æ—¶ï¼Œé™¤éæä¾›æœ‰æ„ä¹‰çš„ä¸Šä¸‹æ–‡ï¼Œå¦åˆ™å¿½ç•¥å€¼ä¸ºé›¶çš„å­—æ®µã€‚ ä¹Ÿå°±æ˜¯ï¼Œè®©æˆ‘ä»¬è‡ªåŠ¨å°†è¿™äº›è®¾ç½®ä¸ºé›¶å€¼</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>user <span class="token operator">:=</span> User<span class="token punctuation">{</span>
  FirstName<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  LastName<span class="token punctuation">:</span> <span class="token string">&quot;Doe&quot;</span><span class="token punctuation">,</span>
  MiddleName<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
  Admin<span class="token punctuation">:</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>user <span class="token operator">:=</span> User<span class="token punctuation">{</span>
  FirstName<span class="token punctuation">:</span> <span class="token string">&quot;John&quot;</span><span class="token punctuation">,</span>
  LastName<span class="token punctuation">:</span> <span class="token string">&quot;Doe&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>è¿™æœ‰åŠ©äºé€šè¿‡çœç•¥è¯¥ä¸Šä¸‹æ–‡ä¸­çš„é»˜è®¤å€¼æ¥å‡å°‘é˜…è¯»çš„éšœç¢ã€‚åªæŒ‡å®šæœ‰æ„ä¹‰çš„å€¼ã€‚</p><p>åœ¨å­—æ®µåæä¾›æœ‰æ„ä¹‰ä¸Šä¸‹æ–‡çš„åœ°æ–¹åŒ…å«é›¶å€¼ã€‚ä¾‹å¦‚ï¼Œ<a href="#%E8%A1%A8%E9%A9%B1%E5%8A%A8%E6%B5%8B%E8%AF%95">è¡¨é©±åŠ¨æµ‹è¯•</a> ä¸­çš„æµ‹è¯•ç”¨ä¾‹å¯ä»¥å—ç›Šäºå­—æ®µçš„åç§°ï¼Œå³ä½¿å®ƒä»¬æ˜¯é›¶å€¼çš„ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span>
  give <span class="token builtin">string</span>
  want <span class="token builtin">int</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token punctuation">{</span>give<span class="token punctuation">:</span> <span class="token string">&quot;0&quot;</span><span class="token punctuation">,</span> want<span class="token punctuation">:</span> <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h4 id="å¯¹é›¶å€¼ç»“æ„ä½¿ç”¨-var" tabindex="-1"><a class="header-anchor" href="#å¯¹é›¶å€¼ç»“æ„ä½¿ç”¨-var"><span>å¯¹é›¶å€¼ç»“æ„ä½¿ç”¨ <code>var</code></span></a></h4><p>å¦‚æœåœ¨å£°æ˜ä¸­çœç•¥äº†ç»“æ„çš„æ‰€æœ‰å­—æ®µï¼Œè¯·ä½¿ç”¨ <code>var</code> å£°æ˜ç»“æ„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>user <span class="token operator">:=</span> User<span class="token punctuation">{</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> user User
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div></td></tr></tbody></table><p>è¿™å°†é›¶å€¼ç»“æ„ä¸é‚£äº›å…·æœ‰ç±»ä¼¼äºä¸º <a href="#%E5%88%9D%E5%A7%8B%E5%8C%96-maps">åˆå§‹åŒ– Maps</a> åˆ›å»ºçš„ï¼ŒåŒºåˆ«äºéé›¶å€¼å­—æ®µçš„ç»“æ„åŒºåˆ†å¼€æ¥ï¼Œ å¹¶ä¸æˆ‘ä»¬æ›´å–œæ¬¢çš„ <a href="https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices" target="_blank" rel="noopener noreferrer">å£°æ˜ç©ºåˆ‡ç‰‡</a> æ–¹å¼ç›¸åŒ¹é…ã€‚</p><h4 id="åˆå§‹åŒ–-struct-å¼•ç”¨" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–-struct-å¼•ç”¨"><span>åˆå§‹åŒ– Struct å¼•ç”¨</span></a></h4><p>åœ¨åˆå§‹åŒ–ç»“æ„å¼•ç”¨æ—¶ï¼Œè¯·ä½¿ç”¨<code>&amp;T{}</code>ä»£æ›¿<code>new(T)</code>ï¼Œä»¥ä½¿å…¶ä¸ç»“æ„ä½“åˆå§‹åŒ–ä¸€è‡´ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>sval <span class="token operator">:=</span> T<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span>

<span class="token comment">// inconsistent</span>
sptr <span class="token operator">:=</span> <span class="token function">new</span><span class="token punctuation">(</span>T<span class="token punctuation">)</span>
sptr<span class="token punctuation">.</span>Name <span class="token operator">=</span> <span class="token string">&quot;bar&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>sval <span class="token operator">:=</span> T<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;foo&quot;</span><span class="token punctuation">}</span>

sptr <span class="token operator">:=</span> <span class="token operator">&amp;</span>T<span class="token punctuation">{</span>Name<span class="token punctuation">:</span> <span class="token string">&quot;bar&quot;</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="åˆå§‹åŒ–-maps" tabindex="-1"><a class="header-anchor" href="#åˆå§‹åŒ–-maps"><span>åˆå§‹åŒ– Maps</span></a></h3><p>å¯¹äºç©º map è¯·ä½¿ç”¨ <code>make(..)</code> åˆå§‹åŒ–ï¼Œ å¹¶ä¸” map æ˜¯é€šè¿‡ç¼–ç¨‹æ–¹å¼å¡«å……çš„ã€‚ è¿™ä½¿å¾— map åˆå§‹åŒ–åœ¨è¡¨ç°ä¸Šä¸åŒäºå£°æ˜ï¼Œå¹¶ä¸”å®ƒè¿˜å¯ä»¥æ–¹ä¾¿åœ°åœ¨ make åæ·»åŠ å¤§å°æç¤ºã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  <span class="token comment">// m1 è¯»å†™å®‰å…¨;</span>
  <span class="token comment">// m2 åœ¨å†™å…¥æ—¶ä¼š panic</span>
  m1 <span class="token operator">=</span> <span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2<span class="token punctuation">{</span><span class="token punctuation">}</span>
  m2 <span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">var</span> <span class="token punctuation">(</span>
  <span class="token comment">// m1 è¯»å†™å®‰å…¨;</span>
  <span class="token comment">// m2 åœ¨å†™å…¥æ—¶ä¼š panic</span>
  m1 <span class="token operator">=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2<span class="token punctuation">)</span>
  m2 <span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><p>å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥éå¸¸ç›¸ä¼¼çš„ã€‚</p></td><td><p>å£°æ˜å’Œåˆå§‹åŒ–çœ‹èµ·æ¥å·®åˆ«éå¸¸å¤§ã€‚</p></td></tr></tbody></table><p>åœ¨å°½å¯èƒ½çš„æƒ…å†µä¸‹ï¼Œè¯·åœ¨åˆå§‹åŒ–æ—¶æä¾› map å®¹é‡å¤§å°ï¼Œè¯¦ç»†è¯·çœ‹<a href="#%E6%8C%87%E5%AE%9Amap%E5%AE%B9%E9%87%8F%E6%8F%90%E7%A4%BA">æŒ‡å®šMapå®¹é‡æç¤º</a></p><p>å¦å¤–ï¼Œå¦‚æœ map åŒ…å«å›ºå®šçš„å…ƒç´ åˆ—è¡¨ï¼Œåˆ™ä½¿ç”¨ map literals(map åˆå§‹åŒ–åˆ—è¡¨) åˆå§‹åŒ–æ˜ å°„ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>m <span class="token operator">:=</span> <span class="token function">make</span><span class="token punctuation">(</span><span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2<span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
m<span class="token punctuation">[</span>k1<span class="token punctuation">]</span> <span class="token operator">=</span> v1
m<span class="token punctuation">[</span>k2<span class="token punctuation">]</span> <span class="token operator">=</span> v2
m<span class="token punctuation">[</span>k3<span class="token punctuation">]</span> <span class="token operator">=</span> v3
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>m <span class="token operator">:=</span> <span class="token keyword">map</span><span class="token punctuation">[</span>T1<span class="token punctuation">]</span>T2<span class="token punctuation">{</span>
  k1<span class="token punctuation">:</span> v1<span class="token punctuation">,</span>
  k2<span class="token punctuation">:</span> v2<span class="token punctuation">,</span>
  k3<span class="token punctuation">:</span> v3<span class="token punctuation">,</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>åŸºæœ¬å‡†åˆ™æ˜¯ï¼šåœ¨åˆå§‹åŒ–æ—¶ä½¿ç”¨ map åˆå§‹åŒ–åˆ—è¡¨ æ¥æ·»åŠ ä¸€ç»„å›ºå®šçš„å…ƒç´ ã€‚å¦åˆ™ä½¿ç”¨ <code>make</code> (å¦‚æœå¯ä»¥ï¼Œè¯·å°½é‡æŒ‡å®š map å®¹é‡)ã€‚</p><h3 id="å­—ç¬¦ä¸²-string-format" tabindex="-1"><a class="header-anchor" href="#å­—ç¬¦ä¸²-string-format"><span>å­—ç¬¦ä¸² string format</span></a></h3><p>å¦‚æœä½ åœ¨å‡½æ•°å¤–å£°æ˜<code>Printf</code>-style å‡½æ•°çš„æ ¼å¼å­—ç¬¦ä¸²ï¼Œè¯·å°†å…¶è®¾ç½®ä¸º<code>const</code>å¸¸é‡ã€‚</p><p>è¿™æœ‰åŠ©äº<code>go vet</code>å¯¹æ ¼å¼å­—ç¬¦ä¸²æ‰§è¡Œé™æ€åˆ†æã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>msg <span class="token operator">:=</span> <span class="token string">&quot;unexpected values %v, %v\n&quot;</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">const</span> msg <span class="token operator">=</span> <span class="token string">&quot;unexpected values %v, %v\n&quot;</span>
fmt<span class="token punctuation">.</span><span class="token function">Printf</span><span class="token punctuation">(</span>msg<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><h3 id="å‘½å-printf-æ ·å¼çš„å‡½æ•°" tabindex="-1"><a class="header-anchor" href="#å‘½å-printf-æ ·å¼çš„å‡½æ•°"><span>å‘½å Printf æ ·å¼çš„å‡½æ•°</span></a></h3><p>å£°æ˜<code>Printf</code>-style å‡½æ•°æ—¶ï¼Œè¯·ç¡®ä¿<code>go vet</code>å¯ä»¥æ£€æµ‹åˆ°å®ƒå¹¶æ£€æŸ¥æ ¼å¼å­—ç¬¦ä¸²ã€‚</p><p>è¿™æ„å‘³ç€æ‚¨åº”å°½å¯èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„<code>Printf</code>-style å‡½æ•°åç§°ã€‚<code>go vet</code>å°†é»˜è®¤æ£€æŸ¥è¿™äº›ã€‚æœ‰å…³æ›´å¤šä¿¡æ¯ï¼Œè¯·å‚è§ <a href="https://golang.org/cmd/vet/#hdr-Printf_family" target="_blank" rel="noopener noreferrer">Printf ç³»åˆ—</a>ã€‚</p><p>å¦‚æœä¸èƒ½ä½¿ç”¨é¢„å®šä¹‰çš„åç§°ï¼Œè¯·ä»¥ f ç»“æŸé€‰æ‹©çš„åç§°ï¼š<code>Wrapf</code>ï¼Œè€Œä¸æ˜¯<code>Wrap</code>ã€‚<code>go vet</code>å¯ä»¥è¦æ±‚æ£€æŸ¥ç‰¹å®šçš„ Printf æ ·å¼åç§°ï¼Œä½†åç§°å¿…é¡»ä»¥<code>f</code>ç»“å°¾ã€‚</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token variable">$go</span> vet <span class="token parameter variable">-printfuncs</span><span class="token operator">=</span>wrapf,statusf
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>å¦è¯·å‚é˜… <a href="https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/" target="_blank" rel="noopener noreferrer">go vet: Printf family check</a>.</p><h2 id="ç¼–ç¨‹æ¨¡å¼" tabindex="-1"><a class="header-anchor" href="#ç¼–ç¨‹æ¨¡å¼"><span>ç¼–ç¨‹æ¨¡å¼</span></a></h2><h3 id="è¡¨é©±åŠ¨æµ‹è¯•" tabindex="-1"><a class="header-anchor" href="#è¡¨é©±åŠ¨æµ‹è¯•"><span>è¡¨é©±åŠ¨æµ‹è¯•</span></a></h3><p>å½“æµ‹è¯•é€»è¾‘æ˜¯é‡å¤çš„æ—¶å€™ï¼Œé€šè¿‡ <a href="https://blog.golang.org/subtests" target="_blank" rel="noopener noreferrer">subtests</a> ä½¿ç”¨ table é©±åŠ¨çš„æ–¹å¼ç¼–å†™ case ä»£ç çœ‹ä¸Šå»ä¼šæ›´ç®€æ´ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// func TestSplitHostPort(t *testing.T)</span>

host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">SplitHostPort</span><span class="token punctuation">(</span><span class="token string">&quot;192.0.2.0:8000&quot;</span><span class="token punctuation">)</span>
require<span class="token punctuation">.</span><span class="token function">NoError</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;192.0.2.0&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;8000&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>

host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> err <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">SplitHostPort</span><span class="token punctuation">(</span><span class="token string">&quot;192.0.2.0:http&quot;</span><span class="token punctuation">)</span>
require<span class="token punctuation">.</span><span class="token function">NoError</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;192.0.2.0&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>

host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> err <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">SplitHostPort</span><span class="token punctuation">(</span><span class="token string">&quot;:8000&quot;</span><span class="token punctuation">)</span>
require<span class="token punctuation">.</span><span class="token function">NoError</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;8000&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>

host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> err <span class="token operator">=</span> net<span class="token punctuation">.</span><span class="token function">SplitHostPort</span><span class="token punctuation">(</span><span class="token string">&quot;1:8&quot;</span><span class="token punctuation">)</span>
require<span class="token punctuation">.</span><span class="token function">NoError</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> host<span class="token punctuation">)</span>
assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> <span class="token string">&quot;8&quot;</span><span class="token punctuation">,</span> port<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// func TestSplitHostPort(t *testing.T)</span>

tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span>
  give     <span class="token builtin">string</span>
  wantHost <span class="token builtin">string</span>
  wantPort <span class="token builtin">string</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token punctuation">{</span>
    give<span class="token punctuation">:</span>     <span class="token string">&quot;192.0.2.0:8000&quot;</span><span class="token punctuation">,</span>
    wantHost<span class="token punctuation">:</span> <span class="token string">&quot;192.0.2.0&quot;</span><span class="token punctuation">,</span>
    wantPort<span class="token punctuation">:</span> <span class="token string">&quot;8000&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    give<span class="token punctuation">:</span>     <span class="token string">&quot;192.0.2.0:http&quot;</span><span class="token punctuation">,</span>
    wantHost<span class="token punctuation">:</span> <span class="token string">&quot;192.0.2.0&quot;</span><span class="token punctuation">,</span>
    wantPort<span class="token punctuation">:</span> <span class="token string">&quot;http&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    give<span class="token punctuation">:</span>     <span class="token string">&quot;:8000&quot;</span><span class="token punctuation">,</span>
    wantHost<span class="token punctuation">:</span> <span class="token string">&quot;&quot;</span><span class="token punctuation">,</span>
    wantPort<span class="token punctuation">:</span> <span class="token string">&quot;8000&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
  <span class="token punctuation">{</span>
    give<span class="token punctuation">:</span>     <span class="token string">&quot;1:8&quot;</span><span class="token punctuation">,</span>
    wantHost<span class="token punctuation">:</span> <span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span>
    wantPort<span class="token punctuation">:</span> <span class="token string">&quot;8&quot;</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span><span class="token punctuation">,</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
  t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>give<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    host<span class="token punctuation">,</span> port<span class="token punctuation">,</span> err <span class="token operator">:=</span> net<span class="token punctuation">.</span><span class="token function">SplitHostPort</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>give<span class="token punctuation">)</span>
    require<span class="token punctuation">.</span><span class="token function">NoError</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> err<span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>wantHost<span class="token punctuation">,</span> host<span class="token punctuation">)</span>
    assert<span class="token punctuation">.</span><span class="token function">Equal</span><span class="token punctuation">(</span>t<span class="token punctuation">,</span> tt<span class="token punctuation">.</span>wantPort<span class="token punctuation">,</span> port<span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>å¾ˆæ˜æ˜¾ï¼Œä½¿ç”¨ test table çš„æ–¹å¼åœ¨ä»£ç é€»è¾‘æ‰©å±•çš„æ—¶å€™ï¼Œæ¯”å¦‚æ–°å¢ test caseï¼Œéƒ½ä¼šæ˜¾å¾—æ›´åŠ çš„æ¸…æ™°ã€‚</p><p>æˆ‘ä»¬éµå¾ªè¿™æ ·çš„çº¦å®šï¼šå°†ç»“æ„ä½“åˆ‡ç‰‡ç§°ä¸º<code>tests</code>ã€‚ æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹ç§°ä¸º<code>tt</code>ã€‚æ­¤å¤–ï¼Œæˆ‘ä»¬é¼“åŠ±ä½¿ç”¨<code>give</code>å’Œ<code>want</code>å‰ç¼€è¯´æ˜æ¯ä¸ªæµ‹è¯•ç”¨ä¾‹çš„è¾“å…¥å’Œè¾“å‡ºå€¼ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span>
  give     <span class="token builtin">string</span>
  wantHost <span class="token builtin">string</span>
  wantPort <span class="token builtin">string</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>å¹¶è¡Œæµ‹è¯•ï¼Œæ¯”å¦‚ä¸€äº›ä¸“é—¨çš„å¾ªç¯ï¼ˆä¾‹å¦‚ï¼Œç”Ÿæˆgoroutineæˆ–æ•è·å¼•ç”¨ä½œä¸ºå¾ªç¯ä½“çš„ä¸€éƒ¨åˆ†çš„é‚£äº›å¾ªç¯ï¼‰ å¿…é¡»æ³¨æ„åœ¨å¾ªç¯çš„èŒƒå›´å†…æ˜¾å¼åœ°åˆ†é…å¾ªç¯å˜é‡ï¼Œä»¥ç¡®ä¿å®ƒä»¬ä¿æŒé¢„æœŸçš„å€¼ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>tests <span class="token operator">:=</span> <span class="token punctuation">[</span><span class="token punctuation">]</span><span class="token keyword">struct</span><span class="token punctuation">{</span>
  give <span class="token builtin">string</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span><span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
<span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> tt <span class="token operator">:=</span> <span class="token keyword">range</span> tests <span class="token punctuation">{</span>
  tt <span class="token operator">:=</span> tt <span class="token comment">// for t.Parallel</span>
  t<span class="token punctuation">.</span><span class="token function">Run</span><span class="token punctuation">(</span>tt<span class="token punctuation">.</span>give<span class="token punctuation">,</span> <span class="token keyword">func</span><span class="token punctuation">(</span>t <span class="token operator">*</span>testing<span class="token punctuation">.</span>T<span class="token punctuation">)</span> <span class="token punctuation">{</span>
    t<span class="token punctuation">.</span><span class="token function">Parallel</span><span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// ...</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­ï¼Œç”±äºä¸‹é¢ä½¿ç”¨äº†<code>t.Parallel()</code>ï¼Œæˆ‘ä»¬å¿…é¡»å£°æ˜ä¸€ä¸ªä½œç”¨åŸŸä¸ºå¾ªç¯è¿­ä»£çš„<code>tt</code>å˜é‡ã€‚ å¦‚æœæˆ‘ä»¬ä¸è¿™æ ·åšï¼Œå¤§å¤šæ•°æˆ–æ‰€æœ‰æµ‹è¯•éƒ½ä¼šæ”¶åˆ°ä¸€ä¸ªæ„å¤–çš„<code>tt</code>å€¼ï¼Œæˆ–è€…ä¸€ä¸ªåœ¨è¿è¡Œæ—¶å‘ç”Ÿå˜åŒ–çš„å€¼ã€‚</p><h3 id="åŠŸèƒ½é€‰é¡¹" tabindex="-1"><a class="header-anchor" href="#åŠŸèƒ½é€‰é¡¹"><span>åŠŸèƒ½é€‰é¡¹</span></a></h3><p>åŠŸèƒ½é€‰é¡¹æ˜¯ä¸€ç§æ¨¡å¼ï¼Œæ‚¨å¯ä»¥åœ¨å…¶ä¸­å£°æ˜ä¸€ä¸ªä¸é€æ˜ Option ç±»å‹ï¼Œè¯¥ç±»å‹åœ¨æŸäº›å†…éƒ¨ç»“æ„ä¸­è®°å½•ä¿¡æ¯ã€‚æ‚¨æ¥å—è¿™äº›é€‰é¡¹çš„å¯å˜ç¼–å·ï¼Œå¹¶æ ¹æ®å†…éƒ¨ç»“æ„ä¸Šçš„é€‰é¡¹è®°å½•çš„å…¨éƒ¨ä¿¡æ¯é‡‡å–è¡ŒåŠ¨ã€‚</p><p>å°†æ­¤æ¨¡å¼ç”¨äºæ‚¨éœ€è¦æ‰©å±•çš„æ„é€ å‡½æ•°å’Œå…¶ä»–å…¬å…± API ä¸­çš„å¯é€‰å‚æ•°ï¼Œå°¤å…¶æ˜¯åœ¨è¿™äº›åŠŸèƒ½ä¸Šå·²ç»å…·æœ‰ä¸‰ä¸ªæˆ–æ›´å¤šå‚æ•°çš„æƒ…å†µä¸‹ã€‚</p><table><thead><tr><th>Bad</th><th>Good</th></tr></thead><tbody><tr><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// package db</span>

<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>
  addr <span class="token builtin">string</span><span class="token punctuation">,</span>
  cache <span class="token builtin">bool</span><span class="token punctuation">,</span>
  logger <span class="token operator">*</span>zap<span class="token punctuation">.</span>Logger
<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Connection<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token comment">// package db</span>

<span class="token keyword">type</span> Option <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithCache</span><span class="token punctuation">(</span>c <span class="token builtin">bool</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithLogger</span><span class="token punctuation">(</span>log <span class="token operator">*</span>zap<span class="token punctuation">.</span>Logger<span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>

<span class="token comment">// Open creates a connection.</span>
<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>
  addr <span class="token builtin">string</span><span class="token punctuation">,</span>
  opts <span class="token operator">...</span>Option<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Connection<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr><tr><td><p>å¿…é¡»å§‹ç»ˆæä¾›ç¼“å­˜å’Œè®°å½•å™¨å‚æ•°ï¼Œå³ä½¿ç”¨æˆ·å¸Œæœ›ä½¿ç”¨é»˜è®¤å€¼ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> db<span class="token punctuation">.</span>DefaultCache<span class="token punctuation">,</span> zap<span class="token punctuation">.</span><span class="token function">NewNop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> db<span class="token punctuation">.</span>DefaultCache<span class="token punctuation">,</span> log<span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* cache */</span><span class="token punctuation">,</span> zap<span class="token punctuation">.</span><span class="token function">NewNop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> <span class="token boolean">false</span> <span class="token comment">/* cache */</span><span class="token punctuation">,</span> log<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td><td><p>åªæœ‰åœ¨éœ€è¦æ—¶æ‰æä¾›é€‰é¡¹ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">WithLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>addr<span class="token punctuation">,</span> db<span class="token punctuation">.</span><span class="token function">WithCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
db<span class="token punctuation">.</span><span class="token function">Open</span><span class="token punctuation">(</span>
  addr<span class="token punctuation">,</span>
  db<span class="token punctuation">.</span><span class="token function">WithCache</span><span class="token punctuation">(</span><span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  db<span class="token punctuation">.</span><span class="token function">WithLogger</span><span class="token punctuation">(</span>log<span class="token punctuation">)</span><span class="token punctuation">,</span>
<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div></td></tr></tbody></table><p>æˆ‘ä»¬å»ºè®®å®ç°æ­¤æ¨¡å¼çš„æ–¹æ³•æ˜¯ä½¿ç”¨ä¸€ä¸ª <code>Option</code> æ¥å£ï¼Œè¯¥æ¥å£ä¿å­˜ä¸€ä¸ªæœªå¯¼å‡ºçš„æ–¹æ³•ï¼Œåœ¨ä¸€ä¸ªæœªå¯¼å‡ºçš„ <code>options</code> ç»“æ„ä¸Šè®°å½•é€‰é¡¹ã€‚</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token keyword">type</span> options <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  cache  <span class="token builtin">bool</span>
  logger <span class="token operator">*</span>zap<span class="token punctuation">.</span>Logger
<span class="token punctuation">}</span>

<span class="token keyword">type</span> Option <span class="token keyword">interface</span> <span class="token punctuation">{</span>
  <span class="token function">apply</span><span class="token punctuation">(</span><span class="token operator">*</span>options<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> cacheOption <span class="token builtin">bool</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>c cacheOption<span class="token punctuation">)</span> <span class="token function">apply</span><span class="token punctuation">(</span>opts <span class="token operator">*</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  opts<span class="token punctuation">.</span>cache <span class="token operator">=</span> <span class="token function">bool</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithCache</span><span class="token punctuation">(</span>c <span class="token builtin">bool</span><span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
  <span class="token keyword">return</span> <span class="token function">cacheOption</span><span class="token punctuation">(</span>c<span class="token punctuation">)</span>
<span class="token punctuation">}</span>

<span class="token keyword">type</span> loggerOption <span class="token keyword">struct</span> <span class="token punctuation">{</span>
  Log <span class="token operator">*</span>zap<span class="token punctuation">.</span>Logger
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token punctuation">(</span>l loggerOption<span class="token punctuation">)</span> <span class="token function">apply</span><span class="token punctuation">(</span>opts <span class="token operator">*</span>options<span class="token punctuation">)</span> <span class="token punctuation">{</span>
  opts<span class="token punctuation">.</span>logger <span class="token operator">=</span> l<span class="token punctuation">.</span>Log
<span class="token punctuation">}</span>

<span class="token keyword">func</span> <span class="token function">WithLogger</span><span class="token punctuation">(</span>log <span class="token operator">*</span>zap<span class="token punctuation">.</span>Logger<span class="token punctuation">)</span> Option <span class="token punctuation">{</span>
  <span class="token keyword">return</span> loggerOption<span class="token punctuation">{</span>Log<span class="token punctuation">:</span> log<span class="token punctuation">}</span>
<span class="token punctuation">}</span>

<span class="token comment">// Open creates a connection.</span>
<span class="token keyword">func</span> <span class="token function">Open</span><span class="token punctuation">(</span>
  addr <span class="token builtin">string</span><span class="token punctuation">,</span>
  opts <span class="token operator">...</span>Option<span class="token punctuation">,</span>
<span class="token punctuation">)</span> <span class="token punctuation">(</span><span class="token operator">*</span>Connection<span class="token punctuation">,</span> <span class="token builtin">error</span><span class="token punctuation">)</span> <span class="token punctuation">{</span>
  options <span class="token operator">:=</span> options<span class="token punctuation">{</span>
    cache<span class="token punctuation">:</span>  defaultCache<span class="token punctuation">,</span>
    logger<span class="token punctuation">:</span> zap<span class="token punctuation">.</span><span class="token function">NewNop</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
  <span class="token punctuation">}</span>

  <span class="token keyword">for</span> <span class="token boolean">_</span><span class="token punctuation">,</span> o <span class="token operator">:=</span> <span class="token keyword">range</span> opts <span class="token punctuation">{</span>
    o<span class="token punctuation">.</span><span class="token function">apply</span><span class="token punctuation">(</span><span class="token operator">&amp;</span>options<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">// ...</span>
<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>æ³¨æ„ï¼šè¿˜æœ‰ä¸€ç§ä½¿ç”¨é—­åŒ…å®ç°è¿™ä¸ªæ¨¡å¼çš„æ–¹æ³•ï¼Œä½†æ˜¯æˆ‘ä»¬ç›¸ä¿¡ä¸Šé¢çš„æ¨¡å¼ä¸ºä½œè€…æä¾›äº†æ›´å¤šçš„çµæ´»æ€§ï¼Œå¹¶ä¸”æ›´å®¹æ˜“å¯¹ç”¨æˆ·è¿›è¡Œè°ƒè¯•å’Œæµ‹è¯•ã€‚ç‰¹åˆ«æ˜¯ï¼Œåœ¨ä¸å¯èƒ½è¿›è¡Œæ¯”è¾ƒçš„æƒ…å†µä¸‹å®ƒå…è®¸åœ¨æµ‹è¯•å’Œæ¨¡æ‹Ÿä¸­å¯¹é€‰é¡¹è¿›è¡Œæ¯”è¾ƒã€‚æ­¤å¤–ï¼Œå®ƒè¿˜å…è®¸é€‰é¡¹å®ç°å…¶ä»–æ¥å£ï¼ŒåŒ…æ‹¬ <code>fmt.Stringer</code>ï¼Œå…è®¸ç”¨æˆ·è¯»å–é€‰é¡¹çš„å­—ç¬¦ä¸²è¡¨ç¤ºå½¢å¼ã€‚</p><p>è¿˜å¯ä»¥å‚è€ƒä¸‹é¢èµ„æ–™ï¼š</p><ul><li><p><a href="https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html" target="_blank" rel="noopener noreferrer">Self-referential functions and the design of options</a></p></li><li><p><a href="https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis" target="_blank" rel="noopener noreferrer">Functional options for friendly APIs</a></p></li></ul><!-- TODO: replace this with parameter structs and functional options, when to
use one vs other --><h2 id="linting" tabindex="-1"><a class="header-anchor" href="#linting"><span>Linting</span></a></h2><p>æ¯”ä»»ä½• &quot;blessed&quot; linter é›†æ›´é‡è¦çš„æ˜¯ï¼Œlint åœ¨ä¸€ä¸ªä»£ç åº“ä¸­å§‹ç»ˆä¿æŒä¸€è‡´ã€‚</p><p>æˆ‘ä»¬å»ºè®®è‡³å°‘ä½¿ç”¨ä»¥ä¸‹ lintersï¼Œå› ä¸ºæˆ‘è®¤ä¸ºå®ƒä»¬æœ‰åŠ©äºå‘ç°æœ€å¸¸è§çš„é—®é¢˜ï¼Œå¹¶åœ¨ä¸éœ€è¦è§„å®šçš„æƒ…å†µä¸‹ä¸ºä»£ç è´¨é‡å»ºç«‹ä¸€ä¸ªé«˜æ ‡å‡†ï¼š</p><ul><li><p><a href="https://github.com/kisielk/errcheck" target="_blank" rel="noopener noreferrer">errcheck</a> ä»¥ç¡®ä¿é”™è¯¯å¾—åˆ°å¤„ç†</p></li><li><p><a href="https://godoc.org/golang.org/x/tools/cmd/goimports" target="_blank" rel="noopener noreferrer">goimports</a> æ ¼å¼åŒ–ä»£ç å’Œç®¡ç† imports</p></li><li><p><a href="https://github.com/golang/lint" target="_blank" rel="noopener noreferrer">golint</a> æŒ‡å‡ºå¸¸è§çš„æ–‡ä½“é”™è¯¯</p></li><li><p><a href="https://golang.org/cmd/vet/" target="_blank" rel="noopener noreferrer">govet</a> åˆ†æä»£ç ä¸­çš„å¸¸è§é”™è¯¯</p></li><li><p><a href="https://staticcheck.io/" target="_blank" rel="noopener noreferrer">staticcheck</a> å„ç§é™æ€åˆ†ææ£€æŸ¥</p></li></ul><h3 id="lint-runners" tabindex="-1"><a class="header-anchor" href="#lint-runners"><span>Lint Runners</span></a></h3><p>æˆ‘ä»¬æ¨è <a href="https://github.com/golangci/golangci-lint" target="_blank" rel="noopener noreferrer">golangci-lint</a> ä½œä¸º go-to lint çš„è¿è¡Œç¨‹åºï¼Œè¿™ä¸»è¦æ˜¯å› ä¸ºå®ƒåœ¨è¾ƒå¤§çš„ä»£ç åº“ä¸­çš„æ€§èƒ½ä»¥åŠèƒ½å¤ŸåŒæ—¶é…ç½®å’Œä½¿ç”¨è®¸å¤šè§„èŒƒã€‚è¿™ä¸ª repo æœ‰ä¸€ä¸ªç¤ºä¾‹é…ç½®æ–‡ä»¶ <a href="https://github.com/uber-go/guide/blob/master/.golangci.yml" target="_blank" rel="noopener noreferrer">.golangci.yml</a> å’Œæ¨èçš„ linter è®¾ç½®ã€‚</p><p>golangci-lint æœ‰ <a href="https://golangci-lint.run/usage/linters/" target="_blank" rel="noopener noreferrer">various-linters</a> å¯ä¾›ä½¿ç”¨ã€‚å»ºè®®å°†ä¸Šè¿° linters ä½œä¸ºåŸºæœ¬ setï¼Œæˆ‘ä»¬é¼“åŠ±å›¢é˜Ÿæ·»åŠ å¯¹ä»–ä»¬çš„é¡¹ç›®æœ‰æ„ä¹‰çš„ä»»ä½•é™„åŠ  lintersã€‚</p><h2 id="stargazers-over-time" tabindex="-1"><a class="header-anchor" href="#stargazers-over-time"><span>Stargazers over time</span></a></h2><figure><a href="https://starchart.cc/xxjwxc/uber_go_guide_cn" target="_blank" rel="noopener noreferrer"><img src="https://starchart.cc/xxjwxc/uber_go_guide_cn.svg" alt="Stargazers over time" tabindex="0" loading="lazy"></a><figcaption>Stargazers over time</figcaption></figure></div><!----><footer class="vp-page-meta"><!----><div class="vp-meta-item git-info"><div class="update-time"><span class="vp-meta-label">ä¸Šæ¬¡ç¼–è¾‘äº: </span><!----></div><div class="contributors"><span class="vp-meta-label">è´¡çŒ®è€…: </span><!--[--><!--[--><span class="vp-meta-info" title="email: hechangjie0619@icloud.com">HeXiaoPi</span><!--]--><!--]--></div></div></footer><nav class="vp-page-nav"><a class="route-link vp-link prev" href="/language/go/reprint/proverb.html" aria-label="Goç®´è¨€"><div class="hint"><span class="arrow start"></span>ä¸Šä¸€é¡µ</div><div class="link"><span class="font-icon icon fa-fw fa-sm fas fa-spell-check" style=""></span>Goç®´è¨€</div></a><!----></nav><div id="vp-comment" class="giscus-wrapper input-top" style="display:block;"><svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" preserveAspectRatio="xMidYMid" viewBox="0 0 100 100"><circle cx="28" cy="75" r="11" fill="currentColor"><animate attributeName="fill-opacity" begin="0s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></circle><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 47a28 28 0 0 1 28 28"><animate attributeName="stroke-opacity" begin="0.1s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path><path fill="none" stroke="#88baf0" stroke-width="10" d="M28 25a50 50 0 0 1 50 50"><animate attributeName="stroke-opacity" begin="0.2s" dur="1s" keyTimes="0;0.2;1" repeatCount="indefinite" values="0;1;1"></animate></path></svg></div><!----><!--]--></main><!--]--><footer class="vp-footer-wrapper"><div class="vp-footer"><a href="http://beian.miit.gov.cn/" rel="noopener noreferrer" target="_blank">å¤‡æ¡ˆå·: çš–ICPå¤‡2022000616å·-1</a> | <a href="/about/site.html">å…³äºç½‘ç«™</a></div><div class="vp-copyright">Copyright Â© 2024 uber </div></footer></div><!--]--><!--[--><!----><!----><!--]--><!--]--></div>
    <script type="module" src="/assets/app-CR0RWkma.js" defer></script>
  </body>
</html>
