import{_ as p}from"./plugin-vue_export-helper-c27b6911.js";import{r as o,o as c,c as i,a as n,b as a,d as t,e as s}from"./app-1d2f39db.js";const u="/assets/confd-f290da1d.jpg",l={},d=s('<h2 id="confd-简介" tabindex="-1"><a class="header-anchor" href="#confd-简介" aria-hidden="true">#</a> confd 简介</h2><blockquote><p>confd是一个轻量级配置管理工具，通过加载存储在etcd、consul、redis、zookeeper等的数据，结合配置模板动态更新配置文件。</p></blockquote><p><strong>github地址</strong>：<code>https://github.com/kelseyhightower/confd</code></p><p><strong>官网：</strong><code>http://www.confd.io/</code></p><h3 id="confd功能角色" tabindex="-1"><a class="header-anchor" href="#confd功能角色" aria-hidden="true">#</a> confd功能角色</h3><p>confd的功能类似于快递员，负责去配置服务中读取配置数据，然后更新配置文件，并通知应用服务热加载配置文件。</p><figure><img src="'+u+`" alt="confd" tabindex="0" loading="lazy"><figcaption>confd</figcaption></figure><h2 id="confd部署" tabindex="-1"><a class="header-anchor" href="#confd部署" aria-hidden="true">#</a> confd部署</h2><p>下载地址：<code>https://github.com/kelseyhightower/confd/releases</code></p><p>以Linux系统为例：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token comment">#下载二进制包</span>
<span class="token function">wget</span> https://github.com/kelseyhightower/confd/releases/download/v0.16.0/confd-0.16.0-linux-amd64
<span class="token comment">#重命名，并移动到PATH的目录</span>
<span class="token function">mv</span> confd-0.16.0-linux-amd64 /usr/local/bin/confd
<span class="token function">chmod</span> +x /usr/local/bin/confd
<span class="token comment">#验证</span>
confd <span class="token parameter variable">--help</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="confd使用" tabindex="-1"><a class="header-anchor" href="#confd使用" aria-hidden="true">#</a> confd使用</h2><h3 id="创建confdir" tabindex="-1"><a class="header-anchor" href="#创建confdir" aria-hidden="true">#</a> 创建confdir</h3><p><code>confdir</code>(默认是<code>/etc/confd</code>)包含两个目录：</p>`,14),r=n("li",null,[n("code",null,"conf.d"),a("：confd的配置文件，主要包含配置的生成逻辑，例如模板源，目标配置文件，后端存储的keys，服务重启命令执行等。")],-1),k=n("code",null,"templates",-1),v={href:"https://golang.google.cn/pkg/text/template/#pkg-overview",target:"_blank",rel:"noopener noreferrer"},g=s(`<div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/confd/<span class="token punctuation">{</span>conf.d,templates<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="模板源配置" tabindex="-1"><a class="header-anchor" href="#模板源配置" aria-hidden="true">#</a> 模板源配置</h3><p>模板源配置文件是以TOML格式的文件，包含配置的生成逻辑，例如模板源，后端存储对应keys，命令执行等。默认目录在<code>/etc/confd/conf.d</code></p><p>参数说明：</p><p><strong>必要参数</strong></p>`,5),m=n("li",null,[n("code",null,"dest"),a("(string) : 目标文件.")],-1),h=n("li",null,[n("code",null,"keys"),a("(array of things) : 存储的keys.")],-1),b=n("code",null,"src",-1),f={href:"https://github.com/kelseyhightower/confd/blob/master/docs/templates.md",target:"_blank",rel:"noopener noreferrer"},q=s(`<p><strong>可选参数</strong></p><ul><li><code>git</code>(int) : 文件的gid</li><li><code>mode</code>(string) : 文件的权限模式</li><li><code>uid</code>（int) : 文件的uid</li><li><code>reload_cmd</code>(string) : 重启命令配置</li><li><code>check_cmd</code>(string) : 检查命令配置，使用<code>{{.src}}</code>引用模板源</li><li><code>prefix</code>(string) : keys的前缀字符串</li></ul><p>例如：<code>/etc/confd/conf.d/prometheus.toml</code></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">[</span>template<span class="token punctuation">]</span>
src <span class="token operator">=</span> <span class="token string">&quot;prometheus.tmpl&quot;</span>
dest <span class="token operator">=</span> <span class="token string">&quot;/data/server/prometheus/prometheus-2.11.1.linux-amd64/prometheus.yml&quot;</span>
keys <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token string">&quot;prometheus/job&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
reload_cmd <span class="token operator">=</span> <span class="token string">&quot;curl -X POST http://192.168.45.172:9090/-/reload&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="模板源" tabindex="-1"><a class="header-anchor" href="#模板源" aria-hidden="true">#</a> 模板源</h3><p>Template定义了单一应用配置的模板，默认存储在<code>/etc/confd/templates</code>目录下，模板文件符合Go的<code>text/template</code>格式。</p><p>例如: <code>/etc/confd/templates/prometheus.tmpl</code></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>global<span class="token punctuation">:</span>
  scrape_interval<span class="token punctuation">:</span> 15s
  scrape_timeout<span class="token punctuation">:</span> 10s
  evaluation_interval<span class="token punctuation">:</span> 15s
alerting<span class="token punctuation">:</span>
  alertmanagers<span class="token punctuation">:</span>
  <span class="token operator">-</span> static_configs<span class="token punctuation">:</span>
    <span class="token operator">-</span> targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
scrape_configs<span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> gets <span class="token string">&quot;/prometheus/job/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">-</span> job_name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
  static_configs<span class="token punctuation">:</span>
  <span class="token operator">-</span> targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动confd的服务" tabindex="-1"><a class="header-anchor" href="#启动confd的服务" aria-hidden="true">#</a> 启动confd的服务</h3><p>confd支持以<code>daemon</code>或者<code>onetime</code>两种模式运行。</p><p><code>onetime</code>模式，只会生成一次，之后key无论变化不会再生成：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>confd <span class="token parameter variable">-onetime</span> <span class="token parameter variable">-backend</span> etcd <span class="token parameter variable">-node</span> http://192.168.45.172:2379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>daemon</code>模式，会监听后端存储的配置变化，并根据配置模板动态生成目标配置文件：</p><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>confd <span class="token parameter variable">-watch</span> <span class="token parameter variable">-backend</span> etcd <span class="token parameter variable">-node</span> http://192.168.45.172:2379 <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="etcd设置数据" tabindex="-1"><a class="header-anchor" href="#etcd设置数据" aria-hidden="true">#</a> etcd设置数据</h3><div class="language-bash line-numbers-mode" data-ext="sh"><pre class="language-bash"><code>etcdctl <span class="token builtin class-name">set</span> /prometheus/job/prometheus <span class="token string">&quot;192.168.45.172:9090&quot;</span>

etcdctl <span class="token builtin class-name">set</span> /prometheus/job/pushgateway <span class="token string">&quot;192.168.45.172:9091&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证配置文件数据" tabindex="-1"><a class="header-anchor" href="#验证配置文件数据" aria-hidden="true">#</a> 验证配置文件数据</h3><p>根据<strong>模板源配置</strong>里设置的目标配置文件查看是否符合预期</p><div class="language-yaml line-numbers-mode" data-ext="yml"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s
  <span class="token key atrule">scrape_timeout</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>

<span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> /prometheus/job/prometheus
  <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.45.172<span class="token punctuation">:</span><span class="token number">9090</span><span class="token punctuation">]</span>

<span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> /prometheus/job/pushgateway
  <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.45.172<span class="token punctuation">:</span><span class="token number">9091</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="confd模板功能函数" tabindex="-1"><a class="header-anchor" href="#confd模板功能函数" aria-hidden="true">#</a> confd模板功能函数</h2><h3 id="map" tabindex="-1"><a class="header-anchor" href="#map" aria-hidden="true">#</a> map</h3><p>string-&gt;interface{}的key/value键值对</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>$endpoint <span class="token operator">:=</span> <span class="token keyword">map</span> <span class="token string">&quot;name&quot;</span> <span class="token string">&quot;elasticsearch&quot;</span> <span class="token string">&quot;private_port&quot;</span> <span class="token number">9200</span> <span class="token string">&quot;public_port&quot;</span> <span class="token number">443</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $endpoint <span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
private<span class="token operator">-</span>port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $endpoint <span class="token string">&quot;private_port&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
public<span class="token operator">-</span>port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $endpoint <span class="token string">&quot;public_port&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="base" tabindex="-1"><a class="header-anchor" href="#base" aria-hidden="true">#</a> base</h3>`,25),x={href:"https://golang.org/pkg/path/#Base",target:"_blank",rel:"noopener noreferrer"},y=s(`<p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with get <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>base <span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="exists" tabindex="-1"><a class="header-anchor" href="#exists" aria-hidden="true">#</a> exists</h3><p>检查key是否存在，如果不存在返回false</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">if</span> exists <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getv <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="get" tabindex="-1"><a class="header-anchor" href="#get" aria-hidden="true">#</a> get</h3><p>返回键值对，如果不存在返回error</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with get <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cget" tabindex="-1"><a class="header-anchor" href="#cget" aria-hidden="true">#</a> cget</h3><p>返回键值对，且值被加密。如果不存在返回error</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with cget <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gets" tabindex="-1"><a class="header-anchor" href="#gets" aria-hidden="true">#</a> gets</h3><p>返回所有键值对，键值对列表，如果key不匹配返回error</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> gets <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cgets" tabindex="-1"><a class="header-anchor" href="#cgets" aria-hidden="true">#</a> cgets</h3><p>返回所有键值对，键值对列表，key匹配参数且值被加密，如果key不匹配返回一个错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> cgets <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="getv" tabindex="-1"><a class="header-anchor" href="#getv" aria-hidden="true">#</a> getv</h3><p>以字符串形式返回值，其中key与其参数或可选的默认值匹配。如果未找到key且未给出默认值，则返回错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getv <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>With a default value</strong></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getv <span class="token string">&quot;/key&quot;</span> <span class="token string">&quot;default_value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="cgetv" tabindex="-1"><a class="header-anchor" href="#cgetv" aria-hidden="true">#</a> cgetv</h3><p>将加密值作为字符串返回，如果未找到key，返回错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>cgetv <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="getvs" tabindex="-1"><a class="header-anchor" href="#getvs" aria-hidden="true">#</a> getvs</h3><p>返回所有值，[]string，其中key与其参数匹配。如果未找到密钥，则返回错误。</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> getvs <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cgetvs" tabindex="-1"><a class="header-anchor" href="#cgetvs" aria-hidden="true">#</a> cgetvs</h3><p>返回所有加密值，[]string，其中key与其参数匹配。如果未找到key则返回错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> cgetvs <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="getenv" tabindex="-1"><a class="header-anchor" href="#getenv" aria-hidden="true">#</a> getenv</h3><p>检索由key命名的环境变量的值。 如果变量不存在，返回为空。 （可选）可以提供一个默认值，如果该键不存在，将返回该值。</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>export HOSTNAME<span class="token operator">=</span><span class="token string">\`hostname\`</span>
hostname<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getenv <span class="token string">&quot;HOSTNAME&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>With a default value</strong></p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>ipaddr<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getenv <span class="token string">&quot;HOST_IP&quot;</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="datetime" tabindex="-1"><a class="header-anchor" href="#datetime" aria-hidden="true">#</a> datetime</h3><p>与time.Now同名</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code># Generated by confd <span class="token punctuation">{</span><span class="token punctuation">{</span>datetime<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Outputs:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code># Generated by confd <span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">56.093250283</span> <span class="token operator">-</span><span class="token number">0800</span> PST
# Generated by confd <span class="token punctuation">{</span><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>Format <span class="token string">&quot;Jan 2, 2006 at 3:04pm (MST)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Outputs:</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code># Generated by confd Jan <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">2015</span> at <span class="token number">1</span><span class="token punctuation">:</span>34pm <span class="token punctuation">(</span>EST<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="split" tabindex="-1"><a class="header-anchor" href="#split" aria-hidden="true">#</a> split</h3><p>用分隔字符拆分输入的字符串并返回一个子字符串切片</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> $url <span class="token operator">:=</span> split <span class="token punctuation">(</span>getv <span class="token string">&quot;/deis/service&quot;</span><span class="token punctuation">)</span> <span class="token string">&quot;:&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    host<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $url <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $url <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>toUpper</strong></p><p>返回大写的字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>toUpper <span class="token string">&quot;value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="tolower" tabindex="-1"><a class="header-anchor" href="#tolower" aria-hidden="true">#</a> toLower</h3><p>返回小写的字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>toLower <span class="token string">&quot;Value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="json" tabindex="-1"><a class="header-anchor" href="#json" aria-hidden="true">#</a> json</h3><p>返回 json值得map[string]interface{}</p><h3 id="lookupsrv" tabindex="-1"><a class="header-anchor" href="#lookupsrv" aria-hidden="true">#</a> lookupSRV</h3><p>LookupSRV函数按照RFC 2782标准来构建用于查询的DNS。也就是说，它查询_service._proto.name。当service和proto参数都是空字符串时，LookupSRV将会直接查找name</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> lookupSRV <span class="token string">&quot;mail&quot;</span> <span class="token string">&quot;tcp&quot;</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  target<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Target<span class="token punctuation">}</span><span class="token punctuation">}</span>
  port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Port<span class="token punctuation">}</span><span class="token punctuation">}</span>
  priority<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Priority<span class="token punctuation">}</span><span class="token punctuation">}</span>
  weight<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Weight<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="base64encode" tabindex="-1"><a class="header-anchor" href="#base64encode" aria-hidden="true">#</a> base64Encode</h3><p>返回一个base64编码得字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>base64Encode <span class="token string">&quot;Value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="base64decode" tabindex="-1"><a class="header-anchor" href="#base64decode" aria-hidden="true">#</a> base64Decode</h3><p>返回一个base64解码的字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>base64Decode <span class="token string">&quot;VmFsdWU=&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="jsonarray" tabindex="-1"><a class="header-anchor" href="#jsonarray" aria-hidden="true">#</a> jsonArray</h3><p>从json数组返回一个 []interface{}</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> jsonArray <span class="token punctuation">(</span>getv <span class="token string">&quot;/services/data/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
val<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ls" tabindex="-1"><a class="header-anchor" href="#ls" aria-hidden="true">#</a> ls</h3><p>返回所有子键，[]string，其中path匹配其参数。如果找不到path，则返回空列表</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> ls <span class="token string">&quot;/deis/services&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
   value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lsdir" tabindex="-1"><a class="header-anchor" href="#lsdir" aria-hidden="true">#</a> lsdir</h3><p>返回所有子键，[]string，其中path匹配其参数。它只返回包含子键的子键。如果找不到路径，则返回空列表。</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> lsdir <span class="token string">&quot;/deis/services&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
   value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dir" tabindex="-1"><a class="header-anchor" href="#dir" aria-hidden="true">#</a> dir</h3><p>返回给定键的父目录</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with dir <span class="token string">&quot;/services/data/url&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
dir<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="join" tabindex="-1"><a class="header-anchor" href="#join" aria-hidden="true">#</a> join</h3><p>字符串拼接</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>$services <span class="token operator">:=</span> getvs <span class="token string">&quot;/services/elasticsearch/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
services<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>join $services <span class="token string">&quot;,&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="replace" tabindex="-1"><a class="header-anchor" href="#replace" aria-hidden="true">#</a> replace</h3><p>字符串替换</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>$backend <span class="token operator">:=</span> getv <span class="token string">&quot;/services/backend/nginx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
backend <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>replace $backend <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lookupip" tabindex="-1"><a class="header-anchor" href="#lookupip" aria-hidden="true">#</a> lookupIP</h3><p>查找ip</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> lookupIP <span class="token string">&quot;some.host.local&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    server <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="atoi" tabindex="-1"><a class="header-anchor" href="#atoi" aria-hidden="true">#</a> atoi</h3><p>字符换转整数</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>seq <span class="token number">1</span> <span class="token punctuation">(</span>atoi <span class="token punctuation">(</span>getv <span class="token string">&quot;/count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,112);function _(w,j){const e=o("ExternalLinkIcon");return c(),i("div",null,[d,n("ul",null,[r,n("li",null,[k,a(": 包含配置模板，修改符合"),n("a",v,[a("Golang Text template"),t(e)]),a("的模板文件。")])]),g,n("ul",null,[m,h,n("li",null,[b,a("(string) : "),n("a",f,[a("模板配置"),t(e)]),a("的相对路径.")])]),q,n("p",null,[a("与"),n("a",x,[a("path.Base"),t(e)]),a("功能同名")]),y])}const T=p(l,[["render",_],["__file","confd.html.vue"]]);export{T as default};
