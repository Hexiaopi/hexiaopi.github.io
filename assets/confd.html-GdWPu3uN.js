import{_ as n}from"./plugin-vue_export-helper-DlAUqK2U.js";import{c as a,a as s,b as e,o as t}from"./app-SE2roejh.js";const p="/assets/confd-uxgAnFzC.jpg",o={},c=e('<h2 id="confd-简介" tabindex="-1"><a class="header-anchor" href="#confd-简介"><span>confd 简介</span></a></h2><blockquote><p>confd是一个轻量级配置管理工具，通过加载存储在etcd、consul、redis、zookeeper等的数据，结合配置模板动态更新配置文件。</p></blockquote><p><strong>github地址</strong>：<code>https://github.com/kelseyhightower/confd</code></p><p><strong>官网：</strong><code>http://www.confd.io/</code></p><h3 id="confd功能角色" tabindex="-1"><a class="header-anchor" href="#confd功能角色"><span>confd功能角色</span></a></h3><p>confd的功能类似于快递员，负责去配置服务中读取配置数据，然后更新配置文件，并通知应用服务热加载配置文件。</p><figure><img src="'+p+`" alt="confd" tabindex="0" loading="lazy"><figcaption>confd</figcaption></figure><h2 id="confd部署" tabindex="-1"><a class="header-anchor" href="#confd部署"><span>confd部署</span></a></h2><p>下载地址：<code>https://github.com/kelseyhightower/confd/releases</code></p><p>以Linux系统为例：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token comment">#下载二进制包</span>
<span class="token function">wget</span> https://github.com/kelseyhightower/confd/releases/download/v0.16.0/confd-0.16.0-linux-amd64
<span class="token comment">#重命名，并移动到PATH的目录</span>
<span class="token function">mv</span> confd-0.16.0-linux-amd64 /usr/local/bin/confd
<span class="token function">chmod</span> +x /usr/local/bin/confd
<span class="token comment">#验证</span>
confd <span class="token parameter variable">--help</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="confd使用" tabindex="-1"><a class="header-anchor" href="#confd使用"><span>confd使用</span></a></h2><h3 id="创建confdir" tabindex="-1"><a class="header-anchor" href="#创建confdir"><span>创建confdir</span></a></h3><p><code>confdir</code>(默认是<code>/etc/confd</code>)包含两个目录：</p><ul><li><code>conf.d</code>：confd的配置文件，主要包含配置的生成逻辑，例如模板源，目标配置文件，后端存储的keys，服务重启命令执行等。</li><li><code>templates</code>: 包含配置模板，修改符合<a href="https://golang.google.cn/pkg/text/template/#pkg-overview" target="_blank" rel="noopener noreferrer">Golang Text template</a>的模板文件。</li></ul><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code><span class="token function">mkdir</span> <span class="token parameter variable">-p</span> /etc/confd/<span class="token punctuation">{</span>conf.d,templates<span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="模板源配置" tabindex="-1"><a class="header-anchor" href="#模板源配置"><span>模板源配置</span></a></h3><p>模板源配置文件是以TOML格式的文件，包含配置的生成逻辑，例如模板源，后端存储对应keys，命令执行等。默认目录在<code>/etc/confd/conf.d</code></p><p>参数说明：</p><p><strong>必要参数</strong></p><ul><li><code>dest</code>(string) : 目标文件.</li><li><code>keys</code>(array of things) : 存储的keys.</li><li><code>src</code>(string) : <a href="https://github.com/kelseyhightower/confd/blob/master/docs/templates.md" target="_blank" rel="noopener noreferrer">模板配置</a>的相对路径.</li></ul><p><strong>可选参数</strong></p><ul><li><code>git</code>(int) : 文件的gid</li><li><code>mode</code>(string) : 文件的权限模式</li><li><code>uid</code>（int) : 文件的uid</li><li><code>reload_cmd</code>(string) : 重启命令配置</li><li><code>check_cmd</code>(string) : 检查命令配置，使用<code>{{.src}}</code>引用模板源</li><li><code>prefix</code>(string) : keys的前缀字符串</li></ul><p>例如：<code>/etc/confd/conf.d/prometheus.toml</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">[</span>template<span class="token punctuation">]</span>
src <span class="token operator">=</span> <span class="token string">&quot;prometheus.tmpl&quot;</span>
dest <span class="token operator">=</span> <span class="token string">&quot;/data/server/prometheus/prometheus-2.11.1.linux-amd64/prometheus.yml&quot;</span>
keys <span class="token operator">=</span> <span class="token punctuation">[</span>
<span class="token string">&quot;prometheus/job&quot;</span><span class="token punctuation">,</span>
<span class="token punctuation">]</span>
reload_cmd <span class="token operator">=</span> <span class="token string">&quot;curl -X POST http://192.168.45.172:9090/-/reload&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="模板源" tabindex="-1"><a class="header-anchor" href="#模板源"><span>模板源</span></a></h3><p>Template定义了单一应用配置的模板，默认存储在<code>/etc/confd/templates</code>目录下，模板文件符合Go的<code>text/template</code>格式。</p><p>例如: <code>/etc/confd/templates/prometheus.tmpl</code></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>global<span class="token punctuation">:</span>
  scrape_interval<span class="token punctuation">:</span> 15s
  scrape_timeout<span class="token punctuation">:</span> 10s
  evaluation_interval<span class="token punctuation">:</span> 15s
alerting<span class="token punctuation">:</span>
  alertmanagers<span class="token punctuation">:</span>
  <span class="token operator">-</span> static_configs<span class="token punctuation">:</span>
    <span class="token operator">-</span> targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
scrape_configs<span class="token punctuation">:</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> gets <span class="token string">&quot;/prometheus/job/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token operator">-</span> job_name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
  static_configs<span class="token punctuation">:</span>
  <span class="token operator">-</span> targets<span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">]</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="启动confd的服务" tabindex="-1"><a class="header-anchor" href="#启动confd的服务"><span>启动confd的服务</span></a></h3><p>confd支持以<code>daemon</code>或者<code>onetime</code>两种模式运行。</p><p><code>onetime</code>模式，只会生成一次，之后key无论变化不会再生成：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>confd <span class="token parameter variable">-onetime</span> <span class="token parameter variable">-backend</span> etcd <span class="token parameter variable">-node</span> http://192.168.45.172:2379
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><code>daemon</code>模式，会监听后端存储的配置变化，并根据配置模板动态生成目标配置文件：</p><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>confd <span class="token parameter variable">-watch</span> <span class="token parameter variable">-backend</span> etcd <span class="token parameter variable">-node</span> http://192.168.45.172:2379 <span class="token operator">&amp;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="etcd设置数据" tabindex="-1"><a class="header-anchor" href="#etcd设置数据"><span>etcd设置数据</span></a></h3><div class="language-bash line-numbers-mode" data-ext="sh" data-title="sh"><pre class="language-bash"><code>etcdctl <span class="token builtin class-name">set</span> /prometheus/job/prometheus <span class="token string">&quot;192.168.45.172:9090&quot;</span>

etcdctl <span class="token builtin class-name">set</span> /prometheus/job/pushgateway <span class="token string">&quot;192.168.45.172:9091&quot;</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="验证配置文件数据" tabindex="-1"><a class="header-anchor" href="#验证配置文件数据"><span>验证配置文件数据</span></a></h3><p>根据<strong>模板源配置</strong>里设置的目标配置文件查看是否符合预期</p><div class="language-yaml line-numbers-mode" data-ext="yml" data-title="yml"><pre class="language-yaml"><code><span class="token key atrule">global</span><span class="token punctuation">:</span>
  <span class="token key atrule">scrape_interval</span><span class="token punctuation">:</span> 15s
  <span class="token key atrule">scrape_timeout</span><span class="token punctuation">:</span> 10s
  <span class="token key atrule">evaluation_interval</span><span class="token punctuation">:</span> 15s
<span class="token key atrule">alerting</span><span class="token punctuation">:</span>
  <span class="token key atrule">alertmanagers</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
    <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span><span class="token punctuation">]</span>
<span class="token key atrule">scrape_configs</span><span class="token punctuation">:</span>

<span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> /prometheus/job/prometheus
  <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.45.172<span class="token punctuation">:</span><span class="token number">9090</span><span class="token punctuation">]</span>

<span class="token punctuation">-</span> <span class="token key atrule">job_name</span><span class="token punctuation">:</span> /prometheus/job/pushgateway
  <span class="token key atrule">static_configs</span><span class="token punctuation">:</span>
  <span class="token punctuation">-</span> <span class="token key atrule">targets</span><span class="token punctuation">:</span> <span class="token punctuation">[</span>192.168.45.172<span class="token punctuation">:</span><span class="token number">9091</span><span class="token punctuation">]</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h2 id="confd模板功能函数" tabindex="-1"><a class="header-anchor" href="#confd模板功能函数"><span>confd模板功能函数</span></a></h2><h3 id="map" tabindex="-1"><a class="header-anchor" href="#map"><span>map</span></a></h3><p>string-&gt;interface{}的key/value键值对</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>$endpoint <span class="token operator">:=</span> <span class="token keyword">map</span> <span class="token string">&quot;name&quot;</span> <span class="token string">&quot;elasticsearch&quot;</span> <span class="token string">&quot;private_port&quot;</span> <span class="token number">9200</span> <span class="token string">&quot;public_port&quot;</span> <span class="token number">443</span><span class="token punctuation">}</span><span class="token punctuation">}</span>

name<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $endpoint <span class="token string">&quot;name&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
private<span class="token operator">-</span>port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $endpoint <span class="token string">&quot;private_port&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
public<span class="token operator">-</span>port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $endpoint <span class="token string">&quot;public_port&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="base" tabindex="-1"><a class="header-anchor" href="#base"><span>base</span></a></h3><p>与<a href="https://golang.org/pkg/path/#Base" target="_blank" rel="noopener noreferrer">path.Base</a>功能同名</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with get <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>base <span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="exists" tabindex="-1"><a class="header-anchor" href="#exists"><span>exists</span></a></h3><p>检查key是否存在，如果不存在返回false</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">if</span> exists <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getv <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="get" tabindex="-1"><a class="header-anchor" href="#get"><span>get</span></a></h3><p>返回键值对，如果不存在返回error</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with get <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cget" tabindex="-1"><a class="header-anchor" href="#cget"><span>cget</span></a></h3><p>返回键值对，且值被加密。如果不存在返回error</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with cget <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="gets" tabindex="-1"><a class="header-anchor" href="#gets"><span>gets</span></a></h3><p>返回所有键值对，键值对列表，如果key不匹配返回error</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> gets <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cgets" tabindex="-1"><a class="header-anchor" href="#cgets"><span>cgets</span></a></h3><p>返回所有键值对，键值对列表，key匹配参数且值被加密，如果key不匹配返回一个错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> cgets <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Key<span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Value<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="getv" tabindex="-1"><a class="header-anchor" href="#getv"><span>getv</span></a></h3><p>以字符串形式返回值，其中key与其参数或可选的默认值匹配。如果未找到key且未给出默认值，则返回错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getv <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p><strong>With a default value</strong></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getv <span class="token string">&quot;/key&quot;</span> <span class="token string">&quot;default_value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="cgetv" tabindex="-1"><a class="header-anchor" href="#cgetv"><span>cgetv</span></a></h3><p>将加密值作为字符串返回，如果未找到key，返回错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>cgetv <span class="token string">&quot;/key&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="getvs" tabindex="-1"><a class="header-anchor" href="#getvs"><span>getvs</span></a></h3><p>返回所有值，[]string，其中key与其参数匹配。如果未找到密钥，则返回错误。</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> getvs <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="cgetvs" tabindex="-1"><a class="header-anchor" href="#cgetvs"><span>cgetvs</span></a></h3><p>返回所有加密值，[]string，其中key与其参数匹配。如果未找到key则返回错误</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> cgetvs <span class="token string">&quot;/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="getenv" tabindex="-1"><a class="header-anchor" href="#getenv"><span>getenv</span></a></h3><p>检索由key命名的环境变量的值。 如果变量不存在，返回为空。 （可选）可以提供一个默认值，如果该键不存在，将返回该值。</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>export HOSTNAME<span class="token operator">=</span><span class="token string">\`hostname\`</span>
hostname<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getenv <span class="token string">&quot;HOSTNAME&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>With a default value</strong></p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>ipaddr<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>getenv <span class="token string">&quot;HOST_IP&quot;</span> <span class="token string">&quot;127.0.0.1&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="datetime" tabindex="-1"><a class="header-anchor" href="#datetime"><span>datetime</span></a></h3><p>与time.Now同名</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code># Generated by confd <span class="token punctuation">{</span><span class="token punctuation">{</span>datetime<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><p>Outputs:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code># Generated by confd <span class="token number">2015</span><span class="token operator">-</span><span class="token number">01</span><span class="token operator">-</span><span class="token number">23</span> <span class="token number">13</span><span class="token punctuation">:</span><span class="token number">34</span><span class="token punctuation">:</span><span class="token number">56.093250283</span> <span class="token operator">-</span><span class="token number">0800</span> PST
# Generated by confd <span class="token punctuation">{</span><span class="token punctuation">{</span>datetime<span class="token punctuation">.</span>Format <span class="token string">&quot;Jan 2, 2006 at 3:04pm (MST)&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><p>Outputs:</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code># Generated by confd Jan <span class="token number">23</span><span class="token punctuation">,</span> <span class="token number">2015</span> at <span class="token number">1</span><span class="token punctuation">:</span>34pm <span class="token punctuation">(</span>EST<span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="split" tabindex="-1"><a class="header-anchor" href="#split"><span>split</span></a></h3><p>用分隔字符拆分输入的字符串并返回一个子字符串切片</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span> $url <span class="token operator">:=</span> split <span class="token punctuation">(</span>getv <span class="token string">&quot;/deis/service&quot;</span><span class="token punctuation">)</span> <span class="token string">&quot;:&quot;</span> <span class="token punctuation">}</span><span class="token punctuation">}</span>
    host<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $url <span class="token number">0</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>index $url <span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p><strong>toUpper</strong></p><p>返回大写的字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>toUpper <span class="token string">&quot;value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="tolower" tabindex="-1"><a class="header-anchor" href="#tolower"><span>toLower</span></a></h3><p>返回小写的字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>toLower <span class="token string">&quot;Value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="json" tabindex="-1"><a class="header-anchor" href="#json"><span>json</span></a></h3><p>返回 json值得map[string]interface{}</p><h3 id="lookupsrv" tabindex="-1"><a class="header-anchor" href="#lookupsrv"><span>lookupSRV</span></a></h3><p>LookupSRV函数按照RFC 2782标准来构建用于查询的DNS。也就是说，它查询_service._proto.name。当service和proto参数都是空字符串时，LookupSRV将会直接查找name</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> lookupSRV <span class="token string">&quot;mail&quot;</span> <span class="token string">&quot;tcp&quot;</span> <span class="token string">&quot;example.com&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
  target<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Target<span class="token punctuation">}</span><span class="token punctuation">}</span>
  port<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Port<span class="token punctuation">}</span><span class="token punctuation">}</span>
  priority<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Priority<span class="token punctuation">}</span><span class="token punctuation">}</span>
  weight<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span>Weight<span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="base64encode" tabindex="-1"><a class="header-anchor" href="#base64encode"><span>base64Encode</span></a></h3><p>返回一个base64编码得字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>base64Encode <span class="token string">&quot;Value&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="base64decode" tabindex="-1"><a class="header-anchor" href="#base64decode"><span>base64Decode</span></a></h3><p>返回一个base64解码的字符串</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code>key<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>base64Decode <span class="token string">&quot;VmFsdWU=&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div><h3 id="jsonarray" tabindex="-1"><a class="header-anchor" href="#jsonarray"><span>jsonArray</span></a></h3><p>从json数组返回一个 []interface{}</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> jsonArray <span class="token punctuation">(</span>getv <span class="token string">&quot;/services/data/&quot;</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
val<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="ls" tabindex="-1"><a class="header-anchor" href="#ls"><span>ls</span></a></h3><p>返回所有子键，[]string，其中path匹配其参数。如果找不到path，则返回空列表</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> ls <span class="token string">&quot;/deis/services&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
   value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lsdir" tabindex="-1"><a class="header-anchor" href="#lsdir"><span>lsdir</span></a></h3><p>返回所有子键，[]string，其中path匹配其参数。它只返回包含子键的子键。如果找不到路径，则返回空列表。</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> lsdir <span class="token string">&quot;/deis/services&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
   value<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="dir" tabindex="-1"><a class="header-anchor" href="#dir"><span>dir</span></a></h3><p>返回给定键的父目录</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>with dir <span class="token string">&quot;/services/data/url&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
dir<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="join" tabindex="-1"><a class="header-anchor" href="#join"><span>join</span></a></h3><p>字符串拼接</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>$services <span class="token operator">:=</span> getvs <span class="token string">&quot;/services/elasticsearch/*&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
services<span class="token punctuation">:</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>join $services <span class="token string">&quot;,&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="replace" tabindex="-1"><a class="header-anchor" href="#replace"><span>replace</span></a></h3><p>字符串替换</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>$backend <span class="token operator">:=</span> getv <span class="token string">&quot;/services/backend/nginx&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
backend <span class="token operator">=</span> <span class="token punctuation">{</span><span class="token punctuation">{</span>replace $backend <span class="token string">&quot;-&quot;</span> <span class="token string">&quot;_&quot;</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="lookupip" tabindex="-1"><a class="header-anchor" href="#lookupip"><span>lookupIP</span></a></h3><p>查找ip</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token keyword">range</span> lookupIP <span class="token string">&quot;some.host.local&quot;</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
    server <span class="token punctuation">{</span><span class="token punctuation">{</span><span class="token punctuation">.</span><span class="token punctuation">}</span><span class="token punctuation">}</span><span class="token punctuation">;</span>
<span class="token punctuation">{</span><span class="token punctuation">{</span>end<span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><h3 id="atoi" tabindex="-1"><a class="header-anchor" href="#atoi"><span>atoi</span></a></h3><p>字符换转整数</p><p>例如：</p><div class="language-go line-numbers-mode" data-ext="go" data-title="go"><pre class="language-go"><code><span class="token punctuation">{</span><span class="token punctuation">{</span>seq <span class="token number">1</span> <span class="token punctuation">(</span>atoi <span class="token punctuation">(</span>getv <span class="token string">&quot;/count&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">}</span><span class="token punctuation">}</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div></div></div>`,159);function i(l,u){return t(),a("div",null,[s(" more "),c])}const k=n(o,[["render",i],["__file","confd.html.vue"]]),g=JSON.parse('{"path":"/tools/confd.html","title":"confd简介","lang":"zh-CN","frontmatter":{"title":"confd简介","date":"2023-07-30T00:00:00.000Z","tag":["工具"],"category":["工具"],"head":[["meta",{"property":"og:url","content":"http://blog.cjhe.top/tools/confd.html"}],["meta",{"property":"og:site_name","content":"个人博客"}],["meta",{"property":"og:title","content":"confd简介"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-05-05T15:52:14.000Z"}],["meta",{"property":"article:author","content":"Hexiaopi"}],["meta",{"property":"article:tag","content":"工具"}],["meta",{"property":"article:published_time","content":"2023-07-30T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-05-05T15:52:14.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"confd简介\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2023-07-30T00:00:00.000Z\\",\\"dateModified\\":\\"2024-05-05T15:52:14.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hexiaopi\\",\\"url\\":\\"https://github.com/Hexiaopi\\"}]}"]]},"headers":[{"level":2,"title":"confd 简介","slug":"confd-简介","link":"#confd-简介","children":[{"level":3,"title":"confd功能角色","slug":"confd功能角色","link":"#confd功能角色","children":[]}]},{"level":2,"title":"confd部署","slug":"confd部署","link":"#confd部署","children":[]},{"level":2,"title":"confd使用","slug":"confd使用","link":"#confd使用","children":[{"level":3,"title":"创建confdir","slug":"创建confdir","link":"#创建confdir","children":[]},{"level":3,"title":"模板源配置","slug":"模板源配置","link":"#模板源配置","children":[]},{"level":3,"title":"模板源","slug":"模板源","link":"#模板源","children":[]},{"level":3,"title":"启动confd的服务","slug":"启动confd的服务","link":"#启动confd的服务","children":[]},{"level":3,"title":"etcd设置数据","slug":"etcd设置数据","link":"#etcd设置数据","children":[]},{"level":3,"title":"验证配置文件数据","slug":"验证配置文件数据","link":"#验证配置文件数据","children":[]}]},{"level":2,"title":"confd模板功能函数","slug":"confd模板功能函数","link":"#confd模板功能函数","children":[{"level":3,"title":"map","slug":"map","link":"#map","children":[]},{"level":3,"title":"base","slug":"base","link":"#base","children":[]},{"level":3,"title":"exists","slug":"exists","link":"#exists","children":[]},{"level":3,"title":"get","slug":"get","link":"#get","children":[]},{"level":3,"title":"cget","slug":"cget","link":"#cget","children":[]},{"level":3,"title":"gets","slug":"gets","link":"#gets","children":[]},{"level":3,"title":"cgets","slug":"cgets","link":"#cgets","children":[]},{"level":3,"title":"getv","slug":"getv","link":"#getv","children":[]},{"level":3,"title":"cgetv","slug":"cgetv","link":"#cgetv","children":[]},{"level":3,"title":"getvs","slug":"getvs","link":"#getvs","children":[]},{"level":3,"title":"cgetvs","slug":"cgetvs","link":"#cgetvs","children":[]},{"level":3,"title":"getenv","slug":"getenv","link":"#getenv","children":[]},{"level":3,"title":"datetime","slug":"datetime","link":"#datetime","children":[]},{"level":3,"title":"split","slug":"split","link":"#split","children":[]},{"level":3,"title":"toLower","slug":"tolower","link":"#tolower","children":[]},{"level":3,"title":"json","slug":"json","link":"#json","children":[]},{"level":3,"title":"lookupSRV","slug":"lookupsrv","link":"#lookupsrv","children":[]},{"level":3,"title":"base64Encode","slug":"base64encode","link":"#base64encode","children":[]},{"level":3,"title":"base64Decode","slug":"base64decode","link":"#base64decode","children":[]},{"level":3,"title":"jsonArray","slug":"jsonarray","link":"#jsonarray","children":[]},{"level":3,"title":"ls","slug":"ls","link":"#ls","children":[]},{"level":3,"title":"lsdir","slug":"lsdir","link":"#lsdir","children":[]},{"level":3,"title":"dir","slug":"dir","link":"#dir","children":[]},{"level":3,"title":"join","slug":"join","link":"#join","children":[]},{"level":3,"title":"replace","slug":"replace","link":"#replace","children":[]},{"level":3,"title":"lookupIP","slug":"lookupip","link":"#lookupip","children":[]},{"level":3,"title":"atoi","slug":"atoi","link":"#atoi","children":[]}]}],"git":{"createdTime":1642859663000,"updatedTime":1714924334000,"contributors":[{"name":"hexiaopi","email":"hechangjie0619@icloud.com","commits":2},{"name":"HeXiaoPi","email":"hechangjie0619@icloud.com","commits":1}]},"readingTime":{"minutes":5.07,"words":1521},"filePathRelative":"tools/confd.md","localizedDate":"2023年7月30日","excerpt":""}');export{k as comp,g as data};
