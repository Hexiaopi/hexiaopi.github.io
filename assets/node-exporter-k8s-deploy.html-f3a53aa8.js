const n=JSON.parse('{"key":"v-775cd751","path":"/devops/node-exporter-k8s-deploy.html","title":"node-exporter k8s 部署","lang":"zh-CN","frontmatter":{"title":"node-exporter k8s 部署","date":"2024-01-15T00:00:00.000Z","tag":["prometheus","k8s"],"category":["devops"],"description":"由于需要每个节点都部署node-exporter，因此kind选择DaemonSet，它会保障每个节点有一个相同的实例。 apiVersion: apps/v1 kind: DaemonSet metadata: name: node-exporter namespace: monitor labels: k8s-app: node-exporter spec: selector: matchLabels: k8s-app: node-exporter template: metadata: labels: k8s-app: node-exporter spec: tolerations: - effect: NoSchedule key: node-role.kubernetes.io/master containers: - image: prom/node-exporter:latest imagePullPolicy: IfNotPresent name: prometheus-node-exporter ports: - containerPort: 9100 hostPort: 9100 protocol: TCP name: metrics volumeMounts: - mountPath: /host/proc name: proc - mountPath: /host/sys name: sys - mountPath: /host name: rootfs args: - --path.procfs=/host/proc - --path.sysfs=/host/sys - --path.rootfs=/host volumes: - name: proc hostPath: path: /proc - name: sys hostPath: path: /sys - name: rootfs hostPath: path: / hostNetwork: true hostPID: true --- apiVersion: v1 kind: Service metadata: annotations: prometheus.io/scrape: \\"true\\" labels: k8s-app: node-exporter name: node-exporter namespace: monitor spec: type: NodePort ports: - name: http port: 9100 nodePort: 39100 protocol: TCP selector: k8s-app: node-exporter","head":[["meta",{"property":"og:url","content":"https://Hexiaopi.github.io/devops/node-exporter-k8s-deploy.html"}],["meta",{"property":"og:site_name","content":"Hexiaopi"}],["meta",{"property":"og:title","content":"node-exporter k8s 部署"}],["meta",{"property":"og:description","content":"由于需要每个节点都部署node-exporter，因此kind选择DaemonSet，它会保障每个节点有一个相同的实例。 apiVersion: apps/v1 kind: DaemonSet metadata: name: node-exporter namespace: monitor labels: k8s-app: node-exporter spec: selector: matchLabels: k8s-app: node-exporter template: metadata: labels: k8s-app: node-exporter spec: tolerations: - effect: NoSchedule key: node-role.kubernetes.io/master containers: - image: prom/node-exporter:latest imagePullPolicy: IfNotPresent name: prometheus-node-exporter ports: - containerPort: 9100 hostPort: 9100 protocol: TCP name: metrics volumeMounts: - mountPath: /host/proc name: proc - mountPath: /host/sys name: sys - mountPath: /host name: rootfs args: - --path.procfs=/host/proc - --path.sysfs=/host/sys - --path.rootfs=/host volumes: - name: proc hostPath: path: /proc - name: sys hostPath: path: /sys - name: rootfs hostPath: path: / hostNetwork: true hostPID: true --- apiVersion: v1 kind: Service metadata: annotations: prometheus.io/scrape: \\"true\\" labels: k8s-app: node-exporter name: node-exporter namespace: monitor spec: type: NodePort ports: - name: http port: 9100 nodePort: 39100 protocol: TCP selector: k8s-app: node-exporter"}],["meta",{"property":"og:type","content":"article"}],["meta",{"property":"og:locale","content":"zh-CN"}],["meta",{"property":"og:updated_time","content":"2024-01-15T12:32:28.000Z"}],["meta",{"property":"article:author","content":"Hexiaopi"}],["meta",{"property":"article:tag","content":"prometheus"}],["meta",{"property":"article:tag","content":"k8s"}],["meta",{"property":"article:published_time","content":"2024-01-15T00:00:00.000Z"}],["meta",{"property":"article:modified_time","content":"2024-01-15T12:32:28.000Z"}],["script",{"type":"application/ld+json"},"{\\"@context\\":\\"https://schema.org\\",\\"@type\\":\\"Article\\",\\"headline\\":\\"node-exporter k8s 部署\\",\\"image\\":[\\"\\"],\\"datePublished\\":\\"2024-01-15T00:00:00.000Z\\",\\"dateModified\\":\\"2024-01-15T12:32:28.000Z\\",\\"author\\":[{\\"@type\\":\\"Person\\",\\"name\\":\\"Hexiaopi\\",\\"url\\":\\"https://github.com/Hexiaopi\\"}]}"]]},"headers":[],"git":{"createdTime":1705321948000,"updatedTime":1705321948000,"contributors":[{"name":"HeXiaoPi","email":"hechangjie0619@icloud.com","commits":1}]},"readingTime":{"minutes":0.61,"words":182},"filePathRelative":"devops/node-exporter-k8s-deploy.md","localizedDate":"2024年1月15日","excerpt":"<p>由于需要每个节点都部署node-exporter，因此kind选择DaemonSet，它会保障每个节点有一个相同的实例。</p>\\n<div class=\\"language-yaml line-numbers-mode\\" data-ext=\\"yml\\"><pre class=\\"language-yaml\\"><code><span class=\\"token key atrule\\">apiVersion</span><span class=\\"token punctuation\\">:</span> apps/v1\\n<span class=\\"token key atrule\\">kind</span><span class=\\"token punctuation\\">:</span> DaemonSet\\n<span class=\\"token key atrule\\">metadata</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n  <span class=\\"token key atrule\\">namespace</span><span class=\\"token punctuation\\">:</span> monitor\\n  <span class=\\"token key atrule\\">labels</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">k8s-app</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n<span class=\\"token key atrule\\">spec</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">selector</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">matchLabels</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token key atrule\\">k8s-app</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n  <span class=\\"token key atrule\\">template</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">metadata</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token key atrule\\">labels</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token key atrule\\">k8s-app</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n    <span class=\\"token key atrule\\">spec</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token key atrule\\">tolerations</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">effect</span><span class=\\"token punctuation\\">:</span> NoSchedule\\n          <span class=\\"token key atrule\\">key</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>role.kubernetes.io/master\\n      <span class=\\"token key atrule\\">containers</span><span class=\\"token punctuation\\">:</span>\\n      <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">image</span><span class=\\"token punctuation\\">:</span> prom/node<span class=\\"token punctuation\\">-</span>exporter<span class=\\"token punctuation\\">:</span>latest\\n        <span class=\\"token key atrule\\">imagePullPolicy</span><span class=\\"token punctuation\\">:</span> IfNotPresent\\n        <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> prometheus<span class=\\"token punctuation\\">-</span>node<span class=\\"token punctuation\\">-</span>exporter\\n        <span class=\\"token key atrule\\">ports</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">containerPort</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">9100</span>\\n          <span class=\\"token key atrule\\">hostPort</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">9100</span>\\n          <span class=\\"token key atrule\\">protocol</span><span class=\\"token punctuation\\">:</span> TCP\\n          <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> metrics\\n        <span class=\\"token key atrule\\">volumeMounts</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">mountPath</span><span class=\\"token punctuation\\">:</span> /host/proc\\n          <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> proc\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">mountPath</span><span class=\\"token punctuation\\">:</span> /host/sys\\n          <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> sys\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">mountPath</span><span class=\\"token punctuation\\">:</span> /host\\n          <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> rootfs\\n        <span class=\\"token key atrule\\">args</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token punctuation\\">-</span><span class=\\"token punctuation\\">-</span>path.procfs=/host/proc\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token punctuation\\">-</span><span class=\\"token punctuation\\">-</span>path.sysfs=/host/sys\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token punctuation\\">-</span><span class=\\"token punctuation\\">-</span>path.rootfs=/host\\n      <span class=\\"token key atrule\\">volumes</span><span class=\\"token punctuation\\">:</span>\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> proc\\n          <span class=\\"token key atrule\\">hostPath</span><span class=\\"token punctuation\\">:</span>\\n            <span class=\\"token key atrule\\">path</span><span class=\\"token punctuation\\">:</span> /proc\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> sys\\n          <span class=\\"token key atrule\\">hostPath</span><span class=\\"token punctuation\\">:</span>\\n            <span class=\\"token key atrule\\">path</span><span class=\\"token punctuation\\">:</span> /sys\\n        <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> rootfs\\n          <span class=\\"token key atrule\\">hostPath</span><span class=\\"token punctuation\\">:</span>\\n            <span class=\\"token key atrule\\">path</span><span class=\\"token punctuation\\">:</span> /\\n      <span class=\\"token key atrule\\">hostNetwork</span><span class=\\"token punctuation\\">:</span> <span class=\\"token boolean important\\">true</span>\\n      <span class=\\"token key atrule\\">hostPID</span><span class=\\"token punctuation\\">:</span> <span class=\\"token boolean important\\">true</span>\\n<span class=\\"token punctuation\\">---</span>\\n<span class=\\"token key atrule\\">apiVersion</span><span class=\\"token punctuation\\">:</span> v1\\n<span class=\\"token key atrule\\">kind</span><span class=\\"token punctuation\\">:</span> Service\\n<span class=\\"token key atrule\\">metadata</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">annotations</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">prometheus.io/scrape</span><span class=\\"token punctuation\\">:</span> <span class=\\"token string\\">\\"true\\"</span>\\n  <span class=\\"token key atrule\\">labels</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">k8s-app</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n  <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n  <span class=\\"token key atrule\\">namespace</span><span class=\\"token punctuation\\">:</span> monitor\\n<span class=\\"token key atrule\\">spec</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token key atrule\\">type</span><span class=\\"token punctuation\\">:</span> NodePort\\n  <span class=\\"token key atrule\\">ports</span><span class=\\"token punctuation\\">:</span>\\n  <span class=\\"token punctuation\\">-</span> <span class=\\"token key atrule\\">name</span><span class=\\"token punctuation\\">:</span> http\\n    <span class=\\"token key atrule\\">port</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">9100</span>\\n    <span class=\\"token key atrule\\">nodePort</span><span class=\\"token punctuation\\">:</span> <span class=\\"token number\\">39100</span>\\n    <span class=\\"token key atrule\\">protocol</span><span class=\\"token punctuation\\">:</span> TCP\\n  <span class=\\"token key atrule\\">selector</span><span class=\\"token punctuation\\">:</span>\\n    <span class=\\"token key atrule\\">k8s-app</span><span class=\\"token punctuation\\">:</span> node<span class=\\"token punctuation\\">-</span>exporter\\n</code></pre><div class=\\"line-numbers\\" aria-hidden=\\"true\\"><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div><div class=\\"line-number\\"></div></div></div>","autoDesc":true}');export{n as data};
