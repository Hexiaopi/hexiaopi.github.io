{
  "version": "https://jsonfeed.org/version/1.1",
  "title": "Hexiaopi",
  "home_page_url": "https://Hexiaopi.github.io/",
  "feed_url": "https://Hexiaopi.github.io/feed.json",
  "description": "一枚后端攻城狮的个人博客",
  "items": [
    {
      "title": "Go之禅",
      "url": "https://Hexiaopi.github.io/go-language/reprint/zen.html",
      "id": "https://Hexiaopi.github.io/go-language/reprint/zen.html",
      "summary": "Python的核心开发成员之一Tim Peter写下的《The Zen of Python》，成为Python编程和设计的指导原则。Go语言步道师Dave Cheney 2020年发表了名为《The Zen of Go》 译文 Each package fulfils a single purpose 每一个package实现单一目标 A well designed Go package provides a single idea, a set of related behaviours. A good Go package starts by choosing a good name. Think of your package’s name as an elevator pitch to describe what it provides, using just one word. 精心设计的Go软件包只提供单一功能和一系列相关的行为。一个好的Go软件包从选择一个好的名字开始。把你的包的名字想象成一个电梯广告，仅用一个词来描述它所提供的功能。",
      "content_html": "<blockquote>\n<p>Python的核心开发成员之一Tim Peter写下的《The Zen of Python》，成为Python编程和设计的指导原则。Go语言步道师Dave Cheney 2020年发表了名为《The Zen of Go》</p>\n</blockquote>\n<h2> 译文</h2>\n<h3> Each package fulfils a single purpose 每一个package实现单一目标</h3>\n<p>A well designed Go package provides a single idea, a set of related behaviours. A good Go package starts by choosing a good name. Think of your package’s name as an elevator pitch to describe what it provides, using just one word.<br>\n精心设计的Go软件包只提供单一功能和一系列相关的行为。一个好的Go软件包从选择一个好的名字开始。把你的包的名字想象成一个电梯广告，仅用一个词来描述它所提供的功能。</p>\n<h3> Handle errors explicitly 显式处理错误</h3>\n<p>Robust programs are composed from pieces that handle the failure cases before they pat themselves on the back. The verbosity of if err != nil { return err } is outweighed by the value of deliberately handling each failure condition at the point at which they occur. Panic and recover are not exceptions, they aren’t intended to be used that way.<br>\n健壮的程序是由处理失败case的各个片段组成的。 冗长的<code>if err != nil { return err }</code> 比出了故障再一个个去处理更有价值。Panic和recover也一样。</p>\n<h3> Return early rather than nesting deeply 尽早return，不要深陷</h3>\n<p>Every time you indent you add another precondition to the programmer’s stack consuming one of the 7 ±2 slots in their short term memory. Avoid control flow that requires deep indentation. Rather than nesting deeply, keep the success path to the left using guard clauses.<br>\n每缩进一次，就会在程序员的堆栈中增加一个前提条件，占用其短时记忆中 7 ±2 个插槽中的一个。避免需要深度缩进的控制流。与其深度嵌套，不如使用保护子句将成功路径保持在左侧。</p>\n<h3> Leave concurrency to the caller 并发权留给调用者</h3>\n<p>Let the caller choose if they want to run your library or function asynchronously, don’t force it on them. If your library uses concurrency it should do so transparently.<br>\n让调用者自己选择是否要异步运行你的库或函数，不要强迫他们。如果您的程序库使用并发功能，则应透明地使用。</p>\n<h3> Before you launch a goroutine, know when it will stop 在启动goroutine之前，要知道它什么时候会停止</h3>\n<p>Goroutines own resources; locks, variables, memory, etc. The sure fire way to free those resources is to stop the owning goroutine.<br>\ngoroutine 拥有锁、变量、内存等资源。释放这些资源的可靠方法是停止拥有资源的 goroutine。</p>\n<h3> Avoid package level state 避免包级状态</h3>\n<p>Seek to be explicit, reduce coupling, and spooky action at a distance by providing the dependencies a type needs as fields on that type rather than using package variables.<br>\n通过将类型所需的依赖关系作为该类型的字段而不是使用包变量来提供，力求显式化，减少耦合，并实现超距作用。</p>\n<h3> Simplicity matters 简单很重要</h3>\n<p>Simplicity is not a synonym for unsophisticated. Simple doesn’t mean crude, it means readable and maintainable. When it is possible to choose, defer to the simpler solution.<br>\n简单不是容易（不复杂）的同义词。简单并不意味着粗糙，它意味着可读性和可维护性。如果可以选择，请遵循较简单的解决方案。</p>\n<h3> Write tests to lock in the behaviour of your package’s API 编写测试以确定包API的行为</h3>\n<p>Test first or test later, if you shoot for 100% test coverage or are happy with less, regardless your package’s API is your contract with its users. Tests are the guarantees that those contracts are written in. Make sure you test for the behaviour that users can observe and rely on.<br>\n先测试还是后测试，是追求 100% 的测试覆盖率还是满足于较低的测试覆盖率，无论如何，软件包的应用程序接口都是您与用户之间的契约。测试是这些合约的保证。请确保您测试的是用户可以观察和依赖的行为。</p>\n<h3> If you think it’s slow, first prove it with a benchmark 如果你觉得慢，先用基准来证明</h3>\n<p>So many crimes against maintainability are committed in the name of performance. Optimisation tears down abstractions, exposes internals, and couples tightly. If you’re choosing to shoulder that cost, ensure it is done for good reason.<br>\n以性能为名，对可维护性犯下了许多罪行。优化会破坏抽象概念，暴露内部结构，并造成紧密耦合。如果你选择承担这种代价，请确保这样做是有充分理由的。</p>\n<h3> Moderation is a virtue 节制是一种美德</h3>\n<p>Use goroutines, channels, locks, interfaces, embedding, in moderation.<br>\n适度使用goroutines、channels、locks、interfaces、embedded。</p>\n<h3> Maintainability counts 可维护性很重要</h3>\n<p>Clarity, readability, simplicity, are all aspects of maintainability. Can the thing you worked hard to build be maintained after you’re gone? What can you do today to make it easier for those that come after you?<br>\n清晰度、可读性、简洁性都是可维护性的体现。你辛辛苦苦创建的东西在你离开后还能被维护吗？你今天能做些什么来让你的后人更容易地维护它？</p>\n<h2> 参考文献</h2>\n<p><a href=\"https://the-zen-of-go.netlify.app\" target=\"_blank\" rel=\"noopener noreferrer\">简洁版</a><br>\n<a href=\"https://dave.cheney.net/2020/02/23/the-zen-of-go\" target=\"_blank\" rel=\"noopener noreferrer\">完整版</a></p>\n",
      "date_published": "2023-08-15T00:00:00.000Z",
      "date_modified": "2023-08-16T03:24:53.000Z",
      "authors": [],
      "tags": [
        "Go语言",
        "转载"
      ]
    },
    {
      "title": "Go箴言",
      "url": "https://Hexiaopi.github.io/go-language/reprint/proverb.html",
      "id": "https://Hexiaopi.github.io/go-language/reprint/proverb.html",
      "summary": "【转】原文链接 Go 语言之父 Rob Pike 在 2015 年分享的主题《Go Proverbs》 核心理念是：简单、诗意、简洁（Simple, Poetic, Pithy）。 译文 Don't communicate by sharing memory, share memory by communicating. 不要通过共享内存进行通信，通过通信共享内存",
      "content_html": "<p>【转】<a href=\"http://go-proverbs.github.io/\" target=\"_blank\" rel=\"noopener noreferrer\">原文链接</a></p>\n<blockquote>\n<p>Go 语言之父 Rob Pike 在 2015 年分享的主题《Go Proverbs》</p>\n<p>核心理念是：简单、诗意、简洁（Simple, Poetic, Pithy）。</p>\n</blockquote>\n<h2> 译文</h2>\n<p>Don't communicate by sharing memory, share memory by communicating.<br>\n不要通过共享内存进行通信，通过通信共享内存</p>\n<p>Concurrency is not parallelism.<br>\n并发不是并行</p>\n<p>Channels orchestrate; mutexes serialize.<br>\n管道用于协调；互斥锁用于同步</p>\n<p>The bigger the interface, the weaker the abstraction.<br>\n接口越大，抽象就越弱</p>\n<p>Make the zero value useful.<br>\n利用好零值</p>\n<p>interface{} says nothing.<br>\n空接口 interface{} 没有任何类型约束</p>\n<p>Gofmt's style is no one's favorite, yet gofmt is everyone's favorite.<br>\nGofmt 的风格不是人们最喜欢的，但 gofmt 是每个人的最爱</p>\n<p>A little copying is better than a little dependency.<br>\n允许一点点重复比引入一点点依赖更好</p>\n<p>Syscall must always be guarded with build tags.<br>\n系统调用必须始终使用构建标记进行保护</p>\n<p>Cgo must always be guarded with build tags.<br>\n必须始终使用构建标记保护 Cgo</p>\n<p>Cgo is not Go.<br>\nCgo 不是 Go。</p>\n<p>With the unsafe package there are no guarantees.<br>\n使用标准库的 unsafe 包，不能保证能如期运行</p>\n<p>Clear is better than clever.<br>\n清晰比聪明更好</p>\n<p>Reflection is never clear.<br>\n反射永远不清晰</p>\n<p>Errors are values.<br>\n错误是值</p>\n<p>Don't just check errors, handle them gracefully.<br>\n不要只检查错误，还要优雅地处理它们</p>\n<p>Design the architecture, name the components, document the details.<br>\n设计架构，命名组件，文档记录细节</p>\n<p>Documentation is for users.<br>\n文档是供用户使用的</p>\n<p>Don't panic.<br>\n不要使用 panic</p>\n<h2> 参考文献</h2>\n<p><a href=\"http://go-proverbs.github.io/\" target=\"_blank\" rel=\"noopener noreferrer\">原文链接</a><br>\n<a href=\"https://zhuanlan.zhihu.com/p/514680942\" target=\"_blank\" rel=\"noopener noreferrer\">中文译文</a></p>\n",
      "date_published": "2023-08-15T00:00:00.000Z",
      "date_modified": "2023-08-15T03:08:15.000Z",
      "authors": [],
      "tags": [
        "Go语言",
        "转载"
      ]
    },
    {
      "title": "Grafana",
      "url": "https://Hexiaopi.github.io/middleware/grafana.html",
      "id": "https://Hexiaopi.github.io/middleware/grafana.html",
      "summary": "Grafana简介 grafana简介 Grafana是适用于所有指标的分析平台，允许用户查询、可视化、提醒和理解指标。 另外一种定义 Grafana是一款开源的、功能丰富的支持Graphite、Elasticsearch、OpenTSDB、Prometheus和InfluxDB等数据源的指标仪表板和图形编辑器。 官网：https://grafana.com/",
      "content_html": "<h2> Grafana简介</h2>\n<h3> grafana简介</h3>\n<blockquote>\n<p>Grafana是适用于所有指标的分析平台，允许用户查询、可视化、提醒和理解指标。</p>\n</blockquote>\n<p>另外一种定义</p>\n<blockquote>\n<p>Grafana是一款开源的、功能丰富的支持Graphite、Elasticsearch、OpenTSDB、Prometheus和InfluxDB等数据源的指标仪表板和图形编辑器。</p>\n</blockquote>\n<p><strong>官网：</strong><code>https://grafana.com/</code></p>\n<p><strong>Github：</strong><code>https://github.com/grafana/grafana</code></p>\n<h2> Grafana使用（基础）</h2>\n<p>Grafana的使用主要围绕Dashboard（仪表板），如图所示：</p>\n<figure><figcaption>dashboard</figcaption></figure>\n<blockquote>\n<p><strong>仪表板</strong>由一组面板（panel）组织排列的视图</p>\n<ul>\n<li>支持动态选择可视化数据，如图中左上角的IP下拉选，该功能是由<strong>变量</strong>实现<!--2.2.3会介绍到--></li>\n<li>支持新增面板、收藏、分享、保存修改、设置、时间选择，如图中右上角展示</li>\n</ul>\n</blockquote>\n<h3> panel（面板）</h3>\n<h4> Queries （查询）</h4>\n<figure><figcaption>panel-query</figcaption></figure>\n<p>查询界面支持选择数据源、查询编辑器以及查询条件，并且支持多条查询；</p>\n<ul>\n<li>\n<p><strong>Lengend</strong>  在图表下方表格展示指标中标签的值。例如：填写**{{hostname}}<strong>将替换为指标标签中</strong>hostname**对应的标签值；</p>\n</li>\n<li>\n<p><strong>Min step</strong> 面板的数据间隔步长，注意，时间范围选择（右上角）会变成该间距的倍数。例如：面板数据时间间隔设置为1m；（可用鼠标放在图线上看数据时间间隔）</p>\n</li>\n<li>\n<p><strong>Resolution</strong> 控制采样点，降低采样点可以加快速度；</p>\n</li>\n<li>\n<p><strong>Format</strong> 在表格、时间序列或热图之间切换；</p>\n</li>\n<li>\n<p><strong>Instant</strong> 即时，对于<strong>某些面板</strong>可以展示历史数据，也可以只展示当前数据，勾选则表示即时；</p>\n</li>\n<li>\n<p><strong>Link to Graph in Prometheus</strong> 重定向到Prometheus Web页面；</p>\n</li>\n</ul>\n<p>由于可以有多个表达式查询，下面三个是用于全局控制多条查询语句的时间</p>\n<ul>\n<li>\n<p><strong>Min time interval</strong> 最小时间间隔，建议设置为采集频率；可以在表达式中使用<code>$__interval</code>和<code>$__interval_ms</code>两个变量；</p>\n</li>\n<li>\n<p><strong>Relative time</strong> 相对时间，面板展示最近多长时间；</p>\n</li>\n<li>\n<p><strong>Time shift</strong> 时间偏移，面板展示到现在之前一段时间，例如：1h之前；</p>\n</li>\n</ul>\n<h4> Visualization（可视化）</h4>\n<p>可视化支持许多类型的面板：<code>Graph</code>、<code>Singlestat</code>、<code>Table</code>、<code>Heatmap</code>、<code>Alert list</code>、<code>Dashboard list</code>、<code>Text</code>等，且支持从社区下载其他类型面板插件，例如饼图、世界地图等；</p>\n<h5> <strong>Graph</strong></h5>\n<p>Graph常用来展示多条数据的折线图、条形图，<a href=\"https://grafana.com/docs/features/panels/graph/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<figure><figcaption>graph-general</figcaption></figure>\n<ul>\n<li>\n<p><strong>Draw Modes</strong>：支持三种方式画图：Bars（条形图）、lines（折线图）、Points(点图)；</p>\n</li>\n<li>\n<p><strong>Model Options</strong>：对图形的一些配置选项：Fill (图形填充颜色深度)、Line Width(线的宽度)、Staircase(将折线图转换为梯状)；</p>\n</li>\n<li>\n<p><strong>Hover tooltip</strong>：鼠标停放提示，Mode支持：<strong>All series</strong>（鼠标停放在线上时展示所有线的数据）、<strong>Single</strong>（鼠标停放在线上时展示该条线的数据）、<strong>Sort order</strong>支持None、Increasing、Decreasing，来排序展示；</p>\n</li>\n<li>\n<p><strong>Stacking &amp; Null value</strong>：<strong>Stack</strong>，一条线放在另一条线上面展示；<strong>Null value</strong>: 当数据丢失时可以选择进行弥补，例如connected连接前后线，null as zero将丢失数据设置为空；</p>\n</li>\n</ul>\n<figure><figcaption>graph-axes</figcaption></figure>\n<p><strong>Left Y / Right Y</strong>：</p>\n<p>在<strong>左侧Y轴</strong>和<strong>右侧Y轴</strong>可以使用自定义的：</p>\n<ul>\n<li><strong>单位</strong> - Y值的显示单位；</li>\n<li><strong>比例</strong> - 用于Y值的比例，线性或对数；（默认线性）</li>\n<li><strong>Y-Min</strong> - 最小Y值；（默认自动）</li>\n<li><strong>Y-Max</strong> - 最大Y值；（默认自动）</li>\n<li><strong>小数</strong> - 控制Y值显示的小数位数；（默认为自动）</li>\n<li><strong>标签</strong> - Y轴标签；（默认为“”）</li>\n</ul>\n<p><strong>X-Axis</strong> ：x轴，Mode支持：<strong>Time</strong>，x轴以时间维度展示；<strong>Series</strong>根据自定义分组条形图展示；<strong>Histogram</strong>根据值分布统计以条形图展示；</p>\n<p><strong>Y-Axes</strong>：Y轴 <s>(暂无需求)</s></p>\n<figure><figcaption>graph-legend</figcaption></figure>\n<ul>\n<li>\n<p><strong>Options</strong>：<strong>As Table</strong>以表格展示下面Values勾选的值；<strong>To the right</strong>在图的右边展示表；</p>\n</li>\n<li>\n<p><strong>Values</strong>: 历史所有值的最小值、最大值、平均值、当前值、总计值；小数位数；</p>\n</li>\n<li>\n<p><strong>Hide series</strong>：对于一些特定值使用空值或零值隐藏；（<s>暂无需求</s>）</p>\n</li>\n</ul>\n<figure><figcaption>graph-time</figcaption></figure>\n<ul>\n<li><strong>Thresholds &amp; Time Regions</strong> 可以增加阈值，例如值gt(大于)0.2的时候显示告警；可以突出显示某段时间，例如周一到周五；</li>\n</ul>\n<h5> <strong>Singlestat</strong></h5>\n<p>Singlestat常用来展示单一数据统计数据，可设置最大值、最小值、平均值、总和值，另外提供数字到文本的转换，例如机器节点状况指标up，值1代表机器正常运行，值0代表机器挂掉；<a href=\"https://grafana.com/docs/features/panels/singlestat/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<h5> <strong>Table</strong></h5>\n<p>Table支持时间序列的多种模式，以时间序列为顺序展示指标数据；<a href=\"https://grafana.com/docs/features/panels/table_panel/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<h5> <strong>Heatmap</strong></h5>\n<p>Heatmap常用来展示数据的分布，例如耗时分布情况，<a href=\"https://grafana.com/docs/features/panels/heatmap/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<h5> <strong>Alert list</strong></h5>\n<p>Alert list 用于展示仪表板警报信息，<s>暂无需求</s>，<a href=\"https://grafana.com/docs/features/panels/alertlist/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<h5> <strong>Dashboard list</strong></h5>\n<p>Dashboard list支持指向其他仪表板的动态链接。该列表可以配置为使用加星标的仪表板。<a href=\"https://grafana.com/docs/features/panels/dashlist/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<h5> <strong>Text</strong></h5>\n<p>Text支持为仪表板制作信息和说明面板，支持三种模式：markdown、HTML、text。<a href=\"https://grafana.com/docs/features/panels/text/\" target=\"_blank\" rel=\"noopener noreferrer\">相关配置参考官网</a></p>\n<h4> General</h4>\n<ol>\n<li><code>Title</code>：标题，仪表板的名称</li>\n<li><code>Transparent</code>：透明，面板是否透明展示；</li>\n<li><code>Description</code>：描述</li>\n</ol>\n<p><strong>Repeating</strong></p>\n<p>根据模板变量的值动态创建新面板，可以使用该功能；例如：想为每个产品创建同一个面板分别展示，可以选择产品这个变量；</p>\n<p><strong>Drilldown Links</strong></p>\n<p>支持添加动态链接到其他仪表板或外部URL；</p>\n<h4> Alert</h4>\n<p><s>暂无需求</s></p>\n<h3> Settings（设置）</h3>\n<figure><figcaption>dashboard-settings</figcaption></figure>\n<h4> General</h4>\n<blockquote>\n<p>一般性设置</p>\n</blockquote>\n<ul>\n<li><code>Name</code>：仪表板名称</li>\n<li><code>Description</code>：描述</li>\n<li><code>Tags</code>：标签，用于主页面搜素</li>\n<li><code>Folde</code>r：文件夹，用于管理仪表板</li>\n<li><code>Editable</code>：是否可编辑</li>\n</ul>\n<p><strong>Time Options</strong></p>\n<ul>\n<li><code>Timezone</code>：时间区域，本地浏览器时间还是UTC</li>\n<li><code>Auto-refresh</code>：自动刷新时间</li>\n<li><code>Now delay now-</code>：例如填写1m，表示忽略最近一分钟的指标数据，因为可能最近一分钟的指标不完整</li>\n<li><code>Hide time picker</code>：是否隐藏时间选择器</li>\n</ul>\n<p><strong>Panel Options</strong></p>\n<ul>\n<li><code>Graph Tooltip</code>：图形工具提示<s>暂无需求</s></li>\n</ul>\n<h4> Annotations（注释）</h4>\n<blockquote>\n<p>可以在图标上标记，描述事件</p>\n</blockquote>\n<p>使用方法：选择面板—&gt;按住CTRL或CMD+单击/选择—&gt;填写</p>\n<figure><figcaption>annotation</figcaption></figure>\n<p>可以用于记录异常情况，稍后进行排查分析</p>\n<p>在设置页面可以设置Annotations的颜色，这样在面板上可以很清楚的发现。</p>\n<h4> Variables（变量）</h4>\n<blockquote>\n<p>变量是值得占位符</p>\n<p>目的：变量使得仪表板具有更多交互式和动态，变量显示为仪表板顶部的下拉选择框，通过这些下拉菜单，可以轻松更改仪表板中显示的数据。</p>\n<p>使用范围：可以在指标查询和面板标题中使用变量；</p>\n</blockquote>\n<p><strong>Example</strong>：如下图红线框所示，可以根据变量IP动态选择展示各个机器的指标数据</p>\n<figure><figcaption>example-variable</figcaption></figure>\n<p><strong>变量引用（基础）</strong>：</p>\n<ul>\n<li><code>$varname</code> 示例：<code>apps.frontend.$server.requests.count</code>、<code>node_load1{instance=~\"$node\"}</code></li>\n<li><code>[[varname]]</code> 示例：<code>apps.frontend.[[server]].requests.count</code></li>\n</ul>\n<p>第一种方式比较容易读写，但不允许在单词中间使用变量，但第二种写法可以例如<code>my.server[[serverNumber]].count</code></p>\n<p><strong>变量引用（高级）</strong>：</p>\n<blockquote>\n<p>对于多值引用，尤其是选择<code>All</code>选项时，不同的数据源对于多值的拼接是不同的。例如，MySql数据源的默认值是将多个值连接为逗号分隔的引号：<code>'server01','server02'</code>。在某些情况下，可能希望使用逗号分隔的字符串而不带引号：<code>server01,server02</code>。现在可以使用高级格式化选项。</p>\n</blockquote>\n<p>形式：<code>${var_name:option}</code><a href=\"https://grafana.com/docs/reference/templating/#advanced-formatting-options\" target=\"_blank\" rel=\"noopener noreferrer\">详情参考官网</a></p>\n<p><strong>添加变量</strong>：点击仪表板设置按钮—&gt;Variable—&gt;new</p>\n<figure><figcaption>edit-variable</figcaption></figure>\n<p><strong>General</strong></p>\n<ol>\n<li><code>Name</code>：名称，变量的名称，是度量标准查询中引用变量使用的名称。必须唯一，不包含空格；</li>\n<li><code>Lable</code>：标签，此变量的下拉列表左边的名称；</li>\n<li><code>Type</code>：类型，定义变量的类型；<strong>一般选择Query</strong>; <a href=\"https://grafana.com/docs/reference/templating/#variable-types\" target=\"_blank\" rel=\"noopener noreferrer\">详情查看官网</a></li>\n<li><code>Hide</code>：隐藏，隐藏下拉选择框的选项；例如选择Lable，则下拉选择框的左边标签不再显示；选择Variable，整个下拉选择框不再显示；</li>\n</ol>\n<p><strong>Query Options</strong></p>\n<ol>\n<li><code>Data Source</code>：数据源</li>\n<li><code>Query</code>：特定的查询表达式，不同的数据源用不同的表达式，<a href=\"https://grafana.com/docs/reference/templating/#query-expressions\" target=\"_blank\" rel=\"noopener noreferrer\">详情参考官网</a>。对于Prometheus<strong>一般使用labe_values(metric,label)表示返回指定metric中的label值</strong></li>\n<li><code>Regex</code>：正则表达式，例如该列的值是以<code>[\"en-US\"]</code>，可以使用正则表达式<code>/\\[\\\"(.*)\\\"\\]/</code>提取到<code>en-US</code>;</li>\n<li><code>Sort</code>：排序，在下拉列表中定义选项的排序顺序；</li>\n<li><code>Refresh</code>：刷新，控制何时更新变量选项列表；</li>\n</ol>\n<p><strong>Selection Options</strong></p>\n<ol>\n<li><code>Multi-value</code>：多值，如果启用，该变量将支持同时选择多个选项；</li>\n<li><code>Include All option</code>：包含 All 选项，如果启用，支持勾选所有选项；对于一些正则表达式需要转换的需注意，所有的下拉选择以<code>|</code>进行合并;</li>\n<li><code>Custom all value</code>：（<code>Include All option</code>选项启用的情况下出现该选项），由于All选项会使得数据特别长，影响性能。例如当前变量是语种，比较多，比较关注的是中文和英文，可以在此填写<code>中文|英文</code>;</li>\n</ol>\n<p><strong>Value groups/tags (Experimental feature)</strong></p>\n<p><s>暂无需求</s></p>\n<p><strong>Preview of Values</strong></p>\n<p>预览下拉选择的值</p>\n<h4> Links（链接）</h4>\n<p><s>暂无需求</s></p>\n<h4> Versions（版本）</h4>\n<blockquote>\n<p>版本可以看到对仪表板历史操作的版本，可以很方便的回退到某个版本，或者比较两个版本的差别</p>\n</blockquote>\n<h4> Permissions （权限）</h4>\n<blockquote>\n<p>可以对某个用户或某个团队设置该仪表板的权限</p>\n</blockquote>\n<h4> JSON Model</h4>\n<blockquote>\n<p>JSON模型是定义仪表板的数据结构。包括设置，面板设置和布局，查询等</p>\n</blockquote>\n<h3> Dashboards（各个仪表板）</h3>\n<p>提供统一的视图管理仪表板、组织仪表板、播放仪表板、共享仪表板</p>\n<h4> Manage（管理）</h4>\n<figure><figcaption>dashboards-manage</figcaption></figure>\n<p>功能：</p>\n<ul>\n<li>创建仪表板</li>\n<li>创建文件夹</li>\n<li>将仪表板移动到文件夹中</li>\n<li>删除多个仪表板</li>\n<li>导航到文件夹页面（设置文件夹和仪表板的权限）</li>\n</ul>\n<p><strong>文件夹</strong></p>\n<blockquote>\n<p>文件夹是一种组织和分组仪表板的方法</p>\n</blockquote>\n<h4> Playlists（播放列表）</h4>\n<blockquote>\n<p>播放列表是一种特殊类型的仪表板，可通过仪表板列表进行旋转。播放列表可以是构建态势感知的好方法，非常适合大屏幕展示。</p>\n</blockquote>\n<figure><figcaption>playlists</figcaption></figure>\n<figure><figcaption>edit-playlist</figcaption></figure>\n<p>支持将仪表板加入到播放列表，且支持播放顺序和播放间隔；</p>\n<h4> Snapshots（快照）</h4>\n<blockquote>\n<p>快照可以提供一种即时方式共享交互式仪表板，我们只需复制URL即可访问仪表板；具体快照设置是在每个仪表板中设置，例如设置过期时间等；</p>\n</blockquote>\n<figure><figcaption>snapshots</figcaption></figure>\n<h2> Grafana管理（高级）</h2>\n<figure><figcaption>configuration</figcaption></figure>\n<h3> Configuration（配置）</h3>\n<h4> Data Source（数据源）</h4>\n<blockquote>\n<p>grafana为每个数据源提供一个特定的查询编辑器，每个数据源的查询语言和功能不同。</p>\n</blockquote>\n<p><strong>支持的数据源：</strong><code>Graphite</code>、<code>Elasticsearch</code>、 <code>OpenTSDB</code>、<code>Prometheus</code>、<code>InfluxDB</code>等</p>\n<figure><figcaption>data-source</figcaption></figure>\n<p>这里以Prometheus设置为例：</p>\n<figure><figcaption>datasource-prometheus</figcaption></figure>\n<p>配置项目说明：</p>\n<ol>\n<li><code>Name</code>：数据源名称，右边<code>default</code>用于是否设置为默认，如果开启，则在面板查询中首先会选择该数据源；</li>\n</ol>\n<p>HTTP相关：</p>\n<ol>\n<li><code>URL</code>：Prometheus的URL地址，Prometheus在9090端口提供web方式查询</li>\n<li><code>Access</code>：如何访问数据源，分为两种：<code>Server</code>和<code>Browser</code>，<code>Server</code>会经过grafana服务端访问数据源，<code>Browser</code>会直接访问数据源；</li>\n<li><code>Whitelisted Cookies</code>：Grafana按名称指定应转发到数据源的cookie。</li>\n</ol>\n<p>Auth相关：</p>\n<ol>\n<li><code>Basic Auth</code>：勾选后会让填写用户名和密码；</li>\n<li><code>TLS Client Auth</code>：勾选后让填写证书和密钥；</li>\n<li><code>Skip TLS Verify</code>：跳过TLS验证；</li>\n<li><code>Forward OAuth Identity</code>：将用户的上游OAuth标识转发给数据源（它们的访问令牌被传递）；</li>\n<li><code>With Credentials</code>:是否应使用跨站点请求发送cookie或auth标头等凭据；</li>\n<li><code>With CA Cert</code>：需要验证自签名TLS证书；</li>\n</ol>\n<p>其他配置：</p>\n<ol>\n<li><code>Scrape interval</code>：采集间隔，默认是Prometheus配置的全局采集间隔；</li>\n<li><code>Query timeout</code>：查询超时时间；</li>\n<li><code>HTTP Method</code>：Prometheus &gt;=v2.1.0才支持POST；</li>\n</ol>\n<h4> User （用户）</h4>\n<blockquote>\n<p>用户权限管理</p>\n</blockquote>\n<p>用户角色分为三种：<code>Admin Role</code>、<code>Editor Role</code>、<code>Viewer Role</code>，其中：</p>\n<p><code>Admin Role</code>：管理员角色可以做一切范围的组织，例如：</p>\n<ul>\n<li>添加和编辑数据源；</li>\n<li>添加和编辑组织用户和团队；</li>\n<li>配置App插件并色湖之组织设置；</li>\n</ul>\n<p><code>Editor Role</code>：编辑者角色</p>\n<ul>\n<li>可以创建和修改仪表板和警报规则；</li>\n<li><strong>无法</strong>创建或编辑数据源，也无法邀请新用户；</li>\n</ul>\n<p><code>Viewer Role</code>：查看者角色</p>\n<ul>\n<li>查看仪表板</li>\n<li><strong>无法</strong>创建或编辑仪表板或数据源</li>\n</ul>\n<h4> Teams（团队）</h4>\n<blockquote>\n<p>可以建立多个团队，例如开发团队、测试团队、运维团队，每个团队可以使用不同的UI主题等配置</p>\n</blockquote>\n<h4> Plugins（插件）</h4>\n<blockquote>\n<p>提供许多可视化插件，帮助用户展示指标数据，理解指标数据</p>\n</blockquote>\n<h4> Preferences（首选项）</h4>\n<blockquote>\n<p>设置组织名、UI主题、首页仪表板、时区等</p>\n</blockquote>\n<h4> API keys</h4>\n<blockquote>\n<p>可提供给其他应用程序的仅查看API访问。</p>\n</blockquote>\n<h3> Server Admin（服务管理）</h3>\n<figure><figcaption>server-admin</figcaption></figure>\n<h4> Users（用户）</h4>\n<blockquote>\n<p>是用于用户管理，支持新增用户，修改用户，删除用户；</p>\n</blockquote>\n<figure><figcaption>edit-user</figcaption></figure>\n<p>修改用户可以更改账户密码等等，最主要是修改用户角色权限，如：<code>Admin</code>、<code>Editor</code>、<code>Viewer</code>（参考2.1.2节）；同时所属组织，一个用户可以加入多个组织；</p>\n<h4> Orgs（组织）</h4>\n<blockquote>\n<p>用于组织的管理，支持新增组织、修改组织、删除组织</p>\n</blockquote>\n<figure><figcaption>orgs</figcaption></figure>\n<figure><figcaption>edit-orgs</figcaption></figure>\n<p>编辑组织可以修改组织名称、管理当前组织内用户角色权限等信息；</p>\n<p><strong>用户和组织是多对多的关系</strong></p>\n<h4> Settings（设置）</h4>\n<blockquote>\n<p>这里是一些系统设置，保存在grafana.ini或custom.ini中定义，或在环境变量中定义；</p>\n</blockquote>\n<figure><figcaption>settings</figcaption></figure>\n<p>维护人员需详细了解</p>\n<p><s>暂无需求</s></p>\n<h4> Stats（状态）</h4>\n<blockquote>\n<p>查看一些统计信息，例如总的用户数，活跃的用户数等</p>\n</blockquote>\n<figure><figcaption>stats</figcaption></figure>\n<p>维护人员需了解</p>\n",
      "date_published": "2023-08-14T00:00:00.000Z",
      "date_modified": "2023-08-14T07:24:56.000Z",
      "authors": [],
      "tags": [
        "中间件"
      ]
    },
    {
      "title": "PromQL语法",
      "url": "https://Hexiaopi.github.io/middleware/promql.html",
      "id": "https://Hexiaopi.github.io/middleware/promql.html",
      "summary": "PromQL是Prometheus的查询语言，类似SQL是MySQL的语言 1. 名词解释 指标是软件或硬件组件属性的度量。 为了使指标有价值，我们会跟踪其状态，通常记录一段时间内的数据点。这些数据点成为观察点（observation），观察点通常包括值、时间戳，有时也涵盖描述观察点的一系列属性。 观察点的集合称为时间序列（time series）。 我们通常以固定的时间间隔收集指标，该时间间隔称为颗粒度（granularity）或分辨率（resolution）",
      "content_html": "<blockquote>\n<p>PromQL是Prometheus的查询语言，类似SQL是MySQL的语言</p>\n</blockquote>\n<h2> 1. 名词解释</h2>\n<blockquote>\n<p><strong>指标</strong>是软件或硬件组件属性的度量。</p>\n<p>为了使指标有价值，我们会跟踪其状态，通常记录一段时间内的数据点。这些数据点成为<strong>观察点</strong>（observation），观察点通常包括值、时间戳，有时也涵盖描述观察点的一系列属性。</p>\n<p>观察点的集合称为<strong>时间序列</strong>（time series）。</p>\n<p>我们通常以固定的时间间隔收集指标，该时间间隔称为<strong>颗粒度</strong>（granularity）或<strong>分辨率</strong>（resolution）</p>\n</blockquote>\n<h3> 1.1 时序（time series）</h3>\n<blockquote>\n<p>时序（time series)是由指标（metric）以及一组key/value标签定义的。标签可以使时序数据更加丰富。</p>\n</blockquote>\n<p>格式：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>时序按照时间戳和值的顺序存放，称之为向量（vector)。</p>\n<h3> 1.2 向量（vector)</h3>\n<p>可以将采集的时序理解为一个以时间为x轴的数字矩阵：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其中每一个点成为一个样本（sample）。</p>\n<h3> 1.3 样本（sample)</h3>\n<blockquote>\n<p>按照某个时序以时间维度采集的数据称之为样本。样本有以下三部分：</p>\n<ul>\n<li>\n<p>指标（metric）</p>\n</li>\n<li>\n<p>时间戳：一个毫秒级的unix时间戳</p>\n</li>\n<li>\n<p>样本值（value）：一个float64值</p>\n</li>\n</ul>\n</blockquote>\n<p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>例如：node_exporter暴漏的metrics接口的指标如下所示：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code># HELP</code> 用于解释说明</p>\n<p><code># TYPE</code>指标类型，Prometheus支持的指标类型有以下四种:</p>\n<ul>\n<li><code>counter</code>（常用），特点：只增不减；通常记录某些事件发生的次数，可以了解该事件产生速率的变化。例如接口请求次数。</li>\n<li><code>gauge</code>（常用），特点：可增可减；通常记录事件状态，例如可用内存大小。</li>\n<li><code>histogram</code>，用于统计分析样本的分布情况；例如延迟在0-10ms、10-20ms的请求数。</li>\n<li><code>summary</code>，与<code>histogram</code>相似；<a href=\"https://prometheus.io/docs/practices/histograms/\" target=\"_blank\" rel=\"noopener noreferrer\">参考官网</a></li>\n</ul>\n<h2> 2. 查询表达式</h2>\n<blockquote>\n<p><strong>PromQL</strong>是一种数据查询语言，类似于MySQL，具有强大的功能。允许用户实时选择和汇总时间序列数据，表达式的结果可以显示为图形。</p>\n</blockquote>\n<h3> 2.1 表达式语言数据类型</h3>\n<p><strong>PromQL</strong>的表达式语句可以分为四种类型：</p>\n<ul>\n<li><code>Instant vector</code>——即时向量，一组包含每个时间序列的单个样本的时间序列，他们共享相同的时间戳。<strong>(当前时间的指标样本)</strong></li>\n<li><code>Range verctor</code>——范围向量，一组时间序列，包含每个事件序列随时间变化的一系列数据点。<strong>（一段时间的指标样本）</strong></li>\n<li><code>Scalar</code>——标量，一个简单的数字浮点值。</li>\n<li><code>String</code>——字符串，<strong>（目前不可用）</strong></li>\n</ul>\n<p><strong>即时向量和范围向量对比</strong></p>\n<p>即时向量指最新的单个维度的指标数据</p>\n<figure><figcaption>instant-vector-1</figcaption></figure>\n<p>范围向量包含一组不同时间戳的指标数据，和时间范围选择有关</p>\n<figure><figcaption>range-vector</figcaption></figure>\n<h3> 2.2 Time series Selectors（时间序列表达式）</h3>\n<h4> 2.2.1 Instant vector selectors（即时向量选择器）</h4>\n<blockquote>\n<p>即时向量返回给定时间戳（即时）的一组指标样本。</p>\n</blockquote>\n<p>例如：仅指定指标名称，<code>prometheus_http_requests_total</code></p>\n<figure><figcaption>instant-vector</figcaption></figure>\n<p>可以通过一组标签来进一步过滤这些时间序列，使用花括号<code>{}</code>。例如：<code>prometheus_http_requests_total{code=\"500\",job=\"prometheus\"}</code></p>\n<figure><figcaption>instant-vector-filter</figcaption></figure>\n<p>可以对标签值进行匹配，匹配运算符：</p>\n<ul>\n<li><code>=</code>：与提供的字符串完全相同的标签；</li>\n<li><code>！=</code>：不等于提供的字符串的标签；</li>\n<li><code>=~</code>：与正则表达式匹配提供的字符串标签；</li>\n<li><code>!~</code>：不与提供的正则表达式匹配的标签；</li>\n</ul>\n<p>例如：<code>prometheus_http_requests_total{code=~\"400|500\"}</code></p>\n<figure><figcaption>instant-vector-regex</figcaption></figure>\n<h4> 2.2.2 Range Vector Selectors (范围向量选择器)</h4>\n<blockquote>\n<p>范围向量返回一段时间的一组指标样本。</p>\n<p>范围持续时间附加在<code>[]</code>中，指定每个结果范围向量提取多长时间值。</p>\n</blockquote>\n<p>持续时间指定为数字，紧接着是以单位之一：</p>\n<ul>\n<li><code>s</code>-秒</li>\n<li><code>m</code>-分钟</li>\n<li><code>h</code>-小时</li>\n<li><code>d</code>-天</li>\n<li><code>w</code>-周</li>\n<li><code>y</code>-年</li>\n</ul>\n<p>例如：<code>prometheus_http_requests_total{code=\"200\"}[5m]</code>表示选择过去5分钟该指标的所有时间序列记录。</p>\n<h4> 2.2.3 Offset modifier（偏移修改器）</h4>\n<blockquote>\n<p>由于即时向量和范围向量使用当前时间为基准，如果想查询5分钟前的即时向量，或者昨天一天的范围向量，使用关键字<code>offset</code>可以进行时间偏移</p>\n</blockquote>\n<p>例如：<code>http_requests_total offset 5m</code>表示返回5分钟前的即时向量<code>http_requests_total</code>的值。</p>\n<p><code>offset</code>需要紧跟向量。例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 2.5 Operators（操作符）</h3>\n<h4> 2.5.1 二元运算符</h4>\n<h5> 算术运算符</h5>\n<p>PromQL支持以下算法运算符：</p>\n<ul>\n<li><code>+</code> 加法</li>\n<li><code>-</code> 减法</li>\n<li><code>*</code> 乘法</li>\n<li><code>/</code> 除法</li>\n<li><code>%</code> 求余</li>\n<li><code>^</code> 幂运算</li>\n</ul>\n<p>算术运算符定义在标量与标量、即时向量与标量、即时向量与即时向量之间。</p>\n<p><strong>在两个标量之间</strong>：结果是标量；</p>\n<p><strong>在即时向量和标量之间</strong>：运算符应用于向量中的每个数据样本的值；如果时间序列即时向量乘以2，则结果是另一个即时向量，且对应的值是原始向量的每个样本值乘以2。</p>\n<p><strong>在两个即时向量之间</strong>：运算符依次查找左侧向量中的每条数据到右侧向量中的匹配样本数据进行运算，。</p>\n<hr>\n<h5> 比较运算符</h5>\n<p>PromQL支持以下比较运算符：</p>\n<ul>\n<li><code>==</code></li>\n<li><code>!=</code></li>\n<li><code>&gt;</code></li>\n<li><code>&lt;</code></li>\n<li><code>&lt;=</code></li>\n<li><code>&gt;=</code></li>\n</ul>\n<p>比较运算符定义在标量与标量、即时向量与标量、即时向量与即时向量之间。</p>\n<p><strong>标量与标量之间</strong>：结果是标量，<code>bool</code>必须提供修饰符，即<code>0</code>（<code>false</code>）或<code>1</code>（<code>true</code>）；<s>待补充</s></p>\n<p><strong>在即时向量和标量之间</strong>：运算符应用于向量中的每个数据样本的值，为<code>true</code>的数据样本保留在结果向量中；</p>\n<p><strong>在两个即时向量之间</strong>：运算符相当于过滤器，表达式为<code>true</code>且在表达式的右侧找到匹配的数据样本都保留在结果向量中。</p>\n<hr>\n<h5> 逻辑运算符</h5>\n<p>PromQL支持以下逻辑运算符：</p>\n<ul>\n<li><code>and</code></li>\n<li><code>or</code></li>\n<li><code>unless</code></li>\n</ul>\n<p><code>vector1 and vector2</code>得到一个向量，该向量由与<code>vector2</code>完全匹配标签集的<code>vector1</code>数据样本组成。结果向量的指标名称和值为左侧向量。</p>\n<p><code>vector1 or vector2</code>得到一个向量，该向量包含<code>vector1</code>和<code>vector2</code>所有的原始数据（标签集+值）。</p>\n<p><code>vector1 unless vector2</code>得到一个向量，该向量包含的指标数据为 <code>vector1</code>中不与<code>vector2</code>匹配的标签集。（两个向量中的所有匹配元素都被删除）。</p>\n<hr>\n<h5> 运算符优先级</h5>\n<p>先级从高到低依次是：</p>\n<ol>\n<li><code>^</code></li>\n<li><code>*</code>、<code>/</code>、<code>%</code></li>\n<li><code>+</code>、<code>-</code></li>\n<li><code>==</code>、<code>!=</code>、<code>&lt;=</code>、<code>&lt;</code>、<code>&gt;=</code>、<code>&gt;</code></li>\n<li><code>and</code>、<code>unless</code></li>\n<li><code>or</code></li>\n</ol>\n<hr>\n<h5> 向量匹配模式</h5>\n<blockquote>\n<p>向量与向量之间进行运算操作时会基于默认的匹配规则：<strong>依次找到与左边向量元素匹配（标签完全一致）的右边向量元素进行运算，如果没找到匹配元素，则直接丢弃。</strong></p>\n</blockquote>\n<p>PromQL支持两种匹配模式：<code>一对一</code>，<code>多对一或一对多</code>。</p>\n<h6> 一对一向量匹配</h6>\n<blockquote>\n<p>一对一匹配，分别从两边表达式获取的即时向量，依次找到标签集完全相同的元素。格式为<code>vector1 &lt;operator&gt; vector2</code>，使用关键字<code>ignoring</code>忽略某些标签，关键字<code>on</code>使用提供的标签列表匹配。</p>\n</blockquote>\n<p>格式：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>例如：</p>\n<p>指标数据如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用以下表达式进行匹配：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>结果：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h6> 多对一和一对多向量匹配</h6>\n<blockquote>\n<p>这里的<code>一</code>和<code>多</code>指的是：<code>一</code>这边的向量每个元素和<code>多</code>这边向量的多个元素匹配。使用关键字<code>group_left</code>和<code>group_right</code>，来表明哪边的向量具有更高的基数（即充当<code>多</code>的角色）。</p>\n</blockquote>\n<p>格式：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>例如：左侧向量有两个标签（method、code），右侧向量有一个标签（method），因此左侧向量具有更高的基数，使用<code>group_left</code>，并忽略标签（code）。如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>结果：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><strong>Group修饰符（group_left、group_right)只能在比较和数学运算符中使用，逻辑运算符默认与右侧向量所有元素匹配。</strong></p>\n<h4> 2.5.2 布尔运算符</h4>\n<blockquote>\n<p>布尔运算符的默认行为是对时序数据进行过滤。</p>\n</blockquote>\n<p>例如，只需要知道当前模块的HTTP请求量是否&gt;=1000，如果大于等于1000则返回1（true）否则返回0（false）。</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>返回的指标样本的值要么是0要么是1，如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 2.5.3 聚合运算符</h4>\n<blockquote>\n<p>聚合运算符可以聚合单个即时向量的数据，从而生成较少标签的新向量</p>\n</blockquote>\n<p>Prometheus支持以下聚合运算符：</p>\n<ul>\n<li><code>sum</code>-总和</li>\n<li><code>min</code>-最小</li>\n<li><code>max</code>-最大</li>\n<li><code>avg</code>平均</li>\n<li><code>stddev</code>-标准差</li>\n<li><code>stdvar</code>-标准差异</li>\n<li><code>count</code>-向量中的样本条数</li>\n<li><code>count_values</code>-具有相同值的样本条数</li>\n<li><code>bottomk</code>-样本值最小的k个元素</li>\n<li><code>topk</code>样本值最大的k个元素</li>\n<li><code>quantile</code>-分布统计</li>\n</ul>\n<p>以上聚合运算符可以用于聚合所有标签维度，也可以通过关键字<code>without</code>或者<code>by</code>来保留不同的维度。</p>\n<p>格式：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>其中</p>\n<ul>\n<li><code>parameter</code>只在<code>count_values</code>、<code>quantile</code>、<code>topk</code>和<code>bottomk</code>；</li>\n<li><code>without</code>从结果向量中删除列出的标签；</li>\n<li><code>by</code>只保留列出的标签；</li>\n</ul>\n<h3> 2.6 Functions（功能函数）</h3>\n<h4> abs()</h4>\n<p><code>abs(v instant-vector)</code>返回输入向量且所有的样本值都转换为绝对值；</p>\n<h4> absent()</h4>\n<p><code>absent(v instant-vector)</code>如果传递给它的向量有任何样本，则返回空向量；如果传递给它的向量没有样本，则返回值为1的向量；</p>\n<h4> ceil()</h4>\n<p><code>ceil(v instant-vector)</code>将所有样本的样本值舍入最接近的整数；</p>\n<h4> changes()</h4>\n<p><code>changes(v range-vector)</code>计算范围向量时间范围内样本值得更改次数作，结果是即时向量；</p>\n<h4> clamp_max()</h4>\n<p><code>clamp_max(v instant-vector, max scalar)</code>限制样本最大值为max；</p>\n<h4> clamp_min()</h4>\n<p><code>clamp_min(v instant-vector, min scalar)</code>限制样本最小值为min；</p>\n<h4> day_of_month()</h4>\n<p><code>day_of_month(v=vector(time()) instant-vector)</code>返回UTC中每个给定时间（月）中的某天，返回值为1到31；</p>\n<h4> day_of_week()</h4>\n<p><code>day_of_week(v=vector(time()) instant-vector)</code>返回UTC中每个给定时间的星期几，返回值为0到6；</p>\n<h4> day_in_month()</h4>\n<p><code>days_in_month(v=vector(time()) instant-vector)</code>返回UTC中每个给定时间的月中天数。返回值为28到31。</p>\n<h4> delta()</h4>\n<p><code>delta(v range-vector)</code>计算范围向量中每个时间系列元素的第一个和最后一个值之间的差异;</p>\n<p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p><strong>delta应该用于gauges类型指标</strong></p>\n<h4> deriv()</h4>\n<p><code>deriv(v range-vector)</code> 使用<a href=\"https://en.wikipedia.org/wiki/Simple_linear_regression\" target=\"_blank\" rel=\"noopener noreferrer\">简单线性回归</a>计算范围向量中时间序列的每秒导数;</p>\n<p><strong>deriv应该用于gauges类型指标</strong></p>\n<h4> exp()</h4>\n<p><code>exp(v instant-vector)</code>计算所有样本的指数函数（样本值为指数）；</p>\n<h4> floor()</h4>\n<p><code>floor(v instant-vector)</code>将所有样本值舍入为最接近的整数；</p>\n<h4> histogram_quantile()</h4>\n<p><code>histogram_quantile(φ float, b instant-vector)</code>从直方图的桶<code>b</code>中计算φ-分位数（0≤φ≤1）；</p>\n<h4> holt_winters()</h4>\n<p><code>holt_winters(v range-vector, sf scalar, tf scalar)</code>根据范围输入生成时间序列的平滑值<code>v</code>。平滑因子越低<code>sf</code>，对旧数据的重视程度越高。趋势因子越高，数据的趋势<code>tf</code>就越多。二者<code>sf</code>并<code>tf</code>必须在0和1之间。</p>\n<p><strong>holt_winters应该用于gauges类型指标</strong></p>\n<h4> hour()</h4>\n<p><code>hour(v=vector(time()) instant-vector)</code>返回UTC中每个给定时间的一天中的小时。返回值为0到23；</p>\n<h4> idelta()</h4>\n<p><code>idelta(v range-vector)</code>计算范围向量中最后两个样本之间的差异;</p>\n<p><strong>idelta应该用于gauges类型指标</strong></p>\n<h4> increase()</h4>\n<p><code>increase(v range-vector)</code>计算范围向量中时间序列的增加；</p>\n<p><strong>incrase应用用于counter类型指标</strong></p>\n<h4> irate()</h4>\n<p><code>irate(v range-vector)</code>计算范围向量中时间序列的每秒即时增长率。（基于最后两个数据点）</p>\n<p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h4> label_join()</h4>\n<p><code>label_join</code>生产一个新的标签，且新的标签值是列出的标签值通过分隔符连接起来。</p>\n<p>格式：</p>\n<p><code>label_join(v instant-vector, dst_label string, separator string, src_label_1 string, src_label_2 string, ...)</code></p>\n<p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h4> label_replace()</h4>\n<p><code>label_replace</code>按照正则表达式匹配源标签，替换目标标签的值。</p>\n<p>格式：</p>\n<p><code>label_replace(v instant-vector, dst_label string, replacement string, src_label string, regex string)</code></p>\n<p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h4> ln()</h4>\n<p><code>ln(v instant-vector)</code>计算所有指标对数。</p>\n<h4> log2()</h4>\n<p><code>log2(v instant-vector)</code>计算所有指标以2为底的对数。</p>\n<h4> log10()</h4>\n<p><code>log10(v instant-vector)</code>计算所有指标以10为底的对数。</p>\n<h4> minute()</h4>\n<p><code>minute(v=vector(time()) instant-vector)</code>以UTC为单位返回每个给定时间的分钟。返回值为0到59。</p>\n<h4> month()</h4>\n<p><code>month(v=vector(time()) instant-vector)</code>返回UTC中每个给定时间的一年中的月份。返回值为1到12，其中1表示1月。</p>\n<h4> predict_linear()</h4>\n<p><code>predict_linear(v range-vector, t scalar)</code>使用简单的线性回归t，基于范围向量预测从现在开始的时间序列的值。</p>\n<p><strong>product_linear()应运用于gauges类型指标</strong></p>\n<h4> rate()</h4>\n<p><code>rate(v range-vector)</code>计算范围向量中时间序列的每秒平均增长率。</p>\n<p>例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p><strong>rate应运用于counter类型指标</strong></p>\n<h4> resets()</h4>\n<p><code>resets(v range-vector)</code>返回时间范围内的计数器重置次数。</p>\n<p><strong>resets应运用于counter类型指标</strong></p>\n<h4> round()</h4>\n<p><code>round(v instant-vector, to_nearest=1 scalar)</code>将所有指标的样本值舍入最接近的整数。可选参数<code>to_nearest</code>允许指定舍入样本值得最近倍数。这个倍数也可能是一个分数。</p>\n<h4> scalar()</h4>\n<p><code>scalar(v instant-vector)</code>将该单个指标得样本值作为标量返回。</p>\n<h4> sort()</h4>\n<p><code>sort(v instant-vector)</code>返回按样本值升序排列得向量。</p>\n<h4> sort_desc()</h4>\n<p>与<code>sort()</code>相似，但按降序排序。</p>\n<h4> sqrt()</h4>\n<p><code>sqrt(v instant-vector)</code>计算所有样本的平方根。</p>\n<h4> time()</h4>\n<p><code>time()</code>返回自1970年1月1日UTC以来的秒数。请注意，这实际上并不返回当前时间，而是返回计算表达式的时间。<s>待补充</s></p>\n<h4> timestamp()</h4>\n<p><code>timestamp(v instant-vector)</code>返回向量得每个样本得时间戳，自1970年1月1日UTC以来得秒数。</p>\n<h4> vector()</h4>\n<p><code>vector(s scalar)</code>将标量返回为没有标签的向量。</p>\n<h4> year()</h4>\n<p><code>year(v=vector(time()) instant-vector)</code> 以UTC格式返回每个给定时间的年份。</p>\n<h4> &lt;-aggregation-&gt;_over_time()</h4>\n<p>以下函数聚合给定范围向量得每个指标随时间的变化并返回聚合结果的即时向量：</p>\n<ul>\n<li><code>avg_over_time(range-vector)</code>：指定时间间隔内所有点的平均值。</li>\n<li><code>min_over_time(range-vector)</code>：指定时间间隔内所有点的最小值。</li>\n<li><code>max_over_time(range-vector)</code>：指定时间间隔内所有点的最大值。</li>\n<li><code>sum_over_time(range-vector)</code>：指定时间间隔内所有值的总和。</li>\n<li><code>count_over_time(range-vector)</code>：指定时间间隔内所有值的计数。</li>\n<li><code>quantile_over_time(scalar, range-vector)</code>：指定间隔中的值的φ-分位数（0≤φ≤1）。</li>\n<li><code>stddev_over_time(range-vector)</code>：指定时间间隔内值的总体标准偏差。</li>\n<li><code>stdvar_over_time(range-vector)</code>：指定时间间隔内值的总体标准差异。</li>\n</ul>\n",
      "date_published": "2023-08-14T00:00:00.000Z",
      "date_modified": "2023-08-14T07:24:56.000Z",
      "authors": [],
      "tags": [
        "中间件"
      ]
    },
    {
      "title": "并发模式",
      "url": "https://Hexiaopi.github.io/design-pattern/concurrency/",
      "id": "https://Hexiaopi.github.io/design-pattern/concurrency/",
      "summary": "Go语言推荐CSP模型进行并发处理，而非通过共享内存。这里总结一些并发模式或者称作范式，去管理控制协程。",
      "content_html": "<p>Go语言推荐CSP模型进行并发处理，而非通过共享内存。这里总结一些并发模式或者称作范式，去管理控制协程。</p>\n<!-- more -->\n<h2> Go并发模式</h2>\n<p>我们都知道Go语言开启协程只需要<code>go func(){ }</code>，有时候需要与goroutine之间建立联系，方便进一步控制与处理。<br>\n因此总结一些范式，优雅的管理goroutine。</p>\n<h3> 退出模式</h3>\n<p>使用关键字<code>go</code>很容易启动goroutine，这样创建的协程和当前协程已经分离，我们并不知道</p>\n<h4> 等待指定协程退出</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>spawn函数创建的新goroutine与调用spawn函数的goroutine（main goroutine）之间通过channel建立了联系。</p>\n</div>\n<h4> 等待多个协程退出</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>通过sync.WaitGroup，对于每一个协程处理前进行wg.Add(1)，退出时执行wg.Done()，并等待所有的协程退出wg.Wait()。保障所有的协程都会结束。</p>\n</div>\n<h3> 管道模式-pipeline</h3>\n<p>管道是Unix/Linux上一种典型的并发程序设计模式，例如执行：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>就可以利用管道机制过滤出当前路径下以\".go\"结尾的文件列表。</p>\n<p><code>ls -l</code>的输出作为<code>grep \"\\.go\"</code>的输入很容易将两个功能模块串在一起。</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>Go通常使用channel原语构建管道模式</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code>echo</code>的结果作为<code>odd</code>的入参，<code>odd</code>的结果作为<code>square</code>的入参。这样我们很容易扩展其他功能函数，例如：<code>sum</code></p>\n<p>参考资料：</p>\n<p><a href=\"https://go.dev/blog/pipelines\" target=\"_blank\" rel=\"noopener noreferrer\">Go Concurrency Patterns: Pipelines and cancellation</a></p>\n<p><a href=\"https://coolshell.cn/articles/21228.html\" target=\"_blank\" rel=\"noopener noreferrer\">GO编程模式：PIPELINE</a></p>\n<h3> 扇出，扇入模式</h3>\n<p>扇出模式，即多个相同goroutine从同一个channel读取数据并处理</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>扇入模式，从多个channel读取数据并处理，将结果放入一个channel</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其中：</p>\n<ul>\n<li>c1、c2是两个相同的goroutine从同一个channel取数据进行平方计算，这就是扇出；</li>\n<li>merge从c1、c2两个channel里取数据合并到一个channel里，这就是扇入；</li>\n</ul>\n<h2> 超时与取消模式</h2>\n",
      "date_published": "2023-02-26T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "小心break🤦‍♂️",
      "url": "https://Hexiaopi.github.io/go-language/advance/break.html",
      "id": "https://Hexiaopi.github.io/go-language/advance/break.html",
      "summary": "这里展示break的一个例子 package main import ( \t\"fmt\" \t\"time\" ) func main() { \texit := make(chan interface{}) \tgo func() { \t\tfor { \t\t\tselect { \t\t\tcase &lt;-time.After(time.Second): \t\t\t\tfmt.Println(\"tick\") \t\t\tcase &lt;-exit: \t\t\t\tfmt.Println(\"exiting...\") \t\t\t\tbreak \t\t\t} \t\t} \t\tfmt.Println(\"exit!\") \t}() \ttime.Sleep(3 * time.Second) \texit &lt;- struct{}{} \t// wait child goroutine exit \ttime.Sleep(3 * time.Second) } &nbsp;",
      "content_html": "<p>这里展示break的一个例子</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<div class=\"hint-container danger\">\n<p class=\"hint-container-title\">警告</p>\n<p>按道理当收到exit信号时，协程应该退出，但此时协程仍旧在打印tick</p>\n<p>其实break语句只是跳出最内部的for、swich或select的执行。例子中只是跳出了select语句，并未跳出for循环</p>\n</div>\n<p>那么我们该怎么跳到最外层呢？</p>\n<p>1、通过break [label]</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>代码执行到<code>break loop</code>时，程序将结束loop所指代的for循环的执行</p>\n</div>\n<p>2、通过goto [label]</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>代码执行到<code>goto loop</code>时，程序将跳转到loop所指的位置继续执行</p>\n</div>\n",
      "date_published": "2023-02-11T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "for-range避坑指南",
      "url": "https://Hexiaopi.github.io/go-language/advance/for-range.html",
      "id": "https://Hexiaopi.github.io/go-language/advance/for-range.html",
      "summary": "警告 for range同常使用在遍历：数组、指向数组的指针、切片、字符串、map和channel等表达式 其中有不少坑需要小心！！！",
      "content_html": "<div class=\"hint-container danger\">\n<p class=\"hint-container-title\">警告</p>\n<p><code>for range</code>同常使用在遍历：数组、指向数组的指针、切片、字符串、map和channel等表达式</p>\n<p>其中有不少坑需要小心！！！</p>\n</div>\n<!-- more -->\n<h2> for range</h2>\n<p>for range使用短变量声明方式(:=)进行遍历时声明了变量<br>\n例如</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 小心短变量声明</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>遍历1和遍历2仅在传递go func()参数有差别，结果却完全不一样</p>\n<details class=\"hint-container details\"><summary>查看运行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其原因在于这些迭代变量在每次循环中都会被重用，而不是重新声明</p>\n<ul>\n<li>遍历1中，遍历结束后，开启的5个协程打印共用的变量<code>i</code>和<code>v</code>,此时<code>i=4</code>,<code>v=5</code>;</li>\n<li>遍历2中，由于在各个协程中，重新声明了<code>i</code>和<code>v</code>变量，及时的将值传入各个协程，因此打印的是期望的结果，但因为各个协程调度时间不同，因此结果是乱序的。</li>\n</ul>\n</details>\n<h2> 小心遍历过程中的修改</h2>\n<p>for range在遍历表达式时如果对其修改不同的类型影响是不一样的</p>\n<h3> 数组遍历</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>在i=0时，我们修改了a[1]=12、a[2]=13，但v还是原来的值，这是因为遍历时使用的是数组a的副本，也就没有真实的反应到数组a本身，因此r拿到的数据时a副本的数据，数组a本身并未发生变化。</p>\n</details>\n<h3> 数组指针遍历</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>此次遍历的是*[5]int作为range的表达式，虽然也是副本，但副本所指向的内存空间是同样的。因此r的值可以改变</p>\n</details>\n<h3> 切片遍历</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>有切片的底层结构，我们知道切片由（<code>array</code>，<code>len</code>，<code>cap</code>）三元组组成，其中<code>array</code>指向底层数组。在range遍历时，它实际上复制的是一个切片，且切片的<code>array</code>指向的是同一个底层数组，因此会修改相同的底层数据。</p>\n</details>\n<p>👀<strong>但如果切片发生了扩容，导致长度发生了改变，for range遍历的仍是原来的长度</strong></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>切片a在遍历时附加了两个元素，len由5加到7，但由于for range使用的是切片a的副本，仍是长度5。</p>\n</details>\n<h3> 字符串遍历</h3>\n<p><code>string</code>类型是不可变的，每次循环的单位是一个<code>rune</code>,而不是<code>byte</code>，虽然底层结构是<code>byte</code>。如果遍历过程中存在非法UTF8字节序列，那么将返回<code>0xfffd</code>这个特殊值，且下次遍历从下一个<code>byte</code>开始，而不是<code>rune</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看运行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>在遍历第4个字节时，发现时非法UTF8字符，则返回的是特殊值，且下标i从4开始。</p>\n</details>\n<h3> 字典遍历</h3>\n<p>字典遍历过程中，如果对其新增和删除，那么会有怎样的结果呢？</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看运行结果</summary>\n<blockquote>\n<p>其输出结果是未知的</p>\n<ul>\n<li>3、3、4</li>\n<li>3、2、4</li>\n<li>3、3、3</li>\n<li>3、2、3</li>\n</ul>\n<p>这是因为map的遍历是无序的</p>\n</blockquote>\n</details>\n",
      "date_published": "2023-02-09T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "goroutine和调度原理",
      "url": "https://Hexiaopi.github.io/go-language/advance/goroutine.html",
      "id": "https://Hexiaopi.github.io/go-language/advance/goroutine.html",
      "summary": "Go语言原生支持并发能力，而goroutine是Go语言原生支持并发的具体实现，本篇将为你揭开goroutine的面纱。 goroutine",
      "content_html": "<p>Go语言原生支持并发能力，而goroutine是Go语言原生支持并发的具体实现，本篇将为你揭开goroutine的面纱。</p>\n<figure><img src=\"http://cdn.cjhe.top/blog/goroutine.png\" alt=\"goroutine\" tabindex=\"0\" loading=\"lazy\"><figcaption>goroutine</figcaption></figure>\n<!-- more -->\n<h2> goroutine</h2>\n<p>goroutine是由Go运行时管理的用户层轻量级线程，相比较操作系统线程，goroutine的资源占用和使用代价都要小的多，一个goroutine初始只需要2KB的内存，而线程需要MB级别的空间，这样在有限的内存空间里，可以创建的goroutine的数量相比较线程数量多的多。其次由于线程切换需要拷贝大量的上下文，这就导致线程切换耗时较高。</p>\n<h2> GPM模型</h2>\n<figure><figcaption>goroutine</figcaption></figure>\n<p>GPM模型中：</p>\n<ul>\n<li>G代表<code>goroutine</code>，存储了<code>goroutine</code>的执行栈信息、<code>goroutine</code>状态及<code>goroutine</code>的任务函数等</li>\n<li>P代表<code>processor</code>，逻辑处理器，所有的P都在程序启动时创建，P的数量决定了系统内最大可并行的G的数量，最多有<code>GOMAXPROCS</code>(可配置)个</li>\n<li>M代表<code>thread</code>即用户态线程，M在绑定有效的P后，进入到一个调度循环：从各种队列、P的本地队列获取G，切换到G的执行栈上并执行G的函数，调用<code>goexit</code>做清理工作并回到M，如此反复。</li>\n</ul>\n<p>此外还有：</p>\n<ul>\n<li>全局队列(Global Queue)：存放等待运行的G</li>\n<li>P的本地队列(Local Queue)：存放的也是等待运行的G，数量不超过256个。\n<ul>\n<li>当G新建goroutine G'时，G'优先加入到P的本地队列(局部性，G和G'相关)</li>\n<li>如果本地队列满了，则会把本地队列中的一半G移动到全局队列</li>\n</ul>\n</li>\n</ul>\n<h2> 调度策略</h2>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>其思想：复用线程M，避免频繁的创建、销毁</p>\n</div>\n<h3> work stealing机制</h3>\n<p>当本地队列无可运行的G时，会尝试从其他P队列中偷取G，而不是销毁M</p>\n<h3> hand off机制</h3>\n<p>当M因为G进行系统调用阻塞时，M会释放绑定的P，此时的M和G都进入阻塞状态</p>\n<ul>\n<li>如果此时有空闲的M，P会与其绑定并执行剩余的G，</li>\n<li>如果没有空闲的M，则会创建新的M</li>\n</ul>\n<p>当系统调用返回后，阻塞在该系统调用的G会尝试获取一个可用的P</p>\n<ul>\n<li>如果有可用的P，之前运行该G的M将绑定P继续运行G</li>\n<li>如果没有可用的P，那么G于M之间的关联将解除，同时G会标记为runable，放入全局队列等待调度</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li>网络I/O不会阻塞M，仅阻塞G</li>\n<li>文件I/O会阻塞M，这就是为什么大量文件I/O操作会导致大量线程被创建的原因。</li>\n</ul>\n</div>\n<h3> 抢占调度</h3>\n<p>与操作系统按<strong>时间片</strong>调度线程不同，Go中没有<strong>时间片</strong>的概念。如果某个G没有进行系统调用，没有进行I/O操作、没有阻塞在一个channel操作上，那么<strong>M是如何让G停下来并调度下一个可运行的G呢</strong>？</p>\n<ul>\n<li>Go1.2版本在每个函数或方法的入口增加一段额外的代码，让运行时有机会检查是否需要执行抢占调度；（对没有函数调用的G无效）</li>\n<li>Go程序运行时会启动一个名为<code>sysmon</code>的M（称为监控线程），该M无须绑定P即可运行（以g0这个G的形式），该M对于长时间运行（超过10ms）的G发出抢占式调度。</li>\n</ul>\n<h2> 参考文献</h2>\n<ul>\n<li><a href=\"https://mp.weixin.qq.com/s/rfjysi-LB-uFiGiZjh-XNw\" target=\"_blank\" rel=\"noopener noreferrer\">文章-Golang调度器GMP原理与调度全分析</a></li>\n<li><a href=\"https://book.douban.com/subject/35720729/\" target=\"_blank\" rel=\"noopener noreferrer\">书籍-Go语言精进之路</a></li>\n</ul>\n",
      "image": "http://cdn.cjhe.top/blog/goroutine.png",
      "date_published": "2023-02-13T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "interface底层原理",
      "url": "https://Hexiaopi.github.io/go-language/advance/interface.html",
      "id": "https://Hexiaopi.github.io/go-language/advance/interface.html",
      "summary": "interface",
      "content_html": "<figure><img src=\"http://cdn.cjhe.top/blog/interface.png\" alt=\"interface\" tabindex=\"0\" loading=\"lazy\"><figcaption>interface</figcaption></figure>\n<!-- more -->\n<h2> 接口不为nil的误区</h2>\n<p>我们看一个demo</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看运行结果</summary>\n<p><code>error: &lt;nil&gt;</code></p>\n</details>\n<p>这里大家很疑惑：明明<code>returnsError</code>函数返回的p值为nil，为何却满足了第30行的条件分支？我们先来看看接口类型的底层结构再来回答这个问题。</p>\n<h2> 接口类型底层结构</h2>\n<p>参见<code>$GOROOT/src/runtime/runtime2.go</code></p>\n<figure><figcaption>interface</figcaption></figure>\n<p>接口类型变量有两种内部表示：</p>\n<ul>\n<li><code>eface</code>：用于表示没有方法的空接口(<code>empty interface</code>)类型变量，即<code>interface{}</code>类型的变量</li>\n<li><code>iface</code>：用于表示其拥有方法的接口(<code>interface</code>)类型变量</li>\n</ul>\n<p><code>data</code>都指向当前赋值给接口类型变量的动态类型变量的值，但<code>iface</code>相比较<code>eface</code>多了<code>itab</code>这个类型，其中:</p>\n<ul>\n<li><code>inter</code>存储该接口类型自身的信息</li>\n<li><code>_type</code>存储该接口类型变量</li>\n<li><code>fun</code>存储动态类型已实现的接口方法的调用地址数组</li>\n</ul>\n<p>Go运行时会为程序内的全部类型建立只读的共享<code>_type</code>信息表，因此如果我们要判断接口类型变量是否相同，只需：</p>\n<ul>\n<li>判断<code>_type/tab</code>是否相同</li>\n<li><code>data</code>指针所指向的内存空间所存储的数据值是否相同</li>\n</ul>\n<p>这里需要区分不同的类型之间的等值比较，参见下文</p>\n<h3> nil接口变量</h3>\n<p>未初始化的接口类型变量默认零值为nil</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>值为nil的接口类型变量内部表示均为<code>(0x0,0x0)</code>，即类型信息和数据信息均为空，因此和nil相等</p>\n<h3> 空接口类型变量</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>对于空接口类型变量，只有在<code>_type</code>和<code>data</code>所指数据内容一致（注意：不是数据指针的值一致）的情况下，两个空接口类型变量之间才能画等号。</p>\n<h3> 非空接口类型</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>针对<code>err1 = (*T)(nil)</code>这种赋值，非空接口类型变量的类型信息并不为空，数据指针为空，因此与<code>nil(0x0,0x0)</code>不能画等号</p>\n<h3> 空接口类型和非空接口类型的等值比较</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结构</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></details>\n<p>空接口类型变量和非空接口类型变量内部表示的结构不同，但Go进行等值比较时，类型比较使用的是<code>eface</code>的<code>_type</code>和<code>iface</code>的<code>tab._type</code></p>\n",
      "image": "http://cdn.cjhe.top/blog/interface.png",
      "date_published": "2023-02-12T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "深入了解Go锁原理",
      "url": "https://Hexiaopi.github.io/go-language/advance/mutex.html",
      "id": "https://Hexiaopi.github.io/go-language/advance/mutex.html",
      "summary": "Go语言sync包提供了两种锁： 互斥锁 Mutex: 加锁时，其他加锁协程均阻塞 读写锁 RWMutex: 加读锁时，加写锁协程阻塞，加读锁协程不阻塞 加写锁时，其他加读写协程均阻塞",
      "content_html": "<p>Go语言sync包提供了两种锁：</p>\n<ul>\n<li>互斥锁 Mutex:\n<ul>\n<li>加锁时，其他加锁协程均阻塞</li>\n</ul>\n</li>\n<li>读写锁 RWMutex:\n<ul>\n<li>加读锁时，加写锁协程阻塞，加读锁协程不阻塞</li>\n<li>加写锁时，其他加读写协程均阻塞</li>\n</ul>\n</li>\n</ul>\n<!-- more -->\n<h2> 互斥锁 Mutex</h2>\n<h3> Mutex数据结构</h3>\n<p>参见<code>$GOROOT/src/sync/mutex.go</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其中：</p>\n<ul>\n<li>state: 表示互斥锁的状态，比如是否被锁定等；</li>\n<li>sema: 表示信号量，协程阻塞等待该信号量，解锁的协程释放信号量从而唤醒等待信号量的协程；</li>\n</ul>\n<p>Mutex.state虽然是<code>int32</code>数据类型，内部实现时把该变量分成四份，用于记录Mutex的四种状态</p>\n<figure><figcaption>mutex</figcaption></figure>\n<ul>\n<li>Locked: 表示该Mutex是否已被锁定，0表示没有锁定，1表示已锁定</li>\n<li>Woken: 表示是否协程已被唤醒，0表示没有协程唤醒，1表示已有协程唤醒</li>\n<li>Starving: 表示该Mutex是否处于饥饿状态，0表示没有饥饿，1表示饥饿状态（说明已有协程阻塞时间超过1ms）</li>\n<li>Waiter: 表示阻塞等待协程的个数，协程解锁时根据此值来判断是否需要释放信号量</li>\n</ul>\n<h3> Mutex的方法</h3>\n<p>Mutex对外提供两个方法：</p>\n<ul>\n<li>Lock(): 加锁方法</li>\n<li>Unlock(): 解锁方法</li>\n</ul>\n<h4> 单个协程的加锁释放过程</h4>\n<p>Mutex内部<code>state</code>表示如下：</p>\n<figure><figcaption>mutex-simple</figcaption></figure>\n<h4> 两个协程的加锁释放过程</h4>\n<p>Mutex内部<code>state</code>表示如下：</p>\n<figure><figcaption>mutex-comple</figcaption></figure>\n<p>上面介绍Mutex加锁和解锁只使用内部<code>state</code>标记：<code>Waiter</code>和<code>Locked</code>两个，另外两个标记就不得不提自旋过程了。</p>\n<h3> 自旋过程</h3>\n<blockquote>\n<p>自旋过程是：加锁时，如果当前<code>Locked</code>为1，则说明当前该锁由其他协程持有，尝试加锁的协程并不是马上转入阻塞，而是会持续地探测<code>Locked</code>是否变为0，这个过程就是自旋过程。</p>\n</blockquote>\n<details class=\"hint-container details\"><summary>自旋的条件</summary>\n<ul>\n<li>自旋次数要足够少，通常为4；</li>\n<li>CPU核数要大于1，否则自旋没有意义，因为此时不可能有其他协程释放锁；</li>\n<li>协程调度GMP中的P的数量要大于1；</li>\n<li>协程调度运行队列必须为空，否则会延迟协程调度；</li>\n</ul>\n</details>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>自旋的好处：当加锁失败时不必立即转入阻塞，有一定机会获得锁，避免协程的切换。</p>\n</div>\n<p>自旋的时间很短，如果自旋过程中发现锁已被释放，那么协程可以立即获取锁，此时即便有其他协程被唤醒也无法获取锁，只能再次阻塞。</p>\n<p>如果自旋过程中获得锁，那么之前被阻塞的协程将无法获得锁，之前阻塞的协程一直获取不到锁（超过1ms）将进入<strong>饥饿</strong>状态</p>\n<p>如果此时有两个协程，一个在加锁，另一个在解锁，在加锁的过程中可能处于自旋，此时会把<code>Woken</code>标记为1，用于告知解锁协程，不必释放信号量，它很快会拿到锁。</p>\n<h3> Mutex注意事项</h3>\n<div class=\"hint-container danger\">\n<p class=\"hint-container-title\">警告</p>\n<p>Mutex等sync中定义的结构类型首次使用后不应对其进行复制操作</p>\n</div>\n<p>我们看一个示例：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><details class=\"hint-container details\"><summary>查看执行结果</summary>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们看到g3在加锁操作之后阻塞，而g2按照预期正常运行</p>\n<p>g2和g3的区别在于：</p>\n<ul>\n<li>g2是在互斥锁首次使用之前创建</li>\n<li>g3是在互斥锁执行完加锁操作之后创建，并且在创建g3的时候复制了foo实例</li>\n</ul>\n</details>\n<p>sync包中类型的实例在被复制得到的副本后将脱离原实例的控制范围，因此推荐传指针的方式</p>\n<h2> 读写锁 RWMutex</h2>\n<h3> RWMutex数据结构</h3>\n<p>参见<code>$GOROOT/src/sync/mutex.go</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其中：</p>\n<ul>\n<li>w: 用于控制多个写锁，获得写锁首先要获取该锁</li>\n<li>writerSem: 写阻塞的协程等待的信号量，最后一个读协程释放锁时会释放信号量</li>\n<li>readerSem: 读阻塞的协程等待的信号量，持有写锁的协程释放锁后会释放信号量</li>\n<li>readerCount: 记录读协程的个数</li>\n<li>readerWait: 记录写阻塞时的读协程个数</li>\n</ul>\n<h3> RWMutex的方法</h3>\n<ul>\n<li>RLock(): 加读锁\n<ul>\n<li>增加读操作计数，即readerCount++</li>\n<li>如果已经有持有写锁协程，则阻塞自己</li>\n</ul>\n</li>\n<li>RUnlock(): 释放读锁\n<ul>\n<li>减少读操作计数，即readerCount--</li>\n<li>如果有阻塞的写锁协程，则唤醒它</li>\n</ul>\n</li>\n<li>Lock(): 加写锁\n<ul>\n<li>获取互斥锁</li>\n<li>如果持有读锁协程，则阻塞自己，等待所有的读操作结束</li>\n</ul>\n</li>\n<li>Unlock(): 释放写锁\n<ul>\n<li>释放互斥锁</li>\n<li>如果其他阻塞的读锁协程，则唤醒它</li>\n</ul>\n</li>\n</ul>\n<figure><figcaption>rwmutex</figcaption></figure>\n<h3> RWMutex的细节分析</h3>\n<h4> 写操作是如何阻止写操作的？</h4>\n<p>读写锁RWMutex包含一个互斥锁w，获取写锁必须先获取该互斥锁，如果互斥锁已被其他协程持有，则只能阻塞等待。</p>\n<h4> 写操作是如何阻止读操作的？</h4>\n<p>读写锁RWMutex包含当前读协程数量readerCount，每次获取读锁则加1，每次释放读锁则减1，因此取值为[0,N],N最大为2e30。<br>\n当获取写锁时，会将readerCount减去2e30，变成了负值。获取读锁协程检测到readerCount为负值，便知道正在加写锁，只好阻塞自己。<br>\n真实的readerCount不会丢失，只需要加2e30即可。</p>\n<h4> 读操作是如何阻止写操作的？</h4>\n<p>读锁会先将RWMutex.readerCount加1，写锁协程检测到readerCount不为0，则会阻塞自己。</p>\n<h4> 写锁为什么不会被<strong>饿死</strong>？</h4>\n<p>获取写锁期间，可能还有其他协程获取读锁，如果写锁一直等待所有的读操作结束，则很可能被<strong>饿死</strong>，RWMutex通过readerWait解决这个问题，当获取写锁时，会把readerCount复制到readerWait，用于标记排在写操作前面的读操作个数，读操作结束会递减readerCount的值，同时也会递减readerWait的值，当readerWait值为0时唤醒写操作。写操作结束后才会唤醒其他的读操作。</p>\n<h2> 参考资料</h2>\n<p><a href=\"https://book.douban.com/subject/35144587/\" target=\"_blank\" rel=\"noopener noreferrer\">Go专家编程</a></p>\n",
      "date_published": "2023-03-11T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "",
      "url": "https://Hexiaopi.github.io/CHANGELOG.html",
      "id": "https://Hexiaopi.github.io/CHANGELOG.html",
      "summary": "v0.7.1 (2023-08-13) Bug Fixes design-pattern: 修改设计原则 go-language: 修改Go语言基础",
      "content_html": "<p><a name=\"v0.7.1\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.7.0...v0.7.1\" target=\"_blank\" rel=\"noopener noreferrer\">v0.7.1</a> (2023-08-13)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>design-pattern:</strong> 修改设计原则</li>\n<li><strong>go-language:</strong> 修改Go语言基础</li>\n</ul>\n<h3> Code Refactoring</h3>\n<ul>\n<li>调整函数模式和并发模式</li>\n</ul>\n<p><a name=\"v0.7.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.6.0...v0.7.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.7.0</a> (2023-08-07)</h2>\n<h3> Code Refactoring</h3>\n<ul>\n<li>侧边栏可折叠</li>\n<li>调整目录结构</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li><strong>design-pattern:</strong> 增加选项模式</li>\n</ul>\n<p><a name=\"v0.6.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.5.0...v0.6.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.6.0</a> (2023-08-03)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li>修改设计模式</li>\n<li>配置页面元数据</li>\n<li>自动化部署问题修复</li>\n<li>删除临时文件</li>\n<li><strong>design-pattern:</strong> 修改设计模式问题</li>\n<li><strong>project-stanard:</strong> 修改项目规范一些问题</li>\n</ul>\n<h3> Code Refactoring</h3>\n<ul>\n<li>调整侧边栏和导航栏</li>\n<li>调整导航栏和侧边栏</li>\n<li><strong>databae:</strong> 优化数据库查询</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li>增加变更日志</li>\n<li>增加Go语言爱好者周刊友情链接</li>\n<li>切换为vuepress-theme-hope</li>\n</ul>\n<p><a name=\"v0.5.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.4.0...v0.5.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.5.0</a> (2022-05-24)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>database:</strong> 增加事务一致性视图</li>\n</ul>\n<h3> Code Refactoring</h3>\n<ul>\n<li><strong>go-language:</strong> 修改操作符</li>\n<li><strong>go-language:</strong> 调整数组与切片</li>\n<li><strong>go-language:</strong> 字符串调整</li>\n<li><strong>go-language:</strong> 数组与切片调整</li>\n<li><strong>go-language:</strong> 调整变量、常量及命名规则</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li><strong>database:</strong> 增加mysql读过程、写过程和事务</li>\n<li><strong>database:</strong> 增加redis大纲</li>\n<li><strong>go-language:</strong> 增加break使用说明</li>\n<li><strong>go-language:</strong> 增加for-range注意点</li>\n<li><strong>go-language:</strong> 增加字符串底层结构</li>\n<li><strong>go-language:</strong> 增加map介绍</li>\n</ul>\n<p><a name=\"v0.4.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.3.4...v0.4.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.4.0</a> (2022-03-27)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>algorithm:</strong> 增加限流-令牌桶算法</li>\n<li><strong>project-standard:</strong> 增加语义化版本工具</li>\n<li><strong>project-standard:</strong> 增加语义化版本详细外链</li>\n<li><strong>project-standard:</strong> 增加readme.so外链</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li><strong>database:</strong> 增加MySQL-表连接</li>\n<li><strong>go-language:</strong> 增加一些环境变量说明</li>\n<li><strong>tools:</strong> 增加CA证书</li>\n</ul>\n<p><a name=\"v0.3.4\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.3.3...v0.3.4\" target=\"_blank\" rel=\"noopener noreferrer\">v0.3.4</a> (2022-03-20)</h2>\n<h3> Features</h3>\n<ul>\n<li><strong>algorithm:</strong> 增加限流算法</li>\n</ul>\n<p><a name=\"v0.3.3\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.3.2...v0.3.3\" target=\"_blank\" rel=\"noopener noreferrer\">v0.3.3</a> (2022-03-03)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>project-standard:</strong> 项目管理改为项目规范</li>\n</ul>\n<p><a name=\"v0.3.2\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.3.1...v0.3.2\" target=\"_blank\" rel=\"noopener noreferrer\">v0.3.2</a> (2022-02-23)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>data-structure:</strong> 删除二叉搜索树迭代版本</li>\n</ul>\n<h3> Code Refactoring</h3>\n<ul>\n<li>调整结构和描述</li>\n</ul>\n<p><a name=\"v0.3.1\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.3.0...v0.3.1\" target=\"_blank\" rel=\"noopener noreferrer\">v0.3.1</a> (2022-02-23)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>data-structure:</strong> 修改二叉搜索树删除节点算法</li>\n</ul>\n<h3> Code Refactoring</h3>\n<ul>\n<li><strong>data-structure:</strong> 修改删除最小节点命名</li>\n</ul>\n<p><a name=\"v0.3.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.2.0...v0.3.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.3.0</a> (2022-02-20)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>data-structure:</strong> 侧边栏修复</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li><strong>data-structure:</strong> 增加二叉搜索树</li>\n<li><strong>data-structure:</strong> 增加二叉树</li>\n</ul>\n<p><a name=\"v0.2.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.1.0...v0.2.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.2.0</a> (2022-02-11)</h2>\n<h3> Features</h3>\n<ul>\n<li><strong>project-manager:</strong> 增加分支规范</li>\n</ul>\n<p><a name=\"v0.1.0\"></a></p>\n<h2> <a href=\"https://github.com/Hexiaopi/hexiaopi.github.io/compare/v0.0.1...v0.1.0\" target=\"_blank\" rel=\"noopener noreferrer\">v0.1.0</a> (2022-02-09)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li><strong>project-manager:</strong> 修正目录规范</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li><strong>commit:</strong> 增加语义化版本自动生成工具gsemver配置和介绍</li>\n<li><strong>commit:</strong> 增加CHANGE LOG自动生产</li>\n<li><strong>docs:</strong> 增加变更历史</li>\n<li><strong>project-manager:</strong> 增加目录规范</li>\n</ul>\n<p><a name=\"v0.0.1\"></a></p>\n<h2> v0.0.1 (2022-02-03)</h2>\n<h3> Bug Fixes</h3>\n<ul>\n<li>更新侧边栏</li>\n<li>update sidebar</li>\n<li>project manager</li>\n<li><strong>monitor-system:</strong> 统一图片文件夹命名</li>\n<li><strong>project-manager:</strong> 更新提交规范</li>\n<li><strong>project-manager:</strong> update version</li>\n</ul>\n<h3> Code Refactoring</h3>\n<ul>\n<li><strong>go-language:</strong> 调整结构</li>\n<li><strong>go-language:</strong> 调整结构</li>\n</ul>\n<h3> Features</h3>\n<ul>\n<li>增加CHANGE LOG</li>\n<li>add project manager</li>\n<li>add <a href=\"http://README.md\" target=\"_blank\" rel=\"noopener noreferrer\">README.md</a></li>\n<li>增加版本规范</li>\n<li>项目文档规范</li>\n<li><strong>design-pattern:</strong> add some design pattern</li>\n<li><strong>project-manager:</strong> add commit standard</li>\n<li><strong>project-manager:</strong> add api standard</li>\n<li><strong>project-manager:</strong> add api standard</li>\n</ul>\n",
      "date_published": "2023-08-03T13:57:06.000Z",
      "date_modified": "2023-08-13T15:38:36.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "文档规范",
      "url": "https://Hexiaopi.github.io/project-standard/doc.html",
      "id": "https://Hexiaopi.github.io/project-standard/doc.html",
      "summary": "README文档是项目的门面，通过README文档可以帮助用户快速了解项目。 README文档可以参考以下模板，或者通过在线网站生成readme.so # 项目名称 &lt;!-- 简介项目 --&gt; ## 功能特性 &lt;!-- 描述该项目的核心功能点 --&gt; ## 软件架构(可选) &lt;!-- 描述下项目的架构 --&gt; ## 快速开始 ### 依赖检查 &lt;!-- 该项目的依赖，比如依赖的包、工具或者其他任何依赖项 --&gt; ### 构建 &lt;!-- 如何构建该项目 --&gt; ### 运行 &lt;!-- 如何运行该项目 --&gt; ### 预览环境（可选） &lt;!-- 提供预览环境，帮助用户快速尝鲜 --&gt; ## 使用指南 &lt;!-- 如何使用该项目 --&gt; ## 如何贡献 &lt;!-- 如何贡献源码 --&gt; ## 社区(可选) &lt;!-- 社区相关的内容 --&gt; ## 关于作者 &lt;!-- 项目作者(多个) --&gt; ## 谁在用(可选) &lt;!-- 使用本项目的其他有影响力的项目，加分 --&gt; ## 许可证 &lt;!-- 开源许可证 --&gt;",
      "content_html": "<blockquote>\n<p>README文档是项目的门面，通过README文档可以帮助用户快速了解项目。</p>\n</blockquote>\n<p>README文档可以参考以下模板，或者通过在线网站生成<a href=\"https://readme.so/\" target=\"_blank\" rel=\"noopener noreferrer\">readme.so</a></p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>项目文档通常放在<code>/docs</code>目录下。包含：</p>\n<p><strong>开发文档</strong><br>\n面向开发人员，用来说明开发流程、构建、测试、部署等。</p>\n<p><strong>用户文档</strong><br>\n面向使用人员，包括：API文档、SDK文档、安装文档、功能介绍文档、最佳实践、操作指南、常见问题等。</p>\n</blockquote>\n<p>这里参考<a href=\"https://github.com/marmotedu/iam\" target=\"_blank\" rel=\"noopener noreferrer\">IAM</a>项目的文档结构</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2020-01-24T00:00:00.000Z",
      "date_modified": "2023-08-02T13:20:49.000Z",
      "authors": [
        {
          "name": "Hexiaopi"
        }
      ],
      "tags": [
        "项目规范"
      ]
    },
    {
      "title": "工厂模式的比较",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/factory-compare.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/factory-compare.html",
      "summary": "简单工厂模式：适用于需要根据客户端的输入来创建对象的场景，但不符合开闭原则，随着产品的增加需要修改工厂类。 工厂方法模式：通过将具体产品的创建延迟到子类中实现，符合开闭原则，每个具体工厂类负责创建一个具体产品。 抽象工厂模式：适用于需要创建一组相关产品对象的场景，每个具体工厂类负责创建一组相关产品。 选择适合的创建型设计模式取决于具体的项目需求和设计考虑，简单工厂模式简单易懂但可扩展性差，工厂方法模式更灵活但需要额外的子类，而抽象工厂模式适用于创建一组相关的产品对象。",
      "content_html": "<p>简单工厂模式：适用于需要根据客户端的输入来创建对象的场景，但不符合<code>开闭原则</code>，随着产品的增加需要修改工厂类。</p>\n<p>工厂方法模式：通过将具体产品的创建延迟到子类中实现，符合<code>开闭原则</code>，每个具体工厂类负责创建一个具体产品。</p>\n<p>抽象工厂模式：适用于需要创建一组相关产品对象的场景，每个具体工厂类负责创建一组相关产品。</p>\n<p>选择适合的创建型设计模式取决于具体的项目需求和设计考虑，简单工厂模式简单易懂但可扩展性差，工厂方法模式更灵活但需要额外的子类，而抽象工厂模式适用于创建一组相关的产品对象。</p>\n",
      "date_published": "2023-07-31T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "函数模式",
      "url": "https://Hexiaopi.github.io/design-pattern/function/",
      "id": "https://Hexiaopi.github.io/design-pattern/function/",
      "summary": "函数模式 函数模式并非人们所熟知的面向对象的设计模式，但由于Go语言将函数作为一等公民： 函数可以作为参数 函数可以作为变量 函数可以作为返回值 因此，在Go语言中，通过函数模式，可以实现一些函数式编程的特性，如高阶函数、闭包等。 选项模式 中间件模式",
      "content_html": "<h2> 函数模式</h2>\n<p>函数模式并非人们所熟知的面向对象的设计模式，但由于Go语言将函数作为<strong>一等公民</strong>：</p>\n<ul>\n<li>函数可以作为参数</li>\n<li>函数可以作为变量</li>\n<li>函数可以作为返回值</li>\n</ul>\n<p>因此，在Go语言中，通过函数模式，可以实现一些函数式编程的特性，如高阶函数、闭包等。</p>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> 选项模式</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> 中间件模式</label></li>\n</ul>\n",
      "date_published": "2023-08-02T00:00:00.000Z",
      "date_modified": "2023-08-03T14:52:58.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "介绍页",
      "url": "https://Hexiaopi.github.io/intro.html",
      "id": "https://Hexiaopi.github.io/intro.html",
      "summary": "介绍页",
      "content_html": "<h1> 介绍页</h1>\n<p><img src=\"https://raw.githubusercontent.com/Hexiaopi/Hexiaopi/master/profile-summary-card-output/github/0-profile-details.svg\" alt=\"profile-details\" loading=\"lazy\"><br>\n<img src=\"https://raw.githubusercontent.com/Hexiaopi/Hexiaopi/master/profile-summary-card-output/github/1-repos-per-language.svg\" alt=\"profile-language\" loading=\"lazy\"><br>\n<img src=\"https://raw.githubusercontent.com/Hexiaopi/Hexiaopi/master/profile-summary-card-output/github/2-most-commit-language.svg\" alt=\"commit-language\" loading=\"lazy\"><br>\n<img src=\"https://raw.githubusercontent.com/Hexiaopi/Hexiaopi/master/profile-summary-card-output/github/3-stats.svg\" alt=\"stats\" loading=\"lazy\"><br>\n<img src=\"https://raw.githubusercontent.com/Hexiaopi/Hexiaopi/master/profile-summary-card-output/github/4-productive-time.svg\" alt=\"time\" loading=\"lazy\"></p>\n",
      "image": "https://raw.githubusercontent.com/Hexiaopi/Hexiaopi/master/profile-summary-card-output/github/0-profile-details.svg",
      "date_published": "2023-07-30T09:20:01.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "幻灯片页",
      "url": "https://Hexiaopi.github.io/slides.html",
      "id": "https://Hexiaopi.github.io/slides.html",
      "summary": "slidestart 幻灯片演示 一个简单的幻灯片演示与各种小贴士。 作者 Mr.Hope. 请滚动鼠标滚轮进入下一页 标注幻灯片 👇 (#/1/1) -- 标注幻灯片 使用 --- 标注水平幻灯片 在水平幻灯片中使用 -- 分割垂直幻灯片 使用 在幻灯片上添加属性 使用 在前一个 HTML 元素上添加属性 Markdown 你可以在幻灯片中使用 M...",
      "content_html": "<!-- markdownlint-disable MD024 MD033 MD051 -->\n",
      "image": "https://Hexiaopi.github.io/logo.svg",
      "date_published": "2023-07-30T09:20:01.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "限流算法",
      "url": "https://Hexiaopi.github.io/algorithm/limit.html",
      "id": "https://Hexiaopi.github.io/algorithm/limit.html",
      "summary": "限流，是一种自我保护的机制，服务端通过一些限流手段控制并发访问请求，目的是为了防止系统因突发流量导致服务不可用或者崩溃。 常用的限流方法： 计数器限流 滑动窗口限流 漏桶限流 令牌桶限流 计数器限流 在一段时间间隔内，对请求进行计数，与阈值进行比较判断是否需要限流 时间结束后重置计数器 因此计数器限流也叫固定时间限流",
      "content_html": "<blockquote>\n<p>限流，是一种自我保护的机制，服务端通过一些限流手段控制并发访问请求，目的是为了防止系统因突发流量导致服务不可用或者崩溃。</p>\n</blockquote>\n<p>常用的限流方法：</p>\n<ul>\n<li>计数器限流</li>\n<li>滑动窗口限流</li>\n<li>漏桶限流</li>\n<li>令牌桶限流</li>\n</ul>\n<h2> 计数器限流</h2>\n<blockquote>\n<p>在一段时间间隔内，对请求进行计数，与阈值进行比较判断是否需要限流<br>\n时间结束后重置计数器<br>\n因此计数器限流也叫固定时间限流</p>\n</blockquote>\n<figure><figcaption>limit-counter</figcaption></figure>\n<p>如图所示，假设每秒钟限流5次，那么接下来的第6次、第7次...会被拒绝，但下一秒钟又可以继续访问，直到达到限流5次后，又被拒绝。</p>\n<h3> 单机版</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试结果，由于我们限制了每秒种只能处理5个请求，前5个运行通过，后5个由于限流，不允许通过</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>但是计数器限流存在一个问题，如下图所示：</p>\n<figure><figcaption>limit-counter-question</figcaption></figure>\n<p>假设限制每秒钟限流5个请求<br>\n虽然在00:00:30-00:00:31之前有5个请求，但没有超过5个，00:00:31-00:00:32之间有5个请求，但也没有超过5个。<br>\n但是在00:00:31秒附近确有10次请求。<br>\n我们模拟这种场景测试如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试结果：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>很显然计数器限流存在临界值问题，限流不够均衡。假设极端情况下，在临界值附近有2倍的流量，很显然我们的系统会处理不过来。</p>\n<h3> 分布式</h3>\n<blockquote>\n<p>分布式是当前的主流模式，在分布式环境下我们可以使用redis+lua脚本实现计数器限流</p>\n</blockquote>\n<div class=\"language-lua line-numbers-mode\" data-ext=\"lua\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 滑动窗口限流</h2>\n<blockquote>\n<p>滑动窗口(Sliding Window)限流在每次检查时，查看最近窗口（例如10秒钟）的请求次数，如果超过最大次数（例如5次）就拒绝，反之则允许<br>\n由于时间窗口是滑动的即没有像计数器限流固定的临界点，解决了计数器的临界问题</p>\n</blockquote>\n<figure><figcaption>limit-sliding-window</figcaption></figure>\n<h3> 分布式</h3>\n<div class=\"language-lua line-numbers-mode\" data-ext=\"lua\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 漏桶限流</h2>\n<blockquote>\n<p>漏桶算法（Leaky Bucket）主要目的是控制数据注入到网络的速率，平滑网络上的突发流量。<br>\n漏桶可以看作是一个带有常量服务时间的单服务器队列，如果漏桶（包缓存）溢出，那么数据包会被丢弃。<br>\n如图所示，把请求比作是谁，水来了都先放进桶里，并以限定的速度出水，当水来的过猛而出水不够快时就会导致水直接溢出。</p>\n</blockquote>\n<figure><figcaption>leaky-bucket</figcaption></figure>\n<h3> 单机版</h3>\n<p>uber团队开源的<a href=\"github.com/user-go/ratelimit\">漏桶</a>，使用比较简单。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 令牌桶限流</h2>\n<blockquote>\n<p>令牌桶算法包含三个过程：</p>\n<ul>\n<li>生产令牌：以固定的速率向令牌桶中增加令牌，如果桶中令牌个数达到上限，则丢弃多余令牌；</li>\n<li>消费令牌：每来一次请求，就会消耗桶中的令牌，可以对耗时高的请求增加每次消费的令牌个数；</li>\n<li>判断是否通过：请求到来，根据消费的令牌个数是否小于等于桶中令牌个数，如果满足则允许通过，否则不允许通过；</li>\n</ul>\n</blockquote>\n<figure><figcaption>token-bucket</figcaption></figure>\n<h3> 分布式</h3>\n<div class=\"language-lua line-numbers-mode\" data-ext=\"lua\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2023-08-14T00:00:00.000Z",
      "date_modified": "2023-08-14T13:05:37.000Z",
      "authors": [],
      "tags": [
        "算法"
      ]
    },
    {
      "title": "设计模式",
      "url": "https://Hexiaopi.github.io/design-pattern/",
      "id": "https://Hexiaopi.github.io/design-pattern/",
      "summary": "提示 面向对象是武器 设计模式是招式 设计原则是心法 以心法为基础，以武器运用招式应对复杂的编程问题",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>面向对象是<strong>武器</strong></p>\n<p>设计模式是<strong>招式</strong></p>\n<p>设计原则是<strong>心法</strong></p>\n<p>以心法为基础，以武器运用招式应对复杂的编程问题</p>\n</div>\n<!-- more -->\n<h2> 什么是设计模式</h2>\n<p>设计模式最早来源于建筑领域</p>\n<blockquote>\n<p>克里斯托弗.亚历山大在作品《建筑的永恒之道》中这样说：\"每个模式都描述了一个在我们的环境中不断出现的问题，然后描述了该问题的解决方案的核心，通过这种方式，我们可以无数次地重用那些已有的成功的解决方案，无须再重复相同的工作。\"</p>\n</blockquote>\n<p>之后四人组（Gang of Four，简称GoF）将模式的概念应用在软件开发设计中，定义如下：</p>\n<blockquote>\n<p>它是一套被反复使用、多数人知晓的、经过分类编目的、代码设计经验的总结。</p>\n<p>它描述了在软件设计过程中的一些不断重复发生的问题，以及该问题的解决方案。</p>\n</blockquote>\n<p>简单来说，就是<strong>解决特定问题的一系列解决方案</strong>，是前辈们的代码设计经验的总结。</p>\n<h3> 具有哪些优点</h3>\n<ul>\n<li>优化软件设计：设计模式通常由经验丰富的开发者提供实现，可以提高软件的可重用性、可扩展性和可维护性。</li>\n<li>提高软件质量：设计模式通常会规范代码编写，有助于减少代码中的错误和问题。</li>\n<li>提高团队协作效率：设计模式具有通用性和标准化，从而使团队成员更容易合作编写代码，提高协作效果。</li>\n<li>提高系统性能：设计模式可以优化代码实现，提高系统性能。</li>\n</ul>\n<h3> 四要素</h3>\n<ul>\n<li><strong>问题</strong>：问题或称为上下文、场景，指在软件开发中需要解决的某个问题或需求。设计模式通常解决针对特定上下文或场景中出现的问题。</li>\n<li><strong>解决方案</strong>：解决方案或称为模型、模式，是指用于解决上述问题的通用方法或最佳实践。设计模式描述了解决某问题的方法或模板，并提供了这些方法的实现细节，使得类似问题可以被解决且易于复用。</li>\n<li><strong>效果</strong>：效果或称为结果、贡献，是指使用该模式带来的好处和优点。设计模式提供了可重用、灵活的解决方案，增加可维护性、可扩展性和可重用性。</li>\n<li><strong>元素</strong>：元素或称为参与者、角色、类和对象，组成了设计模式的各个部分。这些元素可以是类、对象、接口、方法等等。元素描述了在特定上下文或场景中参与模式实现的各种组件。</li>\n</ul>\n<h2> 分类</h2>\n<figure><figcaption>分类</figcaption></figure>\n",
      "date_published": "2022-09-10T00:00:00.000Z",
      "date_modified": "2023-08-02T13:20:49.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "设计原则",
      "url": "https://Hexiaopi.github.io/design-pattern/principle.html",
      "id": "https://Hexiaopi.github.io/design-pattern/principle.html",
      "summary": "设计原则是心法，对于构建高质量的软件系统提供指导和约束，它具有以下作用： 提高代码质量：设计原则强调代码的清晰性、可读性和可维护性。通过遵循设计原则，可以编写出更结构化、更模块化的代码，减少代码重复和冗余。 降低耦合度：设计原则鼓励松散耦合的设计，将系统划分为更小的、相互独立的模块。这样可以减少模块之间的依赖关系，提高系统的灵活性和可扩展性。 促进代码重用：设计原则推崇封装、继承、多态等面向对象的特性，使得代码更易于重用。通过设计模式和设计原则，可以将通用的解决方案抽象出来，并在不同的场景中重复应用。 简化系统维护：良好的设计原则可以减少系统的耦合和复杂度，使系统更易于理解和维护。当需要对系统进行修改或扩展时，通过遵循设计原则，可以更快速、更安全地进行变更。 提高团队协作效率：设计原则提供了一种通用的设计思维和规范，使整个团队在设计和开发过程中能够更好地进行交流和协作。团队成员可以共同理解和遵循设计原则，降低沟通成本，提高开发效率。",
      "content_html": "<p>设计原则是心法，对于构建高质量的软件系统提供<strong>指导</strong>和<strong>约束</strong>，它具有以下作用：</p>\n<ul>\n<li>提高代码质量：设计原则强调代码的清晰性、可读性和可维护性。通过遵循设计原则，可以编写出更结构化、更模块化的代码，减少代码重复和冗余。</li>\n<li>降低耦合度：设计原则鼓励松散耦合的设计，将系统划分为更小的、相互独立的模块。这样可以减少模块之间的依赖关系，提高系统的灵活性和可扩展性。</li>\n<li>促进代码重用：设计原则推崇封装、继承、多态等面向对象的特性，使得代码更易于重用。通过设计模式和设计原则，可以将通用的解决方案抽象出来，并在不同的场景中重复应用。</li>\n<li>简化系统维护：良好的设计原则可以减少系统的耦合和复杂度，使系统更易于理解和维护。当需要对系统进行修改或扩展时，通过遵循设计原则，可以更快速、更安全地进行变更。</li>\n<li>提高团队协作效率：设计原则提供了一种通用的设计思维和规范，使整个团队在设计和开发过程中能够更好地进行交流和协作。团队成员可以共同理解和遵循设计原则，降低沟通成本，提高开发效率。</li>\n</ul>\n<!-- more -->\n<h2> SOLID原则</h2>\n<p>SOLID原则是由罗伯特·C·马丁在21世纪早期引入，指代了面向对象编程和面向对象设计的五个基本原则。遵循SOLID原则可以确保我们设计的代码是易维护、易扩展、易阅读的。SOLID原则同样也适用于Go程序设计。具体SOLID编码原则见下表：</p>\n<table>\n<thead>\n<tr>\n<th>简写</th>\n<th>全称</th>\n<th>中文描述</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>SRP</td>\n<td>The Single Responsibility Principle</td>\n<td>单一功能原则</td>\n</tr>\n<tr>\n<td>OCP</td>\n<td>The Open Closed Principle</td>\n<td>开闭原则</td>\n</tr>\n<tr>\n<td>LSP</td>\n<td>The Liskov Substitution Principle</td>\n<td>里氏替换原则</td>\n</tr>\n<tr>\n<td>DIP</td>\n<td>The Dependency Inversion Principle</td>\n<td>依赖倒置原则</td>\n</tr>\n<tr>\n<td>ISP</td>\n<td>The Interface Segregation Principle</td>\n<td>接口分离原则</td>\n</tr>\n</tbody>\n</table>\n<h3> 单一功能原则</h3>\n<blockquote>\n<p>单一功能原则：一个类或者模块只负责完成一个职责(或者功能)。</p>\n</blockquote>\n<p>简单来说就是保证我们在设计函数、方法时做到功能单一，权责明确，当发生改变时，只有一个改变它的原因。如果函数/方法承担的功能过多，就意味着很多功能会相互耦合，这样当其中一个功能发生改变时，可能会影响其它功能。单一功能原则，可以使代码后期的维护成本更低、改动风险更低。</p>\n<p>例如，有以下代码，用来创建一个班级，班级包含老师和学生，代码如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上面的代码段通过<code>createClass</code>函数创建了一个老师和学生，老师和学生属于同一个班级。但是现在因为老师资源不够，要求一个老师管理多个班级。这时候，需要修改<code>createClass</code>函数的class参数，因为创建学生和老师是通过<code>createClass</code>函数的class参数偶合在一起，所以修改创建老师的代码，势必会影响创建学生的代码，其实，创建学生的代码我们是压根不想改动的。这时候<code>createClass</code>函数就不满足单一功能原则。需要修改为满足单一功能原则的代码，修改后代码段如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述代码，我们将<code>createClass</code>函数拆分成2个函数<code>CreateStudent</code>和<code>CreateTeacher</code>，分别用来创建学生和老师，各司其职，代码互不影响。</p>\n<h3> 开闭原则</h3>\n<blockquote>\n<p>开闭原则：软件实体应该对扩展开放、对修改关闭。</p>\n</blockquote>\n<p>简单来说就是通过在已有代码基础上扩展代码，而非修改代码的方式来完成新功能的添加。开闭原则，并不是说完全杜绝修改，而是尽可能不修改或者以最小的代码修改代价来完成新功能的添加。</p>\n<p>以下是一个满足开闭原则的代码段：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述代码段，定义了一个Book接口和Book接口的一个实现：NovelBook（小说）。现在有新的需求，对所有小说打折统一打5折，根据开闭原则，<strong>打折相关的功能应该利用扩展实现，而不是在原有代码上修改</strong>，所以，新增一个OffNovelBook接口，继承NovelBook，并重写GetPrice方法。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 里氏替换原则</h3>\n<blockquote>\n<p>里氏替换原则：如果S是T的子类型，则类型T的对象可以替换为类型S的对象，而不会破坏程序。在Go开发中，里氏替换原则可以通过接口来实现。</p>\n</blockquote>\n<p>例如，以下是一个符合里氏替换原则的代码段：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们可以将Write函数中的Writer参数替换为其子类型ReadWriter，而不影响已有程序：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 依赖倒置原则</h3>\n<blockquote>\n<p>依赖倒置原则：依赖于抽象而不是一个实例，其本质是要面向接口编程，不要面向实现编程。</p>\n</blockquote>\n<p>以下是一个符合依赖倒置原则的代码段：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上述代码中，IDriver接口的Drive方法，依赖于ICar接口，而不是某一具体的汽车类型。这样司机就可以开不同的汽车。</p>\n<h3> 接口隔离原则</h3>\n<blockquote>\n<p>接口隔离原则：客户端程序不应该依赖它不需要的方法。</p>\n</blockquote>\n<p>例如，我们通过Save函数将文档保存到磁盘：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>上面的Save函数虽然能够完成任务，但有下面的问题：</p>\n<ol>\n<li>Save函数使用*os.File做为保存Document的文件，如果后面需要将Document保存到网络存储，Save函数就无法满足。</li>\n<li>因为Save函数直接保存文档到磁盘，不方便后续的测试。</li>\n<li>*os.File包含了许多跟Save函数的方法，例如：读取路径以及检查路径是否是软连接等。</li>\n</ol>\n<p>可以说上述的Save方法不满足接口隔离原则。可以优化为：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>但是上述的Save函数仍然有问题，我们其实只需要写操作，不需要读操作，因此，Save函数可以进一步优化为：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code>func Save(w io.Writer, doc *Document) error</code>就是最终的符合接口隔离原则的函数。</p>\n<h2> DRY原则</h2>\n<blockquote>\n<p>DRY: Don't Repeat Yourself，不要重复自己</p>\n<p>避免在代码中出现重复的逻辑和代码，可以通过封装来实现重复代码的复用。</p>\n</blockquote>\n<h2> KISS原则</h2>\n<blockquote>\n<p>KISS: Keep It Simple,Stupid，尽可能简化代码</p>\n<p>不要使用过于复杂的算法和设计模式。</p>\n</blockquote>\n<h2> YANGI原则</h2>\n<blockquote>\n<p>YANGI: You Ain't Gonna Need It，你不会需要它</p>\n<p>在编写代码时，不要过度设计，只保持足够的可扩展性，不要编写没有必要的代码。</p>\n</blockquote>\n<h2> LOD原则</h2>\n<blockquote>\n<p>LOD: Law of Demeter,迪米特法则。或者称为：The Least Knowledge Principle，最小知识原则。</p>\n<p>一个对象应该对其它对象有最少的了解。避免在代码中出现过多的依赖关系，可以通过使用接口和依赖注入等方式来实现。</p>\n</blockquote>\n",
      "date_published": "2022-10-15T00:00:00.000Z",
      "date_modified": "2023-08-07T14:03:54.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "高质量代码",
      "url": "https://Hexiaopi.github.io/design-pattern/quantity-code.html",
      "id": "https://Hexiaopi.github.io/design-pattern/quantity-code.html",
      "summary": "提示 什么样的代码才是高质量的代码❓",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>什么样的代码才是高质量的代码❓</p>\n</div>\n<!-- more -->\n<h2> 什么是高质量代码</h2>\n<p>代码质量的评价有很强的主观性，描述代码质量的词汇也有很多，比如可读性、可维护性、灵活、优雅、简洁等，这些词汇是从不同的维度去评价代码质量的。它们之间有互相作用，并不是独立的，比如，代码的可读性好、可扩展性好就意味着代码的可维护性好。代码质量高低是一个综合各种因素得到的结论。我们并不能通过单一的维度去评价一段代码的好坏。</p>\n<h3> 可维护性（maintainability）</h3>\n<blockquote>\n<p>维护：无外乎就是修改bug、修改老的代码、添加新的代码之类的工作。</p>\n</blockquote>\n<p><strong>维护代码的时间远远大于编写代码的时间</strong><br>\n其中：</p>\n<ul>\n<li>代码易维护：在不破坏原有代码设计、不引入新的bug的情况下，能够快速地修改或者添加代码。</li>\n<li>代码不易维护：修改或者添加代码需要冒着极大的引入新bug的风险，并且需要花费很长的时间才能完成。</li>\n</ul>\n<h3> 可读性（readability）</h3>\n<blockquote>\n<p>可读：代码易读易理解</p>\n</blockquote>\n<p><strong>代码被阅读的次数远远超过被编写的次数</strong><br>\n我们可以从以下方面来评价：</p>\n<ol>\n<li>代码是否符合编码规范；</li>\n<li>命名是否达意；</li>\n<li>注释是否详尽；</li>\n<li>函数是否长短合适；</li>\n<li>模块划分是否清晰；</li>\n<li>是否符合高内聚低耦合；</li>\n</ol>\n<h3> 可扩展性（extensibility）</h3>\n<blockquote>\n<p>可扩展：代码应对未来需求变化的能力</p>\n</blockquote>\n<p><strong>开闭原则：对修改关闭，对扩展开放</strong><br>\n评判标准：</p>\n<ul>\n<li>我们在不修改或少量修改原有代码的情况，通过扩展的方式添加新的功能代码；</li>\n<li>代码预留了一些功能扩展点，不需要因为添加一个功能而大动干戈，改动大量的原始代码；</li>\n</ul>\n<h3> 灵活性（flexibility）</h3>\n<blockquote>\n<p>灵活：代码易扩展、易复用或者易用</p>\n</blockquote>\n<p>举例如下：</p>\n<ul>\n<li>\n<p>易扩展：当我们添加一个新的功能代码的时候，原有的代码已经预留好了扩展点，我们不需要修改原有的代码，只要在扩展点上添加新的代码即可。这个时候，我们除了可以说代码易扩展，还可以说代码写得好灵活。</p>\n</li>\n<li>\n<p>易复用：当我们要实现一个功能的时候，发现原有代码中，已经抽象出了很多底层可以复用的模块、类等代码，我们可以拿来直接使用。这个时候，我们除了可以说代码易复用之外，还可以说代码写得好灵活。</p>\n</li>\n<li>\n<p>易用：当我们使用某组接口的时候，如果这组接口可以应对各种使用场景，满足各种不同的需求，我们除了可以说接口易用之外，还可以说这个接口设计得好灵活或者代码写得好灵活。</p>\n</li>\n</ul>\n<h3> 简洁性（simplicity）</h3>\n<blockquote>\n<p>简洁：代码简单、逻辑清晰</p>\n</blockquote>\n<p><strong>KISS原则：“Keep it Simple,Stupid”</strong><br>\n怎么评判呢？每个人的标准都不一样，我觉得能够快速理解业务逻辑就是简单的。\"思从深而行从简，真正的高手能云淡风轻地用最简单的方法解决最复杂的问题。\"</p>\n<h3> 可复用性（reusability）</h3>\n<blockquote>\n<p>可复用：尽量减少重复代码的编写，复用已有的代码。</p>\n</blockquote>\n<p><strong>DRY原则：“Don't Repeat Yourself”</strong><br>\n使用技巧：</p>\n<ul>\n<li>面向对象特性：继承和多态就是为了提高可复用性；</li>\n<li>解耦、高内聚、模块化等思想都能提高代码的可复用性；</li>\n<li>单一职责原则与可复用性相关；</li>\n</ul>\n<h3> 可测试性（testability）</h3>\n<blockquote>\n<p>可测试：能否方便地测试代码逻辑</p>\n</blockquote>\n<p>评判标准：</p>\n<ul>\n<li>即便有存储和第三方服务也能测试；</li>\n<li>不依赖各个环境；</li>\n</ul>\n",
      "date_published": "2022-11-01T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "简介",
      "url": "https://Hexiaopi.github.io/go-language/",
      "id": "https://Hexiaopi.github.io/go-language/",
      "summary": "Go语言最初是由谷歌公司的Robert Griesemer、Ken Thompson、Rob Pike三位大咖于2007年开始设计发明。由于Go语言继承和发扬了C语言的简单哲学，并充分发挥当前时代多核架构的能力，因此，Go语言更多的是被描述为21世纪的C语言。诞生至今，在多个领域尤其是云计算领域有着广泛的应用。 对我的吸引 简单 Go语言的语法非常简答，仅仅20几个关键字即可。相比较学习其他语言时，我觉得更加减轻心智的负担，而不用纠结一些看似高大上的语法糖。Go语言的简单贯彻到整个开发周期中，例如：",
      "content_html": "<blockquote>\n<p>Go语言最初是由谷歌公司的Robert Griesemer、Ken Thompson、Rob Pike三位大咖于2007年开始设计发明。由于Go语言继承和发扬了C语言的简单哲学，并充分发挥当前时代多核架构的能力，因此，Go语言更多的是被描述为<strong>21世纪的C语言</strong>。诞生至今，在多个领域尤其是云计算领域有着广泛的应用。</p>\n</blockquote>\n<h2> 对我的吸引</h2>\n<h3> 简单</h3>\n<p>Go语言的语法非常简答，仅仅20几个关键字即可。相比较学习其他语言时，我觉得更加减轻心智的负担，而不用纠结一些看似高大上的语法糖。Go语言的简单贯彻到整个开发周期中，例如：</p>\n<ul>\n<li>类型转换，在Go语言中必须显示的进行转换，不必纠结</li>\n<li>包依赖，Go语言编译时如果书写了未引入的包会报错，这也大大提高项目的构建速度</li>\n<li>函数支持多返回值，就不用写多个函数</li>\n<li>函数作为一等公民，可以传参、赋值、返回。遇到一些多场景问题，直接把函数作为参数进行处理即可</li>\n</ul>\n<h3> 支持并发</h3>\n<p>Go语言天生支持高并发，在多核时代下，能够充分利用多核的能力。而且语法也简单，仅仅使用<code>go xxx()</code>即可启动一个协程异步处理函数。</p>\n<h3> 工具链丰富</h3>\n<p>Go语言有成熟的工具链帮助我们构建、测试、代码检测、下载依赖包等。</p>\n<h3> 支持垃圾回收</h3>\n<p>Go语言在运行态帮助开发者进行垃圾回收，大大降低开发者的心智负担。</p>\n<h2> 后期计划</h2>\n<ul class=\"task-list-container\">\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-0\" checked=\"checked\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-0\"> 基础，介绍基础的Go语言知识</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-1\" checked=\"checked\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-1\"> 进阶，这里关注一些底层原型</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-2\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-2\"> 工具，介绍一些Go语言相关的工具</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-3\" checked=\"checked\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-3\"> 推荐，推荐一些Go语言相关的博客、工具、项目等</label></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" class=\"task-list-item-checkbox\" id=\"task-item-4\" checked=\"checked\" disabled=\"disabled\"><label class=\"task-list-item-label\" for=\"task-item-4\"> 转载，转载一些高质量的博文</label></li>\n</ul>\n",
      "date_published": "2022-01-22T00:00:00.000Z",
      "date_modified": "2023-08-13T15:30:36.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "WebSocket协议",
      "url": "https://Hexiaopi.github.io/network/websocket.html",
      "id": "https://Hexiaopi.github.io/network/websocket.html",
      "summary": "WebSocket是为了提供web应用程序和服务端全双工通信而专门定制的一种网络协议，和HTTP协议一样位于OSI模型的应用层协议。 特点 建立在TCP协议之上 与HTTP协议有着良好的兼容性，握手阶段采用HTTP协议，默认端口是80和443 数据格式比较轻量，性能开销小、通信高效 可以发送文本，也可以发送二进制数据 没有同源限制，客户端可以与任意服务器通信 协议标识符是ws(如果加密，则为wss)，形式：ws://echo.websocket.org",
      "content_html": "<blockquote>\n<p>WebSocket是为了提供web应用程序和服务端全双工通信而专门定制的一种网络协议，和HTTP协议一样位于OSI模型的应用层协议。</p>\n</blockquote>\n<h2> 特点</h2>\n<ul>\n<li>建立在TCP协议之上</li>\n<li>与HTTP协议有着良好的兼容性，握手阶段采用HTTP协议，默认端口是80和443</li>\n<li>数据格式比较轻量，性能开销小、通信高效</li>\n<li>可以发送文本，也可以发送二进制数据</li>\n<li>没有同源限制，客户端可以与任意服务器通信</li>\n<li>协议标识符是ws(如果加密，则为wss)，形式：ws://echo.websocket.org</li>\n</ul>\n<h2> 交互时序</h2>\n<figure><figcaption>websocket</figcaption></figure>\n<h2> 抓包分析</h2>\n<h3> HTTP请求</h3>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li><code>Connection: Upgrade</code>表明要升级协议</li>\n<li><code>Upgrade:  websocket</code>表明升级至websocket协议</li>\n<li><code>Sec-Websocket-Key</code>是客户端发送的一个base64编码的秘文，要求服务端返回一个对应加密的<code>Sec-Websocket-Accept</code>应答，否则客户端会抛出“Error during WebSocket handshake”错误，并关闭连接</li>\n<li><code>Sec-Websocket-Version: 13</code>表示 websocket的版本，如果服务端不支持该版本，需要返回一个Sec-Websocket-Version里面包含服务端支持的版本号</li>\n</ul>\n<h3> HTTP返回</h3>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>Sec-Websocket-Accept是服务端采用与客户端一致的秘钥计算出来后返回客户端，计算公式</li>\n</ul>\n<blockquote>\n<p>toBase64(sha1(Sec-WebSocket-Key + 258EAFA5-E914-47DA-95CA-C5AB0DC85B11))</p>\n</blockquote>\n<ul>\n<li><code>HTTP/1.1 101 Switching Protocols</code>表示服务端接受WebSocket协议的客户端连接</li>\n</ul>\n<h2> 数据帧格式</h2>\n<blockquote>\n<p>从左到右，单位是比特。比如<code>FIN</code>、<code>RSV1</code>、<code>RSV2</code>、<code>RSV3</code>各占据1比特，<code>opcode</code>占据4比特</p>\n<p>内容包括了标识、操作代码、掩码、数据长度</p>\n</blockquote>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>\n<p><code>FIN</code>：1个比特</p>\n<ul>\n<li>\n<p>如果是1：表示这是消息的最后一个分片；</p>\n</li>\n<li>\n<p>如果是0：标识这不是消息的最后一个分片；</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code>RSV1</code>、<code>RSV2</code>、<code>RSV3</code>：各占1个比特</p>\n<ul>\n<li>\n<p>一般情况下全为0，当客户端、服务端协商采用websocket扩展时，这三个标志位可以非0，且值得含义由扩展进行定义；</p>\n</li>\n<li>\n<p>如果出现非零的值，且并没有采用websocket扩展，连接出错</p>\n</li>\n</ul>\n</li>\n<li>\n<p><code>Opcode</code>：4个比特</p>\n<ul>\n<li>%x0：表示一个延续帧。当Opcode为0时，表示本次数据传输采用了数据分片，当前收到的数据帧为其中一个数据分片。</li>\n<li>%x1：表示这是一个文本帧（frame）</li>\n<li>%x2：表示这是一个二进制帧（frame）</li>\n<li>%x3-7：保留的操作代码，用于后续定义的非控制帧。</li>\n<li>%x8：表示连接断开。</li>\n<li>%x9：表示这是一个ping操作。</li>\n<li>%xA：表示这是一个pong操作。</li>\n<li>%xB-F：保留的操作代码，用于后续定义的控制帧。</li>\n</ul>\n</li>\n<li>\n<p><code>Mask</code>：1个比特</p>\n<blockquote>\n<p>表示是否要对数据载荷进行掩码操作</p>\n<ul>\n<li>从客户端向服务端发送数据时，需要对数据进行掩码操作；</li>\n<li>从服务端向客户端发送数据时，不需要对数据进行掩码操作；</li>\n</ul>\n<p>如果服务端接收到的数据没有进行掩码操作，服务端需要断开连接</p>\n<p>如果Mask是1，那么Masking-key中会定义一个掩码键，并用这个掩码键对数据载荷进行反掩码。</p>\n</blockquote>\n</li>\n<li>\n<p><code>Payload length</code>：数据载荷的长度，单位是字节。为7位、或2✖️8位，或8✖️8位</p>\n<ul>\n<li>[0,126)：数据的长度就是Payload length的大小；</li>\n<li>126：后续2个字节为数据的长度；</li>\n<li>127：后续8个字节为数据的长度；</li>\n</ul>\n</li>\n<li>\n<p><code>Masking-key</code>：0或4字节</p>\n<ul>\n<li><code>Mask</code>为1，则包含4字节的<code>Masking-key</code></li>\n<li><code>Mask</code>为0，则不包含<code>Masking-key</code></li>\n</ul>\n</li>\n<li>\n<p><code>Payload data</code>：扩展数据+应用数据</p>\n<ul>\n<li>如果没有协商使用扩展的话，扩展数据为0字节；</li>\n<li>所有的扩展都必须声明扩展数据的长度，扩展如何使用必须在握手阶段就协商好；</li>\n</ul>\n</li>\n</ul>\n<h2> 参考链接</h2>\n<p><a href=\"http://www.52im.net/thread-831-1-1.html\" target=\"_blank\" rel=\"noopener noreferrer\">新手快速入门：WebSocket简明教程</a></p>\n<p><a href=\"https://www.cnblogs.com/chyingp/p/websocket-deep-in.html\" target=\"_blank\" rel=\"noopener noreferrer\">WebSocket协议：5分钟从入门到精通</a></p>\n",
      "date_published": "2023-03-19T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "网络"
      ]
    },
    {
      "title": "如何不靠运气变得富有",
      "url": "https://Hexiaopi.github.io/other/how-to-get-rich-without-getting-lucky.html",
      "id": "https://Hexiaopi.github.io/other/how-to-get-rich-without-getting-lucky.html",
      "summary": "【转】原文链接",
      "content_html": "<p>【转】<a href=\"https://github.com/fat-garage/how-to-get-rich-without-getting-lucky\" target=\"_blank\" rel=\"noopener noreferrer\">原文链接</a></p>\n<!-- more -->\n<p>如何不靠运气变得富有</p>\n<blockquote>\n<p>Naval 是美国风险投资家，这是他的3小时长播客《如何不靠运气变得富有》的中文翻译，介绍了他的财富观，非常值得一读。</p>\n</blockquote>\n<h2> 瞄一瞄这👇</h2>\n<ol>\n<li>本文搬运自【胖车库】公众号，译者<a href=\"https://www.notion.so/918aecdf7acc476f9cbba7836996c3fe\" target=\"_blank\" rel=\"noopener noreferrer\">Jessie</a>&amp;<a href=\"https://github.com/wangmingyue123\" target=\"_blank\" rel=\"noopener noreferrer\">明月</a>。胖车库是一个有意思人类的收集计划（开发者、创业者、自由职业者，还有你）和DAO去中心化协作实验室，看看大家都在不同领域做着什么样新的尝试，希望给你未来的可能性提供一些想象力。<strong>杰西和她的朋友们也会在胖车库第一时间更新<a href=\"https://mp.weixin.qq.com/s/c-yx-WfWcld1Z2tNpYJxlQ\" target=\"_blank\" rel=\"noopener noreferrer\">“如何不靠运气变得富有”系列</a></strong>，欢迎大家一起来玩耍 🎤。</li>\n</ol>\n<figure><img src=\"https://i.imgur.com/WubW2ud.jpg\" alt=\"胖车库\" tabindex=\"0\" loading=\"lazy\"><figcaption>胖车库</figcaption></figure>\n<ol start=\"2\">\n<li>哈哈哈，😏 其实我还整理出<a href=\"https://www.notion.so/taosu/Updating-faf1fa3dbcc34e60b443506e76a9c1ab\" target=\"_blank\" rel=\"noopener noreferrer\">notion版</a>和<a href=\"https://cdn.jsdelivr.net/gh/taosue/how-to-get-rich-without-getting-lucky@master/%E5%A6%82%E4%BD%95%E4%B8%8D%E9%9D%A0%E8%BF%90%E6%B0%94%E5%8F%98%E5%BE%97%E5%AF%8C%E6%9C%89(%E4%B8%8A)_Naval%20%EF%BC%88%E8%91%97%EF%BC%89%26Jessie%EF%BC%88%E8%AF%91%EF%BC%89.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">PDF版</a>(我就把PDF导进去iPad，在iPad上看书📚)，大家戳戳链接就可以看到了。</li>\n</ol>\n<h2> 第一条：追求财富，而不是金钱或地位</h2>\n<p>Nivi：你可能听说过Naval在推特上进行的那一波主题为“如何在不只依靠运气的情况下致富”的推特风暴（tweetstorm）。我们借助这个播客回顾大部分的推文，给Naval一个机会详细聊聊这些话题。他可能会提出一些以前没有发表过的想法。</p>\n<p>Naval是AngelList创始人和Epinions的联合创始人。他是一位眼光独到的科技投资人，投出了像Twitter、Uber这样的科技公司。</p>\n<p>不只是科技行业的人，各行各业的人都想知道<strong>如何解决他们「钱的问题」</strong>。每个人都隐约地意识到自己想要变得富有，但是他们没有一套好的原则来遵守和践行。</p>\n<h3> 财富是你睡觉时还能产生收入的资产</h3>\n<p>Nivi：财富、金钱和地位有什么区别?</p>\n<p>Naval：财富是你渴望的东西，是你睡觉时还在产生收入的财产。举例来说，财富是在夜间还能运行的为其他客户服务的计算机程序。财富是你存在银行里的钱，用于再投资其他资产和业务。</p>\n<p>房子是财富的一种形式，因为你可以把它租出去，收得租金，尽管这是一种比经营商业企业更低效的土地使用方式。</p>\n<p>我对财富的定义是指那些可以在<strong>你睡觉时依然可以为你赚钱的企业和资产</strong>。</p>\n<h3> 财富的终极目标是自由</h3>\n<p>你渴望财富，是因为它能给你带来自由。也就是说，你不必像白领那样一丝不苟的系领带；你不必早上6点就起床、996挤地铁上下班；你不必把时间浪费在一份没有灵魂，你不喜欢的工作上。</p>\n<p><strong>我们创造财富就是为了自由，仅此而已</strong>。而不是去买毛皮大衣，不是去开法拉利，不是去驾驶游艇，也不是去乘坐湾流飞机环游世界。那些东西很快就会变得无聊和愚蠢。它（财富）是关于<strong>你如何成为你自己的事</strong>。</p>\n<p>除非你真的想要财富，否则你不会得到它。全世界都想要它，全世界都在为此努力。在某种程度上，它是有竞争力的。这是一个正和博弈，但其中也有竞争因素，因为现在社会上的资源是有限的。为了获得资源去做你想做的，你必须脱颖而出。</p>\n<h3> 金钱是我们转移财富的方式</h3>\n<p>金钱是社会信用，它是一种从别人的时间中获得信用和债务的能力。如果我做对了工作，为社会创造了价值，社会会说：“哦，谢谢你。我们欠你一些东西，将来会补偿你。这是我的借条，我们把它叫做钱吧。”</p>\n<p>钱会贬值是因为,</p>\n<ul>\n<li>人们偷了借据</li>\n<li>政府增发货币</li>\n<li>人们违背IOU</li>\n</ul>\n<p>但是金钱试图成为社会的一个可靠的欠条，因为你在为自己的付出而被他人亏欠。我们把这些欠条到处传递，金钱是我们转移财富的方式。</p>\n<h3> 地位是你在社会等级中的地位</h3>\n<p>人生基本上有两大游戏。一个是金钱游戏。钱并不能解决你所有的问题，但它会解决你所有的和钱相关的问题。我想大家都能意识到这一点，所以才想赚钱。同时，在内心深处，许多人认为他们做不到，所以他们不希望任何财富创造发生。他们攻击那些赚钱的企业和企业家们，说他们：“赚钱是罪恶的。你不应该这么做。”但他们实际上在玩另一个游戏，那就是地位游戏。他们试图传递一种信息“我不需要钱，我们不要钱。”</p>\n<p>地位指的是你在社会等级中的地位。</p>\n<p><strong>财富不是零和游戏</strong>。世界上每个人都可以拥有一所房子，你有房子并不会影响我有房子的能力。如果有什么区别的话，建造的房屋越多，建造房屋就越容易，我们对建造房屋的了解就越多，就会有更多的人拥有房屋。</p>\n<p><strong>财富是一个正和游戏</strong>。我们一起创造，努力创造着寄托着我们美好期待的“艺术品”来解释我们正在做的事情。最终，一些全新的东西将被创造出来。这是一个正和游戏。</p>\n<p>另一方面，<strong>地位是一个零和游戏</strong>。这是一个非常古老的游戏。我们从原始人部落开始就玩这个游戏了。也就是等级制度。老大是谁？老二是谁？老三是谁？老三打败了老二，老二就必须让位。所以，地位是一个零和游戏。</p>\n<h2> 第二条：为世界创造更多</h2>\n<p><strong>财富不是从别人那里拿走什么，而是为这个世界创造更多</strong></p>\n<h3> 财富创造带来了世界的丰富</h3>\n<p>Naval：有一种观点认为赚钱是邪恶的，这个说法好像起源于“金钱是万恶之源”。人们认为银行家偷走了我们的钱，这在某种程度上是正确的，在世界上的很多地方，有很多偷窃行为一直在发生。</p>\n<p>从某种意义上说，世界的历史就是创造者和索取者之间的捕食者/被捕食者关系。有些人走出去创造东西，建造东西，努力创造机会。有些人带着剑、枪，或者经济上我们说税收、裙带资本主义，共产主义等等形式，进行着不同形式的偷窃。即使在自然界，寄生生物也比非寄生生物多。你身上有很多寄生虫，它们靠你生存。好的情况是共生，他们会回馈一些东西。但也有很多只是索取。这就是任何复杂系统的本质。</p>\n<p>我关注的是真正的财富创造。这不是仅为了赚钱，不是单纯从别人那里拿东西。</p>\n<p>显而易见的是，工作不是有限的，财富也不是有限的。否则，我们还会坐在洞穴里，琢磨着如何瓜分柴火，或者偶尔运气好时捕食到的一些死鹿。</p>\n<p>人类文明中的大部分财富，事实上是全部财富，都是被创造出来的。它是从某处产生的。它是由人创造，由科技创造，由生产力创造的。它是通过努力创造出来的。这种被窃取的想法是一种可怕的零和游戏，人们试图获得地位的游戏。</p>\n<h3> 每个人都可以变得富有</h3>\n<p>但现实是，每个人都可以变得富有。我们可以看到，在第一世界国家，基本上每个人都比200年前活着的人富有。200年前，没有人使用抗生素，没有人有汽车，没有人能用电，没有人有iPhone。所有这些都是使我们作为一个物种变得更富有的发明。今天，我宁愿在第一世界国家做一个穷人，也不愿在路易十四的法国做一个富人。这是因为财富的创造。</p>\n<p>技术的引擎是科学，其目的是创造丰富性。所以，我认为从根本上来说，每个人都可以变得富有。</p>\n<p>我想让你们想象这样一种情形。如果每个人都掌握一个好的软件工程师和一个好的硬件工程师的技能，你可以自己造机器人，开发程序，自己建桥，并为它们编程。假设每个人都知道怎么做。</p>\n<p>那你认为20年后的社会会是什么样子？我的猜测是，我们会造出各种各样的机器人、机器、软件和硬件来做任何事情。我们都会生活得非常富足。我们基本上就退休了，因为我们都不用为任何基本的东西工作。我们甚至会有机器人护士，会有机器驱动的医院，会有自动驾驶汽车。我们会有100%自动化的农场，会有清洁能源。那时，我们可以利用技术上的突破来得到我们想要的一切。如果有人还在工作，那么他们是在用工作来表达他们的创造力。</p>\n<p>我不认为资本主义是邪恶的。资本主义实际上是好的，它只是被劫持了，被不当的外部成本定价所劫持。它被不正当的收益所劫持，在那里有腐败，或者有垄断。</p>\n<h2> 第三条：自由市场是人类固有</h2>\n<p><strong>我们是唯一跨越基因界限进行合作的动物，因为我们可以在自愿的交换中追踪信用(credit)和债务(debt)</strong></p>\n<h3> 自由市场是人类社会固有的</h3>\n<p>Naval：全面的资本主义(意味着自由市场)是人类社会固有的。资本主义不是我们发明的，甚至不是我们发现的东西。它天然存在于我们的每一次交换中。当你和我交换信息时，你一定想从我这里得到一些信息。如果我们没有良好的信息交流，你会去找别人。所以，交换就是在记录信用和债务，这是我们作为灵活的社会动物与生俱来的本领。</p>\n<p>我们是动物王国中唯一跨越种群进行合作（协作）的动物。大多数动物只会成群合作，共同进化，它们血液相连，所以它们有一些共同的兴趣。人类没有这种成群合作的能力，也不需要这么麻烦。就算你是塞尔维亚人，他是波斯人，我是印度人，没有任何血缘关系，但我们仍然可以合作。</p>\n<p>什么让我们合作？因为我们可以记录借方和贷方。谁投入了多少工作？谁贡献了多少？这就是自由市场资本主义。因此，我坚信这是人类与生俱来的，我们将为每个人创造越来越多的财富。</p>\n<p>每个人都可以变得富有，每个人都可以退休，每个人都可以成功。这只是一个<strong>教育和欲望</strong>的问题。前提是你必须想要它。如果你不想要，没关系，没人强迫你参与游戏。但是不要试图贬低那些积极参与游戏的人。他们没准儿就是那些能让你晚上睡在温暖舒适的床上，让你能更方便的买到全世界的东西，让你能拿着嗡嗡作响的iPhone开心刷抖音的人。因此，这是一场美妙的比赛，值得我们从伦理上、理性上、道德上去挑战一次。它将继续使我们所有人越来越富有，直到我们为任何想要的人创造大量财富。</p>\n<h3> 太多的索取者而没有足够的创造者将使一个社会陷入毁灭</h3>\n<p>Nivi：不只是个人在暗地里鄙视财富，对吧？有些国家、团体和政党公然蔑视财富。至少看起来是这样。</p>\n<p>Naval：没错。这些国家、政党和团体正在沦为一场零和博弈。在摧毁财富创造的过程中，他们把每个人都拉低到和他们一样的水平。</p>\n<p>这就是为什么美国是一个非常受移民欢迎的国家，因为美国梦。显然，不同的人对财富的定义是不同的。第一世界公民对财富的定义可能是，“我一定要赚到数百万美元。而对于第三世界的贫穷移民来说，当刚进入这个国家的时候，我们只是贫穷的移民，对财富的预期值会更低。它可能只是，“我不需要在我的余生做我不想做的体力劳动。”</p>\n<p>但是鄙视它的群体会把整个群体带到和他们一样的水平。如果有太多的索取者，而没有足够的创造者，社会就会分崩离析。你最终会变成一个共产主义国家。看看委内瑞拉就知道，他们不停的忙于获取、分割和重新分配，人们在街上挨饿，每年都因为饥饿而失去几公斤的体重。</p>\n<p>另一种思考方式是想象一个有太多寄生虫的有机体。你需要少量的寄生虫来保持健康。你需要很多的共生体。所有细胞中帮助我们呼吸和燃烧氧气的线粒体。这些是帮助我们生存的共生体。没有他们我们无法生存。</p>\n<p>但是，对我来说，他们（共生体）是一起创造财富的伙伴，共同创造了人类的身体。但是如果你体内充满了寄生虫，如果你感染了蠕虫，或者病毒，或者细菌，而这些都是单纯的寄生，你就会死亡。所以，任何生物都只能抵抗少量的寄生虫。当寄生元素失去控制时，你就死定了。</p>\n<p>我说的还是道德财富创造，不是垄断，也不是裙带资本主义。我说的是自由思想，自由市场。人与人之间的小规模交流是自愿的，不会对他人产生太大的影响。我认为这种财富创造，如果一个社会不尊重它，如果一个群体不尊重它，那么这个社会就会陷入毁灭和黑暗。</p>\n<h2> 第四条：致富与运气无关</h2>\n<h3> 致富与运气无关，要掌握致富的技能</h3>\n<p>Naval：很明显，我们想要在这一生中不只依靠运气变得富有。很多人认为赚钱是靠运气。它不是，关键是你要成为那种能赚钱的人。比如，假设我输光了所有的财产，你把我随便扔到任何一个说英语的国家的大街上，不出5到10年，我就会再次变得富有（笑）。因为这是一种技能，而且我认为每个人都可以拥有这种技能。在1000个平行宇宙中，你想在其中999个里变得富有。你不想只在靠运气成分的50个里面变得富有对吧？</p>\n<p>我们在这讲的运气有四种。这个分类来于一本书，a16z的马克·安德森(Marc Andreessen)在Pmarca.com这个博客中曾经提到过。</p>\n<ol>\n<li>狗屎运</li>\n</ol>\n<p>第一种就是狗屎运。你完全无法控制这种走运，俗话说这就是命好。</p>\n<ol start=\"2\">\n<li>坚持不懈的实干运</li>\n</ol>\n<p>这种幸运来自于坚持、努力、不停的尝试和行动。当你四处奔波创造了各种各样的机会，这期间你输出了很多能量，你做了很多事情，会有大量的能量交换。</p>\n<p>你可能会说，人们只有志趣相投才能聚在一起。那我举另外一个例子，Nenad把他做的很棒的动画视频放到了网上，我在Twitter上看到了它们。从这个意义上说，他通过制作视频创造了自己的运气，直到像我这样的人源源不断找到他。</p>\n<ol start=\"3\">\n<li>早有预备的运气</li>\n</ol>\n<p>第三种方法是你变得非常善于发现运气。如果你在某个领域非常精通，你会注意到在那个领域幸运的事件是如何发生的。当其他人没有注意到它的时候，你会变得对运气敏感，这是通过技能、知识和工作经验的积累达成的。</p>\n<p>4.独特的人格给你带来的好运</p>\n<p>最后一种运气是最奇怪、最艰难的一种，但这就是我们要讨论的。在这里，你建立了一个独特的人格，一个独特的品牌，一个独特的心态，然后好运会找到你。</p>\n<p>例如，假设你是世界上最擅长深海潜水的人。大家都知道，你会进行别人都不敢尝试的深海潜水。然后，有人幸运的在海岸外发现了一艘沉没的宝藏船。他们没办法拿到，只能跑来找你求助。也就是说，他们的运气同时变成了你的运气，你会因此得到非常丰厚的报酬。这是一个比较极端的例子。那个找到宝藏的幸运儿们，走的是狗屎运。但他们不得不来找你帮忙把宝藏拿出来，最终你会得到一部分这里面的财富，这不是运气。也就是说，虽然这个好运的起始不是你，但是你能让那些发现好运的人在关键时刻想起你，很明显你可以在其中起到不可替代的作用。这种情况下你既成就了别人，又分享了他人的好运，这就是你为什么要打造自己独特的个性和品牌。</p>\n<h3> 在1000个平行宇宙中，你想在其中999个里变得富有</h3>\n<p>Nivi：你刚刚提到，在1000个平行宇宙中，你可以在其中的999个变得富有？我想有些人看到后会说：“这听起来不太可能，太夸张了吧。”</p>\n<p>Naval：不，我不认为这是不可能的。考虑到你的起步条件，我认为你可能得再努力一点。我在印度的时候是个穷孩子，所以如果我能成功，从这个意义上说，任何人都能。很明显，我四肢健全，智力正常，当然我也确实接受了教育。也许有一些前提条件不一样，但如果你在听这个视频或播客，说明你已经掌握了基本的技能，而且有一个功能健全的身体和会思考大脑。</p>\n<p>事实上，一路上我其实遇到了很多倒霉事。我赚的第一笔钱，立刻就在股票市场上赔了个精光。我赚的第二笔钱，或者说我应该赚的第二笔钱，基本上都被我的商业伙伴骗走了。这次（成功）已经是第三次了。</p>\n<p>即便如此，财富的积累仍处于缓慢而稳定的挣扎之中。我这辈子还没一次性赚过一大笔钱，总是一大堆小事堆积在一起。它更多的是通过持续的构建商业（做创业公司）、寻找投资机会来持续创造财富。这绝对不是一步登天的事。</p>\n<h3> 财富不是一步登天</h3>\n<p>我的个人财富不是在某一年产生的，它是一点点堆积起来的，每一个阶段积累一点。更多的选择，更多的生意，更多的投资，才能撬开更多自己能做的事情。和Nenad的illacertus一样，他在油管上做了一系列视频，没有任何一个视频会在一夜之间让他一夜暴富，这绝对是一个漫长的过程，学习，阅读，创造，这期间会产生复利效应。</p>\n<p>我们谈论的是变得富有，这样你就可以退休，你就有更多的自由。退休不是说什么都不做。而是说你不必去任何你不想去的地方，你不必做任何你不想做的事，你想什么时候醒来就什么时候醒来，你想什么时候睡觉就什么时候睡觉，没有老板对你指手画脚。这就是自由。我们谈论的是足够的财富来获得自由。特别是由于互联网的普及，机会到处都是。坦白讲，我有太多的方法来赚钱，我满脑子都是想法，唯一缺的就是时间。创造财富、创造产品、创造企业、创造机会，从社会获得报酬的方式太多了。</p>\n<h2> 第五条：你必须有点异乎寻常，才能独自走在前沿</h2>\n<p>Naval在他的博客中还提到了一些关于第四种运气的有趣例子，但我想让读者了解的一点是，第四种运气其实是来自于你异乎寻常（这里用了eccentric这个词）的行为，所以有时候异乎寻常可能并不是一件坏事。</p>\n<p>Naval：没错，因为这个世界非常讲求效率，每个人都在明显的地方挖掘着新奇的、未被发现的东西，这会帮助你建立优势。独自走在前沿可能需要你有点异乎寻常，而且愿意比一般人挖掘得更深，挖掘的更深仅仅因为你感兴趣。</p>\n<p>Nivi：对，除了本杰明·迪斯雷利的那句话外，我看过的两句表达这种运气的话，一个是山姆·阿尔特曼（Samuel Altman）说的，“极端的人才能得到极端的结果。”“我认为这句话很好。还有另一个来自斯坦福大学教授杰弗里·普费弗（Jeffrey Pfeffer）的观点，“你不可能既正常又期待异常回报。”</p>\n<p>Naval：是的。我喜欢的一句与之完全相反的话是，“玩愚蠢的游戏的人赢愚蠢的奖品。”“很多人花很多时间在社交媒体上，比如你试图在Twitter上提高你的社会地位，但你基本上赢得了愚蠢的、价值不大的社交奖项。</p>\n<p>Nivi：我想我从这篇博客文章中得到的最后一个观点是，除了狗屎运，你应该去追求这几种运气（尤其是最后一个），这会让你变得越来越幸运。</p>\n<p>Naval：是的，起码能回归均值（笑）。所以，你至少要中和运气，这样才能更好的发挥你自己的才能。</p>\n<h2> 第六条：出租时间不会让你变得富有</h2>\n<h3> 出租时间不会让你变得富有，因为你不能非线性地赚钱</h3>\n<p>Nivi：接下来你会详细介绍如何致富，以及什么不会有助于致富。第一点是：“出租你的时间不会让你变得富有。<strong>你必须拥有公司的股权，才能获得财务自由。</strong>”</p>\n<p>Naval：这可能是最重要的一点。人们似乎认为你可以创造财富，通过工作致富。这可能行不通，原因有很多。最根本的原因是，你的投入和产出相关性太强。几乎在任何有薪水的工作中，即使是像律师或医生这样每小时报酬很高的工作，你仍然在投入时间，你的报酬是按每小时或工作量计价。因此，这意味着当你睡觉的时候，在度假的时候，你没有在创造财富；一旦你退休了，你就没有收入了（退休金另当别论）。也就是说，你不可能得到非线性的收入。</p>\n<p>如果你看到一些医生非常富有，那是因为他们成立了公司，开了私人诊所。他们通过私人诊所建立了一个品牌，为他们带来持续的口碑和客户。或者他们制造了某种医疗设备或一个程序，且拥有这些东西的知识产权。</p>\n<p>因此，本质上你是在为别人工作，而那个人承担了风险和责任，掌握着知识产权，有品牌。所以，他们不会给你足够的工资，他们会付给你最低工资，让你做他们需要的工作。这可能是一个很高的最低限度，但仍然不是你想象的退休后真正的财富。</p>\n<h3> 出租时间赚钱意味着你很容易被替代</h3>\n<p>最后，你甚至没有为社会创造出那么多原创的东西。正如我所说，这场推特风暴应该被称为“如何创造财富”，只不过“如何致富”是一个更吸引人的标题罢了。因为你现在扮演的是固定的角色，而大多数固定角色的任务是可以教会的。如果他们能像在学校那样被教授，那么最终你将会和一个更年轻的、拥有最新知识的人竞争，这个人注定是要取代你的。</p>\n<p>更可能的是，你做的工作最终会被机器人或人工智能取代。它甚至不需要一夜之间取代，它可以一次替换一点。所以，基本上在出租时间的模式下（也就是打工），投入和产出是匹配的，但我不认为这是真正创造财富的方式。</p>\n<h3> 你必须拥有股权才能获得财务自由</h3>\n<p>所以每个真正想要致富的人在某种程度上都拥有一个产品，一个企业，或者某种知识产权。它可以是股票或者期权，这也是为什么很多人选择在早期科技公司工作。这是一个很好的开始方式。</p>\n<p>但通常真正的财富是通过创办自己的公司，甚至是通过投资来创造的。投资一家公司或者说入股，其实有很多通往财富的路径并不按照小时计数。</p>\n<h3> 追求一份投入与产出“不匹配”的工作</h3>\n<p>为什么你真的需要追求一份投入和产出“不匹配”的工作或者职业，这将会在之后的推特风暴中提到。拥有高创造力和高影响力的企业往往是那些你可以工作一小时的企业，这一小时可能会产生巨大的影响；或者你做了1000个小时的工作，但是没有效果。</p>\n<p>我们拿软件行业为例。一方面，一个伟大的工程师可以创造比特币，创造数十亿美元的价值。另一方面，如果一个工程师一直在错误的方向下功夫，或者做得不够好、不够有创意、深思熟虑等等。就算他辛勤工作整整一年，他们发布的每一段代码最终都不会被使用，他都不会有用户。这是一个投入和产出高度分离的行业的例子，它不是以你投入的时间多少来衡量产出的。</p>\n<p>再举一个极端的例子，假设你是世界上最好的伐木工人，如果你不用工具，或用最简单的工具（比如一把斧子或者一把锯子）伐木，你也只会比最差的伐木工人强三倍，因为投入和产出是有很强的相关性的，不会有很大的区别。</p>\n<p>因此，你要寻找投入和产出高度不相关的职业。这是另一种可以产生杠杆效应的方式。我说的杠杆并不是指华尔街讲的金融杠杆，这个“杠杆”名声不好。我说的杠杆是指工具，人类擅长使用的工具。计算机是软件工程师使用的工具。对于一个伐木工人，如果有推土机、自动机械轴和锯子，他就会使用这些工具，比那些徒手想要把树连根拔起的人更有影响力。</p>\n<p>工具和杠杆是造成投入和产出之间不匹配的原因。一个职业的创造力成分越高，它就越有可能有不匹配的投入和产出。因此，我认为，如果你考虑从事投入和产出高度相关的职业，那在这个过程中，你很难给社会创造财富，也很难为自己创造财富。</p>\n<h2> 第七条：我们应该升级自己的自由，而不是生活方式</h2>\n<p><strong>生活水平远低于其收入水平的人们享受着一种自由，这种自由是那些忙于改善生活方式的人们无法理解的</strong><br>\nNivi：除了把时间租出去之外，还有其他无助于致富的事情吗?</p>\n<p>Naval：有，我之前提到过两条相关的推文。我说的第一个问题是，你的生活方式应该升级，但不应该升级得太快。这句话的大意是说，<strong>生活水平远远低于其收入水平的人享受着一种自由</strong>，而那些忙于提升生活方式的人根本无法体会这种自由。我认为这是非常重要的，不要总是忙于升级你的生活水平。事实上，如果你能在赚越来越多的钱时，保持稳定的生活水平和期望，就不会有太多烦恼。所以，不要总想着住更大的房子，过更奢侈的生活，以及所有类似的贪心。</p>\n<h3> 世界上最危险的东西是海洛因和月薪</h3>\n<p>假设你现在的工资是每小时1000美元，你肯定不是从20美元每小时的月薪立马涨到1000美元，这一定是个漫长职业生涯的积累过程。这里面一个微妙的问题是，你的生活水平会随着你赚的钱越来越多而升级。你会想当然的认为自己赚了钱，就该马上去提升生活水平，但这会使你深陷在工资奴隶的陷阱里。我忘了是谁，可能是纳西姆·塔勒布说的，“<strong>世界上最危险的东西是海洛因和月薪。</strong>”没错，因为它们很容易上瘾。你想要变得富有的方式恰恰是你想要变穷，那时你能做（想做）的事情只有工作，工作，再工作。</p>\n<h3> 理想的情况是，你的赚钱路径是离散的</h3>\n<p>这就是科技产业的运作方式。你十年没赚到钱，然后突然在第11年，你会赚得盆满钵盈。顺便说一下，这就是为什么这些所谓的富人的高边际税率是有缺陷的，因为风险最高，最具创造力的职业一定是，前十年都在赔钱。在冒着巨大的风险时，你会不停的流血，流血，再流血。然后在第11年，或第15年，你可能突然赚到一大笔钱。此时山姆大叔（这里指政府）出现了，说：“嘿，你知道吗，你今年赚了很多钱。因此，你是邪恶的，你必须把一切都交给我们。”因此，它只是摧毁了那些创造性的冒险职业。但理想的情况是，你的致富路径是离散的，循序渐进的。这样你不会期待你的生活水平更新的那么快。一旦你致富之后，你还会选择工作，但你只会在你想做的时候做你想做的事，这才是真正的自由。因此，你会做更多创造性的事情，而减少对钱，对奢侈生活的关注。</p>\n<h2> 第八条：给社会提供它不知道如何获得的东西</h2>\n<p><strong>社会会因为你创造了它想要、却不知道如何大规模获取的东西，而给你丰厚的回报</strong></p>\n<h3> 给社会它需要的，但不知道如何规模化获取的东西</h3>\n<p>Nivi：你不会因为出租时间而发财的。但你说，“你会通过给社会它想要，但不知道如何规模化获取的东西而致富。”</p>\n<p>Naval：没错。所以本质上，就像我们之前说的，钱是社会给你的欠条，你在过去做了一些好事，社会会为你创造它想要的东西而付钱。但社会还不知道如何创造这些东西，因为如果已经被创造了，他们就不需要你了。<br>\n几乎所有在你家里、工作场所和街道上的东西曾经都是科技产品。有一段时间石油是一种科技产品，这让洛克菲勒很富有；有段时间汽车是科技产品，这使亨利·福特富有。因此，正如丹尼•希利斯(Danny Hillis)所说，技术只是一套还不太管用的东西。一旦某样东西成功了，它就不再是技术了。所以，社会总是想要新事物。</p>\n<h3> 想清楚你能提供的产品，然后考虑如何扩大规模</h3>\n<p>如果你想要变得富有，弄清楚你可以为社会提供哪些它想要、但还不知道如何获取的东西。并且是你感兴趣、在你的能力范围内能提供的东西。想清楚之后，下一步你要考虑如何规模化。因为如果你只造一个，那是不够的。你必须建造成千上万个，上百万个，甚至数十亿个。最好的情况是，每个人都可以有一个。史蒂夫·乔布斯和他的团队当然知道社会需要智能手机。他们口袋里的电脑拥有所有电话功能的100倍，而且使用方便。所以，他们想出了如何建造它，然后他们想出了如何扩展它。他们想出了如何让每个第一世界国家的公民，最终也让每个第三世界国家的公民，都能拥有一个。正因为如此，他们获得了丰厚的回报，苹果是世界上最有价值的公司。</p>\n<p>Nivi：我想说的是，企业家的工作是为大众市场带来高端产品。</p>\n<p>Naval：它以高端开始。首先，这是一种创造性的行为，<strong>你创造它只是因为你想要它</strong>。你想要它，需要它，所以你知道如何建造它。其实一开始<strong>你是为自己建造它</strong>。然后你要想办法把它带给其他人。然后有一段时间，富人拥有它。比如，富人有私人司机，他们有黑色高档汽车。然后优步（Uber）出现了，它让每个人都有自己的私人司机。现在你甚至可以看到Uber pool正在取代穿梭巴士，因为它更方便。然后scooter共享电动滑板车出现了，市场进一步下沉。所以规模化需要考虑的是，<strong>如何把曾经只是富人拥有的东西给到给每个人</strong>。</p>\n<h2> 第九条：互联网极大地丰富了职业发展的可能性</h2>\n<p><strong>互联网会给你的小众兴趣找到买单的人</strong></p>\n<h3> 互联网极大扩展了职业发展的可能性</h3>\n<p>Nivi：让我们看看下一条推文，这也是我觉得对于你将从事什么工作或者职业非常隐秘和超级有趣的推文。你说：“互联网极大拓宽了职业发展的可能性，但是大多数人目前并没有察觉到。”</p>\n<p>Naval：互联网最根本的颠覆性是，它使这个星球上的人们能彼此联系，任何一个人只要你想联系总有方法。不论是给他们发邮件，在Twitter上发送推文，还是在Facebook上发布一点他们能看到的动态，或者建立一个他们能来访问的网站。互联网将每一个人都联系在了一起。因此互联网是一个将各个网络连接起来的工具，这就是它的超能力。因此，工具给你了，你要思考怎么去更好的利用它。你要明白，借助互联网，你就总能为你的产品、你的才能、你的技艺找到观众，不论他们来自哪里。</p>\n<p>举个例子，Nenad制作了IIIacertus，试想一下，如果你是在互联网出现之前看到的他的视频，那么他需要怎么做才能让你看到呢？他可能抱着电脑挨家挨户展示给他的邻居们看？或者跑到当地的电影院播放？这都是不可能的，他只有把视频放到互联网上才能达到这个效果。然后在这个世界上又有多少人对它真正的感兴趣呢？或者只是对我们正在讨论的东西感兴趣，真正的吸收？结果会发现只有很少一部分人，所以关键就在能触动<strong>这些人</strong>。</p>\n<h3> 互联网能让你的小众兴趣找到观众</h3>\n<p>互联网最怪异的一点是，它允许各种小众兴趣存在。这就好像养蛇的人、喜欢坐热气球的人、喜欢一人独叶孤舟航游世界的人，亦或是痴迷于微型烹饪的人。就像整个日本的微型烹饪现象一样（哈哈今天刚刚看了一本日本烹饪书叫鸡蛋料理），或者像有一个节目是关于女人帮人收拾家务的节目，对吧？</p>\n<p>因此，无论你拥有多么小众化的兴趣，互联网都能提供给你一个很好的平台去把它规模化。当然，这也不是说你所做的就是下一个Facebook，或者你能获得数以十亿计的用户，但是，如果你仅仅想找到5万个和你一样满怀热情的人，互联网中就有这样一群观众等待着你。</p>\n<p>这个问题的绝妙之处就在于，我们生活的星球上有70亿的人。人类DNA的组合方式达到了难以想像的程度。每个人都是一个完全不同的个体，你不可能遇到另一个一模一样的你。</p>\n<p>这不像你可以说，“恩...，Nivi，离开我的生活吧。这样我可以让Naval进入我的生命中，我就可以有和他同样的感受，得到同样的赞许，有同样的想法。”但事实不是这样的，任何人不是别人的替代品，人与人完全不同的。因此，正是因为每个人有不同的技能、兴趣，才可以在自己独特的事物上发挥创造力。</p>\n<p>但是（在互联网）之前这些并不重要，在前互联网时代，如果你住在意大利的一个小渔村，你的渔村并不一定需要完全独特的技能，那么你就必须遵从现实，从事仅有的工作。但是今天，你可以变得完全独特和独立。</p>\n<p>互联网可以让你低成本的「走出去」，找到属于自己的观众。然后你通过创建业务、创造产品、积累财富，你通过在互联网上展现独特的你让大众获得快乐。你事业的发展空间就会因互联网而扩大，电子竞技玩家，在Fortnite上赚了数百万美元。YouTube广播公司、 博客、播客，让人们能够创建内容和上传视频。我听说乔·罗根（Joe Rogan），他的播客有20亿次下载，这为他每年带来约1亿美元的收入。</p>\n<p>再举一个PewDiePie的例子，前几天，我转发了一条有趣的推文。PewDiePie在新闻媒体中简直就是信任的代名词。这个来自瑞典的小孩，他的热门新闻频道的流量是主流有线网络流量的三倍。而且这仅仅是在他的新闻频道上， 还不算他的娱乐频道。</p>\n<p>可以说互联网为各种小众兴趣提供了沃土，但前提是你要擅于将其壮大发展起来。当然，好消息就是每个人生而不同，每个人都有自己擅长的东西。所以要真实做自己。</p>\n<h3> 通过做自己来规避无意义的竞争</h3>\n<p>还有一条值得一提的推文，它没有被收录到这个推文风暴中。那条是“通过做自己来规避无意义的竞争”。事实上，当你在与人竞争时，往往是因为你在复制别人，因为你在努力干着同样的事情。但是其实每个人生而不同，不要总是忙着复制别人。</p>\n<p>很明显，人类喜欢模仿，René Girard有一套完整的模仿理论很有趣。大家都觉得模仿简单，但其实模仿远比你做自己要难。所以不要纯模仿，不要纯复制，专注于做自己的事情，当你真正在做自己时，你就会发现没有人能和你竞争，就是这么简单。</p>\n<p>因此，你对你自己是谁和你喜欢做什么认识的越深入，你就会面临越少的竞争。也就是说，当你意识到真实做自己没人能和你竞争后，你就能够通过真实性逃离竞争陷阱。但是，这在前互联网时代是没用的建议，而后互联网时代你能将这些变成现实。</p>\n<h2> 第十条：寻找财富游戏中的长期战友</h2>\n<p><em>选择一个你可以和长期伙伴玩长期游戏的行业，所有的回报都来自于多次游戏的复利。</em></p>\n<h3> 寻找财富游戏中的长期战友</h3>\n<p>Nivi：我们来聊聊应该考虑在哪些行业工作？应该做什么样的工作？最好和什么样的人一起工作？这些话题。你说过，“你应该选择的行业是，在这里你有长期战友和你玩长期的游戏。”</p>\n<p>Naval：是的，<strong>这是解释为什么硅谷会成功，也是对高信任度社会能够成功的深刻理解</strong>。事实上，生活中所有的收益都来自于复利。无论是在人际关系中，创造财富中，或是在学习中。因此，复利是一种神奇的力量，如果你以1倍的价格开始，然后如果每年增长20%，并且持续30年，你得到的不只是额外的30年乘以20%。它有复利效应，所以它会增长，增长，增长，最后你得到的回报将会不可思议。不管是善意、爱情、人际关系还是金钱。所以，我认为复利是一种非常重要的力量。</p>\n<p>为什么致富是一场持久战？长期博弈不仅对复利有利，对信任也有利。如果你看一下囚徒困境类型的游戏，囚徒困境的一个解决方案是以牙还牙，也就是我将对你做你上次对我做过的事，如果你犯了错，我会原谅你。但这只适用于重复的囚徒困境的环境中，换句话说，如果我们重复玩一个游戏多次。</p>\n<p>因此，如果你处在这样一种情况下，比如你在硅谷，人们在那里互相做生意。他们彼此了解，相互信任，互相帮助，因为他们知道这个人会在下一场比赛的回合中出现，你迟早会遇到这些人。</p>\n<p>当然，这并不总是奏效。也有情况是，有的人在硅谷一举成名，赚到很多钱，但人们会背叛彼此，因为他们只是想，“我要靠这个发财，我不在乎。”所以，所有这些情况都有例外。</p>\n<p>但本质上，如果你想成功，你必须与他人合作。你必须知道谁可以信任，谁可以长期信任，和你一起在游戏中走下去。所以「复利效应」和「高度信任的圈子」就是你在游戏中生存的武器，同时也是在游戏的周期结束时，让你获利的主要原因。例如，沃伦巴菲特作为美国股票市场的投资者做得非常好，但他能做到这一点的重要原因是因为美国股市一直保持稳定，并且没有碰到美国政府政局非常差的时期，或者是战争时期。总之底层基础设施没有被破坏。因此，对于他来说，他正在玩一场长期比赛。这种信任来自于美国股市的稳定。</p>\n<h3> 当你转行时，你是在从零开始</h3>\n<p>在硅谷，信任来自于小范围内的人际网络，随着时间的推移，你会发现哪些人是你可以合作的，哪些人是你不能合作的。</p>\n<p>如果你不停地更换地点，你就不停地更换团队……假设你从木工行业起步，并在那里建立了一个网络。你努力工作，你试图在木工行业制造产品。然后突然出现了另一个相邻但又不同的行业，但你真的并不了解其中的任何一个人，你想要投身其中，在那里赚钱。如果你持续在工业界跳来跳去——不，实际上我需要打开一系列电动汽车加油站。——这或许有道理。这可能是最好的机会。但是每次你重置时，每次你跳出原来的网络圈时，你都将从零开始。你不知道该相信谁，而且他们也不会很容易相信你。</p>\n<p>当然也存在短暂的行业。他们总是进进出出。政治就是一个例子，对吧？在政治上，新人正在当选。你在政治上会看到，有很多老前辈的地方，比如参议院，这里有在这个行业中已经生存很长时间的人，他们都是职业政治家。对于职业政治家有很多不利因素比如腐败。但好处是他们实际上已经完成了彼此的交易，因为他们知道另一个人将在十年之后处于相同的位置，他们将不得不继续与这些老前辈打交道，所以他们最好学会如何合作。众议院每两年都要举行一次大型选举，选出一批新的众议员，由于一直在相互竞争，几乎任何事情都没法完成。“因为我刚来到这里，我不认识你，我不知道你是否会继续在身边，我为什么要和你合作，而不是只是尝试做我认为正确的事情？”</p>\n<p>因此选择一个你能长期从事的行业、以及长期伙伴是非常重要的。这些人会表明他们会在你身边存在很久，他们是有道德的，他们的道德信条能从他们的行动上体现出来。</p>\n<h3> 长期游戏中，每个人都在让彼此更富有</h3>\n<p><strong>Nivi：在长期游戏中，似乎每个人都在让彼此更富有。而在短期游戏中，似乎每个人都在让自己更富有</strong>。</p>\n<p>Naval：我认为这是一个很棒的形容。在长期游戏中，这是一个正和现象。就好像大家在一起烤一个苹果派，大家都在努力尽可能将它做得越大越好。在短期游戏中，我们是在想方设法分这个派。</p>\n<p>现在这不是在为社会主义者辩解，对吗？这些社会主义者不是参与烘焙派的人，他们最后出现，说”我想要一片，或者整个派。“他们出现时是带着枪的。但是我认为一个好的领导者并不能赢得荣誉。一个好的领导者基本上都在努力激励员工，这样团队才能将工作完成。然后，奖励将按照公平原则进行划分，谁贡献了多少（或尽可能接近）并承担了风险，而不是谁拥有最长的刀…谁有最锋利的刀。</p>\n<h3> 收益来自重复游戏的复利</h3>\n<p>Nivi：因此，接下来的两个推文是，“玩迭代游戏。生活中的所有的回报，不论是财富上的，还是人际关系上的，或者是知识上的都来自复利效应。”</p>\n<p>Naval：当你与一个相处了十年，二十年，三十年的老友做生意时，你根本不需要信任他，事情也可以做得越来越好。因为在相处过程中摩擦逐渐减弱，你们可以一起做越来越大的事情。</p>\n<p>举个极端的例子，最简单的方法是与某人结婚，生孩子然后养孩子，这就是复利（笑）。投资于这些长期的关系，与更随意的关系相比，这些关系最终是无价的。</p>\n<p>在健康和健身方面也是如此。 你的身体越健康，保持健康就越容易。 而你的身体恶化的越多，就越难回到正常的水平。</p>\n<h2> 第十一条： 选择智慧、精力充沛和正直的合作伙伴</h2>\n<p><strong>选择高智商、精力充沛、为人正直的伙伴是你不能妥协的三要素</strong></p>\n<h3> 选择高智商、精力和正直的商业伙伴</h3>\n<p>Naval：在挑选同事方面，选择那些高智商、精力充沛、正直的人，这是你不能妥协的三个要素。</p>\n<p>你需要和聪明的人共事，至少他们不是在错误的方向上一路向西。你需要与精力充沛的人共事，因为世界上到处都是聪明却懒惰，光想不干的人。在生活中，我们都认识一些非常聪明的人，他们可以不起床，或者动一动手指就完成很多事情。我们也知道有些人精力很旺盛，但并不聪明，他们工作非常非常努力，但有时在朝着错误的方向埋头苦干。smart不是一个贬义词。这并不是说有人聪明，有人愚蠢。我想表达的意思是，每个人在不同的事情上会表现出很聪明的一面。因此，取决于你想做什么，你才可以找到在这方面很聪明的人来帮你。</p>\n<p>然后关于精力，很多时候人们对特定的事情没有动力，但对其他事情有动力。例如，有人可能真的没有动力一天都坐在办公室里工作。但他们可能真的有动力去画画，对吧?</p>\n<p>嗯，那样的话，他们应该是画家。他们应该把自己的艺术放到网上，试着探索如何以此为基础建立自己的事业，而不是认命了，戴着项圈，去做一份乏味的工作。这一定是一个长期的事情，很多人在兴致勃勃的发布第一个作品后，发现没有立马收获1w+粉丝的关注而对自己大失所望，然后以此为由失去动力就放弃了。我想说的是，<strong>做一件事情的动力终究来自于你自己到底想做什么，觉得什么有意义，而不是为了讨好别人</strong>。</p>\n<p>最后一点是正直，正直是最重要的，如果只有另外两个品质，你就选择了一个聪明、勤奋的骗子，他最终会欺骗你。所以，你必须弄清楚这个人是否正直。</p>\n<p>我之前说过，你要通过信号判断。信号是他们做什么，而不是他们说什么。当他们认为没有人在看他们时，他们会做一些非语言的事情。</p>\n<h3> 动机必须是内在的</h3>\n<p>Nivi：Sam Altman之前有个有趣的观点，当谈到委任时，他说：“委任的关键在于，让人们做他们<strong>擅长同时是你想让他们做的事情</strong>。”这个道理显而易见，你会和那些自然会做你想让他们做的事情的人合作。</p>\n<p>Naval：是的。如果我认为他们不喜欢我想让他们做的事情，我几乎不会创办公司，不会雇人，也不会和别人一起工作。</p>\n<p>当我年轻的时候，我常常试着说服别人。但事实证明，你可以说服某人帮你做一件事，但是有时候你不能。你无法让他们保持动力。你可以在一开始就给他们灵感，但除非你是像亨利五世那样的国王，拥有那样的权力指使别人做事情。但如果你想让人们长期保持动力，这种动力必须是内在的。你不能只是创造它，如果他们没有内在的动力，你也不能成为他们的拐杖。所以，你必须确保员工精力充沛，愿意做你希望他们做的事，愿意和你一起工作，一起创造。</p>\n<h3> 诚信反映在一个人的行为，而不是他说了什么</h3>\n<p>解读信号非常非常重要。信号不是人们说什么，而是他们做了什么。因此，注意细微的信号是很重要的。举个例子，比如在公众场合，如果有人对服务员态度非常不好，那么他们对你不好只是时间问题。如果有人压制了一个敌人，并对他们怀恨在心，那么他们把你从朋友重新定义为敌人只是时间问题，你会感受到他们的愤怒。所以，愤怒，愤怒，报复，短视的人在现实生活中的很多互动中都是这样的。人们奇怪地一致，至少身体很诚实。所以，你想找到长期合作的伙伴，你要找的是那些似乎没有理性道德的人。</p>\n<p>举个例子，我有一个朋友，他的公司是我投资的，但是公司接近倒闭，他本可以把所有的投资者都鸽了。但他不断地投入越来越多的个人资金，直到公司最终又站起来。在这个过程中，他从未让投资者血本无归。为此我一直很感激他。我说，“哇，你对投资人这么好真是太棒了，你没有坑他们。他觉得被冒犯了。他说：“我这样做不是为了你（投资人），是为了我自己。这关乎我的自尊，是我真正关心的东西。”这种人才是你想要共事的人。</p>\n<p>另一个我喜欢的引用，是我另一条相关的推特。我是在别的地方读到它，但是我稍微修改了一下。</p>\n<p>“<strong>自尊是你对自己的评价</strong>”。</p>\n<p>好人，有道德的人，容易共事的人，可靠的人，往往有很高的自尊，因为他们对自己的声誉非常在意，他们深刻的明白声誉的重要性。</p>\n<h2> 第十二条：与理性的乐观主义者合作</h2>\n<p><strong>不要与愤世嫉俗者和悲观主义者为伴：他们总是以自我为中心</strong></p>\n<h3> 不要与悲观主义者为伍</h3>\n<p>Nivi：最后一条推文。你说：“不要与愤世嫉俗者和悲观主义者为伍。他们总是自以为是。</p>\n<p>Naval：是的。本质上，要创造事物，你必须是一个理性的乐观主义者。理性的意思是你必须看清世界的真相。<strong>但你必须对自己的能力保持乐观</strong>，对自己想要完成的使命保持乐观。</p>\n<p>我们都知道有些人总是很悲观，他们会否定一切。每个人的生活中都有乐于助人的批判者，对吧？他认为他是在帮忙，但实际上他只是在批评（就像我所说的专业的评论家），而且他对每件事都很失望。这样的人不仅在他的生活中不会成就任何伟大的事情，他们还会阻止周围的人做一些伟大的事情或有大胆的想法。他们往往享受挑刺儿的快感，但从未想过提供更好的解决问题的方案，对，他们就是只说不做。有一句经典的军事台词：“要么当头儿，要么服从，要么滚。”这些人想要第四种选择，他们不想当领导，不想跟随，但又不想让路。他们就是想方设法告诉你为什么这事儿行不通。</p>\n<p>我认识的所有真正成功的人都有很强的行动力，<strong>他们只是做事。判断一件事是否可行的最简单方法就是去做</strong>，至少做第一步，第二步，第三步，然后再决定下一步。</p>\n<p>因此，如果你想在生活中取得成功，创造财富，或者拥有良好的人际关系，或者保持健康，甚至是快乐，你需要有一种超强的行动力，这样才能获得你想要的。</p>\n<h3> 与理性的乐观主义者合作</h3>\n<p>你要对合理的东西保持乐观。众所周知，没有什么比一个鲁莽的人去追求不值得的东西更糟糕的了。这就是为什么我说“理性”的乐观主义者。你需要在了解所有的陷阱，知道事物不利的一面的情况下，依旧保持乐观。</p>\n<p>每个人只在这个星球上活一次，为什么不试着做点大事呢？这就是埃隆·马斯克这种人的牛逼之处，我认为他之所以能激励这么多人，是因为他承担了非常、非常大胆的责任和使命。他为人们树立了一个树立远大理想的榜样。即使是做一些小东西也要花很多功夫。我不认为街角杂货店老板的工作强度比埃隆·马斯克(Elon Musk)低，也不认为他付出的汗水和辛劳比马斯克少，甚至更多。无论是教育水平还是所处环境，不管什么原因，他们没有机会去想那么多，所以影响力就不那么大。因此，最好还是想得远一点。当然还是要理性地，在你的能力范围内保持乐观。</p>\n<p>愤世嫉俗者和悲观主义者，他们真正想说的是，这很不幸，但他们基本上是在说，“我放弃了。我想我什么都做不了。所以对我来说，这个世界就像一个没有人能做任何事的世界。”所以他们不理解别人为什么费劲儿地要去做一些事情。</p>\n<h3> 我们是悲观主义者的后代</h3>\n<p>Nivi：也许做一个不理性的乐观主义者或做一个理性的愤世嫉俗者可能更好。</p>\n<p>Naval：对于为什么你应该成为一个乐观主义者，有一个完全理性的框架。历史上，如果你回到2000年，5000年，10000年，两个人在丛林中漫步，他们听到了老虎的声音。一个是乐观主义者，说，“哦，它不是朝我们这边来的。另一个说：“我是个悲观主义者，我要离开这里。”悲观的人跑了，活了下来，乐观的人被吃掉了。</p>\n<p>我们是悲观主义者的后代，我们天生就是悲观主义者。但现代社会要安全得多，没有老虎在街上游荡，虽然你应该避免彻底破产，但你最终不太可能一无所有。</p>\n<p>我想分享的理念是，对于一个人来说，<strong>他的境遇是有下限的，但上限却很难说</strong>（白话说是你很难饿死，但是成功却不可限量）。因此，适应现代社会意味着要克服你的悲观情绪，做出稍微不理性的乐观押注，因为如果你创办下一个SpaceX、特斯拉(Tesla)或优步(Uber)，你可以为社会和自己创造数十亿美元的价值，并改变世界。</p>\n<p>“<strong>如果你失败了，有什么大不了的？你损失了几百万美元的投资人（VC）的钱，而他们还有更多钱，这就是他们对你成功的赌注。</strong>”</p>\n<p>对过去悲观是有道理的，对今天保持乐观是有意义的，尤其对于这么多受过高等教育且生活在第一世界国家的人，甚至是第三世界国家的人。我反而认为第三世界国家的经济机会要大得多。</p>\n<p>当然，你必须注意的一件事就是，不要做任何违法的事情，远离可能会带来灾难性的损失的事。尽可能不做对身体有害的事情，注意你的健康。远离那些会让你失去所有资本和储蓄的事情。</p>\n<p>因此，不要孤注一掷。但理性乐观的押注会带来巨大的好处。</p>\n<h2> 第十三条：用特殊技能（Specific knowledge）武装自己</h2>\n<p>Naval：如果你想变得富有，你需要想办法获得“规模化”的收入，而不是仅仅期盼每个月的工资。责任感决定了你的客户为什么选择你，杠杆效应决定了它可以被规模化。为什么大家要付给你钱而不是给别人，这需要<strong>特殊的技能</strong>。这里提到的特殊技能可能是整个推特风暴中最难传达的东西，也是人们可能最困惑的部分。</p>\n<p>人们普遍持有一种观点是，任何事情都可以从学校学来，都可以“被传授”，但事实上最有价值的事情不是教来的。但好在任何事情都可以学，大部分情况下你想学的东，要么来源于你的兴趣或DNA，要么是源于你从小养成的一些习惯，这些在之后非常难被“教”会；当然也可能是一些全新的东西，所以没有人知道怎么做；或者在工作培训中也是如此，你在高度复杂的环境中进行各种尝试，在一个特定的领域建立判断。典型的例子就是投资，但也可以是其他方面。可以是开拖拉机的技巧，也可以是预测天气的能力。</p>\n<p>因此特殊技能就是你特别关注的技能，尤其是你已经到了20、21、22之后，你几乎就不用去选你需要什么样的特殊技能了。你需要做的就是回顾之前的人生经历中，你建立了什么样的技能是你觉得可以着重被发展的。</p>\n<h3> 特殊技能无法被训练出来</h3>\n<p>特殊技能不是教出来的。如果学校可以教这些东西，那么其他人也可以接受培训，然后我们就可以大规模生产和大规模培训人员。我们甚至可以编程让电脑来做，让机器人来做。如果是这样的话，你就很容易被替代。当有无数的人可以经过培训做这件事的时候，雇主支付给你的只是最低工资，为的就是让你做“这件事”。<strong>你获得的收入=投资培训所产生的回报-培训你的成本</strong>。</p>\n<h3> 特殊技能与你的兴趣高度相关</h3>\n<p>举个例子，一个人拿到了心理学学位后，成为了一名销售人员。如果他已经拥有比较好的销售技巧，那么心理学就可以作为一种杠杆，使他在销售上做得更好。但如果他一直是一个内向的人，从来都不擅长销售，他们试图用心理学来学习销售，他们不会做得很好。因此，你会发现更多的特殊技能是通过认识到你的天赋、你真正的好奇心和你的热情而建立起来的。不是为了最热门的工作去上学，也不是盲目进入投资人认为的最热门的领域创业。</p>\n<h3> 特殊技能往往处于知识的边缘</h3>\n<p>它也是一些刚刚被发现或者很难被发现的东西。因此，如果你不是100%的投入，其他人会比你做得更好。他们不会比你好一点点，他们会比你好很多，因为现在我们正在运营创意领域，非常适用于复利，适用于杠杆。如果你的杠杆率为1000倍，有人在80％的时间都是正确的，而其他人在90％的时间都是正确的，那么90％的时间正确的人将因为市场的杠杆作用和复利获得数百倍的报酬。因此，如果你想确保自己在这方面具有优势，真正具有好奇心非常重要。</p>\n<h3> 建立特殊技能对你来说就像游戏</h3>\n<p>很多时候，它不是你坐下来然后推理的东西，它更多的是通过观察发现的。你几乎不得不回顾自己的生活，看看自己到底擅长什么。例如，我想成为一名科学家，所以我所坚持的价值观都是围绕着「科学家」来建立的。我认为真正的科学家处于人类生产链条的顶端，他们做出了真正的突破和贡献，对人类社会的贡献可能比任何其他阶层的人都要大。当然，我并不是说艺术、政治、工程或商业等贡献小，但如果没有科学，我们仍然会在泥土中挣扎，用棍子打架，每天忙着生火。我的整个价值体系都是围绕着科学家建立的，我想成为一名伟大的科学家。</p>\n<p>但当我真正回头看我擅长的东西，以及我最终把时间花在了什么事情上时，我发现更多的是围绕着赚钱，钻研技术，卖东西（思想），解释事情，和人们交谈。所以，我有一些销售技巧，这是一种形式的具体知识；我有一些关于如何赚钱的分析技巧；我对数据足够敏感，有收集数据，整理并分析数据的能力，这也是我的一个特殊技能。当然我也喜欢摆弄技术。所有这些对我来说都像是游戏，但对其他人来说却是工作。</p>\n<p>有些人会觉得这些事情很难，他们会说，“好吧，我怎么才能变得善于表达和推销想法呢?”如果你不是很擅长，或者你不是很喜欢，也许这不是你的专长，专注于你真正喜欢的事情。</p>\n<p>有点讽刺的是，第一个指出我真正擅长什么的人是我的母亲。她是在厨房里说这些话的，当时我大概15、16岁。当我在和一个朋友说我想成为一名天体物理学家，她说：“不，你更适合去经商。”</p>\n<p>我一脸懵逼，“啥？我妈妈不知道她在说什么吧。”</p>\n<p><strong>但事实上，妈妈当然知道她在说什么</strong>。她已经注意到，每次我们走在街上，我都会批评当地的披萨店，为什么他们要用特定的配料和特定的方式出售披萨，为什么他们点披萨的过程是这样的，而实际上应该是那样的。因此，她知道我对商业更有好奇心，到后来与我对科学的痴迷结合起来，创造了技术和科技企业，我才发现了真正的自己。因此，你的特殊技能可能是由那些了解你的人观察到的，而且经常是由那些了解你的人观察到的。</p>\n<h2> 第十四条：特殊技能（specific knowledge）极富创造性或技术性</h2>\n<h3> 特殊技能能通过课程传授获得</h3>\n<p>Naval: 如果说特殊技能可以被传授，那就是在工作中，通过学徒制。这就是为什么最好的企业、最好的职业是学徒或自学的职业，因为这些都是社会还没有弄清楚如何培训以及使其批量自动生产的事情。这方面的经典例子是沃伦·巴菲特从学校毕业后去找了本杰明·格雷厄姆。本杰明·格雷厄姆（Benjamin Graham）是《聪明的投资者》（Intelligent Investor）一书的作者，可以说他将价值投资发展成了一套理论并将其发扬光大。巴菲特去找了本杰明·格雷厄姆，并主动提出<strong>免费</strong>为他工作。</p>\n<p>但格雷厄姆说：“你开的价格太高了，免费恰恰是一种高价格。”格雷厄姆说得没错。就像后来1954年时格雷厄姆决定要与巴菲特共事时（给予他学徒机会），巴菲特给他多少钱都不为过。</p>\n<h3> 特殊的技能具有高度的创造性或者技术性</h3>\n<p>特定的技能也往往具有技术性和创造性。它在技术的前沿，艺术的前沿，交流的前沿。再举个例子，在今天，互联网上有一些梗王能够创造出令人难以置信的梗，并将这一想法传播给数百万人。斯科特·亚当斯（Scott Adams）就是一个很好的例子，他通过有说服力的文字和视频做出准确的预测，基本上正在成为世界上最可信的人之一。</p>\n<p>这是他多年来积累起来的特殊技能，因为他年轻时就沉迷于催眠，他通过漫画学会了如何沟通，并很早就开始用直播平台Periscope，所以他一直在练习和人对话，他读过所有关于这个话题的书，他将工作融入到生活的点点滴滴。</p>\n<p>这是一个在职业生涯中积累了特殊技能的人的例子。它具有高度的创造性，它具有技术性的元素，而且它永远不会被机器自动化所取代。<br>\n没有人会把这一点从他身上夺走，因为斯科特·亚当斯（Scott Adams）为了发展自己的品牌也尽心尽力。他积极地创作Dilbert系列卡通画、写书，并懂得借助Periscope直播平台的媒体优势运作。他在这个品牌上拥有巨大的影响力，如果他想在现有的基础上创造更多的财富，他现在积累的东西就他的杠杆。</p>\n<h3> 特殊的技能特定于个体和情境</h3>\n<p>Nivi：我们应该称之为独特的知识还是特殊的技能更贴切？</p>\n<p>Naval： 我很小的时候就提出了这个框架，当时特殊的技能就一直伴随着我，我没有尝试改变它是因为我所发现的每一个术语都以不同的方式夸大其词。至少特殊的技能（specific knowledge）这个词没被过度消费，因此我可以赋予他新的含义。独特知识的问题是，是的，也许它是独一无二的，但是如果我从别人那里学到它，它就不再是独一无二的，那么就是我们都知道的东西了。所以，与其说它是独一无二的，不如说它是高度依附于现实的，根据个体的实际情况，根据具体问题存在的，它只能依赖于在这个领域中极度的痴迷、兴趣和所花在这个领域的时间来获得。它不能仅仅从一本书中直接读出，也不能在只在一门课程中获得，也不能被设计成一个算法。</p>\n<h3> 特殊技能不能刻意获得</h3>\n<p>Nivi：说到斯科特·亚当斯，他在博客上发表过一篇文章叫做「努力在2个或以上的领域做到前25%」的文章。在此摘录一段：</p>\n<blockquote>\n<p>如果你想要一个普通的成功的生活，不需要太多的计划。只要远离麻烦，去上学，申请你可能喜欢的工作。但如果你想要与众不同的东西，你有两条路:</p>\n<ol>\n<li>成为某方面的最牛逼的人（世界第一梯队）</li>\n<li>在两件或两件以上的事情上变得非常优秀(前25%)。</li>\n</ol>\n<p>第一种策略几乎是不可能的。很少有人能在NBA打球，也很少有人能出一张白金唱片。真的很难，我不建议任何人去尝试。</p>\n<p>第二种策略相当简单。每个人都至少有几个领域是他们可以努力进入前25%的。就我而言，我比大多数人画得都好，但我算不上艺术家。我并不比一般的单口相声演员更幽默，虽然我从来没有成功过，但我比大多数人都更幽默。神奇的是，很少有人能画得很好，也很少有人能写笑话。正是这两者的结合，让我的作品变得如此罕见。当你再加上我的商业背景，我突然有了一个很少有漫画家不亲身经历就能理解的话题。</p>\n<p>我总是建议年轻人成为优秀的演说家(前25%)。任何人都可以通过练习来做这件事。如果你把这种才能加到其他任何一种才能上，你就会突然成为那些只有一种才能的人的老板。或者在你的工程学位、法律学位、医学学位、科学学位或其他任何学位的基础上再获得一个商学学位。突然之间，你掌握了主动权，或者你正在利用自己的综合知识创办自己的公司。</p>\n</blockquote>\n<p>因此，不要试图在一件事情上做到最好，这太难了。你需要尝试在三件或更多的事情上做到非常优秀。这是一种获得特殊技能的方式吗？</p>\n<p>Naval：我认为最好的方法就是追随自己的内心真正喜欢的事物。在你脑海的某个角落，你会意识到，事实上，这个方面我喜欢，我会留意它的商业方面的可能性。</p>\n<p>但我认为，如果你单单为了获得「特殊技能」无病乱投医，或过于以目标为导向地关注钱，那么你不会选择做正确的事情，不会选择你喜欢做的事，所以你不会真正深入进去。根据统计数据，斯科特・亚当斯的观察结果很准。就知识而言，今天有 10,000 个对人类有价值的区域，这 10,000 个区域中排名第一那些位置已经被抢占了。除非你碰巧成为各种领域最痴迷的一万人之一，否则其他人可能会成为这万人中的第一人。</p>\n<p>当你开始把3728种一流的销售技巧和很好的写作技巧以及一个非常了解会计和财务的人结合起来，当这个交叉点的需求到来时，你已经通过组合数学从10000扩展到了数百万或数千万。所以，它只是变得没有竞争力。此外，收益在递减。因此，在三四件事上成为前25%要比在某件事上成为世界第一容易得多。</p>\n<h3> 在你擅长得领域建立自己的特殊技能</h3>\n<p>natural是天生的、本来的意思，这里翻译成擅长的。我认为这是一个非常务实的方法。但最重要的是，我认为一个人不要太刻意地开始积累，因为你内心其实是想挑选你最擅长的东西。每个人都有与生俱来的擅长的东西。</p>\n<p>我们都很熟悉这句话，一个有天赋的人。“哦，这个人是天生的与人为善的人，这个人就是社交名媛的料，这个人是天生的程序员，这个人是天生的读者。”所以，不管是干什么的料，你都会想着在这方面加倍努力。</p>\n<p>因为人类的个性非常复杂，你可能在很多方面都很有天赋。如果把你在这些方面的天赋结合起来，这样你就可以自动地，仅仅通过纯粹的兴趣和享受，在很多事情上，最终达到25%，10%甚至5%的最高水平。</p>\n<h2> 第十五条：学会销售，学会建造</h2>\n<p><strong>如果你两者都能做到，你将势不可挡</strong></p>\n<h3> 学会销售，学会建造</h3>\n<p>Nivi：谈到技能组合，你说过你应该“学会销售（Sale），学会建造（Build），如果你两者都能做到，你将势不可挡。”</p>\n<p>Naval：这是一个非常广泛的范畴。其中之一是开发产品，即建造。这很难，而且定义很多元。它可以包括设计，开发，可以包括制造，物流，采购，甚至是设计和完成一整套服务。在每个行业，都有一个建造者的定义。在我们所处的科技行业，就是首席技术官CTO，程序员，软件工程师，硬件工程师。但即使在洗衣行业，也可能是创立洗衣服务的人，让物流准时到达的人，确保所有的衣服在正确的时间出现在正确的地方的人，等等。另一方面是销售。同样，销售也有一个非常宽泛的定义。销售不一定只意味着卖东西给个人，它可以意味着营销，意味着沟通，意味着招聘。它也可以意味着筹集资金，意味着鼓舞人心，意味着做公关，等等。</p>\n<h3> 硅谷模式：建造者+销售者=最佳拍档</h3>\n<p>总的来说，硅谷的创业模式是最好的。最常见的形式是有两个创始人，其中一个擅长销售（Sale），另一个擅长搭建（Build）。举几个经典例子，比如苹果创始人史蒂夫·乔布斯和史蒂夫·沃兹尼亚克；微软的盖茨和艾伦在早期可能有类似的分工；谷歌的拉里和谢尔盖可能稍微有点不同，可能是因为谷歌早期交付的是一个非常技术性的产品——搜索，通过一个简单的UI直达终端用户。</p>\n<p>在硅谷，你会看到这种模式反复出现。一个建造者和一个销售者的组合：CTO和CEO的组合。风险投资者和技术投资者几乎心照不宣的尽可能地寻找这种组合，这就是神奇的组合定律。</p>\n<h3> 如果你两者都能做到，你将势不可挡</h3>\n<p>如果一个人可以同时做到这两者，这才是真正的超能力。那时你就是可以创造整个行业的人。马一龙(Elon Musk)就是一个活生生的例子。他不一定是自己造火箭，但他实际上做出了技术上的贡献。他使自己成为最了解这项技术的人，没人会对他说三道四，他也不会说一些自己做不到的事（意思是说到就会做到）。他视时间为朋友，并想尽办法运用它。即使是史蒂夫·乔布斯（Steve Jobs）也拥有足够的产品技能，并且对产品的参与度也很高，实际上他也同时具备这两种能力。拉里·埃里森（Larry Ellison）最初是一名程序员，他编写了Oracle的第一个版本，或者说他深度参与其中。马克·安德森（Marc Andreessen）也属于这一类。他可能对自己的销售技能没有足够的信心，但是他可是写出Netscape Navigator的程序员，或者至少是其中很大的一部分。因此，我认为在任何领域中真正的巨人就是可以「自产自销」的人。</p>\n<h3> 宁愿教工程师销售，也不愿教营销人员工程？</h3>\n<p>我认为你可以从建造技能开始入手，并在你人生的早期尽量掌握一定的建造技能。或者你有足够的时间可以专心地学习销售，而且你正好有一定的天赋和亲和力促使你成为一个好的销售者。这样你做事的效果可以翻番。<br>\n现在我们谈到的销售技能可能不同于传统概念中的，卖东西。</p>\n<p>举个例子，假设你是一个很棒的工程师，然后人们会说，你需要擅长销售。你可能不擅长上门推销东西，但你可能是一个很好的作家。写作是一种比面对面销售门槛更低的技能，所以你可以培养写作技能，直到你成为一个良好的在线交流者，然后将其运用在你的销售上。另一种情况，你可能是一个很好的建造者，但你不擅长写作，你不喜欢与大众沟通，但你擅长一对一说服，所以你可能会用你的销售技能来招聘或募资，这需要更多一对一方向的努力。</p>\n<p>因此，如果你在这两个领域的十字路口，千万不要绝望。因为你不可能成为最好的技术，也不会是最好的销售人员。但神奇的是，我们再回到斯科特·亚当斯（Scott Adams）的技能组合理论，将两个技能是结合将是不可阻挡的。</p>\n<p>从长远来看，那些了解潜在需求产品的人，知道如何建造和销售它的人，最能受到顶尖投资者的青睐。如果他们有足够的精力，他们可以突破任何障碍，做成任何事情。</p>\n<p>Nivi：如果你只能选一个擅长的，你会选哪一个?</p>\n<p>Naval：抛开噪音来说，建造的技能实际上是更好的，因为市场上充斥着太多的骗子和没有任何内核的销售人员。当你刚起步、想要被认可的时候，建造技能会更好。但是之后的建造会很累，因为这是一项专注的工作，很难保持与时俱进，因为总是会有新人出现，有新产品，有更新的工具。</p>\n<p>因此，随着时间的推移，销售技巧实际上更容易产生规模效应。比如，如果你在构建产品上享有声誉，这是好的，但当你推出你的新产品时，我将去验证的是产品本身（意思是和建造的名声关系不大）。但是，如果你在大家的眼中是一个值得信赖的生意伙伴，并且你很有说服力，善于沟通，那么这个名声会让很多事变得容易很多。</p>\n<p>因此，我认为如果你需要选一个，<strong>你可以从建造开始，然后过渡到销售</strong>。这是一个比较中庸的答案，但我觉得这奏是大实话。</p>\n<h2> 第十六条：阅读你所热爱的内容 直到你爱上阅读</h2>\n<p><strong>你应该可以在图书馆中拿起任何一本书阅读</strong></p>\n<h3> 阅读你所热爱的内容 直到你爱上阅读</h3>\n<p>Nivi：在我们讨论责任、影响力和判断之前，你已经有了一些相关的推特，我会把它们放在持续学习的范畴。这些推文本质上是在说，“没有所谓的商业技能。少读商业杂志和商业课程，学习微观经济学、博弈论、心理学、说服力、伦理学、数学和计算机”。你在Periscope上还发表了另一条评论“你应该可以从容的拿起图书馆里的任何一本书来读。”这一类的最后一条推特是，“阅读比听快，做比看快”。</p>\n<p>Naval：是的，这是最重要的一条，因为学习的基础是阅读。我认识的聪明人，他们都经常读书。</p>\n<p>问题是，<strong>我读什么？我怎么读</strong>？因为对大多数人来说，这是一场斗争，是一件家务活儿。但是，读书不是目的，重要的是学会如何教育自己，教育自己的方法就是培养对阅读的热爱。我想说的是，“<strong>读你喜欢的内容，直到你爱上阅读</strong>。”就这么简单。</p>\n<p>我认识的每一个经常读书的人都“爱”阅读，他们爱读书是因为他们读自己喜欢的书。这有点像第二十二条，阅读是没有门槛的，你可以随时开始，然后不断积累，直到它成为一种习惯。接着，你开始不满足于只涉猎单一的领域。</p>\n<p>也就是说，你可以从读小说开始，接着你可以读科幻小说，你可以读非小说，然后你可以读科学，哲学，数学甚至更多。但是重要的是，这个过程是顺其自然非强迫的，读你感兴趣的东西，直到你理解它们。然后你就会自然而然地进入下一步，再下一步。</p>\n<h3> 阅读某一领域的科学原著</h3>\n<p>但是，你会发现在你真正想学的东西中，有太多东西要读。我要提醒的是，即使是阅读也充满了垃圾。实际上有些东西你可以阅读，特别是在早期，<strong>它会以某种方式对你的大脑进行编程</strong>，然后在你阅读的后期，你会根据之前的东西来分辨这些东西是真是假。因此，阅读基础性的东西是很重要的。基础性的东西，是在特定领域最原始（fundamental）书籍，在本质上是经过时间和历史的检验，科学的东西。</p>\n<p>比如，与其读一本商业畅销书，不如读亚当·斯密的《国富论》。与其读今天谁写的一本关于生物学或进化论的书，我更愿意读达尔文《物种起源》。与其现在读一本可能非常先进的生物技术方面的书，我只想学习Horace F. Judson的《创世第八天》(The Eighth Day of Creation)。你不必死磕关于宇宙学和尼尔·德格拉斯·泰森和斯蒂芬·霍金一直在说什么的高级书籍，你需要的是拿起理查德·费曼的《费曼讲物理：入门》，从基础物理学开始。</p>\n<h3> 不要害怕任何书</h3>\n<p>如果你基础打的好，特别是数学、物理和科学，那么你就不会害怕任何一本书。我们所有人都有那种坐在教室里学数学的记忆，这一切都是合乎逻辑的，而且都是有意义的，直到有一次，课程进度太快，我们跟不上了。<br>\n在那之后，我们被留下来背方程式，记忆概念，却无法从第一原理中推导出它们。在那一刻，我们迷失了，因为除非你是一个专业的数学家，否则你不会记得这些东西。你要记住的是技术，基础。</p>\n<p>因此，你必须确保阅读是建立在一个理解的框架上，因为你正在为建摩天大楼打地基，而不只是在反复记忆你不断在丢失的东西。所以基础非常重要。</p>\n<p>最后，阅读的终极是当你走进一个图书馆，你上下打量，你不害怕这里的任何一本书。因为你知道你可以把任何一本书从书架上拿下来，你就能阅读它，理解它，你可以接收什么是真的，拒绝什么是假的。你有一套自己的方法论，分辨哪些是逻辑和科学的，而不仅仅是基于大字报和意见（opinions）。</p>\n<h3> 学习的手段是丰富的，学习的欲望是稀缺的</h3>\n<p>互联网的美丽是整个亚历山大图书馆的十倍，并且时刻在你的指尖，为你所用。不是教育手段或学习手段稀缺，相反稀缺的是学习的欲望。所以，你真的要培养欲望。</p>\n<p>欲望意味着我不允许这种能力的丧失。孩子们天生就有好奇心。如果你去找一个第一次学语言的小孩，他们总是问：这是什么？那是什么？这是为什么？那是谁？他们总是问问题。</p>\n<p>但问题之一是，学校和我们的教育系统，甚至我们培养孩子的方式，都用顺从取代了好奇。<strong>一旦你用顺从取代好奇心，你就会成为一个顺从的工厂工人，而不再是一个创造性的思考者。你需要创造力，你需要有激励自己的大脑去学习你想要的东西的能力</strong>。</p>\n<h2> 第十七条：数学和逻辑才是一切事物的基础</h2>\n<p><strong>数学和逻辑是理解其他一切事物的基础</strong></p>\n<h3> 终极基础是数学和逻辑</h3>\n<p>Naval：最基本的东西是原则性的，可以是算法，是根深蒂固的逻辑理解，你可以从任何角度保护它或攻击它。这就是为什么微观经济学很重要，而宏观经济学就是大量的记忆堆砌，大量的宏观废话。</p>\n<p>正如纳西姆•塔勒布(Nassim Taleb)所说，<strong>宏观上的扯淡比微观上的扯淡更容易</strong>。因为宏观经济学是巫术—复杂—科学与政治的结合。如今，你找不到两个宏观经济学家在任何事情上达成一致，不同的政治家会用不同的宏观经济学家来兜售他们各自偏爱的理论。</p>\n<p>现在甚至有宏观经济学家在兜售所谓的现代货币理论，大概意思就是，有个讨厌的东西叫做通货膨胀，我们可以印所有我们想要的钱。这就像说，有了无限的能量，我们可以发射火箭进入太空一整天。这简直是一派胡言。现实是，有些人打着“宏观经济学家”的旗号，兜售什么现代货币理论，这只能说明，宏观经济学作为一门“所谓的科学”已经腐败。它现在是政治的一个分支。</p>\n<p>因此，你要把重点放在基础上。<strong>最终一切事物的基础是数学和逻辑</strong>。如果你懂逻辑和数学，那么你就有了理解科学方法的基础。一旦你理解了科学方法，你就能理解如何在其他领域和其他你正在阅读的东西中区分真理和谬误。</p>\n<h3> 速食一百本书毫无意义</h3>\n<p>在阅读别人的观点（opinion）时要非常小心，甚至在阅读事实（facts）时也要小心，因为所谓的事实往往只是表面上的(伪科学)观点。你真正需要的是算法（algorithm），是理解（understanding）。最好是慢慢地啃完一本书，然后挣扎、绊倒、倒带，而不是快速地浏览一遍，然后貌似很有成就感：“我已经读了20本书，我已经读了30本书，我已经读了50本这个领域的书...”就像李小龙说的，“我不害怕那些知道一千种踢腿招式的人，我害怕那些练习了一万次出拳或一万踢腿的人。”通过不断重复和运用，不断深入理解逻辑和基础，你才能成为一个聪明的思考者。</p>\n<h3> 学习讲故事和编程</h3>\n<p>Nivi：要为你以后的学习打下基础，我认为你需要两样东西，总结来说。第一，练习说服别人，不断实践怎么讲好一个故事。第二，深入了解一些技术范畴的东西，无论是学习抽象数学，还是读唐纳德·克努斯关于算法的书，或者听费曼关于物理学的讲座。如果你有实际的说服力，对一些复杂的话题有深刻的理解，我认为你的余生将有一个很好的学习基础。</p>\n<p>Naval：是的。我把它展开一下。我认为五个最重要的技能是，阅读，写作，算术，然后加上说服的技巧，也就是会讲故事（storytelling）让别人信服。最后，我还要加上计算机编程，因为它是一种应用形式的运算它能让你在任何领域都能自由的建造。如果你擅长电脑，擅长基础数学，擅长写作，擅长说服，如果你喜欢阅读，你就已经为生活做好了准备。</p>\n<h2> 第十八条：没有被称为“商业”的技能</h2>\n<p><strong>避开商学院和杂志</strong></p>\n<h3> 没有被称为“商业”的实际技能</h3>\n<p>Naval：没有所谓商业的实际技能，它太普通了。这就像一种叫做“关联”的技能，定义为“与人相关”。这都不能称作一种技能，它太宽泛了。</p>\n<p>我并不想完全贬低商学院传授的东西的价值，他们会传授非常聪明的东西—一些成功的案例/轶事，并称之为“案例分析”（case study）。但它们只是一些趣闻轶事，它们试图通过向你抛出大量数据点来帮助你进行模式匹配，但事实是，在你设身处地思考之前，你永远不能完全理解它们，就像你无法重复打造一个可口可乐一样。但是，你会发现博弈论、心理学、伦理学、数学、计算机和逻辑学中的这些基本概念才会更好地帮到你。这也是我为什么会更专注于基础科学、基础逻辑的原因。我会培养对阅读的热爱，包括阅读那些我们明知道不应该阅读的所谓垃圾。你不必（只）读经典。阅读是你进行自我教育的基础。</p>\n<p>着手做比光想要快得多</p>\n<p>Nivi：你之前所说的“做比看快”是什么意思呢？</p>\n<p>Naval：这涉及到学习曲线的话题，人们总是想方设法的优化自己的学习曲线。尽管我也是一个播客博主，但我不喜欢播客的原因之一是，播客无法让我最快的获取知识和信息。我是一个很好的读者，或者说是一个很快的读者，我能读得很快，但我只能以一定的速度听。我知道人们听的时候都是二倍速，三倍速，但那时每个人听起来都像一只花栗鼠，很难再回头看，抓重点，很难精确定位片段并记笔记，等等。</p>\n<p>同样地，很多人认为他们可以通过观察别人做的事情，甚至通过阅读别人做的事情，变得非常熟练。比如刚提到的商学院的案例研究，就是一个非常典型的例子。他们研究其他人的生意，但实际上，你开一个自己的柠檬汽水摊，甚至在街上开一家小杂货店，都会学到比书本上多得多的经营生意的知识。这就是你在工作中要学习的方法，<strong>因为很多微妙的东西在你真正进入这个行业之前是不会真正懂得的</strong>。</p>\n<p>例如，现在人人都喜欢研究心理学。你去看看Farnam Street，读读Poor Charlie’s Almanack*，你可以学习所有不同的心理模式。但哪个更重要？你更常应用哪些？在什么情况下哪一个更重要？这其实是最难的部分。比如，我从心理学研究中最大的收获是，委托-代理问题在现实世界中的驱动力太强大了，这本质是一个激励问题。它让我明白，针锋相对的重复囚徒困境是最值得了解的博弈论。在那之后你几乎可以把博弈论理论书束之高阁了。</p>\n<p>顺便说一下，<strong>学习博弈论的最好方法是自己设计游戏</strong>，自己亲身体验。虽然我从没读过博弈论的书，但我认为自己非常擅长博弈论实践。我从来没有打开过一本博弈论的书，从未尝试在里面发现任何一个我没想到的结果。原因是我从小玩各种游戏，和各种各样的朋友在游戏中碰到各种各样的实际情况，所以这对我来说只是第二天性。实践会告诉你一切你想知道的答案。</p>\n<h3> “执行”迭代的次数决定着你的学习曲线</h3>\n<p>执行本身是一件很微妙的事请，它包含着很多东西。比如说，我想学习如何经营一家企业。如果我在每天上班的地方重复做同样的事情，比如说我在街上开了一家零售店，每天的任务就是在货架上摆满食物和酒，我不会学到很多东西，因为我每天只是在不断重复。因此，即使我花了几千个小时，但我也只是花了几千个小时做同样的事情。而如果在这个过程中我进行了数千次迭代，那结果就会不一样了。因此，学习曲线是需要迭代的，而不是重复。</p>\n<p>但如果我在商店里每天尝试新的营销实验，我不断地改变库存，不断地改善品牌策略，不断尝试新的讲故事的方法，不断地拓展增大客流量的在线渠道，我试着在不同的时间营业，并且经常有目的地四处走走，和其他店主交谈，拿到他们的书，弄清楚他们是如何经营自己的生意的。<strong>真正影响学习曲线的是迭代次数</strong>。迭代次数越多，收获的就越多，学习速度就越快。而不仅仅是投入的时间长短的问题。</p>\n<h3> 如果你愿意每天流一点血，你可能在未来的人生路上赢得很多</h3>\n<p>虽然世界为我们提供着一次又一次做同样事情的机会，但事实上，如果我们能从零开始寻找新的方法，世界会呈现出不一样的精彩。</p>\n<p>第一次尝试新事物是很痛苦的，因为你正徘徊在不确定的领域，很有可能你会失败。因此你只需要不断让自己<strong>适应频繁的小失败（bleed a little）</strong>。</p>\n<p>Nassim Taleb也谈到了这一点。他靠做一个基本上依赖黑天鹅的商人的生意发家致富。Nassim Taleb通过每天损失一点点钱来赚钱，然后在一个偶然的时机，当一件被常识定义为不可能发生的事情发生在其他人身上时，他会赚很多钱。</p>\n<p>虽然大多数人每天都想一夜暴富，但相应的，他们需要承担爆炸式的风险，做好破产的心理准备。</p>\n<p>如果说你在自然界里割伤了，然后每天都在流血，你最终会因失血而死亡，你必须想办法及及时想办法挽救生命。但其实现实生活没那么夸张，我们并不是每天都在流血，流血在这里只是一个比喻，每天让自己损失一点点。</p>\n<p>但现实是，大部分人都不这么做，相反他们每天都在追求着小的胜利，这最终会被证明是不合算的。我想说的是，如果你愿意每天都流一点点血，将来你会赢一笔大的。</p>\n<p>其实，这就是创业精神，企业家们每天都在流血（bleed a little）。他们不是在赚钱，他们是在赔钱，而且他们总是亚历山大，因为所有的责任都在他们身上，但是当他们赢了，他们就会大赚一笔，所以总体上来看他们会赚得更多。</p>\n<h2> 第十九条：勇敢承担责任才能获得影响力</h2>\n<p><strong>勇敢冒险你就会在社会上获得影响力</strong></p>\n<h3> 你需要通过责任获得影响力</h3>\n<p>Nivi: 我们何不谈谈责任呢，我觉得这很有趣，我估计你对此有自己独特的看法。因此，你的关于责任的第一条推文是，“拥抱责任，以自己的名义承担商业风险。社会将以责任、公平和影响力来回报你。”</p>\n<p>Naval: 是啊，所以要想发财，你需要杠杆。杠杆来自于劳动力、资本，也可能是通过代码和媒体。但其中的大多数，比如<strong>劳动力和资本，必须来自于他人的给予</strong>。对于劳动力，必须是有人愿意跟随你；对于资本，必须有人给你钱或资产来让你管理和使用。</p>\n<p>所以要得到这些，你必须建立信誉，而且你必须尽可能以自己的名义去做，当然这也是有风险的。所以责任是一把双刃剑。它能让你在事情顺利的时候收获信誉，在事情糟糕的时候承受失败的冲击。</p>\n<h3> 以自己的名义承担商业风险</h3>\n<p>从这个意义上说，那些在各种事物上贴上自己标签的人并不愚蠢，他们只是对自己有信心。也许最终结果是愚蠢的，但如果你看到一个坎耶、奥普拉、特朗普、马斯克或其他类似的人，这些人之所以可以凭借自己的名字致富，是因为他们的名字就是强大的敲门砖。</p>\n<p>不管你如何看待特朗普，你必须意识到，这家伙的名字就是世界名片。你为什么要去特朗普赌场？只是因为是特朗普。你为什么要去特朗普大厦？也是因为特朗普。</p>\n<p>到了投票的时候，我想很多选民只是进去说“特朗普”，他们认出了这个名字，所以这个名字得到了回报（获得选票）。</p>\n<p>奥普拉也是同样的，她把某样东西打上自己的标签，当商品到达人们手中，她的名字就是这些商品的招牌。</p>\n<p>这些人在坚持把自己的名字打造成招牌的同时当然也面临着一系列的风险。显然，特朗普现在可能被世界上的一大部分人憎恨着，也同样是因为特朗普式的风格。</p>\n<p>把你的名字公之于众，你就会成为一个名人，而名声也有很多缺点。<strong>隐姓埋名、有钱总比穷出名好，但即便是名利双收，也有很多不利因素。你需要在公众的眼皮子底下生活</strong>。</p>\n<h3> 一个运作良好的团队对每个职位都有明确的责任分工</h3>\n<p>责任感是非常重要的，当你正在开发一个产品，或者你在一个团队中工作，或者你在一个企业中工作时，我们就会不断地提醒自己成为一个团队的一员是多么的重要。这的确是非常重要的。</p>\n<p>我们在社交方面的很多训练都告诉我们不要强出头。就像中国的一句俗语，枪打出头鸟，别紧张，但是我要说的是，一个真正运作良好的团队规模很小，对每一个不同的部分都有明确的责任分工。</p>\n<p>你可以说，“好吧，这个人负责制造产品，这个人负责信息发布，这个人负责筹款，这个人负责定价策略，也可能负责在线广告。“所以如果有人搞砸了，你就知道到底是谁负责。同时，如果事情进展顺利，你也清楚地知道是谁做得很好。</p>\n<p>如果你有一个很小的团队，并且你已经清楚地划分了责任，那么你仍然可以保持很高的责任感。问责制在面对结果时显得真的很重要，不然就会出现，如果失败了，每个人都会互相指责，如果成功了，每个人都会站出来争夺功劳。</p>\n<p>我们在学校的时候都有过这样的经历，有一个小组作业要做，里面可能有几个人做了很多工作，然后有一些人只是做了很多哗众取宠的工作或者强行给自己做的工作加戏。我们从小就习以为常，但说出来难免会感到不舒服。</p>\n<h3> 能在公众面前坦然面对失败的人都有很大的能量</h3>\n<p>明确责任很重要。没有责任感，你就没有动力；没有责任感，就无法建立信誉。但你要冒险，你冒着失败的风险冒着被羞辱的危险，你冒着以自己名义承受失败的风险。</p>\n<p>幸运的是，在现代社会，不再有债务人的监狱，人们也不会因为失去别人的钱而坐牢或被处死，但与生俱来的，我们不会以自己的名义在公共场合失败。那些以自己的名义在公共场合面对失败的人，实际上拥有很大的能量。</p>\n<p>例如，我讲一个个人轶事。直到2013年，2014年，我的公众形象完全围绕着创业和投资。直到2014年、2015年左右，我才开始谈论哲学、心理学等等。</p>\n<p>这让我有点紧张，因为<strong>我是以自己的名义做的</strong>。肯定有业内人士通过背后悄悄戳我，比如“你在干什么？你要结束你的职业生涯了吗？这太愚蠢了。”</p>\n<p>我有点同意了，的确，我冒险了。</p>\n<p>当你把你的名字放在那里，你就要冒着某些风险。但同时你也会得到回报，你会得到好处的。</p>\n<h2> 第三十五条：冷静的头脑，健康的身体，充满爱的家庭</h2>\n<p><strong>当你变得富有时，你会发现这些都不是你一直以来追求的</strong></p>\n<p>Nivi：最后一条关于长期工作的推特是：“当你最终变得富有时，你会意识到这些并不是你最初想要的。”</p>\n<p>Naval：这本身就是一个能谈论很久的话题。首先，我认为这是一个非常聪明的结论，它解放了那些说“致富有什么意义？”的人们的思想武装。有很多人喜欢以德服人，反对创造财富或赚钱的想法。这其实也没错。是的，钱能解决你所有能用钱解决的问题，但钱也不是万能的。</p>\n<p><strong>当你赚了一大笔钱后，你首先意识到你仍然是同一个人</strong>。如果你本来快乐，你就还是快乐的。如果你本来不快乐，你就会不快乐。如果你平静、满足、平和，你还是那个人。我认识很多非常富有的人，他们身材非常不好。我也认识很多有钱人，他们的家庭生活很糟糕。我同时也知道很多有钱人，他们内心很混乱。</p>\n<h3> 平静的头脑，健康的身体和充满爱的家庭必须要经营</h3>\n<p>我想到我之前发的另一条推特，也是我最喜欢的一条。它不一定是最有见地的，也不一定是最有用的，这甚至不是我想的最清楚的。但那里面有一个非常确定的事实，它引起了共鸣。</p>\n<p>“健康的身体，平静的头脑，充满爱的家庭。这些东西是买不来的，必须要经营才能得到。”</p>\n<p>即使你拥有世界上所有的钱，你也不会拥有这三样东西。Jeff Bezos（亚马逊董事长）还得健身，他也得为他的婚姻努力，他的内在精神状态仍然很难不被外部事件所影响。这将取决于他内心的平静与安宁。因此，我认为这三件事——你的身体健康，你的心理健康和你的亲密关系是你必须要培养的。他们能给你带来比任何金钱都多的安宁和幸福。</p>\n<h3> 关于平静内心状态的实用性建议</h3>\n<p>如何才能保持内心平静，这个话题是我一直在研究的。我大概有100条这个方面的推特。在这个话题上，最近经常会遭到至少50种不同形式的攻击。所以我一直在犹豫要不要做，因为我想针对一种非常特殊的人群。</p>\n<p>有很多人不相信研究内在状态是有用的，他们太注重外在。没关系，这样也的确没什么问题。这就是“如何致富”推特系列的目的。有很多人认为唯一值得努力的就是<strong>彻底解放(complete liberation)</strong>，就像，你成了佛。他们会怀疑过程中的任何东西，认为它们毫无用处。但事实是绝大多数人没法儿成佛不是吗？</p>\n<p><strong>我想创建一个新的推特系列，来为那些想要一个更平静的内在的人们提供实用的建议</strong>。一套理解、分辨半真半假和真理的理论，如果你能正确地吸收它们，这些都是指向你已经拥有的想法和经验的指针；如果你把这些理论慢慢融会贯通，它将帮助你、引导你进入一个更平静的内在状态，这就是我想做的。</p>\n<p>健身是另一个大问题，我不是这方面的专家，推特上有很多比我更擅长健身的专业人士。</p>\n<h3> 很多离婚案例是为了钱，很多争吵是因为内心恐惧</h3>\n<p>我认为，一个充满爱的家庭和人际关系实际上是自然而然地从其他事情中脱颖而出的。如果你有一个冷静的头脑，你已经赚了钱，你应该有良好的关系。你没有理由不这样做，很多离婚都是为了钱，不幸的是，这就是现实，有了钱但是丢失了家庭这部分。</p>\n<p>很多外在的纷争主要是因为你的内在状态不好。当你内心自然平静的时候，你会选择更少的争斗，你会变得更有爱心而不期待任何回报，这会让你应对外部关系更加得心应手。</p>\n<p>Nivi：总结一下，钱能解决你的关于金钱的问题，金钱可以让你在物质世界中获得自由。金钱能给你不去做你不想做的事情的自由。</p>\n<p>Naval：是啊。对我来说，金钱的最终目的是让你不必在某个特定的地方的某个特定的时间，做任何你不想做的事情。</p>\n<h2> 第三十六条：没有什么快速致富的方法</h2>\n<p><strong>别相信能快速致富的鬼话，那些人只是想从你身上赚钱而已</strong></p>\n<p>Nivi：我们跳过了一条推文，因为我想涵盖所有关于长期话题的推文。我们跳过的那条推特是，“世界上没有快速致富的捷径，如果谁告诉你有，那不过是他想从你这里发财罢了。”</p>\n<p>Naval：我们说回有效率的世界。如果有一种简单的致富方式，那就是已经被开发了。有很多人会向你推销如何赚钱的产品，比如他们总是卖给你一些79-95美元的课程或一些有声读物，或研讨会门票。这没什么对错，人们总是需要谋生。他们可能真的有很好的建议，但如果他们给你可行的、高质量的建议，承认这（致富）是一个艰难的旅程，会花很多时间，那么我认为这是现实的。但是，如果他们卖给你一些快速致富的各种线上线下的产品，他们只是想从你身上赚钱，你要掂量一下它的价值。</p>\n<h3> 我们不放广告，因为我们知道那只会损害信誉</h3>\n<p>关于整个推特风暴和这个播客，我想强调的一件事是我们这里没有广告，也不收任何费用。我们不卖任何东西。不是因为我不想赚更多的钱，赚更多的钱总是好的。但是，它会完全破坏企业的信誉。如果我说，“嘿，我知道如何致富，我要把它卖给你。“这就毁了它。</p>\n<p>我年轻的时候就开始思考致富的话题，我最喜欢的书之一就是《如何致富》，作者是Felix Dennis，《Maxim》杂志的创始人，一位去世的亿万富翁。他写了很多疯狂的东西，但他对财富的理解真的好。</p>\n<p>但每当我读到他或GoDaddy创始人鲍勃·帕森斯或安德鲁·卡内基的作品时，这些已经非常富有的人写的东西，他们显然是在其他领域发家致富的，而不是靠<strong>推销如何致富的方法</strong>。他们不是想从你身上赚钱。他们显然是想赢得一些地位和一些自尊，对吧，你总是要有做某事的动机。但是，至少这是他们没有撒谎的一个更清晰的理由。</p>\n<h3> 每个创始人都会对他的员工撒谎</h3>\n<p>在某种程度上，每个创始人都要对公司的每个员工撒谎。他们必须让员工觉得，你为我工作比做你自己想做的事，为你自己工作（创业）要好。同样作为一个创始人，但对此我总是很难接受。</p>\n<p>于是我开始尝试一些保持诚实的方法，我招募了一些有企业家精神的员工，然后告诉他们，“你们可以在这个公司成为企业家，当你们准备好开始自己的事业的那一天，我将支持你们。我永远不会妨碍你创业。但在你想开始一些新东西之前，这里可能是一个好地方，让你学习如何构建一个良好的团队，建立一个好的企业文化，通过打磨自己的技能找到适合的产品市场，见更多更加优秀的人、和他们交流碰撞，直到最终想通自己到底想做什么。因为定位、时机、以及必要的深思熟虑，在开始创业时很重要。”</p>\n<p>但我从来不会做一些无谓的监督，告诉员工“你必须在早上8点之前到你的办公桌。”因为我自己就不会在早上8点之前坐在办公桌前，我想要自由。这就像告诉他们你今天很擅长做董事，明天你就会成为副总裁。这种话我自己都不相信。</p>\n<h3> 任何提供致富建议的人，去想想别的赚钱方式吧</h3>\n<p>就好像，你不会想从一个胖子那里学到如何保持健康；也不会想从一个抑郁的人那里学到如何快乐。所以，你不会想从一个穷人那里学习如何致富，也一定不想从一个通过告诉别人如何致富来赚钱的人那里学习如何致富。想想都奇怪不是吗？</p>\n<p>Nivi：任何时候，如果你看到有人按照大师的建议致富了，只要记住，在任何随机事件中，如果你持续足够长的时间，如果有足够多的人参与其中，你就会得到想要的结果。</p>\n<p>Naval：这里面存在着幸存者偏差，这也是为什么当商业记者和经济学家谈论私营公司时，你可以完全忽视他们的原因。</p>\n<p>我不会指名道姓，但当一位著名的经济学家对比特币大加抨击，或者当一名商业记者攻击最新一家即将上市的公司时，这完全是胡说八道。那些人什么都没做，他们只是「专业的评论家」。他们对赚钱一无所知。他们只知道如何通过吐槽和批评来博眼球。你要是不停的被他们洗脑可就太蠢了。</p>\n<p>最后我想引用纳西姆·塔勒布*的一句话，我很喜欢他说的话，“如果你想成为一个哲学家，先当国王，再当哲学家。”不是先成为哲学家，再成为国王。”</p>\n<p>Nivi：我很高兴你提到了塔勒布，我想请大家记住他成名作的书名《随机骗局》。</p>\n<p>Naval：我们在这期播客中有些模糊的原因之一是，我们试图去讨论值得长期遵循的原则，而不仅仅是告诉你昨天中奖的彩票号。</p>\n<h2> 第三十七条：产品化你自己</h2>\n<p><strong>找出你最擅长的，并尽可能多地运用杠杆</strong></p>\n<p>Nivi：你用两个词概括了整个推特风暴。“产品化（Productize）你自己。”</p>\n<p>Naval：产品化你自己这个概念的意思是：<strong>你自己</strong>是独特的、有责任心的，<strong>产品化</strong>需要独特的技能和杠杆。所以所有这些部分，你可以把它们合并成这两个词。</p>\n<p>如果你想要长期致富，你应该问自己：“这是我的真实想法吗？”我在打造的是我自己吗？然后，“我在生产它吗？”我在规模化它吗？我是在用劳动力还是资本，代码还是媒体来衡量？所以这是一个非常方便、简单的记忆方法。</p>\n<p>这是什么播客？这是一个叫做Naval的播客。我实际上是在用播客在产品化自己的一部分</p>\n<p>Nivi：你要弄清楚你有什么特别擅长的，或者你有什么特别之处，然后尽可能地运用杠杆。在这种情况下你不是在刻意赚钱，赚钱甚至也不是一种技能。你就是在做你自己，探索成千上百种方式找到真正的你。</p>\n<h2> 找到让你富有、健康和有创造力的爱好</h2>\n<p>Naval：赚钱应该取决于你是谁和你喜欢做什么。另一条我特别喜欢的推特是...这不是我说的，是别人发过的。他们说“找三个爱好”。一个能让你赚钱，一个能让你保持健康，一个能让你富有创造力。”</p>\n<p>我会稍微改变一下。我会说，找到三个爱好，一个让你赚钱，一个让你健康，一个让你更聪明。就我而言，我的爱好是阅读，赚钱，因为我喜欢与初创公司合作。要么投资，要么集思广益，要么开始行动。我很喜欢创业初期的创意和创造阶段。</p>\n<p>至于让你保持健康的爱好，我真的没有。我最喜欢的是瑜伽，但那是我崩溃的地方。我认为，那些早年发现冲浪、游泳、网球或某种他们一生中大部分时间都在做的运动的人是非常幸运的，因为他们发现了一种使他们健康的爱好。</p>\n",
      "image": "https://i.imgur.com/WubW2ud.jpg",
      "date_published": "2022-10-11T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "转载"
      ]
    },
    {
      "title": "程序员延寿指南",
      "url": "https://Hexiaopi.github.io/other/how-to-live-longer.html",
      "id": "https://Hexiaopi.github.io/other/how-to-live-longer.html",
      "summary": "【转】原文链接",
      "content_html": "<p>【转】<a href=\"https://github.com/geekan/HowToLiveLonger\" target=\"_blank\" rel=\"noopener noreferrer\">原文链接</a></p>\n<!-- more -->\n<h1> 程序员延寿指南</h1>\n\n<h2> 1. 术语</h2>\n<ul>\n<li>ACM: All-Cause Mortality / 全因死亡率</li>\n</ul>\n<h2> 2. 目标</h2>\n<ul>\n<li>稳健地活得更久</li>\n</ul>\n<h2> 3. 关键结果</h2>\n<ul>\n<li>降低66.67%全因死亡率</li>\n<li>增加~20年预期寿命</li>\n<li><s>维持多巴胺于中轴</s></li>\n</ul>\n<h2> 4. 分析</h2>\n<ul>\n<li>主要参考：对ACM的学术文献相对较多，可以作为主要参考</li>\n<li>增加寿命与ACM关系非线性：显然增加寿命与ACM关系是非线性函数，这里假设 <code>DeltaLifeSpan=(1/(1+DeltaACM)-1)*10</code>（DeltaACM为ACM变化值；公式欢迎优化）</li>\n<li>变量无法简单叠加：显然各个变量之间并不符合独立同分布假设，变量之间的实际影响也并不明确</li>\n<li>存在矛盾观点：所有的证据都有文献/研究对应，但注意到：有些文献之间有显著矛盾的观点（如对于碳水摄入比例的矛盾）；有些文献存在较大争议（如认为22点前睡觉会提升43%全因死亡率）</li>\n<li>研究仅表达相关：所有文献表明的更多是相关而非因果，在阅读时要考虑文献是否充分证明了因果 —— 如某文献表明了日均&gt;=7000步的人有显著低的全因死亡率。但步数少的人可能包含更多长期病患，如果没有合理的排除这块数据，那此文献调查失真</li>\n</ul>\n<h2> 5. 行动</h2>\n<ul>\n<li>输入\n<ul>\n<li>固体：吃白肉（-11%~-3% ACM）、蔬果为主（-26%~-17% ACM），多吃辣（-23% ACM），多吃坚果（-27%~-4% ACM），<em>少吃蛋黄（否则+7% ACM/0.5颗/天）（存在争议）</em>，中量碳水、多吃植物蛋白（-10% ACM），少吃超加工食物（-62%~-18%）</li>\n<li>液体：喝咖啡（-22%~-12% ACM），喝牛奶（-17%~-10% ACM），喝茶（-15%~-8% ACM），少喝或不喝甜味饮料（否则每天一杯+7% ACM，+多巴胺），戒酒或每周100g（纯酒精量(g)=饮酒量(ml)×酒精浓度(%)×酒精密度0.8g/ml）内（否则+~50% ACM，无上限）</li>\n<li>气体：不吸烟（否则+~50% ACM，-12~-11年寿命）</li>\n<li>光照：晒太阳（-~40% ACM）</li>\n<li>药物：二甲双胍（糖尿病人相比正常人可以+3年）、复合维生素（-8%癌症风险）、亚精胺（-60%~-30% ACM）、葡萄糖胺（-39% ACM）</li>\n</ul>\n</li>\n<li>输出\n<ul>\n<li>运动：每周3次45分钟挥拍运动（-47% ACM）</li>\n<li>日常：刷牙（-25% ACM）</li>\n<li>睡眠：每天睡7小时全因死亡率最低；且22-24点间最好，<em>早睡+43% ACM，晚睡+15% ACM（存在争议）</em></li>\n</ul>\n</li>\n<li>上下文\n<ul>\n<li>体重：减肥（-54% ACM）</li>\n</ul>\n</li>\n</ul>\n<h2> 6. 证据</h2>\n<h3> 6.1. 输入</h3>\n<h4> 6.1.1. 固体</h4>\n<ul>\n<li>白肉\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/268401670\" target=\"_blank\" rel=\"noopener noreferrer\">JAMA子刊：食用红肉和加工肉类会增加心脏病和死亡风险！鱼肉和家禽肉则不会</a>\n<ul>\n<li>出处：<a href=\"https://jamanetwork.com/journals/jamainternalmedicine/articlepdf/2759737/jamainternal_zhong_2020_oi_190112.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Associations of Processed Meat, Unprocessed Red Meat, Poultry, or Fish Intake With Incident Cardiovascular Disease and All-Cause Mortality</a></li>\n<li>增加红肉摄入与死亡风险相关。八年内平均每天增加至少半份红肉摄入（半份红肉相当于14g加工红肉或40g非加工红肉）的调查对象，在接下来八年内全因死亡风险增加10％（HR, 1.10; 95%CI, 1.04-1.17）；每周吃两份红肉或加工肉类（但不包括家禽或鱼类）会使全因死亡风险增加3%</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163703960-6f321de5-4daa-4ea5-95b9-af9c96f1c1bc.jpg\" alt=\"红肉\" tabindex=\"0\" loading=\"lazy\"><figcaption>红肉</figcaption></li>\n</ul>\n</li>\n<li><a href=\"https://www.zhihu.com/question/67223570/answer/809785380\" target=\"_blank\" rel=\"noopener noreferrer\">红肉和白肉最大的区别是什么？为啥要这么分呢？</a></li>\n</ul>\n</li>\n<li>蔬果\n<ul>\n<li><a href=\"https://www.sohu.com/a/322360740_164924\" target=\"_blank\" rel=\"noopener noreferrer\">每年54万人死亡，竟是因为水果吃得少！？这已成十大死亡因素之一！</a>\n<ul>\n<li>出处：<a href=\"https://academic.oup.com/cdn/article-abstract/3/Supplement_1/nzz028.FS01-01-19/5516583\" target=\"_blank\" rel=\"noopener noreferrer\">Estimated Global, Regional, and National Cardiovascular Disease Burdens Related to Fruit and Vegetable Consumption: An Analysis from the Global Dietary Database (FS01-01-19)</a></li>\n<li>每天摄入200克新鲜水果可使死亡率降低17%，糖尿病大血管并发症（如中风、缺血性心脏病等）风险降低13%，及糖尿病小血管并发症（如糖尿病肾病、糖尿病眼病、糖尿病足病等）风险降低28%</li>\n</ul>\n</li>\n<li><a href=\"https://mp.weixin.qq.com/s/E6BAi-Vnhr1jXBm0Pys2ZQ\" target=\"_blank\" rel=\"noopener noreferrer\">《自然》子刊：每天二两西兰花，健康长寿都有啦！分析近6万人23年的数据发现，吃含黄酮类食物与死亡风险降低20%相关丨临床大发现</a>\n<ul>\n<li>出处：<a href=\"https://www.nature.com/articles/s41467-019-11622-x\" target=\"_blank\" rel=\"noopener noreferrer\">Flavonoid intake is associated with lower mortality in the Danish Diet Cancer and Health Cohort</a></li>\n<li>吃含黄酮类食物与死亡风险降低20%相关</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163703969-42e64f88-e727-4e7d-85f2-07a92e29b613.jpg\" alt=\"黄酮\" tabindex=\"0\" loading=\"lazy\"><figcaption>黄酮</figcaption></li>\n<li>Bondonno博士说道“吃不同蔬菜、水果补充，不同种类的黄酮类化合物是很重要的，这很容易通过饮食实现：一杯茶、一个苹果、一个橘子、100克蓝莓，或100克西兰花，就能提供各种黄酮类化合物，并且总含量超过500毫克。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>辣椒\n<ul>\n<li><a href=\"https://3g.163.com/dy/article/F6Q7I1ME053228ZU.html\" target=\"_blank\" rel=\"noopener noreferrer\">辣椒成死亡克星？据调研，常吃辣患病死亡风险可降低61%</a>\n<ul>\n<li>出处1：<a href=\"https://www.sciencedirect.com/science/article/pii/S0735109719382063\" target=\"_blank\" rel=\"noopener noreferrer\">Chili pepper consumption and mortality in Italian adults</a></li>\n<li>出处2：<a href=\"https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0169876\" target=\"_blank\" rel=\"noopener noreferrer\">The Association of Hot Red Chili Pepper Consumption and Mortality: A Large Population-Based Cohort Study</a></li>\n<li>2017年Plos One 的另一项来自美国的研究以16179名，年龄在18岁以上的人群为对象，并对其进行了高达19年的随访，发现在4946例死亡患者中，食用辣椒的参与者的全因死亡率为21.6％，而未食用辣椒的参与者的全因死亡率为33.6％。相较于不吃辣或很少吃（少于每周两次）的人群，每周吃辣＞4次的人群总死亡风险降低23%，心血管死亡风险降低34%。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>鸡蛋\n<ul>\n<li><a href=\"https://m.thepaper.cn/baijiahao_11540780\" target=\"_blank\" rel=\"noopener noreferrer\">每天多吃半个蛋，增加7%的全因和心血管死亡风险？</a>\n<ul>\n<li>出处：<a href=\"https://dietandhealth.cancer.gov/\" target=\"_blank\" rel=\"noopener noreferrer\">NIH-AARP工作主页</a>、<a href=\"https://www.ncbi.nlm.nih.gov/pmc/articles/PMC7872242/\" target=\"_blank\" rel=\"noopener noreferrer\">Egg and cholesterol consumption and mortality from cardiovascular and different causes in the United States: A population-based cohort study</a></li>\n<li>每天多吃半个蛋，增加7%的全因和心血管死亡风险？在假设性替代分析中，研究者发现，用等量的蛋清/鸡蛋替代物、家禽、鱼、乳制品、坚果和豆类分别替代半只全蛋（25克/天）可以降低6%、8%、9%、7%、13%和10%的全因死亡率。<br>\n*<a href=\"https://raw.githubusercontent.com/qhy040404/Image-Resources-Repo/master/pmed.1003508.g002.jpg\" target=\"_blank\" rel=\"noopener noreferrer\">鸡蛋</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>坚果\n<ul>\n<li><a href=\"https://www.163.com/dy/article/GKVOMMMF05148PF4.html\" target=\"_blank\" rel=\"noopener noreferrer\">哈佛20年研究：吃核桃的人更长寿，显著减少全因死亡，延长寿命</a>\n<ul>\n<li>出处：<a href=\"https://www.mdpi.com/2072-6643/13/8/2699/pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Association of Walnut Consumption with Total and Cause-Specific Mortality and Life Expectancy in US Adults</a></li>\n<li>通过分析发现，经常食用核桃可以延长寿命，降低心血管疾病死亡风险。比起不吃核桃，每周食用核桃5份以上（1份28克）的健康预期寿命延长1.3岁，全因死亡风险降低14%，心血管疾病死亡率降低25%。</li>\n</ul>\n</li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/44454030\" target=\"_blank\" rel=\"noopener noreferrer\">研究：每日食生坚果，死亡率降20%</a>\n<ul>\n<li>出处1：<a href=\"https://www.nejm.org/doi/full/10.1056/NEJMoa1307352\" target=\"_blank\" rel=\"noopener noreferrer\">Association of nut consumption with total and cause-specific mortality</a></li>\n<li>出处2：<a href=\"https://americanpistachios.cn/sites/china/files/inline-files/APG_Health-%26-Nutrition-Research-Brochure_DEC-19-18.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">APG_Health-&amp;-Nutrition-Research-Brochure_DEC-19-18</a></li>\n<li>研究人员发现，每周吃树坚果低于1盎司份量的人，死亡率降低7％。而每周吃了1盎司份量的人，减少11％的死亡率；每周吃2份量的人，减低13％；每周5至6份量者，减少了15％；一周7份以上的人，死亡率则减少20％。</li>\n<li>另外两篇发表在《公共科学图书馆在线期刊》(Public Library of Science Online Journal)和《生物医学中心》(BioMed Central)上的医学预科研究论文，展示了试验开始时的横断面数据。这两项研究都评估了7,216名对象，以及他们食用坚果的频率和数量之间的关系。那些每周食用三份以上坚果(包括开心果)的研究对象的死亡率降低39%。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>钠（存有大量争议）\n<ul>\n<li><a href=\"https://nursing.medsci.cn/article/show_article.do;jsessionid=A34E8A33918A152CB55BDD2E5FB1798D?id=afe720486ee7\" target=\"_blank\" rel=\"noopener noreferrer\">Eur Heart J：钠摄入量与预期寿命、全因死亡率的关系</a>\n<ul>\n<li>出处：<a href=\"https://europepmc.org/backend/ptpmcrender.fcgi?accid=PMC8169157&amp;blobtype=pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Messerli F H, Hofstetter L, Syrogiannouli L, et al. Sodium intake, life expectancy, and all-cause mortality[J]. European heart journal, 2021, 42(21): 2103-2112.</a></li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/164894778-9710f18d-e055-4f62-bdcb-618687771d77.jpeg\" alt=\"ehaa947f6\" tabindex=\"0\" loading=\"lazy\"><figcaption>ehaa947f6</figcaption></li>\n<li>在该分析所包含的181个国家中，研究人员发现钠摄入量与出生时的健康预期寿命（β=2.6年/克每日钠摄入量，R<sup>2</sup>=0.66，P&lt;0.001）和60岁时的健康预期寿命（β=0.3年/克每日钠摄入量，R<sup>2</sup>=0.60，P=0.048）之间存在正相关关系，但与非传染性疾病死亡（β=17次事件/克每日钠摄入量，R<sup>2</sup>=0.43，P=0.100）无关。相反，全因死亡率与钠摄入量成负相关（β=−131次事件/克每日钠摄入量，R<sup>2</sup>=0.60，P&lt;0.001）。在仅限于46个收入最高国家的敏感性分析中，钠摄入量与出生时的健康预期寿命呈正相关（β=3.4年/克每日钠摄入量，R<sup>2</sup>=0.53，P&lt;0.001），而与全因死亡率（β=−168次事件/克每日钠摄入量，R<sup>2</sup>=0.50，P&lt;0.001）呈负相关。</li>\n<li>该（大范围）研究认为更多的钠摄入与显著更低的全因死亡率有关</li>\n<li><a href=\"https://www.tctmd.com/news/fresh-foray-salt-wars-life-expectancy-higher-greater-sodium-intake\" target=\"_blank\" rel=\"noopener noreferrer\">针对该论文的延伸解读和讨论：A Fresh Foray in the Salt Wars: Life Expectancy Higher With Greater Sodium Intake</a></li>\n</ul>\n</li>\n<li><a href=\"https://ibook.antpedia.com/x/669028.html\" target=\"_blank\" rel=\"noopener noreferrer\">NEJM/Lancet：不要吃太多盐，中国饮食所致心血管病和癌症死亡全球第一，吃低钠盐可降低全因死亡率</a>\n<ul>\n<li>但也有多项研究认为用低钠盐可以降低一系列疾病的发生概率，对全因死亡率的减少有积极影响</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>碳水（存有大量争议）\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/137815934\" target=\"_blank\" rel=\"noopener noreferrer\">低碳生酮饮食（四）碳水化合物与长期死亡率</a>\n<ul>\n<li>出处：The Lancet Public Health - <a href=\"https://www.sciencedirect.com/science/article/pii/S246826671830135X\" target=\"_blank\" rel=\"noopener noreferrer\">Dietary carbohydrate intake and mortality: a prospective cohort study and meta-analysis</a></li>\n<li>碳水越低，寿命越短；碳水越高，寿命也轻微缩短；碳水50%左右（其实按照一般的说法，这也算高碳水）是最长寿命区间</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163703985-a2e2f8ac-101a-4f3c-903b-6850507f144b.jpg\" alt=\"碳水\" tabindex=\"0\" loading=\"lazy\"><figcaption>碳水</figcaption></li>\n</ul>\n</li>\n<li><a href=\"https://www.chinacdc.cn/gwxx/202003/t20200323_214639.html\" target=\"_blank\" rel=\"noopener noreferrer\">最强营养搭配！BMJ：这么吃，心血管疾病和死亡风险更低</a></li>\n</ul>\n</li>\n<li>槟榔\n<ul>\n<li><a href=\"https://www.zhihu.com/question/312784161/answer/603370131\" target=\"_blank\" rel=\"noopener noreferrer\">如何看待槟榔嚼出来的癌症？槟榔致癌风险究竟有多大？ - 丁香医生的回答 - 知乎</a>\n<ul>\n<li>出处：Chewing Betel Quid and the Risk of Metabolic Disease, Cardiovascular Disease, and All-Cause Mortality: A Meta-Analysis(<a href=\"https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0070679\" target=\"_blank\" rel=\"noopener noreferrer\">https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0070679</a>)</li>\n<li>嚼槟榔会增加21%的全因死亡率</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>热量限制\n<ul>\n<li><a href=\"https://www.zhihu.com/question/31395511\" target=\"_blank\" rel=\"noopener noreferrer\">怎么看待BBC《进食、断食与长寿》？</a>\n<ul>\n<li>限制卡路里动物实验：CR（热量限制，即少吃）延迟了恒河猴的多种疾病发病和死亡率，与CR动物相比，正常喂养的猴子的各种疾病患病风险增加2.9倍，死亡风险增加3.0倍。</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163703988-8767185b-326a-4783-b2e2-f190322bb7d6.jpg\" alt=\"热量限制-恒河猴\" tabindex=\"0\" loading=\"lazy\"><figcaption>热量限制-恒河猴</figcaption></li>\n</ul>\n</li>\n</ul>\n</li>\n<li>综合\n<ul>\n<li><a href=\"https://www.chinacdc.cn/gwxx/202003/t20200323_214639.html\" target=\"_blank\" rel=\"noopener noreferrer\">最强营养搭配！BMJ：这么吃，心血管疾病和死亡风险更低</a></li>\n<li><a href=\"https://doi.org/10.1136/bmj.m688\" target=\"_blank\" rel=\"noopener noreferrer\">Associations of fat and carbohydrate intake with cardiovascular disease and mortality: prospective cohort study of UK Biobank participants</a>\n<ul>\n<li>通过对这些参与者的数据进行分析，研究人员发现碳水化合物（糖、淀粉和纤维）和蛋白质的摄入与全因死亡率呈非线性关系，而脂肪则与全因死亡率呈线性相关。其中，较高的糖分摄入与全因死亡风险和患心血管疾病的风险较高均有关联，而较高的饱和脂肪酸摄入与全因死亡风险较高有关。</li>\n<li>图1：各种营养元素与全因死亡之间的关系</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163702022-8c2bfea9-ed5d-4fe0-8ead-e8740014b92b.jpg\" alt=\"各种营养元素与全因死亡之间的关系\" tabindex=\"0\" loading=\"lazy\"><figcaption>各种营养元素与全因死亡之间的关系</figcaption></li>\n<li>图2：各种营养元素与心血管疾病之间的关系</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163702084-97fb4a03-707c-475d-b88e-6fe2f8e87f92.jpg\" alt=\"各种营养元素与心血管疾病之间的关系\" tabindex=\"0\" loading=\"lazy\"><figcaption>各种营养元素与心血管疾病之间的关系</figcaption></li>\n<li><strong>进一步研究表明，在所有的饮食模式中，全因死亡率风险最低的饮食方式为：10-30g高纤维、14-30%蛋白质、10-25%单不饱和脂肪酸、5%-7%多不饱和脂肪酸以及20%-30%淀粉摄入。</strong></li>\n<li><strong>最优能量来源配比：&lt;24%淀粉，15%-17%蛋白质，&gt;15%单不饱和脂肪酸，&lt;15%糖，6%饱和脂肪酸，6%多不饱和脂肪酸，30g+高纤维</strong></li>\n</ul>\n</li>\n<li><a href=\"https://med.ckcest.cn/details.html?id=5183272274855936&amp;classesEn=news\" target=\"_blank\" rel=\"noopener noreferrer\">BMJ | 常吃薯片汉堡巧克力等食品，平均死亡年龄仅仅为58岁，死亡风险剧增</a>\n<ul>\n<li><a href=\"https://www.bmj.com/content/365/bmj.l1949.full\" target=\"_blank\" rel=\"noopener noreferrer\">Rico-Campà A, Martínez-González M A, Alvarez-Alvarez I, et al. Association between consumption of ultra-processed foods and all cause mortality: SUN prospective cohort study[J]. bmj, 2019, 365.</a></li>\n<li><a href=\"https://www.bmj.com/content/365/bmj.l1451\" target=\"_blank\" rel=\"noopener noreferrer\">Srour B, Fezeu L K, Kesse-Guyot E, et al. Ultra-processed food intake and risk of cardiovascular disease: prospective cohort study (NutriNet-Santé)[J]. bmj, 2019, 365.</a></li>\n<li><a href=\"https://www.researchgate.net/profile/Phillip-Baker-5/publication/333483796_Ultra-processed_food_and_adverse_health_outcomes/links/5f0c646ca6fdcc2f32336a95/Ultra-processed-food-and-adverse-health-outcomes.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Lawrence M A, Baker P I. Ultra-processed food and adverse health outcomes[J]. bmj, 2019, 365.</a></li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4> 6.1.2. 液体</h4>\n<ul>\n<li>牛奶\n<ul>\n<li><a href=\"https://www.sohu.com/a/253940257_419768\" target=\"_blank\" rel=\"noopener noreferrer\">《柳叶刀》调研21个国家13万人：每天1斤牛奶或酸奶，心血管死亡风险下降23%</a></li>\n<li>出处：<a href=\"http://mdrf-eprints.in/1114/1/Association_of_dietary_patterns_and_dietary_diversity_with_cardiometabolic_disease_risk_factors.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Association of dairy intake with cardiovascular disease and mortality in 21 countries from five continents (PURE): a prospective cohort study</a></li>\n<li>与不食用乳制品的人相比，每天摄入两份乳制品（一份指244克牛奶/酸奶，15克奶酪或5克黄油）的人，<strong>全因死亡风险下降了17%</strong>，心血管死亡风险下降23%，中风风险下降33%</li>\n</ul>\n</li>\n<li>茶\n<ul>\n<li><a href=\"https://www.jianshu.com/p/5461a205cf95?utm_campaign=hugo\" target=\"_blank\" rel=\"noopener noreferrer\">10万中国人随访7年发现，每周喝三次茶与全因死亡风险降低15%，预期寿命增加1.26年相关</a></li>\n<li>出处：<a href=\"https://www.researchgate.net/profile/Fangchao-Liu-4/publication/338483323_Tea_consumption_and_the_risk_of_atherosclerotic_cardiovascular_disease_and_all-cause_mortality_The_China-PAR_project/links/5e55e5e94585152ce8efe511/Tea-consumption-and-the-risk-of-atherosclerotic-cardiovascular-disease-and-all-cause-mortality-The-China-PAR-project.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Tea consumption and the risk of atherosclerotic cardiovascular disease and all-cause mortality: The China-PAR project</a></li>\n<li><a href=\"http://rs.yiigle.com/CN112338202202/1351516.htm\" target=\"_blank\" rel=\"noopener noreferrer\">中国成年人饮茶与死亡风险的前瞻性关联研究</a></li>\n<li>纳入分析的438 443例研究对象随访11.1年共发生死亡34 661例。与从不饮茶者相比，当前非每日饮茶者和每日饮茶者全因死亡HR值（95%CI）依次为0.89（0.86-0.91）和0.92（0.88-0.95）。分性别分析显示，饮茶对全因死亡风险的保护作用主要见于男性（交互P&lt;0.05）</li>\n</ul>\n</li>\n<li>无糖（甜味）饮料\n<ul>\n<li><a href=\"https://www.zhihu.com/question/418598272/answer/1450648364\" target=\"_blank\" rel=\"noopener noreferrer\">「无糖饮料使死亡风险增加 26 %」，是真的吗？</a>\n<ul>\n<li>相比于软饮料摄入量＜1杯/月的参与者，混合软饮料摄入≥1杯/天的参与者死亡风险增加18%，而<strong>摄入含糖软饮料或无糖软饮料会令死亡风险分别增加11%和27%。</strong></li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163704346-e7d92e7f-eba5-4673-8f15-3a96782c2e32.png\" alt=\"饮料\" tabindex=\"0\" loading=\"lazy\"><figcaption>饮料</figcaption></li>\n</ul>\n</li>\n<li><a href=\"https://jamanetwork.com/journals/jamainternalmedicine/fullarticle/2749350\" target=\"_blank\" rel=\"noopener noreferrer\">Association Between Soft Drink Consumption and Mortality in 10 European Countries</a></li>\n</ul>\n</li>\n<li>有糖饮料\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/400746073\" target=\"_blank\" rel=\"noopener noreferrer\">可乐和奶茶，增加全因死亡率高达62%！果汁降低免疫力，影响肝代谢！含糖饮料那些事</a>\n<ul>\n<li>每天1杯含糖饮料增加7%全因死亡率，2杯21%</li>\n<li>在34年的随访中，研究人员发现，相比那些一个月喝1杯或者更少含糖饮料的人，每天喝2杯的人总体死亡风险升高了21%，心血管疾病死亡风险升高了31%，癌症死亡风险上升了16%。</li>\n<li>只要每天多喝一杯含糖饮料，总体死亡风险将增加7%，心血管疾病的风险将增加10%，癌症相关的死亡风险将16%。</li>\n<li>发表在国际顶级期刊《BMJ》上的一篇论文就证明了含糖饮料会在增加患癌风险，当然这篇文章验证的不仅仅是果汁，奶茶也有份——和含糖饮料相关的总体患癌风险要高出通常值18%，100%的鲜榨果汁也会使得整体的患癌风险上升12%。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>果汁\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/66513350\" target=\"_blank\" rel=\"noopener noreferrer\">JAMA子刊：100%纯果汁可能比含糖饮料更危险</a>\n<ul>\n<li>每天多摄入一份12盎司的含糖饮料，全因死亡率风险增加11%；</li>\n<li>每天多摄入一份12盎司的果汁，全因死亡率风险增加24%。</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>咖啡\n<ul>\n<li><a href=\"https://news.bioon.com/article/6725420.html\" target=\"_blank\" rel=\"noopener noreferrer\">重磅！多篇研究证实喝咖啡与人群全因死亡率降低直接相关</a></li>\n<li><a href=\"https://www.sohu.com/a/439412995_100003595\" target=\"_blank\" rel=\"noopener noreferrer\">科普 | 喝咖啡又多了一个新理由：降低死亡率！</a></li>\n<li><a href=\"https://fanyi.pdf365.cn/help/249\" target=\"_blank\" rel=\"noopener noreferrer\">地中海成年人咖啡消耗量及全因，心血管疾病和癌症的死亡率</a>\n<ul>\n<li>在最近的荟萃分析中，该研究包括来自不同国家的40项研究和3,852,651名受试者。在这项荟萃分析显示，咖啡摄入量与各种原因的死亡率，CVD和癌症死亡率之间存在非线性关系，每天摄入两杯咖啡的癌症死亡率最低(RR = 0.96)，CVD最低的死亡率，每天2.5杯(RR= 0.83)，全天最低死亡率为每天3.5杯(RR= 0.85)，并且随着咖啡消费量的增加，死亡率没有进一步降低或增加</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>亚精胺\n<ul>\n<li><a href=\"https://www.medsci.cn/article/show_article.do?id=420d12904103\" target=\"_blank\" rel=\"noopener noreferrer\">Science：科学背书！从精液中发现的亚精胺，竟然有着抗衰老、抗癌、保护心血管和神经、改善肥胖和2型糖尿病等逆天神效</a></li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/388942219\" target=\"_blank\" rel=\"noopener noreferrer\">饮食中亚精胺摄入量高会降低死亡率</a></li>\n</ul>\n</li>\n</ul>\n<h4> 6.1.3. 气体</h4>\n<ul>\n<li>吸烟\n<ul>\n<li><a href=\"https://www.medsci.cn/article/show_article.do?id=02ca2083319b\" target=\"_blank\" rel=\"noopener noreferrer\">即使是低强度吸烟，也增加死亡风险！</a>\n<ul>\n<li>研究发现：在42 416名男性和86 735名女性（年龄在35-89岁之间，以前没有患病）中，18 985名男性（45%）和18 072名女性（21%）目前吸烟，其中33%的男性吸烟者和39%的女性吸烟者并不每天吸烟。8866名男性（21%）和53 912名女性（62%）从不吸烟。在随访期间，与从不吸烟相比，每天&lt;10支烟或每天≥10支烟的全因死亡率危险比分别为1.17（95%置信区间1.10-1.25）和1.54（1.42-1.67）。无论年龄或性别，危险比相似。与每日吸烟关系最密切的疾病是呼吸道癌症、慢性阻塞性肺病和胃肠道及血管疾病。在招募时已经戒烟的人的死亡率低于现在每天吸烟者。</li>\n<li>吸烟者平均减少寿命11-12年</li>\n</ul>\n</li>\n<li><a href=\"https://www.zhihu.com/question/24846224/answer/1719798177\" target=\"_blank\" rel=\"noopener noreferrer\">吸烟让人过瘾是什么原理？有节制的吸烟依旧有害吗？</a></li>\n</ul>\n</li>\n</ul>\n<h4> 6.1.4. 光照</h4>\n<ul>\n<li>晒太阳\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/76301306\" target=\"_blank\" rel=\"noopener noreferrer\">晒太阳和死亡率的关系，如何科学，安全的晒太阳？<br>\n</a>\n<ul>\n<li>丹麦一项长达26年的研究发现，多晒太阳能显著延长寿命，即使是由于过度暴晒诱发皮肤癌的患者，平均寿命也比普通人长了6岁。</li>\n</ul>\n</li>\n</ul>\n</li>\n</ul>\n<h4> 6.1.5. 药物</h4>\n<ul>\n<li>NMN</li>\n<li>二甲双胍\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/419202902\" target=\"_blank\" rel=\"noopener noreferrer\">“胍”吹必看 丨我就是神药——二甲双胍</a>\n<ul>\n<li>二甲双胍不仅在多种肿瘤、心血管疾病及糖尿病中发挥保护作用，而且在肥胖、肝病、肾病及衰老方面也大放异彩。</li>\n</ul>\n</li>\n<li><a href=\"https://zhuanlan.zhihu.com/p/357807109\" target=\"_blank\" rel=\"noopener noreferrer\">二甲双胍2020最值得了解的“吃瓜”大新闻——护胃、健脑、抗衰、防癌还是致癌？</a></li>\n<li><a href=\"https://baijiahao.baidu.com/s?id=1729999374705305768\" target=\"_blank\" rel=\"noopener noreferrer\">二甲双胍真的那么神吗？美研究：父亲服用二甲双胍或致子女有缺陷</a></li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163702325-5d427542-9ae5-4311-8979-d0d326a9832f.jpg\" alt=\"二甲双胍\" tabindex=\"0\" loading=\"lazy\"><figcaption>二甲双胍</figcaption></li>\n<li>不良反应\n<ul>\n<li>作为一种使用近百年的药物，二甲双胍的不良反应已经非常明确，常见的有：维生素B12缺乏（7%-17.4%），胃肠道不良反应（最高53%），疲倦（9%），头痛（6%）；严重但不常见的不良反应包括乳酸酸中毒、肝损伤；也有研究表明可能对胎儿致畸</li>\n</ul>\n</li>\n</ul>\n</li>\n<li>复合维生素\n<ul>\n<li><a href=\"https://health.qq.com/a/20121023/000026.htm\" target=\"_blank\" rel=\"noopener noreferrer\">服用复合维生素可降低癌症危险8%，其他效果并不显著</a></li>\n</ul>\n</li>\n<li>葡萄糖胺\n<ul>\n<li><a href=\"https://www.sohu.com/a/436372221_120873241\" target=\"_blank\" rel=\"noopener noreferrer\">神奇！氨糖降低心血管死亡率65%，与定期运动效果相当</a></li>\n<li>美国西弗吉尼亚大学最新研究发现 氨糖（软骨素） 可以降低心血管死亡率65%，降低总体死亡率39%，效果与坚持定期运动相对</li>\n<li>该研究使用1999年至2010年，16,686名成年人的国家健康和营养检查(NHANES)数据，参与者的中位追踪时间为107个月，而其中有648位参与者定期且每服用日500-1000毫克的葡萄糖胺/软骨素一年以上。</li>\n</ul>\n</li>\n<li>亚精胺\n<ul>\n<li><a href=\"https://www.medsci.cn/article/show_article.do?id=420d12904103\" target=\"_blank\" rel=\"noopener noreferrer\">Science：科学背书！从精液中发现的亚精胺，竟然有着抗衰老、抗癌、保护心血管和神经、改善肥胖和2型糖尿病等逆天神效</a></li>\n<li>亚精胺是最容易从人体肠道吸收的多胺。许多的食物中都含有大量的亚精胺，例如新鲜的青椒、小麦胚芽、花椰菜、西兰花、蘑菇和各种奶酪，尤其在纳豆等大豆制品、香菇和榴莲中含量更高。在本实验中，研究人员选择了829位年龄在45-84岁之间的参与者进行了为期20年的随访，分析了饮食中亚精胺摄入量与人类死亡率之间的潜在关联。</li>\n<li>研究发现，女性的亚精胺摄入量高于男性，并且摄入量都会随着年龄的增长而下降。亚精胺的主要来源是全谷物（占13.4%）、苹果和梨（占13.3%）、沙拉（占9.8%）、芽菜（占7.3%）和马铃薯（占6.4%）。研究根据亚精胺摄入量将人群分为三组，低摄入量组（&lt;62.2 µmol / d）、中摄入量组（62.2–79.8 µmol / d）和高摄入量组（&gt; 79.8 µmol / d）。随访期间共记录了341例死亡，其中血管疾病137例，癌症94例，其他原因110例。经计算低中高三组的粗略死亡率分别为40.5%、23.7%和15.1%，这些数据表明亚精胺摄入量与全因死亡率之间的负相关关系显著。随着逐步对年龄、性别和热量的比例进行调整，这种相关关系依然显著。</li>\n</ul>\n</li>\n<li>综合\n<ul>\n<li><a href=\"https://zhuanlan.zhihu.com/p/145495570\" target=\"_blank\" rel=\"noopener noreferrer\">《自然》子刊深度综述：如何开发抗衰老药</a></li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163702474-205baeec-f0ce-4e8d-96a4-36efe47534de.jpg\" alt=\"如何开发抗衰老药\" tabindex=\"0\" loading=\"lazy\"><figcaption>如何开发抗衰老药</figcaption></li>\n</ul>\n</li>\n</ul>\n<h3> 6.2. 输出</h3>\n<h4> 6.2.1. 挥拍运动</h4>\n<ul>\n<li><a href=\"https://www.sohu.com/a/535581770_121124216\" target=\"_blank\" rel=\"noopener noreferrer\">哪种运动性价比最高？权威医学杂志“柳叶刀”给出答案了</a>\n<ul>\n<li>一周三次，每次45-60分钟，挥拍运动，降低~47%全因死亡率</li>\n<li>羽毛球、乒乓球、网球等都算挥拍运动，但由于西化研究背景，可能指网球更多。这隐式的表达了全身锻炼更为重要</li>\n</ul>\n</li>\n</ul>\n<h4> 6.2.2. 走路</h4>\n<ul>\n<li><a href=\"http://www.shcell.org/219/3571.html\" target=\"_blank\" rel=\"noopener noreferrer\">走路降低全因死亡率超过50%！每天走多少步最合适？《JAMA》子刊超10年研究告诉你答案</a>\n<ul>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163704147-afec1c79-799b-4db8-b547-1a2431d504c9.jpg\" alt=\"走路降低全因死亡率\" tabindex=\"0\" loading=\"lazy\"><figcaption>走路降低全因死亡率</figcaption></li>\n<li>注1：这项研究参与者的平均年龄为45.2岁</li>\n<li>注2：平均步数的多少与职业有关，此项研究仅表明相关性，还没有更深度的因果分析</li>\n</ul>\n</li>\n</ul>\n<h4> 6.2.3. 刷牙</h4>\n<ul>\n<li><a href=\"https://www.cn-healthcare.com/articlewm/20211209/content-1293760.html\" target=\"_blank\" rel=\"noopener noreferrer\">50万国人研究证实：不好好刷牙，致癌！血管疾病也会增多！</a>\n<ul>\n<li>经常不刷牙的人：癌症、慢性阻塞性肺病及肝硬化风险分别增加了9%、12%和25%，过早死亡风险增加25%。</li>\n</ul>\n</li>\n</ul>\n<h4> 6.2.4. 泡澡</h4>\n<ul>\n<li><a href=\"https://www.cn-healthcare.com/article/20200326/content-533379.html\" target=\"_blank\" rel=\"noopener noreferrer\">定期洗澡降低心血管疾病发作风险</a>\n<ul>\n<li>与每周一至两次泡澡或根本不泡澡相比，每天洗热水澡可以降低28%的心血管疾病总风险，降低26%的中风总风险，脑出血风险下降46%。而浴缸浴的频率与心源性猝死的风险增加无关。</li>\n</ul>\n</li>\n</ul>\n<h4> 6.2.5. 做家务（老年男性）</h4>\n<ul>\n<li><a href=\"https://journals.plos.org/plosone/article?id=10.1371/journal.pone.0061529\" target=\"_blank\" rel=\"noopener noreferrer\">Housework Reduces All-Cause and Cancer Mortality in Chinese Men</a>\n<ul>\n<li>72岁之后男性每周做重型家务可以减少29%平均死亡率</li>\n<li>重型家务：吸尘、擦地板、拖地、擦洗窗户、洗车、搬动家具、搬煤气罐等等。</li>\n<li>轻型家务：掸灰尘、洗碗、手洗衣服、熨烫、晾衣服、做饭、买日用品等等。</li>\n</ul>\n</li>\n</ul>\n<h4> 6.2.6. 睡眠</h4>\n<ul>\n<li><a href=\"https://med.sina.com/article_detail_103_1_105491.html\" target=\"_blank\" rel=\"noopener noreferrer\">超30万亚洲人数据：每天睡几个小时最有益长寿？</a>\n<ul>\n<li>在男性中，与睡眠时长为7小时相比：睡眠持续时间≥10小时与全因死亡风险增加34%相关；</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163704166-226b7ebb-92ce-4753-a3e7-77a87652a104.jpg\" alt=\"睡眠-男\" tabindex=\"0\" loading=\"lazy\"><figcaption>睡眠-男</figcaption></li>\n<li>在女性中，与睡眠持续时间7小时相比：睡眠持续时间≥10小时与全因死亡风险增加48%相关；</li>\n<li><img src=\"https://user-images.githubusercontent.com/2707039/163704169-c5c715aa-7130-403b-b0d1-ec34fab094d8.png\" alt=\"睡眠-女\" tabindex=\"0\" loading=\"lazy\"><figcaption>睡眠-女</figcaption></li>\n</ul>\n</li>\n<li><a href=\"https://www.thepaper.cn/newsDetail_forward_14461799\" target=\"_blank\" rel=\"noopener noreferrer\">颠覆认知！加拿大研究发现：早睡比熬夜或许更伤身，几点睡才好？</a>\n<ul>\n<li>其中一个结论为，就寝时间与全因死亡率的关联性强，过早睡觉和过晚睡觉都会影响健康，但是早睡增加的全因死亡率比晚睡增加的死亡率高，早睡增加了43%的死亡风险，而晚睡增加了15%的死亡风险。</li>\n<li>这项调查研究，还存在很多局限性，比如没有直接证明就寝时间与死亡的关系，仅仅说明相关性，通过参与人群自我报告统计睡眠时间，数据不够客观</li>\n</ul>\n</li>\n</ul>\n<h3> 6.3. 上下文</h3>\n<h4> 6.3.1. 情绪</h4>\n<ul>\n<li><a href=\"https://www.x-mol.com/paper/1288184397379059712/t?recommendPaper=1263704526086578176\" target=\"_blank\" rel=\"noopener noreferrer\">悲观情绪与更高的全因死亡率和心血管疾病死亡率有关，但乐观情绪并不能起到保护作用</a></li>\n<li><a href=\"https://www.nature.com/articles/s41598-020-69388-y?utm_source=xmol&amp;utm_medium=affiliate&amp;utm_content=meta&amp;utm_campaign=DDCN_1_GL01_metadata_scirep\" target=\"_blank\" rel=\"noopener noreferrer\">Pessimism is associated with greater all-cause and cardiovascular mortality, but optimism is not protective</a>\n<ul>\n<li>在1993-1995年间，一项针对50岁以上澳大利亚人健康的双胞胎研究中包括了生活取向测试（LOT），其中包含乐观和悲观的项目。平均20年后，参与者与来自澳大利亚国家死亡指数的死亡信息相匹配。在2,978名具有很多可用分数的参与者中，有1,068人死亡。生存分析测试了各种乐观因素和悲观情绪分数与任何原因，癌症，心血管疾病或其他已知原因的死亡率之间的关联。年龄调整后的悲观量表上的核心与全因和心血管疾病死亡率相关（每1个标准差单位的危险比，95％置信区间和p值1.134、1.065–1.207、8.85×10 –5和1.196、1.045–1.368、0.0093 ），但不会因癌症死亡。乐观得分与悲观得分之间的相关性很弱（年龄调整后的等级相关系数= − 0.176），但与总死亡率或特定原因死亡率没有显着相关性。反向因果关系（引起悲观情绪的疾病）是不可能的，因为在那种情况下，心血管疾病和癌症都会导致悲观情绪。</li>\n</ul>\n</li>\n</ul>\n<h4> 6.3.2. 贫富</h4>\n<ul>\n<li><a href=\"https://www.cn-healthcare.com/articlewm/20210727/content-1246348.html\" target=\"_blank\" rel=\"noopener noreferrer\">JAMA子刊：贫富差距真能影响寿命？这可能是真的！</a>\n<ul>\n<li>该研究使用1994-1996年第一次收集的数据，并通过生存模型来分析净资产和长寿之间的关联。结果显示，共收纳5414 名参与者，平均年龄为 46.7岁，包括 2766 名女性。较高的净资产与较低的死亡风险相关。特别是在兄弟姐妹和双胞胎中（n = 2490），在较高的净资产和较低的死亡率之间观察到类似的关联，表明拥有更多财富的兄弟姐妹或双胞胎比拥有更少财富的兄弟姐妹/双胞胎活得更久。</li>\n</ul>\n</li>\n</ul>\n<h4> 6.3.3. 体重</h4>\n<ul>\n<li><a href=\"https://www.chinacdc.cn/gwxx/202009/t20200904_218959.html\" target=\"_blank\" rel=\"noopener noreferrer\">JAMA子刊：减肥要趁早，才能有效降低死亡率风险</a>\n<ul>\n<li>对体重减轻的死亡率风险评估发现，体重从肥胖减轻到超重的成年人与稳定肥胖人群相比，全因死亡率降低了54％（危险比为0.46），然而从成年初期的超重减轻到中年以前的正常体重的人群的死亡率风险并未降低（风险比为1.12）。</li>\n<li><img src=\"https://raw.githubusercontent.com/qhy040404/Image-Resources-Repo/master/zoi200509t3_1596761185.02415.png\" alt=\"Table3\" tabindex=\"0\" loading=\"lazy\"><figcaption>Table3</figcaption></li>\n</ul>\n</li>\n</ul>\n<h4> 6.3.4. 新冠</h4>\n<ul>\n<li><a href=\"https://www.nature.com/articles/s41591-020-1112-0.pdf\" target=\"_blank\" rel=\"noopener noreferrer\">Magnitude, demographics and dynamics of the effect of the first wave of the COVID-19 pandemic on all-cause mortality in 21 industrialized countries</a>\n<ul>\n<li>目前来看，新冠死亡率（美国）在1.5%左右，人均预期寿命减少了2年</li>\n</ul>\n</li>\n<li><a href=\"https://www.zhihu.com/question/510943670/answer/2308499719\" target=\"_blank\" rel=\"noopener noreferrer\">如何看待美国CDC宣称新冠死亡人数被高估？</a></li>\n<li><a href=\"https://www.cdc.gov/nchs/nvss/deaths.htm\" target=\"_blank\" rel=\"noopener noreferrer\">NVSS deaths</a></li>\n</ul>\n",
      "image": "https://user-images.githubusercontent.com/2707039/163703960-6f321de5-4daa-4ea5-95b9-af9c96f1c1bc.jpg",
      "date_published": "2023-03-03T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "转载"
      ]
    },
    {
      "title": "收集的一些网站",
      "url": "https://Hexiaopi.github.io/other/website.html",
      "id": "https://Hexiaopi.github.io/other/website.html",
      "summary": "算法 数据结构和算法动态可视化 算法可视化 在线运行代码的算法可视化",
      "content_html": "<h2> 算法</h2>\n<p>数据结构和算法动态可视化<a href=\"https://visualgo.net/zh\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>算法可视化<a href=\"https://www.chrislaux.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>在线运行代码的算法可视化<a href=\"https://algorithm-visualizer.org/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>数据结构可视化<a href=\"https://www.cs.usfca.edu/~galles/visualization/Algorithms.html\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>算法实现<a href=\"https://the-algorithms.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> Linux</h2>\n<p>鸟哥的Linux私房菜<a href=\"http://cn.linux.vbird.org/linux_basic/linux_basic.php\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>TLCL<a href=\"http://billie66.github.io/TLCL/book/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>精彩的Linux命令<a href=\"https://www.cnblogs.com/nineep/p/6795650.html\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>命令行的艺术<a href=\"https://github.com/jlevy/the-art-of-command-line/blob/master/README-zh.md\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>CURL使用<a href=\"https://everything.curl.dev/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> 设计模式</h2>\n<p>图说设计模式<a href=\"https://design-patterns.readthedocs.io/zh_CN/latest/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go设计模式<a href=\"https://golangbyexample.com/all-design-patterns-golang/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go设计模式<a href=\"https://dev.to/gopher/go-all-design-patterns-code-with-workflow-ea1\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>设计模式<a href=\"https://refactoringguru.cn/design-patterns\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> 容器化</h2>\n<p>Docker-从入门到实践<a href=\"https://www.cntofu.com/book/139/index.html\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Docker中文文档<a href=\"http://www.dockerinfo.net/document\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>从Docker到kubernetes进阶<a href=\"https://www.qikqiak.com/k8s-book/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Kubernetes中文指南<a href=\"https://jimmysong.io/kubernetes-handbook/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Prometheus告警<a href=\"https://awesome-prometheus-alerts.grep.to/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> 设计</h2>\n<p>Google API设计指南<a href=\"https://www.bookstack.cn/read/API-design-guide/API-design-guide-README.md\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n",
      "date_published": "2023-03-04T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "转载"
      ]
    },
    {
      "title": "接口规范",
      "url": "https://Hexiaopi.github.io/project-standard/api.html",
      "id": "https://Hexiaopi.github.io/project-standard/api.html",
      "summary": "API接口文档常常包含以下内容 接口详细列表，包含接口功能，请求方法、输入参数、输出参数、请求示例 CHANGELOG：API接口文档变更历史，方便进行回溯 通用的请求参数、返回参数、认证方法或者加密算法 接口中使用的数据结构 错误码描述 常见的API接口规范为：RESTful API规范 URI URI表示资源，资源一般对应后端实体，例如：用户为user 资源集合通常使用复数形式，例如：users",
      "content_html": "<blockquote>\n<p>API接口文档常常包含以下内容</p>\n<ul>\n<li>接口详细列表，包含接口功能，请求方法、输入参数、输出参数、请求示例</li>\n<li>CHANGELOG：API接口文档变更历史，方便进行回溯</li>\n<li>通用的请求参数、返回参数、认证方法或者加密算法</li>\n<li>接口中使用的数据结构</li>\n<li>错误码描述</li>\n</ul>\n</blockquote>\n<p>常见的API接口规范为：RESTful API规范</p>\n<h2> URI</h2>\n<blockquote>\n<p>URI表示资源，资源一般对应后端实体，例如：用户为user<br>\n资源集合通常使用复数形式，例如：users</p>\n</blockquote>\n<h2> Request</h2>\n<blockquote>\n<p>通过HTTP方法对资源进行CRUD</p>\n</blockquote>\n<p>GET：查询资源集合或一个资源</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>POST：创建一个资源</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>PUT：更新一个资源（全量更新）</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>PATCH：更新一个资源（部分更新，例如只更新用户的状态等）</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>DELETE：删除一个资源</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>安全性和幂等性</p>\n<blockquote>\n<p>安全性：不会改变资源状态，可以理解为只读的；<br>\n幂等性：执行1次和执行N次，对资源状态改变效果是等价的；</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">Request</th>\n<th style=\"text-align:center\">安全性</th>\n<th style=\"text-align:center\">幂等性</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">GET</td>\n<td style=\"text-align:center\">Y</td>\n<td style=\"text-align:center\">Y</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">POST</td>\n<td style=\"text-align:center\">N</td>\n<td style=\"text-align:center\">N</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">PUT</td>\n<td style=\"text-align:center\">N</td>\n<td style=\"text-align:center\">Y</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">PATCH</td>\n<td style=\"text-align:center\">N</td>\n<td style=\"text-align:center\">Y</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">DELETE</td>\n<td style=\"text-align:center\">N</td>\n<td style=\"text-align:center\">Y</td>\n</tr>\n</tbody>\n</table>\n<blockquote>\n<p>这里的幂等性关注的是资源状态改变效果，而非两次相同的请求得到相同的结果。</p>\n<p>例如：删除某一个资源，第一次成功删除，下次再删除就不一定成功了。但是对于这条资源的最终状态来说，都是一样的，即该资源已删除。</p>\n</blockquote>\n<h2> Response</h2>\n<h3> 错误处理</h3>\n<blockquote>\n<p>返回错误码及其描述<br>\nAPI包含两类异常：业务异常和非业务异常</p>\n<p>业务异常须返回相应的HTTP状态码，例如：</p>\n<ul>\n<li>请求未授权对应HTTP状态码401；</li>\n<li>请求参数校验失败对应HTTP状态码400；</li>\n</ul>\n<p>非业务异常统一返回状态码500</p>\n</blockquote>\n<h2> 接口版本</h2>\n<blockquote>\n<p>接口版本常常发生在不兼容场景。<br>\n常见通过URI中增加版本号信息，例如：</p>\n<ul>\n<li>/api/v1/user</li>\n<li>/api/v2/user</li>\n</ul>\n</blockquote>\n",
      "date_published": "2020-01-24T00:00:00.000Z",
      "date_modified": "2023-08-03T13:57:06.000Z",
      "authors": [],
      "tags": [
        "项目规范"
      ]
    },
    {
      "title": "分支规范",
      "url": "https://Hexiaopi.github.io/project-standard/branch.html",
      "id": "https://Hexiaopi.github.io/project-standard/branch.html",
      "summary": "git-model 提示 一个好的代码分支应该是怎样的❓",
      "content_html": "<figure><img src=\"https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122301.png\" alt=\"git-model\" tabindex=\"0\" loading=\"lazy\"><figcaption>git-model</figcaption></figure>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>一个好的代码分支应该是怎样的❓</p>\n</div>\n<!-- more -->\n<h2> 分支模型</h2>\n<p>我们经常使用Git用于管理版本，但如果没有清晰的流程和规范，会导致难以协调和维护。<br>\nVincent Driessen 为了解决这个问题，提出<a href=\"https://nvie.com/posts/a-successful-git-branching-model/\" target=\"_blank\" rel=\"noopener noreferrer\">A Successful Git Branching Model</a></p>\n<figure><figcaption>git-model</figcaption></figure>\n<h2> master分支</h2>\n<p>这个分支保持最近发布到生产环境的代码。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<ul>\n<li>不能在这个分支直接修改</li>\n<li>生产环境运行的代码和该分支保持一致</li>\n<li>master分支每合并一个hotfix/release分支，都会打一个版本标签</li>\n</ul>\n</div>\n<h2> develop分支</h2>\n<p>这个分支是我们的主开发分支</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>feature/release/hotfix都需要合并到该分支</p>\n</div>\n<h2> feature分支</h2>\n<p>这个分支是用来开发新的功能，一旦开发完成，合并到develop分支并进入下一个release</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<ul>\n<li>分支命名建议：<code>feature/xxx-xxx</code></li>\n<li>合并到develop分支需要删除该分支，如果有bug，在对应的release分支进行修复</li>\n<li>feature分支合并到develop分支之前先pull一下develop分支，避免冲突</li>\n</ul>\n</div>\n<h2> release分支</h2>\n<p>当需要发布一个新的release的时候，基于develop分支创建一个release分支</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li>分支名建议命名<code>release/xxx-xxx</code></li>\n<li>测试人员基于release分支进行测试，如有bug，也在该分支修复，再测试。</li>\n<li>完成release分支后需要合并到master和develop分支</li>\n</ul>\n</div>\n<h2> hotfix分支</h2>\n<p>当在现网发现bug时，需要创建一个hotfix分支进行修复，完成后合并到master和develop，hotfix的改动会进入下一个release</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<ul>\n<li>建议命名：<code>hotfix/xxx-xxx</code></li>\n<li>只能基于master分支创建hotfix分支</li>\n</ul>\n</div>\n",
      "image": "https://www.ruanyifeng.com/blogimg/asset/2015/bg2015122301.png",
      "date_published": "2020-02-11T00:00:00.000Z",
      "date_modified": "2023-08-03T13:57:06.000Z",
      "authors": [],
      "tags": [
        "项目规范"
      ]
    },
    {
      "title": "提交规范",
      "url": "https://Hexiaopi.github.io/project-standard/commit.html",
      "id": "https://Hexiaopi.github.io/project-standard/commit.html",
      "summary": "Commit Message Git每次提交代码，都需要写Commit message，好的规范例如：Angular规范，可以帮助我们： 根据摘要信息就可以知道每次变更哪些内容 可以过滤某些commit，例如只关注新增加的功能 根据commit生成Change log",
      "content_html": "<h2> Commit Message</h2>\n<p>Git每次提交代码，都需要写<code>Commit message</code>，好的规范例如：<a href=\"https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#-commit-message-guidelines\" target=\"_blank\" rel=\"noopener noreferrer\">Angular规范</a>，可以帮助我们：</p>\n<ul>\n<li>根据摘要信息就可以知道每次变更哪些内容</li>\n<li>可以过滤某些commit，例如只关注新增加的功能</li>\n<li>根据commit生成<code>Change log</code></li>\n</ul>\n<p>在Angular规范中，Commit Message包含三个部分：Header、Body、Footer，格式如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li><code>&lt;scope&gt;</code>必须用括号()括起来</li>\n<li><code>&lt;type&gt;(&lt;scope&gt;)</code>后必须紧跟冒号，冒号后紧跟空格</li>\n<li><code>&lt;body&gt;</code>和<code>&lt;footer&gt;</code>之前两个空行也必须要有</li>\n</ul>\n<p>建议每行字符控制在<code>72</code>个字符之内</p>\n</div>\n<h3> Header（必须项）</h3>\n<p>示例：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h4> type（必须项）</h4>\n<blockquote>\n<p>type用来说明commit的类型：</p>\n</blockquote>\n<ul>\n<li>feat：新功能（feature）</li>\n<li>fix：修补bug</li>\n<li>perf: 提高代码性能的变更</li>\n<li>docs：文档（documentation）</li>\n<li>style： 格式（不影响代码运行的变动）</li>\n<li>refactor：优化重构（即不是新增功能，也不是修改bug的代码变动，例如：变量重命名、冗余代码删除、代码简化或增加注释）</li>\n<li>test：增加测试</li>\n<li>chore：构建过程或辅助工具的变动</li>\n</ul>\n<p>type为<code>feat</code>和<code>fix</code>的可以出现在<code>Change log</code>中，其他建议不要</p>\n<h4> scope（可选项）</h4>\n<blockquote>\n<p>scope用于说明commit影响范围，视项目不同而不同。<br>\n如果项目包含多个组件，建议每个组件作为scope<br>\n如果项目只有一个组件，建议根据分成作为scope，例如数据层、控制层、视图层</p>\n</blockquote>\n<h4> subject（可选项）</h4>\n<blockquote>\n<p>subject是commit的简短描述，建议：</p>\n<ul>\n<li>以动词开头、使用第一人称现在时</li>\n<li>第一个字母小写</li>\n<li>结尾不加句号</li>\n</ul>\n</blockquote>\n<h3> Body（可选项）</h3>\n<blockquote>\n<p>Body用于对本次commit的详细描述，可以分多行。建议：<br>\n说明本次修改的冬季<br>\n和上一版本相比的改动点</p>\n</blockquote>\n<p>示例：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> Footer（可选项）</h3>\n<blockquote>\n<p>用来说明本次commit导致的后果，常用来说明：</p>\n<ul>\n<li>不兼容的改动，以<code>BREAKING CHANGE</code>开头</li>\n<li>关闭的Issue列表<br>\n示例：</li>\n</ul>\n</blockquote>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>或</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h2> Change Log</h2>\n<p>我们可以使用一些工具根据git提交记录自动生成<code>CHANGELOG</code>，例如：<br>\n<a href=\"https://github.com/git-chglog/git-chglog\" target=\"_blank\" rel=\"noopener noreferrer\">git-chglog</a>，本项目的<code>CHANGELOG</code>就是使用该工具自动生成，非常方便。</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h2> SemVer</h2>\n<p>可以使用<a href=\"https://github.com/arnaud-deprez/gsemver\" target=\"_blank\" rel=\"noopener noreferrer\">gsemver</a>工具根据git提交记录生成下一个版本</p>\n",
      "date_published": "2020-02-02T00:00:00.000Z",
      "date_modified": "2023-08-03T13:57:06.000Z",
      "authors": [],
      "tags": [
        "项目规范"
      ]
    },
    {
      "title": "目录规范",
      "url": "https://Hexiaopi.github.io/project-standard/directory.html",
      "id": "https://Hexiaopi.github.io/project-standard/directory.html",
      "summary": "提示 Go语言项目业界公认的目录结构是怎样的❓",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>Go语言项目业界公认的目录结构是怎样的❓</p>\n</div>\n<!-- more -->\n<h2> 目录结构</h2>\n<blockquote>\n<p>可以通过以下维度进行考量：</p>\n<ul>\n<li>\n<p>命名清晰：目录命名需要简洁，清晰的表达出该目录实现的功能，做到一看到该目录名就知道是干嘛的；</p>\n</li>\n<li>\n<p>功能明确：目录的功能必须明确，例如：api目录是接口服务、service目录是业务逻辑；</p>\n</li>\n<li>\n<p>功能齐全：例如测试、构建、脚本、工具、文档等；</p>\n</li>\n</ul>\n</blockquote>\n<p>这里参考Go语言公认项目目录<a href=\"https://github.com/golang-standards/project-layout\" target=\"_blank\" rel=\"noopener noreferrer\">project-layout</a>结构如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 应用目录</h2>\n<h3> api目录</h3>\n<blockquote>\n<p>OpenAPI/Swagger规范、JSON模式文件、协议定义文件</p>\n</blockquote>\n<h3> cmd目录</h3>\n<blockquote>\n<p>该项目的主要应用，Go语言以main函数文件作为程序入口。每个应用程序的目录名称应与执行文件的名称相匹配，例如：<code>/cmd/myapp</code></p>\n</blockquote>\n<h3> examples目录</h3>\n<blockquote>\n<p>应用程序和公共库的示例</p>\n</blockquote>\n<h3> internal目录</h3>\n<blockquote>\n<p>存放私有应用和库代码，如果一些代码，你不希望在其他在其他应用和库中被导入，可以放在internal目录下。而对于私有应用共享的代码可以放在/internal/pkg目录下。<br>\n建议internal目录以各个组件的方式进行分层。</p>\n</blockquote>\n<h3> pkg目录</h3>\n<blockquote>\n<p>与internal相反，该目录存放可供其他外部应用程序使用的库代码。</p>\n</blockquote>\n<h3> vendor目录</h3>\n<blockquote>\n<p>该目录存放项目依赖，可通过<code>go mod vendor</code>创建。</p>\n</blockquote>\n<p>👀 注意</p>\n<p>如果开发的是Go语言库，不要提交vendor依赖包</p>\n<h3> test目录</h3>\n<blockquote>\n<p>其他外部测试应用程序和测试数据。对于更大的项目，有一个数据子目录是有意义的。例如：<code>/test/data</code>或者<code>/test/testdata</code></p>\n</blockquote>\n<p>👀 注意</p>\n<p>Go 也会忽略以“.”开头的目录或文件。或“_”，因此您可以更灵活地命名测试数据目录。</p>\n<h3> third_party目录</h3>\n<blockquote>\n<p>外部帮助工具，分支代码或其他第三方应用。</p>\n</blockquote>\n<h3> tools目录</h3>\n<blockquote>\n<p>该项目的支持工具</p>\n</blockquote>\n<p>👀 注意</p>\n<p>这些工具可以从<code>pkg</code>和<code>internal</code>目录导入代码</p>\n<h3> web目录</h3>\n<blockquote>\n<p>前端代码存放目录，用来存放Web静态资源，服务端模块和单页应用（SPAs）</p>\n</blockquote>\n<h3> assets</h3>\n<blockquote>\n<p>其他资产，例如：图像、徽标、CSS、JavaScript等</p>\n</blockquote>\n<h3> website</h3>\n<blockquote>\n<p>项目网站或者Github页面</p>\n</blockquote>\n<h2> 项目管理目录与文件</h2>\n<h3> build目录</h3>\n<blockquote>\n<p>打包和持续集成</p>\n<p>将云 (AMI)、容器 (Docker)、操作系统（deb、rpm、pkg）包配置和脚本放在<code>/build/package</code>目录中。</p>\n<p>将CI（travis、circle、drone）配置和脚本放在<code>/build/ci</code>目录中。</p>\n</blockquote>\n<p>👀 注意</p>\n<p>一些 CI 工具（例如 Travis CI）对其配置文件的位置非常挑剔。尝试将配置文件放在/build/ci将它们链接到 CI 工具期望它们的位置的目录中（如果可能）。</p>\n<h3> configs目录</h3>\n<blockquote>\n<p>配置文件，例如这里可以存放confd或consul-template模版文件。</p>\n</blockquote>\n<h3> deployments目录</h3>\n<blockquote>\n<p>IaaS、PaaS、系统和容器编排部署配置和模板（docker-compose、kubernetes/helm、mesos、terraform、bosh）。</p>\n</blockquote>\n<p>👀 注意</p>\n<p>在某些存储库（尤其是使用 kubernetes 部署的应用程序）中，此目录称为<code>deploy</code>.</p>\n<h3> init目录</h3>\n<blockquote>\n<p>系统初始化（systemd、upstart、sysv）和进程管理器(runit、supervisord)配置文件，在非容器化部署的项目中会使用到。</p>\n</blockquote>\n<p>例如：systemd的unit文件，用于管理程序，一般以.service结尾</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> scripts目录</h3>\n<blockquote>\n<p>执行各种构建、安装、分析等操作的脚本。这些脚本使根级 Makefile 小而简单</p>\n</blockquote>\n<p>例如: <a href=\"https://github.com/hashicorp/terraform/blob/master/Makefile\" target=\"_blank\" rel=\"noopener noreferrer\">terraform-website</a>使用了很多scipts目录下的脚本，使得Makefile小但功能强大。</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> githooks目录</h3>\n<blockquote>\n<p>Git钩子，比如可以将commit-msg存放在该目录</p>\n</blockquote>\n<h3> Makefile文件</h3>\n<blockquote>\n<p>Makefile是一个很优秀的项目管理工具，通常用来执行静态代码检查、单元测试、编译等功能</p>\n</blockquote>\n<ul>\n<li>静态代码检查(lint)：推荐用 golangci-lint。</li>\n<li>单元测试(test)：运行 go test ./...。</li>\n<li>编译(build)：编译源码，支持不同的平台，不同的 CPU 架构。</li>\n<li>镜像打包和发布(image/image.push)：现在的系统比较推荐用 Docker/Kubernetes 进行部署，所以一般也要有镜像构建功能。</li>\n<li>清理（clean）:清理临时文件或者编译后的产物。</li>\n<li>代码生成（gen）：比如要编译生成 protobuf pb.go 文件。</li>\n<li>部署（deploy，可选）：一键部署功能，方便测试。</li>\n<li>发布（release）：发布功能，比如：发布到 Docker Hub、github 等。</li>\n<li>帮助（help）:告诉 Makefile 有哪些功能，如何执行这些功能。</li>\n<li>版权声明（add-copyright）：如果是开源项目，可能需要在每个文件中添加版权头，这可以通过 Makefile 来添加。</li>\n<li>API 文档（swagger）：如果使用 swagger 来生成 API 文档，这可以通过 Makefile 来生成。</li>\n</ul>\n<h2> 文档目录与文件</h2>\n<h3> docs目录</h3>\n<blockquote>\n<p>设计和用户文档，除了<code>godoc</code>生成的文档之外</p>\n</blockquote>\n<ul>\n<li>/docs/devel/{en-US,zh-CN}: 存放开发文档、hack文档</li>\n<li>/docs/guide/{en-US,zh-CN}: 存放用户手册，安装、quickstart、产品文档等</li>\n<li>/docs/image: 存放图片文件</li>\n</ul>\n<h3> CHANGELOG目录</h3>\n<blockquote>\n<p>当项目有更新时，为了方便了解当前版本的更新内容或者历史更新内容，需要将更新记录存放到CHANGELOG目录。</p>\n</blockquote>\n<p>编写CHANGELOG是一个繁琐的工作，我们可以结合<a href=\"https://github.com/angular/angular/blob/22b96b9/CONTRIBUTING.md#-commit-message-guidelines\" target=\"_blank\" rel=\"noopener noreferrer\">Angular规范</a>和<a href=\"https://github.com/git-chglog/git-chglog\" target=\"_blank\" rel=\"noopener noreferrer\">git-chglog工具</a></p>\n<h3> CONTRIBUTING.md文件</h3>\n<blockquote>\n<p>开源项目用于说明如何贡献代码，如何开源协同等。</p>\n</blockquote>\n<h3> LICENSE文件</h3>\n<blockquote>\n<p>版权文件，常用的开源协议有：Apache 2.0、MIT、GPL等</p>\n</blockquote>\n<p>为了声明版权，你可能会需要将LICENSE头添加到源代码文件或者其他文件中，可以尝试使用这个工具自动化实现：<a href=\"https://github.com/marmotedu/addlicense\" target=\"_blank\" rel=\"noopener noreferrer\">addlicense</a></p>\n<p>当代码中引用了其他开源代码时，需要在LICENSE中说明对其他源码的引用，可以借助工具来进行检查：<a href=\"https://github.com/ribice/glice\" target=\"_blank\" rel=\"noopener noreferrer\">glice</a></p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> README.md文件</h3>\n<blockquote>\n<p>项目的README文件一般包含了项目的介绍、功能、快速安装和使用指引、详细的文档链接以及开发指引。</p>\n</blockquote>\n<p>有时候README文档比较长，可以借助工具<a href=\"https://github.com/nochso/tocenize\" target=\"_blank\" rel=\"noopener noreferrer\">tocenize</a>来添加markdown toc索引</p>\n<h2> 不应该拥有的目录</h2>\n<h3> src</h3>\n<blockquote>\n<p>Go语言的工作空间包含：<code>pkg</code>、<code>bin</code>、<code>src</code>。且项目代码放在<code>src</code>目录下，如果一个Go项目包含<code>src</code>目录，则项目路径将会变成：<code>/some/path/to/workspace/src/your_project/src/your_code.go</code>，就变得非常丑。</p>\n</blockquote>\n",
      "date_published": "2020-02-09T00:00:00.000Z",
      "date_modified": "2023-08-03T13:57:06.000Z",
      "authors": [],
      "tags": [
        "项目规范"
      ]
    },
    {
      "title": "版本规范",
      "url": "https://Hexiaopi.github.io/project-standard/version.html",
      "id": "https://Hexiaopi.github.io/project-standard/version.html",
      "summary": "提示 随着系统功能越来越复杂，依赖的软件包越来越多，如何解决【依赖地狱】问题？",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>随着系统功能越来越复杂，依赖的软件包越来越多，如何解决【依赖地狱】问题？</p>\n</div>\n<!-- more -->\n<h2> 语义化版本规范</h2>\n<blockquote>\n<p>语义化版本规范（SemVer,Semantic Versioning）是Github起草的一个具有指导意义的、统一的版本号表示规范。<br>\n它规定了版本号的表示、增加和比较方式，以及不同版本号代表的含义。</p>\n</blockquote>\n<p>语义化版本格式为：<code>主版本号.次版本号.修订号（X.Y.Z）</code>，其中X、Y和Z为非负整数，且禁止在数字前方补零。<br>\n例如：v1.2.3</p>\n<p>版本号增加的含义：</p>\n<ul>\n<li>主版本号（MAJOR）：当做了不兼容的API修改。一般用于大的功能变动(Breaking Change)，影响到之前的功能。</li>\n<li>次版本号（MINOR）：当做了向下兼容的功能性新增及修改。一般用于不影响之前逻辑的功能优化，或者新的功能(New Feature)。</li>\n<li>修订号（PATCH）：当做了向下兼容的问题修正，一般用于问题修复(Bug Fix)。</li>\n</ul>\n<figure><figcaption>server</figcaption></figure>\n<p>一些经验：</p>\n<ul>\n<li>建议0.1.0作为第一个开发版本号；</li>\n<li>当用于正式环境，它应该达到1.0.0版，0.y.z版本均可视为不稳定版本，仍在持续开发中；</li>\n<li>v1.2.3并不是一个语义化的版本号，但是在语义化版本之前增加前缀”v\"是用来表示版本号的常用做法；</li>\n</ul>\n<p>关于语义化版本规范详细内容参考：<a href=\"https://semver.org/lang/zh-CN/\" target=\"_blank\" rel=\"noopener noreferrer\">semver.org</a></p>\n<h2> 先行版本</h2>\n<p>此外我们还会经常遇见先行版本，例如：1.0.0-alpha.0、1.0.0-alpha.1、1.0.0-beta.0、1.0.0-rc.0、1.0.0-rc.1等</p>\n<blockquote>\n<p>当要发布大版本或者核心的feature时，但又不能保证这个版本的功能100%正常，这个时候就需要通过发布先行版本</p>\n</blockquote>\n<p>常见的先行版本包括：内测版 、灰度版和RC版本。Semver规范中使用alpha、beta、rc来修饰即将要发布的版本。</p>\n<ul>\n<li>snapshot:快照，也被称为开发版，处于开发阶段，这个版本的代码禁止用于生产环境；</li>\n<li>alpha:内部版本，该版本表示软件在此阶段主要是以实现功能为主，用于软件开发内部交流，一般bug比较多；</li>\n<li>beta:公测版本，该版本表示相对alpha版已经改进，但仍然存在一些缺陷，用于专业爱好者大规模使用；</li>\n<li>gamma:比较成熟的测试版；</li>\n<li>rc:即release candiate，正式版本的候选版本，该版本已经相当成熟，只会修复Bug，不会对软件做任何大的更改；</li>\n<li>release:发行版本，适合一般用户使用，不开源的软件，release可能是带有免费使用时间限制的版本；</li>\n<li>stable:稳定版，同release；</li>\n</ul>\n<h2> 工具</h2>\n<p>另外可以使用一些工具规范版本号：</p>\n<ul>\n<li><a href=\"https://github.com/arnaud-deprez/gsemver\" target=\"_blank\" rel=\"noopener noreferrer\">gsemver</a>\n<ul>\n<li>使用<code>gsemver bump</code>命令就可以根据Git历史提交约定生成下一个版本</li>\n</ul>\n</li>\n<li><a href=\"https://github.com/commitizen/cz-cli\" target=\"_blank\" rel=\"noopener noreferrer\">cz-cli</a></li>\n</ul>\n",
      "date_published": "2020-01-25T00:00:00.000Z",
      "date_modified": "2023-08-02T13:20:49.000Z",
      "authors": [],
      "tags": [
        "项目规范"
      ]
    },
    {
      "title": "基于Redis的分布式锁",
      "url": "https://Hexiaopi.github.io/system-design/distribute-lock.html",
      "id": "https://Hexiaopi.github.io/system-design/distribute-lock.html",
      "summary": "分布式锁 分布式锁即在分布式环境下不同实例之间抢一把锁，相比较单一实例的锁，分布式环境下带来的问题更多，例如网络问题。 分布式锁可以通过多种途径实现，例如:Zookeeper等。由于Redis是经常使用的中间件，本篇内容基于Redis实现分布式锁。 特性： 互斥性：任意时刻，只有一个客户端能持有锁；; 锁超时释放：持有锁超时，可以释放，防止不必要的资源...",
      "content_html": "<!-- more -->\n<h2> 分布式锁</h2>\n<blockquote>\n<p>分布式锁即在分布式环境下不同实例之间抢一把锁，相比较单一实例的锁，分布式环境下带来的问题更多，例如网络问题。<br>\n分布式锁可以通过多种途径实现，例如:Zookeeper等。由于Redis是经常使用的中间件，本篇内容基于Redis实现分布式锁。</p>\n</blockquote>\n<p>特性：</p>\n<ul>\n<li>互斥性：任意时刻，只有一个客户端能持有锁；</li>\n<li>锁超时释放：持有锁超时，可以释放，防止不必要的资源浪费，也可以防止死锁；</li>\n<li>可重入性：一个线程如果获取了锁之后，可以再次对其请求加锁；</li>\n<li>高性能和高可用：加锁和解锁需要开销尽可能低，同时也要保证高可用，避免分布式锁失效；</li>\n<li>安全性：锁只能被持有的客户端释放，不能被其他客户端释放</li>\n</ul>\n<h3> 简单版本</h3>\n<blockquote>\n<p>锁的特性就是排他性，这里可以通过Redis的命令：<code>SETNX</code>，该命令：</p>\n<ul>\n<li>只在键key不存在的情况下，将键的值设置为value，返回1；</li>\n<li>若键key已存在，则SETNX命令不做任何操作，返回0；</li>\n</ul>\n</blockquote>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>但是这里的释放其实是存在问题的：</p>\n<ul>\n<li>当redis存储的是别人的锁，直接删除key这就会导致删除别人的锁问题</li>\n</ul>\n<h3> 解决锁释放问题</h3>\n<blockquote>\n<p>方法就是生产唯一的value，只有当前redis存储的value是自己的才可以删除</p>\n<p>为了保证原子性，即查询redis的value和删除动作是一起进行操作，这里采用lua脚本去保证</p>\n</blockquote>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>release.lua脚本</p>\n<div class=\"language-lua line-numbers-mode\" data-ext=\"lua\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 解决超时问题</h3>\n<blockquote>\n<p>极端场景下业务很可能执行超时，例如：分布式锁一分钟，但业务执行一小时，导致这一个小时之内，有60个业务拿到分布式锁，和我们期望1个业务执行不一致。</p>\n<p>解决超时问题，那么我们可以通过续约的方式，不断延长分布式锁的有效期来解决业务超时问题，保证业务执行过程锁不会自动释放。</p>\n</blockquote>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>refresh.lua脚本</p>\n<div class=\"language-lua line-numbers-mode\" data-ext=\"lua\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 解决无限续约问题</h3>\n<blockquote>\n<p>当续约遇见网络超时问题，总不能一直续约，须有合理的方式告知业务方错误</p>\n<p>因此需增加策略去重试续约</p>\n</blockquote>\n<p>我们定义策略</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用带策略的续约方式</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>lock.lua脚本</p>\n<div class=\"language-lua line-numbers-mode\" data-ext=\"lua\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 进一步优化获取锁</h3>\n<blockquote>\n<p>当并发量很大场景时，为了减缓DB的压力，我们可以在单个实例上面，只允许一个协程获取分布式锁，即：单一实例先筛选一个协程，不同的实例再去竞争分布式锁</p>\n</blockquote>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2022-11-12T00:00:00.000Z",
      "date_modified": "2023-08-14T13:05:37.000Z",
      "authors": [],
      "tags": [
        "系统设计"
      ]
    },
    {
      "title": "CA证书",
      "url": "https://Hexiaopi.github.io/tools/ca.html",
      "id": "https://Hexiaopi.github.io/tools/ca.html",
      "summary": "安装工具 使用CloudFlare的PKI和TLS工具包cfssl来创建证书 安装cfssl工具集 cfssl工具集中包含很多工具 cfssl：证书签发工具 go get github.com/cloudflare/cfssl/cmd/cfssl",
      "content_html": "<h2> 安装工具</h2>\n<blockquote>\n<p>使用CloudFlare的PKI和TLS工具包cfssl来创建证书</p>\n</blockquote>\n<h3> 安装cfssl工具集</h3>\n<p>cfssl工具集中包含很多工具</p>\n<blockquote>\n<p>cfssl：证书签发工具</p>\n</blockquote>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><blockquote>\n<p>cfssljson：将cfssl生产的证书（json格式）变为文件承载式证书</p>\n</blockquote>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>或者直接安装所有工具</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 创建配置文件</h3>\n<blockquote>\n<p>CA配置文件是用来配置根证书的使用场景（profile）和具体参数（usage、过期时间、服务端认证、客户端认证、加密等）<br>\n创建文件：ca-config.json</p>\n</blockquote>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>signing：表示该证书可用于签名其他证书（生成的ca.pem证书中的CA=TRUE）</li>\n<li>server auth：表示client可以用该证书对server提供的证书进行验证</li>\n<li>client auth：表示server可以用该证书对client提供的证书进行验证</li>\n<li>expiry：876000h，证书有效期设置为100年</li>\n</ul>\n<h3> 创建证书签名请求文件</h3>\n<blockquote>\n<p>用来生成CA证书签名请求（CSR）的JSON配置文件</p>\n</blockquote>\n<p>创建文件：ca-csr.json</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>C：Country，国家</li>\n<li>ST：State，省份</li>\n<li>L：Locality or City，城市</li>\n<li>CN：Common Name，浏览器使用该字段验证网站是否合法</li>\n<li>O：Organization，组织</li>\n<li>OU：Company Division，部门/单位</li>\n</ul>\n<h3> 创建CA证书和私钥</h3>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>上述命令会创建运行CA所必须的文件<code>ca-key.pem</code>（私钥）和 <code>ca.pem</code>（证书），还会生成<code>ca.csr</code>(证书签名请求)，用于交叉签名或重新签名。</p>\n",
      "date_published": "2023-08-14T00:00:00.000Z",
      "date_modified": "2023-08-14T13:05:37.000Z",
      "authors": [],
      "tags": [
        "工具"
      ]
    },
    {
      "title": "confd简介",
      "url": "https://Hexiaopi.github.io/tools/confd.html",
      "id": "https://Hexiaopi.github.io/tools/confd.html",
      "summary": "confd 简介 confd是一个轻量级配置管理工具，通过加载存储在etcd、consul、redis、zookeeper等的数据，结合配置模板动态更新配置文件。 github地址：https://github.com/kelseyhightower/confd 官网：http://www.confd.io/ confd功能角色 confd的功能类似于快递员，负责去配置服务中读取配置数据，然后更新配置文件，并通知应用服务热加载配置文件。",
      "content_html": "<h2> confd 简介</h2>\n<blockquote>\n<p>confd是一个轻量级配置管理工具，通过加载存储在etcd、consul、redis、zookeeper等的数据，结合配置模板动态更新配置文件。</p>\n</blockquote>\n<p><strong>github地址</strong>：<code>https://github.com/kelseyhightower/confd</code></p>\n<p><strong>官网：</strong><code>http://www.confd.io/</code></p>\n<h3> confd功能角色</h3>\n<p>confd的功能类似于快递员，负责去配置服务中读取配置数据，然后更新配置文件，并通知应用服务热加载配置文件。</p>\n<figure><figcaption>confd</figcaption></figure>\n<h2> confd部署</h2>\n<p>下载地址：<code>https://github.com/kelseyhightower/confd/releases</code></p>\n<p>以Linux系统为例：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> confd使用</h2>\n<h3> 创建confdir</h3>\n<p><code>confdir</code>(默认是<code>/etc/confd</code>)包含两个目录：</p>\n<ul>\n<li><code>conf.d</code>：confd的配置文件，主要包含配置的生成逻辑，例如模板源，目标配置文件，后端存储的keys，服务重启命令执行等。</li>\n<li><code>templates</code>: 包含配置模板，修改符合<a href=\"https://golang.google.cn/pkg/text/template/#pkg-overview\" target=\"_blank\" rel=\"noopener noreferrer\">Golang Text template</a>的模板文件。</li>\n</ul>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 模板源配置</h3>\n<p>模板源配置文件是以TOML格式的文件，包含配置的生成逻辑，例如模板源，后端存储对应keys，命令执行等。默认目录在<code>/etc/confd/conf.d</code></p>\n<p>参数说明：</p>\n<p><strong>必要参数</strong></p>\n<ul>\n<li><code>dest</code>(string) : 目标文件.</li>\n<li><code>keys</code>(array of things) : 存储的keys.</li>\n<li><code>src</code>(string) :  <a href=\"https://github.com/kelseyhightower/confd/blob/master/docs/templates.md\" target=\"_blank\" rel=\"noopener noreferrer\">模板配置</a>的相对路径.</li>\n</ul>\n<p><strong>可选参数</strong></p>\n<ul>\n<li><code>git</code>(int) : 文件的gid</li>\n<li><code>mode</code>(string) : 文件的权限模式</li>\n<li><code>uid</code>（int) : 文件的uid</li>\n<li><code>reload_cmd</code>(string) : 重启命令配置</li>\n<li><code>check_cmd</code>(string) : 检查命令配置，使用<code>{{.src}}</code>引用模板源</li>\n<li><code>prefix</code>(string) : keys的前缀字符串</li>\n</ul>\n<p>例如：<code>/etc/confd/conf.d/prometheus.toml</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 模板源</h3>\n<p>Template定义了单一应用配置的模板，默认存储在<code>/etc/confd/templates</code>目录下，模板文件符合Go的<code>text/template</code>格式。</p>\n<p>例如: <code>/etc/confd/templates/prometheus.tmpl</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 启动confd的服务</h3>\n<p>confd支持以<code>daemon</code>或者<code>onetime</code>两种模式运行。</p>\n<p><code>onetime</code>模式，只会生成一次，之后key无论变化不会再生成：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p><code>daemon</code>模式，会监听后端存储的配置变化，并根据配置模板动态生成目标配置文件：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> etcd设置数据</h3>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 验证配置文件数据</h3>\n<p>根据<strong>模板源配置</strong>里设置的目标配置文件查看是否符合预期</p>\n<div class=\"language-yaml line-numbers-mode\" data-ext=\"yml\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> confd模板功能函数</h2>\n<h3> map</h3>\n<p>string-&gt;interface{}的key/value键值对</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> base</h3>\n<p>与<a href=\"https://golang.org/pkg/path/#Base\" target=\"_blank\" rel=\"noopener noreferrer\">path.Base</a>功能同名</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> exists</h3>\n<p>检查key是否存在，如果不存在返回false</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> get</h3>\n<p>返回键值对，如果不存在返回error</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> cget</h3>\n<p>返回键值对，且值被加密。如果不存在返回error</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> gets</h3>\n<p>返回所有键值对，键值对列表，如果key不匹配返回error</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> cgets</h3>\n<p>返回所有键值对，键值对列表，key匹配参数且值被加密，如果key不匹配返回一个错误</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> getv</h3>\n<p>以字符串形式返回值，其中key与其参数或可选的默认值匹配。如果未找到key且未给出默认值，则返回错误</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p><strong>With a default value</strong></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> cgetv</h3>\n<p>将加密值作为字符串返回，如果未找到key，返回错误</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> getvs</h3>\n<p>返回所有值，[]string，其中key与其参数匹配。如果未找到密钥，则返回错误。</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> cgetvs</h3>\n<p>返回所有加密值，[]string，其中key与其参数匹配。如果未找到key则返回错误</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> getenv</h3>\n<p>检索由key命名的环境变量的值。 如果变量不存在，返回为空。 （可选）可以提供一个默认值，如果该键不存在，将返回该值。</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><strong>With a default value</strong></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> datetime</h3>\n<p>与time.Now同名</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>Outputs:</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>Outputs:</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> split</h3>\n<p>用分隔字符拆分输入的字符串并返回一个子字符串切片</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><strong>toUpper</strong></p>\n<p>返回大写的字符串</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> toLower</h3>\n<p>返回小写的字符串</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> json</h3>\n<p>返回 json值得map[string]interface{}</p>\n<h3> lookupSRV</h3>\n<p>LookupSRV函数按照RFC 2782标准来构建用于查询的DNS。也就是说，它查询_service._proto.name。当service和proto参数都是空字符串时，LookupSRV将会直接查找name</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> base64Encode</h3>\n<p>返回一个base64编码得字符串</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> base64Decode</h3>\n<p>返回一个base64解码的字符串</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> jsonArray</h3>\n<p>从json数组返回一个 []interface{}</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> ls</h3>\n<p>返回所有子键，[]string，其中path匹配其参数。如果找不到path，则返回空列表</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> lsdir</h3>\n<p>返回所有子键，[]string，其中path匹配其参数。它只返回包含子键的子键。如果找不到路径，则返回空列表。</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> dir</h3>\n<p>返回给定键的父目录</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> join</h3>\n<p>字符串拼接</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> replace</h3>\n<p>字符串替换</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> lookupIP</h3>\n<p>查找ip</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> atoi</h3>\n<p>字符换转整数</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div>",
      "date_published": "2023-07-30T00:00:00.000Z",
      "date_modified": "2023-07-30T10:52:56.000Z",
      "authors": [],
      "tags": [
        "工具"
      ]
    },
    {
      "title": "vscode leetcode插件",
      "url": "https://Hexiaopi.github.io/tools/vscode-leetcode.html",
      "id": "https://Hexiaopi.github.io/tools/vscode-leetcode.html",
      "summary": "提示 vscode这款插件太香了，终于可以沉浸式刷leetcode😄",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>vscode这款插件太香了，终于可以沉浸式刷leetcode😄</p>\n</div>\n<!-- more -->\n<h2> 环境搭建</h2>\n<h3> 安装</h3>\n<p>在vscode扩展商店搜索<code>LeetCode</code>,一般是下载量最高的那个就完事了<br>\n</p>\n<h3> 登陆</h3>\n<p>在登陆之前，记得要选择中国版，否则会遇见登陆不上问题<br>\n<br>\n接下来选择账号登录，需要提前在LeetCode官网注册账号<br>\n<br>\n这里我选择账户方式，按照提示填写邮箱、密码即可登录</p>\n<h3> 预览</h3>\n<figure><figcaption>leetcode-preview</figcaption></figure>\n<blockquote>\n<p>在左侧，该插件按照五个分类将题目进行了分类，比如：按照难易程度(简单、中等、难)、按照标签(数据、二叉搜索等)、按照公司(Google、Facebook等)</p>\n<p>且题目根据难易程度有不同的颜色进行区分，如果已经完成相关的练习，还会用✔️提示</p>\n</blockquote>\n<h3> 个性化配置</h3>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 沉浸式刷题</h2>\n<h3> 预览题目内容</h3>\n<p><br>\n点击Code Now，选择一种编程语言就可以开始了</p>\n<h3> 编写代码</h3>\n<figure><figcaption>leetcode-code</figcaption></figure>\n<h3> 测试代码</h3>\n<p>点击代码下方的<code>Test</code>标签即可进行测试代码（再也不用编写大量的单元测试用例了）<br>\n</p>\n<h3> 提交代码</h3>\n<p>点击代码下方的<code>Submit</code>标签即可提交代码，完成之后就会看到提交后的代码性能等信息了<br>\n</p>\n",
      "date_published": "2022-08-10T00:00:00.000Z",
      "date_modified": "2023-08-14T13:05:37.000Z",
      "authors": [],
      "tags": [
        "工具"
      ]
    },
    {
      "title": "二叉搜索树",
      "url": "https://Hexiaopi.github.io/data-structure/tree/binary-search-tree.html",
      "id": "https://Hexiaopi.github.io/data-structure/tree/binary-search-tree.html",
      "summary": "二叉搜索树 简介 二叉搜索树（Binary Search Tree,BST）又叫二叉排序树，基于二分法查找思想设计的树。它的定义如下： 它是一棵二叉树 左子树的所有节点的值都小于它的根节点，右子树的所有节点的值都大于它的根节点 左右子树也是一棵二叉搜索树 增加节点 func (n *Node) Add(value int) { \tif value &gt; n.Data { \t\tif n.Right == nil { \t\t\tn.Right = &amp;Node{ \t\t\t\tLeft: nil, \t\t\t\tData: value, \t\t\t\tRight: nil, \t\t\t} \t\t} else { \t\t\tn.Right.Add(value) \t\t} \t} else if value &lt; n.Data { \t\tif n.Left == nil { \t\t\tn.Left = &amp;Node{ \t\t\t\tLeft: nil, \t\t\t\tData: value, \t\t\t\tRight: nil, \t\t\t} \t\t} else { \t\t\tn.Left.Add(value) \t\t} \t} else { \t\tfmt.Println(value, \" already exist\") \t} }",
      "content_html": "<h1> 二叉搜索树</h1>\n<h2> 简介</h2>\n<blockquote>\n<p>二叉搜索树（Binary Search Tree,BST）又叫二叉排序树，基于二分法查找思想设计的树。它的定义如下：</p>\n<ol>\n<li>它是一棵二叉树</li>\n<li>左子树的所有节点的值都小于它的根节点，右子树的所有节点的值都大于它的根节点</li>\n<li>左右子树也是一棵二叉搜索树</li>\n</ol>\n</blockquote>\n<h2> 增加节点</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 查找节点</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 删除节点</h2>\n<h3> 递归版本</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h1> 总结</h1>\n<blockquote>\n<p>二叉搜素树采用二分法思想，查找效率高</p>\n<p>但是二叉搜索树具有不平衡性，容易出现斜树</p>\n</blockquote>\n<figure><figcaption>斜树</figcaption></figure>\n",
      "date_published": "2023-07-30T09:20:01.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "二叉树",
      "url": "https://Hexiaopi.github.io/data-structure/tree/binary-tree.html",
      "id": "https://Hexiaopi.github.io/data-structure/tree/binary-tree.html",
      "summary": "二叉树 满足以下两个条件的树就是二叉树： 本身是有序树 树中包含的各个节点的度不能超过2，即只能是：0、1、2 定义二叉树的结构 type Node struct { \tLeft *Node \tData interface{} \tRight *Node }",
      "content_html": "<h1> 二叉树</h1>\n<blockquote>\n<p>满足以下两个条件的树就是二叉树：</p>\n<ul>\n<li>本身是有序树</li>\n<li>树中包含的各个节点的度不能超过2，即只能是：0、1、2</li>\n</ul>\n</blockquote>\n<p>定义二叉树的结构</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><figcaption></figcaption></figure>\n<h2> 先序遍历</h2>\n<blockquote>\n<p>其思想是：</p>\n<ol>\n<li>访问根节点；</li>\n<li>访问当前节点的左子树；</li>\n<li>若当前节点无左子树，则访问当前节点的右子树；</li>\n</ol>\n</blockquote>\n<p>以图为例：</p>\n<ol>\n<li>访问该二叉树的根节点，找到节点1；</li>\n<li>访问节点1的左子树，找到节点2；</li>\n<li>访问节点2的左子树，找到节点4；</li>\n<li>访问节点4的左子树失败，访问节点4的右子树失败，结束节点4的查询。继续查找节点2的右子树，找到节点5；</li>\n<li>访问节点5的左子树失败，访问节点5的右子树失败，结束节点5的查询。结束节点2的查询，查询节点1的右子树，找到节点3；</li>\n<li>访问节点3的左子树，找到节点6；</li>\n<li>访问节点6的左子树失败，访问节点6的右子树失败，结束节点6的查询。继续查找节点3右子树，知道节点7；</li>\n<li>访问节点7的左子树失败，访问节点7的右子树失败，结束节点7的查询。结束节点3的查询，结束节点1的查询；</li>\n</ol>\n<p>!&gt; 顺序如下：1、2、4、5、3、6、7</p>\n<h3> 递归实现</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 示例测试</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 中序遍历</h2>\n<blockquote>\n<p>其实想是：</p>\n<ol>\n<li>访问当前节点的左子树；</li>\n<li>访问当前节点；</li>\n<li>访问当前节点的右子树；</li>\n</ol>\n</blockquote>\n<p>以图为例：</p>\n<ol>\n<li>访问根节点，遍历找到左子树直到失败；找到节点4，找到节点4的右子树失败，结束节点4的遍历；</li>\n<li>访问节点4的根节点，找到节点2；</li>\n<li>访问节点2的右子树，遍历找左子树失败，找到节点5，遍历找到右子树失败，结束节点5的遍历，也结束节点2的遍历；</li>\n<li>结束节点1的左子树查询，找到节点1；</li>\n<li>遍历节点1的右子树，遍历找到左子树为6，结束节点6的遍历；</li>\n<li>找到节点3；</li>\n<li>遍历节点3的右子树，遍历找到左子树失败；找到节点7，遍历节点7的右子树失败，结束节点7的遍历；</li>\n</ol>\n<p>!&gt; 顺序如下：4，2，5，1，6，3，7</p>\n<h3> 递归实现</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 示例测试</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 后续遍历</h2>\n<blockquote>\n<p>其思想是：</p>\n<ol>\n<li>遍历访问当前节点的左子树；</li>\n<li>遍历访问当前节点的右子树；</li>\n<li>访问当前节点；</li>\n</ol>\n</blockquote>\n<p>以图为例：</p>\n<ol>\n<li>从根节点开始，遍历左子树直到失败，1-&gt;2-&gt;4，找到节点4，结束节点4的查询；</li>\n<li>回退到节点2，遍历右子树，找到节点5的左子树失败、右子树失败，找到节点5，结束节点5的查询；</li>\n<li>节点2的左右子树遍历完成，找到节点2，结束节点2的查询；</li>\n<li>回退到节点1，遍历右子树，1-&gt;3-&gt;6，找到节点6的左子树失败、右子树失败，找到节点6，结束节点6的查询；</li>\n<li>回到到节点3，遍历右子树，3-&gt;7，找到节点7的左子树失败、右子树失败，找到节点7，结束节点7的查询；</li>\n<li>节点3左右子树遍历完成，找到节点3，结束节点3的查询；</li>\n<li>回退到节点1，节点1左右子树遍历完成，找到节点1，结束节点1的查询；</li>\n</ol>\n<p>!&gt; 顺序为：4、5、2、6、7、3、1</p>\n<h3> 递归实现</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 示例测试</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 层次遍历</h2>\n<blockquote>\n<p>其思想是：</p>\n<ol>\n<li>节点入队；</li>\n<li>节点出队，节点左孩子和右孩子入队；</li>\n<li>知道所有节点出队；</li>\n</ol>\n</blockquote>\n<p>以图为例：</p>\n<ol>\n<li>根节点1入队；</li>\n<li>根节点1出队，找到节点1，根节点1的左孩子节点2和右孩子3节点入队；</li>\n<li>节点2出队，找到节点2，节点2的左孩子节点4和右孩子节点5入队；</li>\n<li>节点3出队，找到节点3，节点3的左孩子节点6和右孩子节点7入队；</li>\n<li>节点4出队，没有左右孩子，找到节点4；</li>\n<li>节点5出队，没有左右孩子，找到节点5；</li>\n<li>节点6出队，没有左右孩子，找到节点6；</li>\n<li>节点7出队，没有左右孩子，找到节点7；</li>\n</ol>\n<h3> 队列实现</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 示例测试</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2023-07-30T09:20:01.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": []
    },
    {
      "title": "MySQL-存储引擎",
      "url": "https://Hexiaopi.github.io/database/mysql/engine.html",
      "id": "https://Hexiaopi.github.io/database/mysql/engine.html",
      "summary": "MySQL是常用的关系型数据库 MySQL架构 MySQL架构 存储引擎 存储引擎是MySQL区别于其他数据库的一个重要特性，MySQL有诸多存储引擎，且存储引擎是基于表的，而不是数据(同一个数据库下面的各个表可以使用不同的引擎); 存储引擎是底层物理结构的实现，每个存储引擎开发者可以按照自己的意愿开发，具有各自的特点; 对于MySQL使用者来说，存储...",
      "content_html": "<!-- more -->\n<blockquote>\n<p>MySQL是常用的关系型数据库</p>\n</blockquote>\n<h2> MySQL架构</h2>\n<figure><figcaption>MySQL架构</figcaption></figure>\n<h2> 存储引擎</h2>\n<ul>\n<li>存储引擎是MySQL区别于其他数据库的一个重要特性，MySQL有诸多存储引擎，且<strong>存储引擎是基于表的，而不是数据</strong>(同一个数据库下面的各个表可以使用不同的引擎)</li>\n<li>存储引擎是底层物理结构的实现，每个存储引擎开发者可以按照自己的意愿开发，具有各自的特点</li>\n<li>对于MySQL使用者来说，存储引擎对其实透明的</li>\n</ul>\n<h3> Innodb引擎</h3>\n<blockquote>\n<p>是一个支持ACID事务，行锁设计，支持MVCC功能，实现了SQL标准的4种隔离级别</p>\n</blockquote>\n<h4> 特点</h4>\n<ul>\n<li>使用Table Space的方式仅限数据存储</li>\n<li>支持事务、外键约束等数据库特性</li>\n<li>Rows Level Lock，读写性能都非常优秀</li>\n<li>拥有独立的缓冲池，能够缓存数据和索引</li>\n<li>通过多版本控制，支持高并发业务</li>\n</ul>\n<h4> 注意事项</h4>\n<ul>\n<li>主键尽可能小，否则二级索引会膨胀</li>\n<li>避免全表扫描，导致锁升级</li>\n<li>尽可能缓存所有的索引和数据，减少IO操作</li>\n<li>避免主键更新，造成大量的数据移动</li>\n</ul>\n<h3> MyISAM存储引擎</h3>\n<blockquote>\n<p>MySQL 5.5之前默认是MyISAM存储引擎，之后默认都改为InnoDB</p>\n</blockquote>\n<h4> 特点</h4>\n<ul>\n<li>数据存储方式简单，使用B-Tree进行索引，<strong>索引叶子节点存放数据的指针</strong></li>\n<li><strong>不支持一些数据库特性，比如事务、外键约束等</strong></li>\n<li><strong>Table Level Lock(表级别锁)</strong>，性能稍差，更适合读多的操作</li>\n<li>使用三个文件定义一个表：\n<ul>\n<li><code>.MYi</code>：存储索引</li>\n<li><code>.MYD</code>：存储数据</li>\n<li><code>.frm</code>：存储表定义</li>\n</ul>\n</li>\n<li>少碎片、支持大文件、能够进行索引压缩</li>\n<li>二进制层次的文件可以移植（Linux-&gt;Windows）</li>\n<li>访问速度快，适合只读查询场景</li>\n</ul>\n<h4> 注意事项</h4>\n<ul>\n<li>设置合适索引</li>\n<li>启用延迟写入，尽量一次大批量写入，而非频繁写入</li>\n<li>降低并发数，高并发使用排队机制</li>\n<li>由于存储了Count字段，因此Count操作比较高效，但仅限不带条件</li>\n</ul>\n<h2> 引擎对比</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">存储引擎</th>\n<th style=\"text-align:center\">特点</th>\n<th style=\"text-align:center\">应用场景</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">InnoDB</td>\n<td style=\"text-align:center\">支持事务、行锁、支持MVCC多版本并发控制、并发性高</td>\n<td style=\"text-align:center\">OLTP</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">MyISAM</td>\n<td style=\"text-align:center\">不支持事务、表锁、并发低、资源利用低，但具有高性能和低存储空间消耗的特点</td>\n<td style=\"text-align:center\">适用于大量只读数据的应用场景</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Memory</td>\n<td style=\"text-align:center\">数据存放在内存中、支持Hash和Btree索引、读取速度快</td>\n<td style=\"text-align:center\">用于高并发、无需持久化的应用场景</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Archive</td>\n<td style=\"text-align:center\">高度压缩、zlib无损数据压缩，较MyISAM8倍，不支持更新、删除索引</td>\n<td style=\"text-align:center\">适用于存储大量历史数据</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Blackhole</td>\n<td style=\"text-align:center\">不存储数据，同步时只写binlog</td>\n<td style=\"text-align:center\">用于binlog转储</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">CSV</td>\n<td style=\"text-align:center\">CSV格式，数据以文本文件形式存储</td>\n<td style=\"text-align:center\">用于数据交换和数据迁移</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">NDB</td>\n<td style=\"text-align:center\">MySQL的分布式存储引擎，支持分布式事务和高可用性，能够处理海量数据</td>\n<td style=\"text-align:center\">集群存储</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n",
      "date_published": "2022-10-22T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "MySQL-索引",
      "url": "https://Hexiaopi.github.io/database/mysql/idx.html",
      "id": "https://Hexiaopi.github.io/database/mysql/idx.html",
      "summary": "索引是一种数据结构，帮助SQL高效获取数据的。类似一本书的目录，可以快速对特定值进行定位和查找，从而大大加快数据查询的效率。",
      "content_html": "<p>索引是一种数据结构，帮助SQL高效获取数据的。类似一本书的目录，可以快速对特定值进行定位和查找，从而大大加快数据查询的效率。</p>\n<!-- more -->\n<h2> 索引优缺点</h2>\n<h3> 索引优点</h3>\n<ul>\n<li>索引可以大大减少需要扫描的数据量</li>\n<li>索引可以避免排序和临时表，索引已经有序</li>\n<li>索引可以尽量将随机IO变成顺序IO，例如：聚簇索引包含数据，且索引是有序的，就可以快速获得批量数据，但如果回表，通过主键查询数据，则又变成随机IO</li>\n<li>索引对于InnoDB（支持行级锁）非常重要，InnoDB对需要访问的元组加锁，而索引能够减少InnoDB访问的元组数，如果查询不能使用索引，MySQL会进行全表扫描，导致锁住全表。</li>\n</ul>\n<h3> 索引缺点</h3>\n<ul>\n<li>降低了更新表的数据，因为不仅要更新原始数据，还要更新索引</li>\n<li>索引占用磁盘空间</li>\n<li>数据列如果包含了许多重复的内容，例如性别为：男、女，索引选择可能只筛选一半的数据量，效果不是很好</li>\n<li>对于数据量非常小的表，索引意义不大，有时全表扫描更高效</li>\n</ul>\n<p>MySQL单张表最多只支持16个索引</p>\n<h2> 索引类型</h2>\n<h3> 按功能逻辑划分</h3>\n<h4> 普通索引</h4>\n<p>普通索引仅仅加快对数据的访问速度，常用于查询条件（where field_name=value）或排序条件（order by field_name）这些场景中。</p>\n<h4> 唯一索引</h4>\n<p>唯一索引相比较普通索引，要求索引列的值必须唯一，但允许有空值。</p>\n<h4> 主键索引</h4>\n<p>主键索引是一种特殊的索引，不允许有空值，一张表只能有一个主键，一般在建表的时候通过primary key(field_name)指定</p>\n<h4> 全文索引</h4>\n<p>mysql Like '%xxx'就会导致索引失效，为了模糊搜索需求，例如：like '%hello%'，就需要全文索引支持。InnoDB在5.6版本之后支持全文索引。</p>\n<h3> 按物理逻辑划分</h3>\n<h4> 聚簇索引</h4>\n<p>聚簇索引的叶子节点直接存储数据，因此查询的时候只需要进行一次查询</p>\n<h4> 非聚簇索引</h4>\n<p>非聚簇索引的叶子节点存储数据的主键，因此查询的时候需要进行两次查询：先查询聚簇索引获取到主键，再通过主键查询数据。</p>\n<h3> 按字段个数划分</h3>\n<h4> 单一索引</h4>\n<p>索引只使用一个字段</p>\n<h4> 联合索引</h4>\n<p>索引使用多个字段<br>\n例如：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>MySQL联合索引遵从：最左匹配原则</p>\n<p>上面索引相当于建立下面三组索引：</p>\n<ul>\n<li>name,city,age</li>\n<li>name,city</li>\n<li>name</li>\n</ul>\n<p>因此：</p>\n<ul>\n<li>如果查询条件是：(city)、(city,age)、(age)都不会命中索引</li>\n<li>如果查询条件是：(name,age)，则会命中name索引</li>\n</ul>\n<p>理论上最左匹配原则中索引对 where 中子句的顺序也是敏感的，但是由于MySQL的查询优化器会自动调整 where 子句的条件顺序以使用适合的索引，所以实际上 where 子句顺序不影响索引的效果。</p>\n<p>如果联合索引有范围查询，就会停止匹配</p>\n<p>如果分别在 x, y, z 上建立单列索引，让该表有3个单列索引，索引效率也会大不一样，在联合索引生效的情况下，单个索引的效率远远低于联合索引。这是由 MySQL 查询优化器的执行顺序决定的，在执行一条查询 sql 时，针对索引的选择大致有如下步骤：</p>\n<p>MySQL 优化器根据搜索条件，找出所有可能使用的索引<br>\n计算全表扫描的代价<br>\n计算使用不同索引执行查询的代价<br>\n对比各种执行方案的代价，找出成本最低的那一个<br>\n因此，虽然有多个单列索引，但 MySQL 只能用到其中的那个系统认为似乎是最有效率的，其他的就会失效。</p>\n<h2> 总结</h2>\n<h3> 索引推荐使用情况</h3>\n<ul>\n<li>WHERE, GROUP BY, ORDER BY 子句中的字段</li>\n<li>多个单列索引在多条件查询是只会有一个最优的索引生效，因此多条件查询中最好创建联合索引。</li>\n<li>联合索引的时候必须满足最左匹配原则，并且最好考虑到 sql 语句的执行顺序，比如 WHERE a = 1 GROUP BY b ORDER BY c, 那么联合索引应该设计为 (a,b,c)，因为mysql 查询语句的执行顺序 WHERE &gt; GROUP BY &gt; ORDER BY。<a href=\"/database/mysql/sql-order.html\" target=\"blank\">参见</a></li>\n<li>多张表 JOIN 的时候，对表连接字段创建索引。</li>\n<li>当 SELECT 中有不在索引中的字段时，会先通过索引查询出满足条件的主键值，然后通过主键回表查询出所有的 SELECT 中的字段，影响查询效率。因此如果 SELECT 中的内容很少，为了避免回表，可以把 SELECT 中的字段都加到联合索引中，这也就是宽索引的概念。但是需要注意，如果索引字段过多，存储和维护索引的成本也会增加。</li>\n</ul>\n<h3> 不推荐使用或索引失效情况</h3>\n<ul>\n<li>数据量很小的表</li>\n<li>有大量重复数据的字段</li>\n<li>频繁更新的字段</li>\n<li>如果对索引字段使用了函数或者表达式计算，索引失效</li>\n<li>字段类型不一致也会失效，因为等价使用函数</li>\n<li>innodb OR 条件没有对所有条件创建索引，索引失效</li>\n<li>大于小于条件 &lt; &gt;，索引是否生效取决于命中的数量比例，如果命中数量很多，索引生效，命中数量很小，索引失效</li>\n<li>不等于条件 !=、&lt;&gt;，索引失效</li>\n<li>LIKE 值以 % 开头，索引失效</li>\n</ul>\n",
      "date_published": "2023-03-15T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "MySQL-表连接",
      "url": "https://Hexiaopi.github.io/database/mysql/join.html",
      "id": "https://Hexiaopi.github.io/database/mysql/join.html",
      "summary": "连接是一种机制，用来在一条SELECT语句中关联表 内连接（INNER JOIN） 内连接又叫等值连接,它将第一个表中的每一行与第二个表中的每一行配对，只返回匹配给定条件的行 从数据的角度就是求两个集合的交集，如下图所示 内连接 示例： 自然连接（NATURE JOIN） 自然连接，会自动找出两个表中相同的列作为连接条件进行连接 以下示例语句与内连接语...",
      "content_html": "<!-- more -->\n<blockquote>\n<p>连接是一种机制，用来在一条SELECT语句中关联表</p>\n</blockquote>\n<h2> 内连接（INNER JOIN）</h2>\n<blockquote>\n<p>内连接又叫等值连接,它将第一个表中的每一行与第二个表中的每一行配对，只返回匹配给定条件的行<br>\n从数据的角度就是求两个集合的交集，如下图所示</p>\n</blockquote>\n<figure><figcaption>内连接</figcaption></figure>\n<p>示例：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 自然连接（NATURE JOIN）</h2>\n<blockquote>\n<p>自然连接，会自动找出两个表中相同的列作为连接条件进行连接</p>\n</blockquote>\n<p>以下示例语句与内连接语句等价</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p>也可以省略<code>INNER</code>关键字，即<code>INNER JOIN</code>和<code>JOIN</code>等价</p>\n</blockquote>\n<h2> 叉连接（CROSS JOIN）</h2>\n<blockquote>\n<p>即返回笛卡尔积的联<br>\n假设第一个表有6行数据，第二个表中有9行数据，那么通过叉连接就可以返回6*9=54条数据</p>\n</blockquote>\n<figure><figcaption>叉连接</figcaption></figure>\n<p>示例：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 外连接（OUTER JOIN）</h2>\n<p>可以通过内连接将一个表中的行与另一个表中的行相关联，但有时候需要包含没有关联行的那些行，这就需要外连接了。外连接分为：</p>\n<ul>\n<li>左外连接，内连接并保留左表没有匹配的行（若SELECT中包含右表的字段，则查询结果对应的记录为NULL）</li>\n<li>右外连接，内连接并保留右表没有匹配的行（若SELECT中包含左表的字段，则查询结果对应的记录为NULL）</li>\n</ul>\n<figure><figcaption>外连接</figcaption></figure>\n<p>左外连接示例：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p><code>OUTER</code>关键字可以省略，即<code>LEFT OUTER JOIN</code>和<code>LEFT JOIN</code>等价</p>\n</blockquote>\n<p>右外连接示例：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><blockquote>\n<p><code>OUTER</code>关键字可以省略，即<code>RIGHT OUTER JOIN</code>和<code>RIGHT JOIN</code>等价</p>\n</blockquote>\n",
      "date_published": "2022-10-22T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "MySQL-查询过程",
      "url": "https://Hexiaopi.github.io/database/mysql/read-process.html",
      "id": "https://Hexiaopi.github.io/database/mysql/read-process.html",
      "summary": "read",
      "content_html": "<figure><img src=\"https://cdn.cjhe.top/blog/MySQL-Read-Simple.png\" alt=\"read\" tabindex=\"0\" loading=\"lazy\"><figcaption>read</figcaption></figure>\n<!-- more -->\n<h2> 执行流程</h2>\n<p>简单的查询过程如下：</p>\n<figure><figcaption>MySQL交互流程</figcaption></figure>\n<p>详细的查询过程如下：</p>\n<figure><figcaption>MySQL查询流程</figcaption></figure>\n<h3> 连接器</h3>\n<blockquote>\n<p>连接器负责跟客户端建立连接、获取权限、维持和管理连接。</p>\n</blockquote>\n<p>我们使用以下命令和MySQL建立连接</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><ul>\n<li>如果用户名或密码不对，就会收到一个<code>Access denied for user</code>的错误</li>\n<li>如果用户名密码认证通过，连接器会到权限表里查出当前用户的权限。</li>\n</ul>\n<p>我们使用<code>show processlist</code>命令可以查看当前建立的连接以及执行的动作</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 查询缓存</h3>\n<blockquote>\n<p><code>&lt;=MySQL5.7版本</code>，自带缓存模块，默认关闭；</p>\n<p><code>&gt;=MySQL5.8版本</code>，移除缓存模块</p>\n</blockquote>\n<p>MySQL拿到一个查询请求后，会先进行缓存查询，如果之前执行的语句有缓存，则直接返回；</p>\n<p>缓存的限制：</p>\n<ul>\n<li>sql语句完全一致</li>\n<li>表里的数据不发生变化，如果发生变化，这张表的所有缓存都会失效</li>\n</ul>\n<p>因此，<strong>不建议使用查询缓存</strong>！</p>\n<h3> 分析器</h3>\n<blockquote>\n<p>分析器对SQL语句进行词法分析、语法分析、语义检查，得到语法树，在这个阶段，输入的是一条SQL语句，输出的是一棵语法树（AST）。</p>\n</blockquote>\n<ul>\n<li>\n<p><strong>词法分析</strong>：从左到右一个字符、一个字符的读入源输入，根据构词规则识别出一条SQL语句里面的字符串分别是什么，代表什么。</p>\n</li>\n<li>\n<p><strong>语法分析</strong>：在词法分析的基础上将单词序列组合成各类语法短语，如：“程序”、“语句”、“表达式”等。判断输入的这个SQL语句是否满足MySQL语法。如果语句不对，就会收到<code>You have an error in your SQL syntax</code>的错误提醒。</p>\n</li>\n<li>\n<p><strong>语义检查</strong>：对语法分析树进行逻辑判断，例如：</p>\n<ul>\n<li>检查表名是否错误（存在）</li>\n<li>检查列名是否错误（存在）</li>\n<li>检查别名是否错误（保证没有歧义）</li>\n</ul>\n</li>\n</ul>\n<p>例如：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>解析为语法树如下：<br>\n</p>\n<p><a href=\"https://shardingsphere.apache.org/document/current/cn/reference/sharding/parse/\" target=\"_blank\" rel=\"noopener noreferrer\">参考链接</a></p>\n<h3> 优化器</h3>\n<p>经过分析器，MySQL知道你需要做什么，在开始执行之前，还需要经过优化器的处理。</p>\n<p>例如：优化器在表里面有多个索引的时候，决定使用哪个索引，或者在一个语句有多表关联(join)的时候，决定各个表的连接顺序。</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><ul>\n<li>即可以先从表t1里面取出c=10的记录，再根据ID关联到表t2，再判断t2里面的d的值是否等于20</li>\n<li>也可以先从表t2里面取出d=20的记录，再根据ID关联到表t1，再判断t1里面的c的值是否等于10</li>\n</ul>\n<p>这两种执行方案的逻辑一致，但是执行的效率会有不同，优化器会决定选择使用哪一个方案。</p>\n<h4> 逻辑优化</h4>\n<blockquote>\n<p>优化器在逻辑优化阶段主要解决的问题是：如何找出SQL语句等价的变换形式，使得SQL执行更高效。</p>\n</blockquote>\n<h4> 物理优化</h4>\n<blockquote>\n<p>根据数据库的状态统计信息（数据库通过采样，统计出来的表、索引的相关信息，例如：表的记录数、索引的page数量、字段的Cardinality）计算各种操作算法的执行代价，定量的选择最优的查询方式。</p>\n</blockquote>\n<h3> 执行器</h3>\n<blockquote>\n<p>MySQL通过分析器知道了要做什么，通过优化器知道了该怎么做，就会进入执行器阶段，开始执行语句</p>\n</blockquote>\n<p>开始之前，先判断一下用户对表有没有查询的权限，如果没有就会返回没有权限错误，如果有权限，就打开表继续执行，执行器根据表的引擎定义，去使用这个引擎提供的接口。</p>\n",
      "image": "https://cdn.cjhe.top/blog/MySQL-Read-Simple.png",
      "date_published": "2022-10-22T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "SQL查询顺序",
      "url": "https://Hexiaopi.github.io/database/mysql/sql-order.html",
      "id": "https://Hexiaopi.github.io/database/mysql/sql-order.html",
      "summary": "sql-queries",
      "content_html": "<figure><img src=\"https://jvns.ca/images/sql-queries.jpeg\" alt=\"sql-queries\" tabindex=\"0\" loading=\"lazy\"><figcaption>sql-queries</figcaption></figure>\n<!-- more -->\n<p>这张图与 SQL 查询的语义有关，让你知道一个查询会返回什么，并回答了以下这些问题：</p>\n<ul>\n<li>\n<p>可以在 GROUP BY 之后使用 WHERE 吗？（不行，WHERE 是在 GROUP BY 之前！）</p>\n</li>\n<li>\n<p>可以对窗口函数返回的结果进行过滤吗？（不行，窗口函数是 SELECT 语句里，而 SELECT 是在 WHERE 和 GROUP BY 之后）</p>\n</li>\n<li>\n<p>可以基于 GROUP BY 里的东西进行 ORDER BY 吗？（可以，ORDER BY 基本上是在最后执行的，所以可以基于任何东西进行 ORDER BY）</p>\n</li>\n<li>\n<p>LIMIT 是在什么时候执行？（在最后！）</p>\n</li>\n</ul>\n<p>但数据库引擎并不一定严格按照这个顺序执行 SQL 查询，因为为了更快地执行查询，它们会做出一些优化。</p>\n<p>所以：</p>\n<p>如果你想要知道一个查询语句是否合法，或者想要知道一个查询语句会返回什么，可以参考这张图；</p>\n<p>需要注意的是，在实际实现中，MySQL会根据具体的查询条件和数据量进行一定的优化和调整。在涉及查询性能或者与索引有关的东西时，这张图就不适用了。</p>\n<h2> 详细查询顺序</h2>\n<p>1.FROM子句<br>\nMySQL首先处理FROM子句，该步骤主要是确定需要查询的数据表，并建立数据表之间的连接关系。</p>\n<p>2.WHERE子句<br>\n根据WHERE子句指定的查询条件，MySQL会进行筛选并过滤出符合条件的数据。</p>\n<p>3.GROUP BY子句<br>\n如果查询需要对数据分组，则MySQL会按照GROUP BY子句中指定的分组条件对数据进行分组，然后对每个组进行汇总计算。</p>\n<p>4.HAVING子句<br>\nHAVING子句用于过滤分组后的数据，和WHERE子句类似。只有满足HAVING子句指定的条件的组才会出现在结果集中。</p>\n<p>5.SELECT子句<br>\nSELECT子句是MySQL查询语句最主要的部分，它用于指定需要查询的数据集合以及计算这个数据集合中的一些列值。</p>\n<p>6.DISTINCT<br>\n如果使用了DISTINCT关键字，则MySQL会过滤掉查询结果中的重复记录。</p>\n<p>7.ORDER BY<br>\nORDER BY子句用于对查询结果进行排序。MySQL会按照指定的列或表达式的结果对查询结果进行排序，可以指定升序或降序。</p>\n<p>8.LIMIT<br>\nLIMIT关键字用于限制查询结果的数量。MySQL只返回前N条符合条件的记录，其中N由LIMIT语句后面的数字指定。</p>\n<h2> 参考文献</h2>\n<p><a href=\"https://jvns.ca/blog/2019/10/03/sql-queries-don-t-start-with-select/\" target=\"_blank\" rel=\"noopener noreferrer\">SQL查询不是以select开始</a></p>\n",
      "image": "https://jvns.ca/images/sql-queries.jpeg",
      "date_published": "2023-03-09T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "MySQL-事务",
      "url": "https://Hexiaopi.github.io/database/mysql/transaction.html",
      "id": "https://Hexiaopi.github.io/database/mysql/transaction.html",
      "summary": "事务的特性 原子性(Atomicity): 事务中的所有操作要么全部完成，要么全部不完成（回滚），不会在事务中间遇到错误而中断。 一致性(Consistency): 事务开始和结束时，数据都必须保持一致状态，即符合约束、完整性、默认值以及其它定义的规则。事务执行的结果不能破坏数据库的完整性和一致性。 隔离性(Isolation): 各个事务互相隔离，每个事务的执行都不会影响其它事务的执行或者结果。 持久性(Durability): 一个事务一旦提交成功，它对数据库中的数据的改变就是永久性的，即使发生数据库故障也不应该对其产生影响。",
      "content_html": "<h2> 事务的特性</h2>\n<ul>\n<li>原子性(Atomicity): 事务中的所有操作要么全部完成，要么全部不完成（回滚），不会在事务中间遇到错误而中断。</li>\n<li>一致性(Consistency): 事务开始和结束时，数据都必须保持一致状态，即符合约束、完整性、默认值以及其它定义的规则。事务执行的结果不能破坏数据库的完整性和一致性。</li>\n<li>隔离性(Isolation): 各个事务互相隔离，每个事务的执行都不会影响其它事务的执行或者结果。</li>\n<li>持久性(Durability): 一个事务一旦提交成功，它对数据库中的数据的改变就是永久性的，即使发生数据库故障也不应该对其产生影响。</li>\n</ul>\n<h2> 事务的实现</h2>\n<ul>\n<li>Undo log：实现事务的原子性；</li>\n<li>Redo log：实现事务的持久性；</li>\n<li>锁/MVCC：实现事务的隔离性；锁机制来保证事务在执行时互相隔离，防止事务间相互干扰，即写-写问题。MVCC 机制是通过保存历史版本的方式来实现，事务可以读取数据在事务开始时的版本，而不受到事务期间其他事务所做的改变的影响，即写-读问题。</li>\n<li>以上三者保证了事务的一致性；</li>\n</ul>\n<h2> 并发事务带来的问题</h2>\n<p>当数据库上有多个事务同时执行的时候，就可能出现<strong>脏读(dirty read)</strong>、<strong>不可重复读(non-repeatable read)</strong>、<strong>幻读(phantom read)</strong>，为了解决这些问题，就有了隔离级别的概念</p>\n<h3> 脏读问题</h3>\n<blockquote>\n<p>脏读是指：一个事务中访问到了另外一个事务未提交的数据</p>\n</blockquote>\n<figure><figcaption>dirty-read</figcaption></figure>\n<h3> 不可重复读问题</h3>\n<blockquote>\n<p>不可重复读是指：一个事务多次读取同一行数据，但是在多次读取中数据发生了改变。</p>\n</blockquote>\n<figure><figcaption>non-repeatable-read</figcaption></figure>\n<h3> 幻读问题</h3>\n<blockquote>\n<p>幻读是指：一个事务多次执行同一条 SQL 语句，但结果集却不同，导致无法支撑后续的业务操作</p>\n</blockquote>\n<figure><figcaption>phantom-read</figcaption></figure>\n<h2> 事务的隔离级别</h2>\n<p>针对上面三种问题，分别有四种隔离级别：</p>\n<h3> 未提交读(read uncommitted，RU)</h3>\n<blockquote>\n<p>未提交读，是指一个事务还未提交时，它做的变更就能被别的事务看到。即<strong>没有提交却可以读</strong></p>\n</blockquote>\n<h3> 提交读(read committed，RC)</h3>\n<blockquote>\n<p>提交读，是指一个事务提交之后，它做的变更才会被其他事务看到。即<strong>提交才可以读</strong></p>\n</blockquote>\n<p>👀 <strong>大多数数据库系统的默认隔离级别</strong></p>\n<h3> 可重复读(repeatable read，RR)</h3>\n<blockquote>\n<p>可重复度，是指同一个事务执行过程看到的数据，总是跟这个事务在启动时看到的数据是一致的。即同一个事务多次请求读取数据，会看到同样的数据行。</p>\n</blockquote>\n<p>👀 <strong>MySQL的默认隔离级别</strong></p>\n<h3> 串行化(serializable，S)</h3>\n<blockquote>\n<p>是最高的隔离级别，它通过强制事务排序，使之不可能相互冲突。</p>\n<p>这个级别可能导致大量的超时现象和锁竞争。</p>\n</blockquote>\n<p>以上四种隔离级别解决问题如下：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">隔离级别\\解决问题</th>\n<th style=\"text-align:center\">脏读</th>\n<th style=\"text-align:center\">不可重复读</th>\n<th style=\"text-align:center\">幻读</th>\n<th style=\"text-align:center\">实现原理</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">未提交读</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">没有视图概念</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">提交读</td>\n<td style=\"text-align:center\">✔️</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">每个SQL语句开始执行的时候创建视图</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">可重复读</td>\n<td style=\"text-align:center\">✔️</td>\n<td style=\"text-align:center\">✔️</td>\n<td style=\"text-align:center\">❌</td>\n<td style=\"text-align:center\">事务启动时创建视图，且整个事务期间都在用这个视图</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">串行化</td>\n<td style=\"text-align:center\">✔️</td>\n<td style=\"text-align:center\">✔️</td>\n<td style=\"text-align:center\">✔️</td>\n<td style=\"text-align:center\">加锁的方式避免并行访问</td>\n</tr>\n</tbody>\n</table>\n<p>各个隔离级别都有它自己的使用场景，需要根据业务情况来定，隔离级别从上到下，性能变差。</p>\n<h2> MVCC</h2>\n<p>MySQL InnoDB默认级别是可重复度隔离级别，为了解决不可重复读问题，InnoDB采用了MVCC(多版本并发控制)的方式。它为存储的每一行增加三个额外的隐藏字段</p>\n<ul>\n<li>DATA_TRX_ID：产生当前记录项的事务ID</li>\n<li>DELETE BIT：用于标识该记录是否是删除记录</li>\n<li>DATA_ROLL_PTR：指向当前记录项的undo信息</li>\n</ul>\n<h3> MVCC下SQL语句实际处理</h3>\n<h4> SELECT</h4>\n<ol>\n<li>\n<p>InnoDB只查找版本早于当前事务版本的数据行（行的事务版本号&lt;=当前事务的系统版本号），这样可以确保事务读取的行，要么是在事务开始前以及存在，要么是事务自身插入或者修改过的。</p>\n</li>\n<li>\n<p>行的删除版本要么未定义，要么大于当前事务版本号，这样可以确保事务读取到的行，在事务开始之前未被删除。</p>\n</li>\n</ol>\n<blockquote>\n<p>只有符合上述两个条件的记录，才能返回作为查询结果</p>\n</blockquote>\n<h4> INSERT</h4>\n<blockquote>\n<p>InnoDB为新插入的每一行保存当前事务版本号作为行版本号</p>\n</blockquote>\n<h4> DELETE</h4>\n<blockquote>\n<p>InnoDB为删除的每一行保存当前事务版本号作为行删除标识</p>\n</blockquote>\n<h4> UPDATE</h4>\n<blockquote>\n<p>InnoDB为插入一行新记录，保存当前事务版本作为行版本号，同时保存当前事务版本号到原来的行作为行删除标识</p>\n</blockquote>\n<p>MVCC多版本在事务启动时用到<strong>一致性读视图(consisten read view)</strong>，那什么是事务的一致性视图呢？</p>\n<p>InnoDB每个事务都有唯一的事务ID(transaction id)，它在事务开始的时候向InnoDB的事务系统申请的，是严格按照递增的顺序申请的。</p>\n<p>每行数据也都是有多个版本的，每次事务更新数据的时候，都会生成一个新的数据版本，并且将事务ID赋值给这个数据版本的事务ID，同时旧的数据版本要保留。如下图所示：</p>\n<figure><figcaption>行-版本</figcaption></figure>\n<p>图中虚线框中同一行数据有4个版本，每个版本均有对应的事务ID。</p>\n<p>InnoDB为每个事务构造了一个数组，用来保存这个事务启动瞬间，当前正在<strong>活跃</strong>（启动还为提交）的所有事务ID，数组里面事务ID的最小值记为<strong>低水位</strong>，事务ID的最大值+1记为<strong>高水位</strong>。这个视图数组和高水位就组成了当前事务的一致性视图。</p>\n<figure><figcaption>视图</figcaption></figure>\n<p>对于数据版本的事务ID，则存在以下情况：</p>\n<ul>\n<li>如果落在绿色部分，表示这个版本是已提交事务或者当前事务自己生成的，这个版本数据是可见的；</li>\n<li>如果落在红色部分，表示这个版本是由将来启动的事务生成的，则不可见；</li>\n<li>如果落在黄色部分，存在两种情况\n<ul>\n<li>若row trx_id在数组中，表示这个版本是由<strong>还未提交的事务</strong>生成的，这个版本数据是不可见的；</li>\n<li>若row trx_id不在数组中，表示这个版本是由<strong>已经提交的事务</strong>生成的，这个版本数据是可见的；</li>\n</ul>\n</li>\n</ul>\n<p>示例：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们以<strong>可重复读隔离级别</strong>为例：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">事务A</th>\n<th style=\"text-align:center\">事务B</th>\n<th style=\"text-align:center\">事务C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">start transaction with consistent snapshot;</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">start transaction with consistent snapshot;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">update t set k=k+1 where id=1;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">update t set k=k+1 where id=1;  <br>select k from t where id =1;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select k from t where id=1;<br>commit;</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">commit;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n<p>这里注意：</p>\n<p><code>begin/start transaction</code> 命令并不是一个事务的起点，在执行到它们之后的第一个操作 InnoDB 表的语句，事务才真正启动。如果你想要马上启动一个事务，可以使用 <code>start transaction with consistent snapshot</code>这个命令。</p>\n<p>这里我们假设事务A、B、C的版本号分别是100、101、102。</p>\n<p>id=1这行数据存在以下版本：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">事务ID</th>\n<th style=\"text-align:center\">90（历史事务ID）</th>\n<th style=\"text-align:center\">102</th>\n<th style=\"text-align:center\">101</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">值</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">3</td>\n</tr>\n</tbody>\n</table>\n<p>事务A查询的时候，事务B还没有提交，因此3不可见。事务C虽然提交了，但是事务A启动时，就创建了一致性视图，对于事务A来说，它的视图数组是[99,100]，依旧不可见。</p>\n<p>对于事务一致性视图来说，除了自己的更新总是可见以为，还有三种情况：</p>\n<ol>\n<li>版本未提交，不可见；</li>\n<li>版本已提交，但是是在视图创建后提交的，不可见。</li>\n<li>版本已提交，而且是在视图前提交的，可见。</li>\n</ol>\n<p>那么问题来了，事务B更新的时候，如果按照一致性视图，不应该更新k=3呀，这里就需要一条规则：<strong>更新数据都是先读后写</strong>，这个读要属于<strong>当前读</strong>，否则事务C就不生效了。</p>\n<p>读存在两种读：<strong>当前读</strong>和<strong>快照读</strong>。</p>\n<h3> 快照读</h3>\n<blockquote>\n<p>读取的是记录的可见版本，不用加锁</p>\n</blockquote>\n<p>简单的select操作，属于快照读，例如：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 当前读</h3>\n<p><strong>幻读在当前读才有可能出现</strong>，那么Innodb是如何防止幻读的呢，innodb提供了一个间隙锁的技术，行数结合间隙锁，达到最终目的。</p>\n<blockquote>\n<p>读取的是记录的最新版本，并且，当前读返回的记录，都会加上锁，保证其他事务不会再并发修改这条记录。</p>\n</blockquote>\n<p>特殊的读操作，以及插入、更新、删除操作都属于当前读，例如：</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们以<strong>读提交隔离级别</strong>为例：</p>\n<p>由于<code>start transaction with consistent snapshot;</code>在读提交隔离级别下没有意义，等价于普通的<code>start transaction</code></p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">事务A</th>\n<th style=\"text-align:center\">事务B</th>\n<th style=\"text-align:center\">事务C</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">start transaction;</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">start transaction;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">update t set k=k+1 where id=1;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">update t set k=k+1 where id=1;  <br>select k from t where id =1;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select k from t where id=1;<br>commit;</td>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">commit;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n<p>事务A在执行<code>select k from t where id=1;</code>才创建一致性视图，此时事务C已提交，因此k=2;</p>\n<p>同样事务B，事务C已提交，因此可见，且自己修改的肯定可见，因此k=3;</p>\n<h2> 那么MySQL可重复读解决幻读了吗？</h2>\n<p>我们试验为例：</p>\n<p>假设存在表<code>dept</code></p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>开启两个事务进行试验</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">事务A</th>\n<th style=\"text-align:center\">事务B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">start transaction;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">start transaction;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>Empty set (0.01 sec)</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">insert into dept values(1,'a');</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>Empty set (0.01 sec)</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">commit;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>Empty set (0.01 sec)</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">insert into dept values(1,'a');<br>Duplicate entry '1' for key 'PRIMARY'</td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n<p>事务A就很奇怪，明明查询不到数据，写入时却报主键重复错误😢(<strong>幻读出现</strong>)</p>\n<p>继续试验：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">事务A</th>\n<th style=\"text-align:center\">事务B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">start transaction;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">start transaction;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>1,a</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">insert into dept values(2,'b');</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>1,a</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">commit;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>1,a</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">update dept set value='z';<br>Query OK, 2 rows affected (0.00 sec)</td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n<p>事务A又奇怪了，明明只有一条数据，为啥影响了两条数据😭（<strong>幻读出现</strong>）</p>\n<p>那么MySQL如何解决幻读呢</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">事务A</th>\n<th style=\"text-align:center\">事务B</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">start transaction;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">start transaction;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept where id&gt;=1 for update;<br>1,z<br>2,z</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">insert into dept values(3,'c');<br>Lock wait timeout exceeded; try restarting transaction</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>1,z<br>2,z</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\"></td>\n<td style=\"text-align:center\">commit;</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">insert into dept values(3,'c');</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">commit;</td>\n<td style=\"text-align:center\"></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">select * from dept;<br>1,z<br>2,z<br>3,c</td>\n<td style=\"text-align:center\"></td>\n</tr>\n</tbody>\n</table>\n<p>可以看到通过对<code>id&gt;=1</code>加锁，成功解决幻读问题，但是如果在间隙锁之外进行数据操作，其实还是会出现幻读。因此MySQL可重复读隔离级别通过间隙锁部分解决幻读问题，并没有完全解决，如果要解决幻读问题只能使用串行化隔离级别。</p>\n",
      "date_published": "2022-10-23T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "MySQL-写入过程",
      "url": "https://Hexiaopi.github.io/database/mysql/write-process.html",
      "id": "https://Hexiaopi.github.io/database/mysql/write-process.html",
      "summary": "执行流程 查询语句执行的流程，更新语句也会执行类似的过程，稍有差别的地方是更新语句会将更新表的所有缓存清理，这就是为什么不建议使用查询缓存。 交互流程 日志模块 更重要的是MySQL的日志模块，这是数据库提供高可用以及事务的重要模块 我们以InnoDB引擎和一条更新语句为例 写流程 蓝色框是MySQL服务层处理过程; 绿色框是InnoDB引擎层处理过程...",
      "content_html": "<!-- more -->\n<h2> 执行流程</h2>\n<blockquote>\n<p>查询语句执行的流程，更新语句也会执行类似的过程，稍有差别的地方是更新语句会将更新表的所有缓存清理，这就是为什么不建议使用查询缓存。</p>\n</blockquote>\n<figure><figcaption>交互流程</figcaption></figure>\n<h3> 日志模块</h3>\n<blockquote>\n<p>更重要的是MySQL的日志模块，这是数据库提供高可用以及事务的重要模块</p>\n</blockquote>\n<p>我们以InnoDB引擎和一条更新语句为例</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><figure><figcaption>写流程</figcaption></figure>\n<ul>\n<li>蓝色框是MySQL服务层处理过程</li>\n<li>绿色框是InnoDB引擎层处理过程</li>\n</ul>\n<p>其中：</p>\n<ul>\n<li>undolog用于InnoDB记录事务回滚日志</li>\n<li>redolog用于InnoDB记录事务前滚日志，保障事务<code>crash-safe</code></li>\n<li>binlog是MySQL服务层归档日志</li>\n</ul>\n<ol>\n<li>执行器先找引擎取 ID=2 这一行。ID 是主键，引擎直接用树搜索找到这一行。如果 ID=2 这一行所在的数据页本来就在内存中，就直接返回给执行器；否则，需要先从磁盘读入内存，然后再返回。</li>\n<li>执行器拿到引擎给的行数据，把这个值加上 1，比如原来是 N，现在就是 N+1，得到新的一行数据，再调用引擎接口写入这行新数据。</li>\n<li>引擎记录undolog</li>\n<li>引擎将这行新数据更新到内存中，同时将这个更新操作记录到 redo log 里面，此时 redo log 处于 prepare 状态。然后告知执行器执行完成了，随时可以提交事务。</li>\n<li>执行器生成这个操作的 binlog，并把 binlog 写入磁盘。</li>\n<li>执行器调用引擎的提交事务接口，引擎把刚刚写入的 redo log 改成提交（commit）状态，更新完成。</li>\n</ol>\n<p>redolog的写入拆成了两个步骤：prepare和commit，这就是<strong>两阶段提交</strong></p>\n",
      "date_published": "2022-10-22T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "数据库"
      ]
    },
    {
      "title": "行为型模式",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/",
      "summary": "行为型设计模式 行为型设计模式是一类用于处理对象之间交互、职责划分以及算法封装等问题的设计模式，这类设计模式关注的是对象之间的通信以及行为的分配，可以帮助解决对象之间职责不够清晰、相互依赖、难以复用等问题。 相同点 都是用于描述和组织对象的行为和交互方式； 通过将复杂的交互拆分成多个独立的部分，提高代码的重用性和可维护性； 用于降低对象之间的耦合度，提高代码的可扩展性和灵活性； 通过定义抽象接口和规范方法调用方式，提高代码的规范性和可读性。",
      "content_html": "<h2> 行为型设计模式</h2>\n<blockquote>\n<p>行为型设计模式是一类用于处理对象之间交互、职责划分以及算法封装等问题的设计模式，这类设计模式关注的是对象之间的通信以及行为的分配，可以帮助解决对象之间职责不够清晰、相互依赖、难以复用等问题。</p>\n</blockquote>\n<h3> 相同点</h3>\n<ul>\n<li>都是用于描述和组织对象的行为和交互方式；</li>\n<li>通过将复杂的交互拆分成多个独立的部分，提高代码的重用性和可维护性；</li>\n<li>用于降低对象之间的耦合度，提高代码的可扩展性和灵活性；</li>\n<li>通过定义抽象接口和规范方法调用方式，提高代码的规范性和可读性。</li>\n</ul>\n<h3> 不同点</h3>\n<ul>\n<li>观察者模式旨在实现对象之间的松耦合关系，当一个对象状态发生改变时，它会通知它所观察到的所有对象；</li>\n<li>模板方法模式旨在将通用的算法框架定义为一个抽象函数，然后由子类实现具体算法的不同部分；</li>\n<li>策略模式是定义一族算法、封装每个算法，并使这些算法可以互换，从而让算法的变化独立于客户端；</li>\n<li>命令模式旨在将请求封装成对象，以便于参数化和传递，同时支持请求排队、记录日志、撤销等操作；</li>\n<li>责任链模式旨在将请求的处理方式连成一个链，每个对象都尝试处理该请求，直到其中一个对象处理成功为止；</li>\n<li>迭代器模式是在不暴露集合内部结构的情况下，提供一种访问元素的方式；</li>\n<li>访问者模式则是定义了一组对数据结构中的元素进行操作的方法，通过这些方法可以实现对数据结构的统一处理。</li>\n</ul>\n",
      "date_published": "2023-07-31T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "责任链",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/chain-of-responsibility.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/chain-of-responsibility.html",
      "summary": "责任链",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/chain-of-responsibility/chain-of-responsibility-2x.png\" alt=\"责任链\" tabindex=\"0\" loading=\"lazy\"><figcaption>责任链</figcaption></figure>\n<!-- more -->\n<h2> 什么是责任链模式</h2>\n<p>责任链模式(Chain of Responsibility)：为了避免请求发送者与多个请求处理者耦合在一起，将所有请求的处理者通过前一对象记住其下一个对象的引用而连成一条链；当有请求发生时，可将请求沿着这条链传递，直到有对象处理它为止。</p>\n<div class=\"language-ascii line-numbers-mode\" data-ext=\"ascii\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 包含哪些角色</h3>\n<ul>\n<li>\n<p>Handler: 抽象处理者</p>\n<p>包含一个处理请求的接口和一个设置后续处理者</p>\n</li>\n<li>\n<p>Concrete Handler: 具体处理者</p>\n<p>实现抽象处理者接口</p>\n</li>\n<li>\n<p>Client: 客户端</p>\n<p>创建处理链，并让链头开始执行处理</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 使用场景</h3>\n<ul>\n<li>审批流程：经理、主管、Boss</li>\n<li>医院流程：挂号处、医生、收银处、药房</li>\n</ul>\n<h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>可以控制请求处理的顺序；</li>\n<li>单一职责原则，具体的处理者只关心自己的业务；</li>\n<li>开闭原则，可以不更改现有代码的情况下新增处理者；</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>各个处理者须有共同的处理函数</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/chain-of-responsibility/chain-of-responsibility-2x.png",
      "date_published": "2022-12-13T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "命令",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/command.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/command.html",
      "summary": "command",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/command/command-zh-2x.png\" alt=\"command\" tabindex=\"0\" loading=\"lazy\"><figcaption>command</figcaption></figure>\n<!-- more -->\n<h2> 什么是行为型模式</h2>\n<p>命令设计模式允许将请求封装成对象，从而将不同的请求发送者与接收者解耦。命令对象包含了请求的所有信息，包括调用的方法、参数和接收者等。这种方式使得请求的发送者与接收者无需知道彼此的存在，从而可以更灵活地进行交互。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>command</figcaption></figure>\n<ul>\n<li>\n<p>Invoker: 调用者</p>\n<p>创建和配置命命令对象，并将其传递给接收者</p>\n</li>\n<li>\n<p>Command: 命令接口</p>\n<p>定义命令的核心接口，通常包括一个执行方法</p>\n</li>\n<li>\n<p>ConcreteCommand: 具体命令类</p>\n<p>实现命令接口，并封装具体的操作。通常需要引用接收者，从而调用对应的方法</p>\n</li>\n<li>\n<p>Receiver: 接收者</p>\n<p>实现请求的实际操作，命令对象将请求传递给接收者，从而完成请求</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 适用场景</h2>\n<ul>\n<li>\n<p>需要将请求和执行操作解耦的情况。命令模式可以将请求封装为对象并将其发送给接收者，从而使得发送者和接收者之间松耦合。</p>\n</li>\n<li>\n<p>需要支持撤销或重做操作的情况。由于每个命令都封装了一组特定的操作，因此可以轻松进行撤销或重做。</p>\n</li>\n<li>\n<p>需要支持事务操作的情况。将一组相关的命令组合在一起，可以实现事务操作，即一组操作要么全部成功执行，要么全部失败。</p>\n</li>\n<li>\n<p>需要远程执行操作的情况。将命令对象序列化到网络上，可以实现远程执行操作的功能。</p>\n</li>\n<li>\n<p>需要将命令队列中的请求延迟、调度或者执行的情况。可以将命令对象存储在队列中，然后按照特定的规则执行它们。</p>\n</li>\n<li>\n<p>需要实现日志、审计或者事务记录的情况。可以在执行命令的同时，将其记录下来，并可以将其回放以重现历史操作。</p>\n</li>\n</ul>\n<h3> 请求与执行解耦</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们将请求者Computer和接收者Origin，进行了解耦。请求者可以任意追加命令，执行：加、减、乘、除等运算。</p>\n<h3> 撤销操作</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们对Commonder接口增加Undo方法，即可以实现计算器的撤销操作。</p>\n<h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>命令模式可以降低代码的耦合度，并且将请求调用者与请求接收者进行解耦；</li>\n<li>命令模式扩展性较高\n<ul>\n<li>如果是扩展新的命令，那么直接定义新的命令类即可；</li>\n<li>如果是执行一组命令，那么</li>\n</ul>\n</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>可能会导致性能问题。使用命令模式可能会增加对象数量，并且每个命令都需要进行封装，可能会导致性能下降。</li>\n<li>可能会使代码更加复杂。使用命令模式需要定义许多接口和类，可能会使代码过于复杂，难以维护。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/command/command-zh-2x.png",
      "date_published": "2023-04-26T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "迭代器",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/iterator.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/iterator.html",
      "summary": "iterator",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/iterator/iterator-zh-2x.png\" alt=\"iterator\" tabindex=\"0\" loading=\"lazy\"><figcaption>iterator</figcaption></figure>\n<!-- more -->\n<h2> 什么是迭代器模式</h2>\n<p>迭代器模式是一种行为设计模式，让你能在不暴露集合底层结构（列表、栈、树等）的情况下遍历集合中的所有元素。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>iterator</figcaption></figure>\n<ul>\n<li>\n<p>Iterator: 迭代器接口</p>\n<p>声明了遍历集合所需的操作</p>\n</li>\n<li>\n<p>IterableCollection: 集合接口</p>\n<p>声明一个方法或多个方法来获取与集合兼容的迭代器。</p>\n</li>\n<li>\n<p>ConcreteIterator: 具体迭代器</p>\n<p>实现遍历集合的一种特定算法，迭代器对象必须跟踪自身遍历进度。</p>\n</li>\n<li>\n<p>ConcreteCollection: 具体集合</p>\n<p>会在客户端请求迭代器时返回一个特定的具体迭代器类实体。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>访问一个聚合对象的内容而无须暴露它的内部表示。</li>\n<li>遍历任务交由迭代器完成，这简化了聚合类。</li>\n<li>它支持以不同方式遍历一个聚合，甚至可以自定义迭代器的子类以支持新的遍历。</li>\n<li>增加新的聚合类和迭代器类都很方便，无须修改原有代码。</li>\n<li>封装性良好，为遍历不同的聚合结构提供一个统一的接口。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>增加了类的个数，这在一定程度上增加了系统的复杂性。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/iterator/iterator-zh-2x.png",
      "date_published": "2022-12-12T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "中介者",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/mediator.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/mediator.html",
      "summary": "mediator",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/mediator/mediator-2x.png\" alt=\"mediator\" tabindex=\"0\" loading=\"lazy\"><figcaption>mediator</figcaption></figure>\n<!-- more -->\n<h2> 什么是中介者模式</h2>\n<p>中介者模式(Mediator Pattern)又叫调停者模式，通过在中间引入中介对象来协调各个对象之间交互，使得对象之间不直接交互，而是通过中介者进行通信和协调，从而使得各个对象能够更加灵活地进行组合和拆分，增强系统的可维护性和扩展性。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>mediator</figcaption></figure>\n<ul>\n<li>\n<p>Mediator：中介者</p>\n<p>定义了中介者的接口，即通过该接口与其他组件交互</p>\n</li>\n<li>\n<p>ConcreteMediator：具体中介者</p>\n<p>实现了中介者的接口，维护其他组件之间的交互关系。</p>\n</li>\n<li>\n<p>Colleague：同事</p>\n<p>定义组件的接口，即通过该接口与中介者交互。</p>\n</li>\n<li>\n<p>ConcreteColleague：具体同事</p>\n<p>实现了组件的接口，维护自己与其他组件之间的交互关系。注意，同事之间不会直接交互，而是通过中介者来完成交互。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>\n<p>降低系统复杂度：通过中介者对象，可以将系统中多个对象之间的直接交互关系转化为对中介者对象的请求调用，从而简化了系统的复杂度；</p>\n</li>\n<li>\n<p>减低系统维护成本：通过减少对象之间的直接耦合度，提高了系统的灵活性和可维护性，降低了系统维护的成本；</p>\n</li>\n<li>\n<p>提高系统扩展性：由于中介者对象独立负责对象之间的通信协调，因此增加、删除或修改一个对象都不会影响其他对象的交互关系，从而提高了系统的可扩展性。</p>\n</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>\n<p>中介者对象会引入系统的复杂度：虽然中介者对象可以简化系统的复杂度，但如果中介者对象本身过于复杂，可能会引入新的复杂度；</p>\n</li>\n<li>\n<p>中介者对象可能成为系统的<strong>瓶颈</strong>：由于所有的交互都要经过中介者对象，当系统中对象数量较多或交互复杂时，中介者对象可能成为系统的瓶颈。</p>\n</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/mediator/mediator-2x.png",
      "date_published": "2023-04-29T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "备忘录",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/memento.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/memento.html",
      "summary": "memento",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/memento/memento-zh-2x.png\" alt=\"memento\" tabindex=\"0\" loading=\"lazy\"><figcaption>memento</figcaption></figure>\n<!-- more -->\n<h2> 什么是备忘录模式</h2>\n<p>备忘录模式(Memento Pattern)允许在不暴露对象实现细节的情况下保存和恢复对象之前的状态。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>memento</figcaption></figure>\n<ul>\n<li>\n<p>Originator: 原发器</p>\n<p>用于生成自身状态的快照，在需要时可以通过快照恢复自身状态</p>\n</li>\n<li>\n<p>Memento: 备忘录</p>\n<p>原发器状态快照，通常将备忘录设置为不可变的类，并且通过构造函数一次性传递数据</p>\n</li>\n<li>\n<p>Caretaker: 负责人</p>\n<p>存储备忘录的历史记录</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>可以在不破坏对象封装性的前提下捕获并存储对象的状态；</li>\n<li>简化了对象在不同状态之间的切换过程，避免了大量的 if-else 语句；</li>\n<li>原发器和负责人之间的解耦，原发器只需要知道如何创建备忘录和恢复备忘录即可，而负责人则负责保存备忘录。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>使用备忘录会占用一定的内存空间；</li>\n<li>当原发器的状态改变很频繁时，备忘录对象的数量会很大，会占用较大的内存空间；</li>\n<li>如果原发器需要保存的状态很多，那么备忘录对象的创建和恢复操作就会变得很慢。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/memento/memento-zh-2x.png",
      "date_published": "2023-05-01T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "观察者",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/observer.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/observer.html",
      "summary": "observer",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/observer/observer-2x.png\" alt=\"observer\" tabindex=\"0\" loading=\"lazy\"><figcaption>observer</figcaption></figure>\n<!-- more -->\n<h2> 什么是观察者模式</h2>\n<p>观察者模式(Observer Pattern)定义了对象之间的一对多依赖关系，当一个对象的状态发生变化时，所有依赖关系都会自动得到通知和更新。类似订阅机制，对象变化时通知多个<strong>观察</strong>该对象的其他对象。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>observer</figcaption></figure>\n<ul>\n<li>\n<p>Observer: 观察者</p>\n<p>声明了通知接口，在绝大数情况下，该接口仅包含一个<code>update</code>方法，该方法可以有多个参数</p>\n</li>\n<li>\n<p>Subject: 主题</p>\n<p>提供一个用于存储观察者对象的聚集类，该类通常包含<code>注册</code>和<code>取消注册</code>观察者的方法，以及通知所有观察者变化的方法。</p>\n</li>\n<li>\n<p>ConcreteObserver: 具体的观察者</p>\n<p>实现观察者接口定义的方法，根据自己的需要，实现对象变化时具体的行为。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>松耦合：观察者模式使主题和观察者之间的依赖关系变得松散，让它们可以独立演化，这样就可以在不影响主题的情况下修改或扩展观察者。</li>\n<li>可重用性：由于主题和观察者之间的关系被封装在抽象接口中，因此可以方便地添加新的观察者或主题，从而提高代码的可重用性和可维护性。</li>\n<li>通知机制：一旦主题状态发生变化，观察者会自动被通知，并且可以及时更新自己的状态，从而保证了数据的一致性。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>性能问题：如果观察者过多，通知所有观察者会浪费很多资源，可能会导致系统运行缓慢。</li>\n<li>难以理解：当涉及多个对象之间的交互时，观察者模式可能比较难以理解和调试</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/observer/observer-2x.png",
      "date_published": "2023-05-02T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "状态",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/state.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/state.html",
      "summary": "state",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/state/state-zh-2x.png\" alt=\"state\" tabindex=\"0\" loading=\"lazy\"><figcaption>state</figcaption></figure>\n<!-- more -->\n<h2> 什么是状态模式</h2>\n<p>状态模式(State Pattern) 允许对象在其内部状态发生变化时改变其行为。通过将状态转换代码从主逻辑中抽离并封装在状态对象中，使得对象能够在行为上进行更灵活的变化。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>state</figcaption></figure>\n<ul>\n<li>\n<p>Context: 上下文</p>\n<p>它是包含状态的主对象。它还包含一些用于在状态之间切换的方法。</p>\n</li>\n<li>\n<p>State: 状态</p>\n<p>它定义一个接口，用于封装与上下文的特定状态相关的行为。</p>\n</li>\n<li>\n<p>ConcreteStates: 具体状态类</p>\n<p>实现State接口，每个具体状态都提供各自的实现方式。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>将状态抽象成对象，使得状态之间的转换更加清晰明了。通过将每种状态封装成具体的类，可以使代码更加简单易懂，避免了状态转换时大量的条件判断。</li>\n<li>状态之间的转换变得容易扩展。由于状态之间的转换是由状态对象自身完成的，因此只需要增加、修改或删除对应的状态类即可扩展或修改状态转换，而不影响其他部分。</li>\n<li>提高代码的复用性和灵活性。由于每个状态都是一个独立的对象，因此可以在不同的上下文中重复使用。这样，就可以实现更多的组合方式，从而提高代码的复用性和灵活性。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>\n<p>对于简单的状态机，引入状态模式会增加额外的复杂度。如果状态机只有几个状态，那么引入状态模式可能会让代码更加复杂，难以维护。</p>\n</li>\n<li>\n<p>增加了系统的类和对象数量。引入状态模式会增加额外的类和对象，在一定程度上增加了系统的复杂度和开销。</p>\n</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/state/state-zh-2x.png",
      "date_published": "2023-05-04T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "策略",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/strategy.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/strategy.html",
      "summary": "strategy",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/strategy/strategy-2x.png\" alt=\"strategy\" tabindex=\"0\" loading=\"lazy\"><figcaption>strategy</figcaption></figure>\n<!-- more -->\n<h2> 什么是策略模式</h2>\n<p>策略模式(Strategy Pattern)定义了算法族，分别封装起来，让他们之间可以互相替换，此模式让算法的变化独立于使用算法的客户。策略模式属于对象行为模式，它通过对算法进行封装，把使用算法的责任和算法的实现分割开来，并委派给不同的对象对这些算法进行管理。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>strategy</figcaption></figure>\n<ul>\n<li>\n<p>Strategy: 策略接口</p>\n<p>是所有具体策略的通用接口，它声明了一个上下文用于执行策略的方法</p>\n</li>\n<li>\n<p>Concrete Strategies: 具体策略，实现了上下文所用算法的各种不同变体；</p>\n</li>\n<li>\n<p>Context: 上下文，维护指向具体策略的引用，且仅通过策略接口与该对象进行交流；</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>可以在运行时切换对象内的算法。</li>\n<li>可以将算法的实现和使用算法的代码隔离开来。</li>\n<li>可以使用组合来代替继承。</li>\n<li>开闭原则，无需对上下文进行修改就能够引入新的策略。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>如果你的算法极少发生改变， 那么没有任何理由引入新的类和接口。 使用该模式只会让程序过于复杂。</li>\n<li>客户端必须知晓策略间的不同——它需要选择合适的策略。</li>\n<li>许多现代编程语言支持函数类型功能， 允许你在一组匿名函数中实现不同版本的算法。 这样， 你使用这些函数的方式就和使用策略对象时完全相同， 无需借助额外的类和接口来保持代码简洁。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/strategy/strategy-2x.png",
      "date_published": "2022-12-13T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "模版方法",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/template-method.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/template-method.html",
      "summary": "template-method",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/template-method/template-method-2x.png\" alt=\"template-method\" tabindex=\"0\" loading=\"lazy\"><figcaption>template-method</figcaption></figure>\n<!-- more -->\n<h2> 场景问题</h2>\n<p>例如：假设开发一个文档的数据挖局程序，输入各种格式的文档（PDF、DOC、CSV、...），程序从这些文档中提取有意义的数据，进行处理和分析，并返回给用户。随着开发进行，实现三个类分别是：PDFDataMiner、DOCDataMiner、CSVDataMiner，它们都有相似的处理逻辑：打开文件、提取数据、转换数据、分析数据、发送报告。其中：分析数据和发送报告模块完全一致。<br>\n那么我们就可以使用模版方法模式将步骤进行抽象，并提供步骤的默认实现，支持重写。</p>\n<h2> 什么是模版方法模式</h2>\n<p>模版方法模式（Template Method Pattern），将总结出来的规律沉淀为一种既定格式，并固化于模版中以供子类继承，对未确定下来的步骤方法进行抽象化，使其得以延续、多态化，最终架构起一个平台，使系统实现在不改变预设规则的前提下，对每个分步骤进行个性化定义的目的。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>template-method</figcaption></figure>\n<ul>\n<li>\n<p>AbstractClass: 抽象类</p>\n<p>负责给出一个算法的轮廓和骨架。它由一个模版方法和若干个基本方法构成</p>\n</li>\n<li>\n<p>ConCreteClass: 具体实现类</p>\n<p>复用抽象类的方法，或者重写相关方法。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<p>由于Go语言没有抽象类这一概念，我们使用接口实现。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其中concreate2并未实现step2()，而是使用了默认的step2()</p>\n<h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>允许客户端重写一个大型算法中的特定部分，使得算法其他部分修改对其所造成的影响较小。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>部分客户端可能受到算法框架的限制</li>\n<li>通过子类一直默认步骤实现可能会导致违反里氏替换原则</li>\n<li>模版方法中的步骤越多，其维护工作就可能会越困难</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/template-method/template-method-2x.png",
      "date_published": "2022-12-11T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "访问者",
      "url": "https://Hexiaopi.github.io/design-pattern/behavioral/visitor.html",
      "id": "https://Hexiaopi.github.io/design-pattern/behavioral/visitor.html",
      "summary": "visitor",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/visitor/visitor-2x.png\" alt=\"visitor\" tabindex=\"0\" loading=\"lazy\"><figcaption>visitor</figcaption></figure>\n<!-- more -->\n<h2> 什么是访问者模式</h2>\n<p>访问者模式(Visitor Pattern)将算法与对象结构分离开来，并在结构中增加可操作元素的能力。其主要思想是在不改变已有类的前提下，通过增加访问者类，来给已有类增加新的操作方法。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>visitor</figcaption></figure>\n<ul>\n<li>\n<p>Visitor: 访问者</p>\n<p>声明了一些列以对象结构的具体元素为参数的访问者方法</p>\n</li>\n<li>\n<p>ConCreteVistors: 具体访问者</p>\n<p>不同的具体访问者实现访问元素对象各不相同</p>\n</li>\n<li>\n<p>Element: 元素</p>\n<p>声明了一个方法来接收访问者</p>\n</li>\n<li>\n<p>ConcreteElement: 具体元素</p>\n<p>具体元素实现接收方法，该方法根据当前访问者类调用相应访问者方法。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 应用场景</h2>\n<ul>\n<li>当对象结构比较稳定，但需要经常定义新的操作时，访问者模式可以使用。</li>\n<li>当一组对象中，需要执行不同的、复杂的操作时，可以使用访问者模式来封装这些操作，以简化代码逻辑。</li>\n</ul>\n<h3> 在不修改已有代码的情况下，向已有类层次结构增加新的行为</h3>\n<p>假如当前已有三种稳定图形类：正方形、圆形、三角形。当前需求是获取这三种图形的面积和周长，且未来可能有其他的行为操作。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这里只需要实现面积访问者类和周长访问者类就可以不用动三个图形类。</p>\n<h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>增加新的操作时不需要改变现有的对象结构，只需要增加新的访问者即可。</li>\n<li>结构和操作分离，符合<strong>单一职责原则</strong>和<strong>开闭原则</strong>，降低了系统的耦合度。</li>\n<li>把数据结构和操作分离，可以使得代码更容易理解和维护。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>增加新的元素时比较困难，需要修改抽象访问者的接口以及所有的具体访问者的实现。</li>\n<li>访问者模式将对象本身和操作分离开来，导致增加新的操作不够方便。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/visitor/visitor-2x.png",
      "date_published": "2023-05-05T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "创建型模式",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/",
      "summary": "创建型设计模式 创建型设计模式是一种常用的设计模式，常用于对象的创建和初始化，这些模式描述了创建对象的不同方式，以及处理对象创建的方案。 相同点 目标：创建型设计模式的主要目标是将对象的创建和使用分离，提供一种灵活的方式来创建对象。 抽象：这些模式通常通过引入抽象层来隐藏对象创建的细节，使得客户端代码更加简洁和可维护。 重用：创建型设计模式鼓励代码的重用，通过提供灵活的创建方式来满足不同的需求。 不同点",
      "content_html": "<h2> 创建型设计模式</h2>\n<blockquote>\n<p>创建型设计模式是一种常用的设计模式，常用于对象的创建和初始化，这些模式描述了创建对象的不同方式，以及处理对象创建的方案。</p>\n</blockquote>\n<h3> 相同点</h3>\n<ul>\n<li>目标：创建型设计模式的主要目标是将对象的创建和使用分离，提供一种灵活的方式来创建对象。</li>\n<li>抽象：这些模式通常通过引入抽象层来隐藏对象创建的细节，使得客户端代码更加简洁和可维护。</li>\n<li>重用：创建型设计模式鼓励代码的重用，通过提供灵活的创建方式来满足不同的需求。</li>\n</ul>\n<h3> 不同点</h3>\n<ul>\n<li>创建过程：不同的创建型设计模式使用不同的方式来创建对象。例如，工厂方法模式使用工厂类来创建对象，抽象工厂模式使用一组相关的工厂类来创建对象，单例模式只允许创建一个对象等。</li>\n<li>灵活性：不同的创建型设计模式在灵活性方面有所不同。有些模式提供了更高的灵活性，允许在运行时动态配置对象的创建过程，而有些模式则在创建过程上更为固定。</li>\n<li>适用场景：不同的创建型设计模式适用于不同的场景和需求。例如，工厂方法模式适用于需要根据特定条件创建不同类型对象的场景，建造者模式适用于复杂对象的创建过程等。</li>\n</ul>\n",
      "date_published": "2023-07-31T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "抽象工厂",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/abstract-factory.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/abstract-factory.html",
      "summary": "abstract-factory",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/abstract-factory/abstract-factory-zh-2x.png\" alt=\"abstract-factory\" tabindex=\"0\" loading=\"lazy\"><figcaption>abstract-factory</figcaption></figure>\n<!-- more -->\n<h2> 什么是抽象工厂模式</h2>\n<p>工厂方法模式只考虑生产同等级的产品，而抽象工厂模式(Abstract Factory Pattern)可生产多个等级的产品。抽象工厂模式用于生成<strong>产品族</strong>的工厂，所生成的对象是有关联的，同一个具体工厂所生产的位于不同等级的一组产品称为一个产品族，例如：</p>\n<ul>\n<li>桌子、椅子、沙发是一个产品族</li>\n<li>欧洲牌、亚洲牌是一个产品等级</li>\n</ul>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>抽象工厂模式</figcaption></figure>\n<ul>\n<li>\n<p>Abstract Factory: 抽象工厂</p>\n<p>它声明了一组用于创建一族产品的方法，每一个方法对应一种产品。</p>\n</li>\n<li>\n<p>Concrete Factory: 具体工厂</p>\n<p>它实现了在抽象工厂中声明的创建产品的方法，生成一组具体产品，这些产品构成了一个产品族，每一个产品都位于某个产品等级结构中。</p>\n</li>\n<li>\n<p>Abstract Product: 抽象产品</p>\n<p>它为每种产品声明接口，在抽象产品中声明了产品所具有的业务方法。</p>\n</li>\n<li>\n<p>Product: 具体产品</p>\n<p>它定义具体工厂生产的具体产品对象，实现抽象产品接口中声明的业务方法。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 应用场景</h3>\n<p>在以下情况下可以使用抽象工厂模式：</p>\n<ul>\n<li>一个系统不应当依赖于产品类实例如何被创建、组合和表达的细节，这对于所有类型的工厂模式都是重要的。</li>\n<li>系统中有多于一个的产品族，而每次只使用其中某一产品族。</li>\n<li>属于同一个产品族的产品将在一起使用，这一约束必须在系统的设计中体现出来。</li>\n<li>系统提供一个产品类的库，所有的产品以同样的接口出现，从而使客户端不依赖于具体实现。</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>抽象工厂模式隔离了具体类的生产，使得客户并不需要知道什么被创建。</li>\n<li>抽象工厂模式可以在类的内部对产品族进行约束，保证客户端始终只使用同一个产品族中的对象。</li>\n<li>抽象工厂模式可以方便地切换产品系列，只需要更换具体工厂即可。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>产品族扩展非常困难，要增加一个系列的某一产品，既要在抽象的工厂里加代码，又要在具体的工厂里加代码。<strong>产品族难扩展，产品等级易扩展</strong></li>\n<li>抽象工厂模式增加了系统的抽象性和理解难度。</li>\n</ul>\n<h2> 总结</h2>\n<p>抽象工厂模式通过引入抽象工厂接口和抽象产品接口，提供了一种统一的接口用于创建一组相关的产品对象。它可以将产品的创建过程封装起来，使得客户端代码可以与具体产品的实现细节解耦。抽象工厂模式的灵活性和可扩展性允许在运行时动态切换不同的具体工厂和产品族。</p>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/abstract-factory/abstract-factory-zh-2x.png",
      "date_published": "2022-10-15T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "建造者",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/builder.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/builder.html",
      "summary": "builder",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/builder/builder-zh-2x.png\" alt=\"builder\" tabindex=\"0\" loading=\"lazy\"><figcaption>builder</figcaption></figure>\n<!-- more -->\n<h2> 什么是建造者模式</h2>\n<p>建造者模式(Builder Pattern)又叫生成器模式，它将一个复杂对象的构建与它的表示分离。使统一的构建过程可以创建不同的表示。</p>\n<p>它将一个复杂的对象分解为多个简单的对象，然后一步一步构建而成，它将变与不变相分离，即产品的组成部分是不变的，但每一部分是可以灵活选择的。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>建造者模式</figcaption></figure>\n<ul>\n<li>\n<p>Product：产品角色</p>\n<p>包含多个组成部分的复杂对象，由具体建造者来创建各个零部件。</p>\n</li>\n<li>\n<p>Builder：抽象建造者</p>\n<p>为创建产品各个子部件指定抽象接口，一般是buildXXX()方法，通常还包含一个返回复杂产品的方法getResult()。</p>\n</li>\n<li>\n<p>Concrete Builder：具体建造者</p>\n<p>实现Builder接口，完成复杂产品的各个部件的具体创建方法。</p>\n</li>\n<li>\n<p>Director：指挥者</p>\n<p>调用建造者对象中的部件构建与装配方法完成复杂对象的创建，在指挥者中不涉及具体产品的信息。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 应用场景</h3>\n<ul>\n<li>当要创建的对象是由多个部件组成，而且部件的组合方式可能有不同的变化时，可以使用建造者模式来封装复杂的创建逻辑，提高代码的复用性和可维护性。</li>\n<li>当要创建的对象的构建过程需要分步进行，而且每一步都可能有不同的实现方式时，可以使用建造者模式来将构建过程和表示分离，提高代码的灵活性和扩展性。</li>\n<li>当要创建的对象的表示和构建过程都需要根据不同的需求进行定制时，可以使用建造者模式来将客户端和具体建造者解耦，提高代码的可定制性和可配置性。</li>\n</ul>\n<p>例如：</p>\n<p>房屋装修是一个复杂的过程，包含：地板的选择、墙体的装修颜色、天花板的设计、家具的布局等等。客户把装修要求告诉装修项目经理，项目经理指挥工人一步步装修，最后完成整个房屋的装修与布局。</p>\n<p>汽车的建造通常包含：轮胎的选择、发动机的选择、车身设计、车内装潢等等，方案虽然不同，但步骤通常是一致的。</p>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>封装性好，创建和使用分离，调用者无需关注细节部分。</li>\n<li>扩展性好，各个具体的建造者相互独立，有利于系统的解耦。</li>\n<li>客户端不必知道产品内部组成的细节，建造者可以对创建过程逐步细化，而不对其他模块产生任何影响，便于控制细节风险。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>产品的组成部分必须相同，这限制了其使用范围。</li>\n<li>如果产品内部发生变化，则建造者也要同步修改，后期维护成本较大。</li>\n</ul>\n<h2> 总结</h2>\n<p>建造者设计模式是一种创建型模式，它可以用于创建复杂的对象，将对象的构建过程和表示分离开来。它适用于以下情况：</p>\n<ul>\n<li>当要创建的对象是由多个部件组成，而且部件的组合方式可能有不同的变化时。</li>\n<li>当要创建的对象的构建过程需要分步进行，而且每一步都可能有不同的实现方式时。</li>\n<li>当要创建的对象的表示和构建过程都需要根据不同的需求进行定制时。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/builder/builder-zh-2x.png",
      "date_published": "2022-10-16T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "工厂方法",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/factory-method.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/factory-method.html",
      "summary": "factory-method",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/factory-method/factory-method-zh-2x.png\" alt=\"factory-method\" tabindex=\"0\" loading=\"lazy\"><figcaption>factory-method</figcaption></figure>\n<!-- more -->\n<h2> 什么是工厂方法模式</h2>\n<p>工厂方法模式(Factory Method Pattern)也叫虚拟构造器(Virtual Constructor)模式，由于简单工厂模式违背了<code>开闭原则</code>，而工厂方法模式对简单工厂模式进一步抽象，其好处是可以使系统在不修改原来代码的情况下引进新的产品，即满足开闭原则。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>工厂方法模式</figcaption></figure>\n<ul>\n<li>\n<p>Abstract Factory：抽象工厂</p>\n<p>提供了创建产品的接口，调用者通过它访问具体工厂的工厂方法来创建产品。</p>\n</li>\n<li>\n<p>Concrete Factory：具体工厂</p>\n<p>实现了抽象工厂的方法，完成具体产品的创建。</p>\n</li>\n<li>\n<p>Product：抽象产品</p>\n<p>定义了产品的规范，描述了产品的主要特性和功能。</p>\n</li>\n<li>\n<p>Concrete Product：具体产品</p>\n<p>实现了抽象产品定义的接口，由具体工厂来创建，它同具体工厂之间一一对应。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用工厂创建产品示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 应用场景</h3>\n<ul>\n<li>当创建对象需要使用大量重复的代码时，可以使用工厂方法模式来简化代码和提高可读性。</li>\n<li>当客户端不关心对象的创建过程和实现细节时，可以使用工厂方法模式来隐藏对象的创建逻辑，只需要知道工厂类和产品接口即可。</li>\n<li>当一个类通过其子类来指定创建哪个对象时，可以使用工厂方法模式来实现多态和动态绑定，让子类决定具体的产品类。</li>\n<li>当需要根据不同的环境或条件来创建不同的对象时，可以使用工厂方法模式来根据不同的工厂类来创建对应的产品类。</li>\n</ul>\n<p>举例：</p>\n<ul>\n<li>换灯泡：假设你有一个灯泡接口，它有一个方法是发光，你有不同的灯泡实现类，比如白炽灯、节能灯、LED灯等，每种灯泡都有自己的工厂类，负责创建对应的灯泡对象。这样你就可以根据需要选择不同的工厂来创建不同的灯泡，而不用直接使用new关键字。</li>\n<li>日志记录器：假设你有一个日志记录器接口，它有一个方法是记录日志，你有不同的日志记录器实现类，比如文件日志记录器、数据库日志记录器、网络日志记录器等，每种日志记录器都有自己的工厂类，负责创建对应的日志记录器对象。这样你就可以根据需要选择不同的工厂来创建不同的日志记录器，而不用直接使用new关键字。</li>\n<li>电脑商店：假设你有一个电脑接口，它有一些方法是显示配置、运行程序等，你有不同的电脑实现类，比如联想电脑、华为电脑、苹果电脑等，每种电脑都有自己的工厂类，负责创建对应的电脑对象。这样你就可以根据需要选择不同的工厂来创建不同的电脑，而不用直接使用new关键字。</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>遵循了<code>开闭原则</code>，扩展性极强。增加新的产品类时，只需增加对应的工厂类，不需要修改原有代码。</li>\n<li>降低了系统的耦合性，将对象的创建和使用分离，使得各个模块各司其职。</li>\n<li>利用了面向接口编程的思路，创建的对象是一个符合通用接口的通用对象，这个对象的具体实现可以随意替换。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>增加了系统的复杂度，类的个数容易过多，增加了系统抽象性和理解难度。</li>\n<li>增加了系统的开销，每次创建对象时都要创建一个工厂对象，消耗资源和时间。</li>\n<li><strong>抽象产品只能是一种产品</strong>。此弊端可使用抽象工厂模式解决。</li>\n</ul>\n<h2> 总结</h2>\n<p>工厂方法模式通过定义工厂接口和产品接口，并由具体的工厂类和产品类来实现，实现了对象的创建和使用的分离，提高了代码的可扩展性和可维护性。</p>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/factory-method/factory-method-zh-2x.png",
      "date_published": "2022-10-15T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "对象池",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/object-pool.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/object-pool.html",
      "summary": "什么是对象池模式 对象池模式(Object Pool Pattern)：它通过预先创建和初始化一组对象，然后将它们存放在一个池中，以便在需要时重复使用。这样可以减少频繁创建和销毁对象的开销，提高应用程序的性能和效率。 包含哪些角色 object-pool Pool：对象池; 对象池维护活动对象列表和空闲对象列表 Object：对象; 对象被客户端使用 ...",
      "content_html": "<!-- more -->\n<h2> 什么是对象池模式</h2>\n<p>对象池模式(Object Pool Pattern)：它通过预先创建和初始化一组对象，然后将它们存放在一个池中，以便在需要时重复使用。这样可以减少频繁创建和销毁对象的开销，提高应用程序的性能和效率。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>object-pool</figcaption></figure>\n<ul>\n<li>\n<p>Pool：对象池</p>\n<p>对象池维护活动对象列表和空闲对象列表</p>\n</li>\n<li>\n<p>Object：对象</p>\n<p>对象被客户端使用</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 使用场景</h3>\n<ul>\n<li>资源受限的场景，比如不需要可伸缩性的环境（CPU、内存等物理资源有限），CPU性能不够强劲，内存比较紧张，垃圾收集，内存抖动会造成比较大的影响，需要提高内存管理效率，响应性比吞吐量更为重要。</li>\n<li>在内存中数量受限的对象，比如数据库连接、网络连接、线程等。</li>\n<li>创建成本高的对象，比如初始化时间长、占用资源多、需要复杂的配置等。</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>提升性能：减少创建和销毁对象的开销，节省内存和CPU资源，提高响应速度。</li>\n<li>减少GC压力：复用对象池中的对象，避免频繁的垃圾回收，降低内存抖动和暂停时间。</li>\n<li>易于实现：对象池模式相对容易实现，可用于多种情况。它是一种经过验证的设计模式，已在许多应用程序和编程语言中成功使用。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>增加依赖性：将对象返回对象池中的操作依赖于客户端，如果客户端忘记将对象返回对象池中，将导致该对象无法被其他组件使用。</li>\n<li>增加复杂性：对象池模式可以通过添加额外的抽象层来增加应用程序的复杂性。这会使代码更难理解和维护，尤其是涉及到多线程和并发的场景。</li>\n<li>存在脏对象问题：所谓的脏对象就是指的是当对象被放回对象池后，还保留着刚刚被客户端调用时生成的数据。脏对象可能带来两个问题：\n<ul>\n<li>脏对象持有上次使用的引用，导致内存泄露等问题。</li>\n<li>脏对象如果下一次使用时没有做清理，可能影响程序的处理数据。</li>\n</ul>\n</li>\n<li>生命周期问题：处于对象池中的对象生命周期要比普通的对象要长久。这可能导致一些难以预料的问题，比如对象状态不一致、资源占用过多等。</li>\n</ul>\n<h2> 总结</h2>\n<p>对象池模式是一种创建型设计模式，它通过预先创建和初始化一组对象，然后将它们存放在一个池中，以便在需要时重复使用。这样可以减少频繁创建和销毁对象的开销，提高应用程序的性能和效率。在使用对象池设计模式时，需要注意：</p>\n<ul>\n<li>对象池的大小应该根据实际需求和资源情况来确定，不要过大或过小。</li>\n<li>对象池中的对象应该是无状态或者可重置状态的，以避免状态污染和数据不一致。</li>\n<li>对象池中的对象应该是线程安全或者线程隔离的，以避免并发问题和竞争条件。</li>\n<li>对象池中的对象应该在使用完毕后及时归还，以避免资源泄露和浪费。</li>\n</ul>\n",
      "date_published": "2023-04-16T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "原型",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/prototype.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/prototype.html",
      "summary": "prototype",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/prototype/prototype-2x.png\" alt=\"prototype\" tabindex=\"0\" loading=\"lazy\"><figcaption>prototype</figcaption></figure>\n<!-- more -->\n<h2> 什么是原型模式</h2>\n<p>原型模式(Prototype Pattern)用一个已经创建的实例作为原型，通过复制该原型对象来创建一个和原型相同或相似的新对象。它的核心思想是通过复制一个已经存在的<strong>对象</strong>来创建新的<strong>对象</strong>，而不是通过调用构造函数或者其他初始化方法。这样可以避免一些复杂的或者耗时的对象创建过程，提高程序的效率和灵活性。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>prototype</figcaption></figure>\n<ul>\n<li>\n<p>Prototype：抽象原型</p>\n<p>抽象原型规定了clone()接口来复制新的对象</p>\n</li>\n<li>\n<p>ConcretePrototype：具体原型</p>\n<p>具体原型实现抽象原型的clone()方法，是可被复制的对象</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 应用场景</h3>\n<ul>\n<li>当对象创建过程很复杂或者很耗时时，可以通过复制一个已经存在的对象来简化和加快对象创建过程。</li>\n<li>当需要生成大量相同或者相似的对象时，可以通过复制一个原型对象来减少内存消耗和提高性能。</li>\n<li>当需要根据不同的需求和环境来动态地生成对象时，可以通过选择不同的原型对象来实现多态性和灵活性。</li>\n</ul>\n<p>例如：</p>\n<p>游戏中的子弹，通常数量规模很大，通过原型设计模式可以复制已经创建好的字段对象，这样可以节省内存和性能。</p>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>可以避免重复的对象创建过程，节省时间和资源。</li>\n<li>可以动态地生成对象，根据不同的需求和环境来选择合适的原型。</li>\n<li>可以隐藏对象创建的细节，降低代码的耦合度和依赖性。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>需要实现克隆方法，可能会增加代码的复杂度和维护成本。</li>\n<li>需要注意深拷贝和浅拷贝的区别，避免出现意外的副作用和错误。</li>\n<li>需要保证原型对象的稳定性和安全性，避免被修改或者破坏。</li>\n</ul>\n<h2> 总结</h2>\n<p>原型设计模式是一种创建型设计模式，它通过复制一个已经存在的对象来创建新的对象，而不是通过调用构造函数或者其他初始化方法。<br>\n在Go语言中，我们还需要注意深拷贝和浅拷贝的区别。深拷贝是指完全复制一个对象及其所有关联的对象，使得新对象和旧对象完全独立。浅拷贝是指只复制一个对象本身，而不复制其关联的对象，使得新对象和旧对象共享部分数据。</p>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/prototype/prototype-2x.png",
      "date_published": "2022-10-16T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "简单工厂",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/simple-factory.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/simple-factory.html",
      "summary": "什么是简单工厂模式 简单工厂模式(Simple Factory Pattern)又称为静态工厂方法(Static Factory Method)模式 它可以根据参数的不同，返回不同类的实例，而无需让客户端知道具体的创建细节。 包含哪些角色 simple-factory SimpleFactory：简单工厂; 简单工厂根据参数的不同创建并返回不同的产品实...",
      "content_html": "<!-- more -->\n<h2> 什么是简单工厂模式</h2>\n<p>简单工厂模式(Simple Factory Pattern)又称为静态工厂方法(Static Factory Method)模式</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>它可以根据参数的不同，返回不同类的实例，而无需让客户端知道具体的创建细节。</p>\n</div>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>simple-factory</figcaption></figure>\n<ul>\n<li>\n<p>SimpleFactory：简单工厂</p>\n<p>简单工厂根据参数的不同创建并返回不同的产品实例。</p>\n</li>\n<li>\n<p>Product：抽象产品</p>\n<p>抽象产品负责描述所有实例所共有的公共接口。</p>\n</li>\n<li>\n<p>ConcreteProduct：具体产品</p>\n<p>具体产品实现产品的具体行为。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例：只需要传入产品的参数，就可以获得该产品</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 有哪些应用场景</h3>\n<ul>\n<li>创建对象少：工厂类负责创建的对象比较少。</li>\n<li>不关心创建过程：客户端只知道传入工厂类的参数，对于如何创建对象不关心。</li>\n</ul>\n<p>例如：</p>\n<ul>\n<li>对于<strong>门</strong>这个产品，我们只需要给定的<strong>材料</strong>参数，工厂就会给我们创建<code>木门</code>、<code>铁门</code>、<code>玻璃门</code>等等。</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>实现了对象的创建和使用分离，降低了系统的耦合性。</li>\n<li>通过该模式，实现了对责任的分配，提高了系统的灵活性和可维护性。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>扩展性差，如果要增加新的产品类，就需要修改工厂类的代码，违背了<strong>开闭</strong>原则</li>\n<li>由于使用了静态工厂方法，造成工厂角色无法形成基于继承的结构</li>\n<li>如果产品种类较多，工厂方法的代码将会非常复杂</li>\n</ul>\n<h2> 总结</h2>\n<p>简单工厂设计模式是一种创建型设计模式，它可以根据参数的不同，返回不同类的实例，而无需让客户端知道具体的创建细节。简单工厂设计模式有利于实现对象的创建和使用分离，降低了系统的耦合性，提高了系统的灵活性和可维护性。但是简单工厂设计模式也有缺点，首先，它扩展性差，如果要增加新的产品类，就需要修改工厂类的代码，违背了<code>开闭原则</code>。其次，工厂类的职责过重，如果产品种类较多，工厂方法的代码将会非常复杂。因此，简单工厂设计模式适用于创建对象少且不关心创建过程的场景。</p>\n",
      "date_published": "2022-10-15T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "单例",
      "url": "https://Hexiaopi.github.io/design-pattern/creational/singleton.html",
      "id": "https://Hexiaopi.github.io/design-pattern/creational/singleton.html",
      "summary": "singleton",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/singleton/singleton-2x.png\" alt=\"singleton\" tabindex=\"0\" loading=\"lazy\"><figcaption>singleton</figcaption></figure>\n<!-- more -->\n<h2> 什么是单例模式</h2>\n<p>单例模式(Singleton Pattern)指一个类只允许创建一个对象或者实例，那这个类就是一个单例类，这种设计模式就叫做单例设计模式。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>singleton</figcaption></figure>\n<ul>\n<li>\n<p>Singleton：单例类</p>\n<p>单例类提供getInstance方法获取实例</p>\n</li>\n</ul>\n<h3> 有哪些类别</h3>\n<p>单例模式从实现上分为两种：</p>\n<ul>\n<li>饿汉模式：类加载时，instance静态实例就已经创建并初始化好了\n<ul>\n<li>好处在于：对于耗时较高的初始化操作，提前到程序启动的时候完成，这样就能避免在程序运行的时候，再去初始化导致的性能问题。如果初始化有问题，基于fail-fast的设计原则（有问题及早暴露），而不是等待使用的时候才反馈问题会更好。</li>\n</ul>\n</li>\n<li>懒汉模式：程序需要某个变量的时候才会去初始化\n<ul>\n<li>缺点在于：需要增加一把锁，导致并发度低。频繁的使用，也会频繁的加锁、释放锁，可能导致性能瓶颈。通常我们会采用双重检测，一旦instance创建之后就不再加锁。</li>\n</ul>\n</li>\n</ul>\n<h3> 有哪些特点</h3>\n<ul>\n<li>单例类只有一个实例对象；</li>\n<li>该单例对象必须由单例类自行创建；</li>\n<li>单例类对外提供一个访问该单例的全局访问点；</li>\n</ul>\n<h3> 有哪些应用场景</h3>\n<ul>\n<li>配置文件实例--通常我们在应用运行期间，只使用一个配置文件实例；</li>\n<li>DB实例--我们只想创建DB对象的一个实例，并且该实例将在整个应用程序中使用；</li>\n<li>日志实例--同样，只应创建一个日志实例，并应在整个应用程序中使用它；</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>可以减少内存开销，提高程序的运行效率，避免对资源的过多占用，方便定位问题</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>不能被继承，很难进行类的扩展，违背了<code>单一职责</code>原则，忽略了外部关系，不适用于变化对象，可能存在线程安全问题</li>\n</ul>\n<h2> 代码示例</h2>\n<p>Go语言创建单例的办法</p>\n<ul>\n<li>Sync.Mutex方式，在GetInstance方法中加锁（懒汉方式）</li>\n<li>init()函数方式，引入singleton包时进行初始化（饿汉方式）</li>\n<li>sync.Once方式，在GetInstance方法中调用once.Do方法</li>\n</ul>\n<h3> Sync.Mutex 方式</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其中：</p>\n<ul>\n<li>18行再次判断的原因是：如果多个goroutine通过第一次检查（15行），其中一个goroutine获得锁并初始化了instance示例，那么剩余的goroutine就不必在获得锁之后再去初始化实例了。</li>\n</ul>\n<p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>通过atomic保证原子性也是可行的方案</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> init() 函数方式</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> sync.Once 方式</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "image": "https://refactoringguru.cn/images/patterns/content/singleton/singleton-2x.png",
      "date_published": "2022-10-17T00:00:00.000Z",
      "date_modified": "2023-08-02T11:52:23.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "选项模式",
      "url": "https://Hexiaopi.github.io/design-pattern/function/option.html",
      "id": "https://Hexiaopi.github.io/design-pattern/function/option.html",
      "summary": "提示 由于Go语言不支持重载函数，当我们需要使用不同的方式构建对象时，不得不使用多个构造函数进行初始化。 对于多参数的类的初始化遇到哪些困境？ 例如：HTTP Server的初始化 type Server struct { \tAddr string \tPort int \tProtocol string \tTimeout time.Duration \tMaxConns int \tTLS *tls.Config }",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>由于Go语言不支持重载函数，当我们需要使用不同的方式构建对象时，不得不使用多个构造函数进行初始化。</p>\n</div>\n<h2> 对于多参数的类的初始化遇到哪些困境？</h2>\n<p>例如：HTTP Server的初始化</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>为了支持不同功能的Server，我们不得不通过不同的函数命名和参数，构造初始化函数。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>一圈写下来，发现这仅不禁无法列举所有的功能场景，而且代码冗余非常多。</p>\n<h2> 那么Option(选项模式)是如何解决这个问题的呢？</h2>\n<h3> 首先：定义一个Option函数，参数为Server指针</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>如果关注错误的话，可以定义如下</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 其次：定义各种初始化选项函数，通常返回上文定义的Option</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 通常：我们定义一个全局的初始化函数，使用Go语言可变参数Option</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><div class=\"highlight-line\">&nbsp;</div><div class=\"highlight-line\">&nbsp;</div><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 最后，我们看看最终效果</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<p>由于Go语言函数不支持重载，因此在多参数的类的初始化中，我们遇到初始化函数冗余问题，<br>\n我们可以通过Option(选项模式)，可以很自由的定义类的初始化，解决前面遇到的问题。</p>\n<p>这里本质上使用了Go语言以下特点：</p>\n<ul>\n<li>闭包，<code>With...</code>等Option的定义，通过闭包的方式，扩展了Option的场景;</li>\n<li>可变参数，<code>(options ...option)</code>，通过可变参数，我们可以自由选择Option;</li>\n</ul>\n<h2> 参考链接</h2>\n<p><a href=\"https://coolshell.cn/articles/21146.html\" target=\"_blank\" rel=\"noopener noreferrer\">GO 编程模式：FUNCTIONAL OPTIONS</a></p>\n",
      "date_published": "2023-08-06T00:00:00.000Z",
      "date_modified": "2023-08-06T08:10:45.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "结构型模式",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/",
      "summary": "结构型设计模式 结构型设计模式是一组用于组织类和对象之间关系的设计模式，它们通常用于提高代码的可维护性、可扩展性和可重用性。结构型设计模式分为类结构型模式和对象结构型模式。 其中： 类结构型模式关注类之间的组合，例如装饰器模式、适配器模式、代理模式等；而对象结构型模式关注对象之间的组合，例如组合模式、享元模式等。 类结构型模式更侧重于对象之间的静态关系，即在编译时期已经确定相关类之间的关系，而对象结构型模式更侧重于对象之间的动态关系，即在运行时期可以动态添加或移除对象。 类结构型模式的使用场景更为广泛，适用于不同的问题领域；而对象结构型模式更加专注于一些具体的问题场景。",
      "content_html": "<h2> 结构型设计模式</h2>\n<blockquote>\n<p>结构型设计模式是一组用于组织类和对象之间关系的设计模式，它们通常用于提高代码的可维护性、可扩展性和可重用性。结构型设计模式分为<code>类结构型模式</code>和<code>对象结构型模式</code>。</p>\n</blockquote>\n<p>其中：</p>\n<ul>\n<li><code>类结构型模式</code>关注类之间的组合，例如装饰器模式、适配器模式、代理模式等；而<code>对象结构型模式</code>关注对象之间的组合，例如组合模式、享元模式等。</li>\n<li><code>类结构型模式</code>更侧重于对象之间的静态关系，即在编译时期已经确定相关类之间的关系，而<code>对象结构型模式</code>更侧重于对象之间的动态关系，即在运行时期可以动态添加或移除对象。</li>\n<li><code>类结构型模式</code>的使用场景更为广泛，适用于不同的问题领域；而<code>对象结构型模式</code>更加专注于一些具体的问题场景。</li>\n</ul>\n<h3> 相同点</h3>\n<ul>\n<li>都可以用于组织和组合类之间的关系；</li>\n<li>在代码中提供了高度模块化的方式，便于代码的重用和维护；</li>\n<li>通过组合、代理、继承等方式，可以更加灵活地设计类的层次结构；</li>\n<li>可以降低系统的复杂度，提高代码的可读性和可维护性。</li>\n</ul>\n<h3> 不同点</h3>\n<ul>\n<li>代理模式旨在控制对对象的访问，为使用者提供简化的接口，同时也可以提升对象的访问效率；</li>\n<li>适配器模式旨在将不同对象之间的接口协调起来，使它们能够协同工作；</li>\n<li>桥接模式旨在将类的抽象和实现分离出来，使得两者可以独立地变化；</li>\n<li>装饰器模式旨在动态地添加类的额外行为，而无需修改类的接口和实现；</li>\n<li>外观模式旨在将一组紧密相关的类中的复杂逻辑抽象出来，提供一个简单的接口给使用者；</li>\n<li>享元模式旨在共享多个具有相同状态的对象，以减少内存的占用。</li>\n</ul>\n",
      "date_published": "2023-07-31T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "适配器",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/adapter.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/adapter.html",
      "summary": "adapter",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/adapter/adapter-zh-2x.png\" alt=\"adapter\" tabindex=\"0\" loading=\"lazy\"><figcaption>adapter</figcaption></figure>\n<!-- more -->\n<h2> 什么是适配器模式</h2>\n<p>适配器模式(Adapter Pattern)：它将一个接口转换成用户期望的另一个接口，使的接口不兼容的那些类可以相互合作。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>适配器</figcaption></figure>\n<ul>\n<li>\n<p>Target: 目标角色</p>\n<p>该角色定义是用户期望的接口</p>\n</li>\n<li>\n<p>Adapter: 适配器角色</p>\n<p>将适配者的接口转换为目标接口的类，它是适配器模式的核心</p>\n</li>\n<li>\n<p>Adaptee: 适配者</p>\n<p>需要被适配的接口，它与目标角色接口不一致</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 应用场景</h3>\n<ul>\n<li>当我们想要使用一个已经存在的类，但是它的接口不符合我们的需求时，我们可以使用适配器来转换接口，而不需要修改原来的类。</li>\n<li>当我们想要复用一些已有的功能，但是这些功能来自于不同的系统或者库时，我们可以使用适配器来统一接口，而不需要修改原来的系统或者库。</li>\n<li>当我们想要在不同的环境中使用同一个类时，我们可以使用适配器来适应不同的环境，而不需要修改原来的类。</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>提高代码的重用性：适配器设计模式可以将已经存在的代码与新的代码进行整合，提高了现有代码的重用率。</li>\n<li>可以让不兼容的代码协同工作：适配器设计模式可以将一个类的接口转换成另一个类的接口，让其它不兼容的代码可以一起工作。</li>\n<li>保证系统的稳定性：适配器设计模式可以让已有的系统保持稳定，不必对其进行修改，只是增加新的功能，满足<code>开闭原则</code>。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>增加代码复杂性：适配器设计模式需要在原有的类和适配器类中定义大量的代码，会增加系统的复杂度。</li>\n<li>降低代码的可读性：适配器设计模式在现有类的基础上增加了适配器类，使得代码的可读性下降。</li>\n<li>新增了一个中间层，可能会影响系统的性能：适配器设计模式新增了适配器类，可能会影响系统的性能，增加系统的运行开销。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/adapter/adapter-zh-2x.png",
      "date_published": "2022-10-18T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "桥接",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/bridge.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/bridge.html",
      "summary": "bridge",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/bridge/bridge-2x.png\" alt=\"bridge\" tabindex=\"0\" loading=\"lazy\"><figcaption>bridge</figcaption></figure>\n<!-- more -->\n<h2> 场景问题</h2>\n<p>假设你有一个几何形状类Shape，从它扩展出两个子类：圆形Cicle和方形Square，你希望对这样的类进行扩展使其包含两种颜色：Blue、Red。</p>\n<figure><figcaption>bridge-question</figcaption></figure>\n<p>很快你会发现，如果新增形状类，例如: 三角形，椭圆形。或者新增颜色，子类的数量将会暴躁式增长。</p>\n<p>为了解决这些问题，我们可以用桥接模式来将图形的形状和颜色分离为两个层次结构，让它们可以独立地变化。</p>\n<h2> 什么是桥接模式</h2>\n<p>桥接模式(Bridge Pattern)：是一种结构型设计模式，能将抽象与实现分离，使二者可以各自单独变化而不受对方约束，使用时再将它们组合起来，就像架设桥梁一样链接它们的功能，如此降低了抽象与实现这两个可变维度的耦合度，以保证系统的可扩展性。</p>\n<p>桥接模式通过将继承改为组合的方式来解决这个问题，具体来说，就是抽取其中一个维度并使之成为独立的类层次，这样就可以在初始类中引用这个新层次的对象，从而使得一个类不必拥有所有的状态和行为。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>bridge</figcaption></figure>\n<ul>\n<li>\n<p>Abstraction: 抽象角色</p>\n<p>定义抽象类，并包含一个对实现对象的引用</p>\n</li>\n<li>\n<p>RefinedAbstraction: 扩展抽象角色</p>\n<p>抽象角色的子类，实现父类中的业务方法，并通过组合关系调用实现角色中的业务方法。</p>\n</li>\n<li>\n<p>Implementor: 实现角色</p>\n<p>定义实现类的接口，该接口不一定要与抽象角色的接口完全一致，而是根据实际情况来设计</p>\n</li>\n<li>\n<p>ConCreteImplementor: 具体实现角色</p>\n<p>实现角色接口的具体实现</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 解决场景问题</h3>\n<p>回到本文前面的问题，那么我们如何使用桥接模式解决该问题呢</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>实现了抽象和实现部分的分离，从而极大地提高了系统的灵活性，让抽象部分和实现部分独立开来，这有助于系统进行分层设计，从而产生更好的结构化系统。</li>\n<li>符合开闭原则，抽象部分和实现部分可以分别独立地扩展，而不会相互影响，对系统的修改是通过增加代码进行的，而不是修改原有代码。</li>\n<li>符合合成复用原则，可以使用不同的实现部分来组合不同的抽象部分，实现更多的功能组合。</li>\n<li>其实现细节对客户透明，客户只需要关心抽象部分的接口，不用了解具体的实现细节。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>增加了系统的理解和设计难度，由于关联关系建立在抽象层，要求开发者一开始就针对抽象层进行设计和编程，能正确地识别出系统中两个独立变化的维度，这增加了系统的复杂性和学习成本。</li>\n<li>要求正确识别出系统中两个独立变化的维度，因此其使用范围有一定的局限性，如果系统中只有一个变化维度或者两个变化维度之间有很强的耦合关系，那么桥接模式就不适用了。</li>\n</ul>\n<h2> 总结</h2>\n<h3> 桥接设计模式和适配器设计模式的区别</h3>\n<p>适配器模式是为了复用已有接口的功能，而通过适配将已有接口功能引入到所需接口的一种模式，目的是能够结合。适配器是先定义了新接口，然后才与旧接口进行适配，即先接口后关系。</p>\n<p>桥接模式是在一个系统中解决多个维度独立变化的类之间的耦合度问题，先定义了一个桥（即实现和抽象的关系），通过多个实现的不同组合达到其灵活性的目的，即先关系后组合。</p>\n<ul>\n<li>\n<p>适配器模式中适配器角色只需要一个，解决两个接口适配问题。</p>\n</li>\n<li>\n<p>桥接模式中扩展抽象角色通常有多个，解决抽象和实现组合爆炸问题。</p>\n</li>\n<li>\n<p>适配器模式中适配者通常只有一个。</p>\n</li>\n<li>\n<p>桥接模式中具体抽象和实现的关系可以有多个，使得多个维度独立变化。</p>\n</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/bridge/bridge-2x.png",
      "date_published": "2022-12-10T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "组合",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/composite.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/composite.html",
      "summary": "composite",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/composite/composite-2x.png\" alt=\"composite\" tabindex=\"0\" loading=\"lazy\"><figcaption>composite</figcaption></figure>\n<!-- more -->\n<h2> 某一场景问题</h2>\n<p>例如：有两类对象：<code>产品</code>和<code>盒子</code>，<code>盒子</code>中可以包含多个<code>产品</code>或者小<code>盒子</code>，在此基础需要知道这个盒子的总价格，如果直接打开所有的盒子，累加产品的价值，虽然可行。但对计算机会增加许多繁杂的细节。</p>\n<p>那么使用组合模式，就可以很好的简化这个细节，如果是<code>产品</code>就直接返回价格，如果是<code>盒子</code>，则遍历盒子中的所有项目，累加价格。最大的优点，<code>产品</code>和<code>盒子</code>提供一致的接口，你无需了解内部结构，只需要调用这一个接口即可。</p>\n<h2> 什么是组合模式</h2>\n<p>组合模式（Composite Pattern）：是针对由多个节点对象（部分）组成的树形结构的对象（整体）而发展出的一种结构型设计模式，它能够使客户端在操作整体对象或者其下的每个节点对象时做出统一的响应，保证树形结构对象使用方法的一致性。使客户端不必关注对象的整体或部分，最终达到对象复杂的层次结构与客户端解耦的目的。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>composite</figcaption></figure>\n<ul>\n<li>\n<p>Component: 抽象构件角色</p>\n<p>它的主要作用是为树叶构件和树枝构件声明公共接口</p>\n</li>\n<li>\n<p>Leaf: 树叶构件角色</p>\n<p>组合模式中的叶节点对象，它没有子节点</p>\n</li>\n<li>\n<p>Composite: 树枝构件角色</p>\n<p>是组合模式中的分支节点对象，它与子节点。</p>\n</li>\n</ul>\n<h3> 有哪些分类</h3>\n<p>(1) 透明方式：在该方式中，由于抽象构件声明了所有子类中的全部方法，所以客户端无须区别树叶对象和树枝对象，对客户端来说是透明的。但其缺点是：树叶构件本来没有 Add()、Remove() 及 GetChild() 方法，却要实现它们（空实现或抛异常），这样会带来一些安全性问题。</p>\n<p>(2) 安全方式：在该方式中，将管理子构件的方法移到树枝构件中，抽象构件和树叶构件没有对子对象的管理方法，这样就避免了上一种方式的安全性问题，但由于叶子和分支有不同的接口，客户端在调用时要知道树叶对象和树枝对象的存在，所以失去了透明性。</p>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>组合模式使得客户端代码可以一致地处理单个对象和组合对象，无须关心自己处理的是单个对象，还是组合对象，这简化了客户端代码；</li>\n<li>更容易在组合体内加入新的对象，客户端不会因为加入了新的对象而更改源代码，满足<strong>开闭原则</strong>；</li>\n<li>组合模式适用于递归结构，使得代码的实现变得更加简单；</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>递归结构限制：递归结构对于计算机的性能来说是一种挑战，如果组合对象的结构过于复杂，这将会影响程序的性能和可维护性；</li>\n<li>接口实现复杂：组合对象必须实现单个对象的所有方法。在组合对象中实现与单个对象相同的方法可能会导致代码冗余；</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/composite/composite-2x.png",
      "date_published": "2022-12-03T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "装饰器",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/decorator.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/decorator.html",
      "summary": "decorator",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/decorator/decorator-2x.png\" alt=\"decorator\" tabindex=\"0\" loading=\"lazy\"><figcaption>decorator</figcaption></figure>\n<!-- more -->\n<h2> 什么是装饰器模式</h2>\n<p>装饰器模式(Decorator Pattern)：它可以在不改变原有对象的结构和功能的情况下，动态地给对象添加新的功能或者增强原有功能。装饰器设计模式的核心思想是使用一个装饰器对象来包装原有对象，从而实现对原有对象的功能扩展或修改。</p>\n<p>装饰器非常类似于<strong>继承</strong>，它们都是为了增强原始对象的功能，区别在于方式的不同，后者是在编译时(compile-time)静态地通过对原始类的继承完成，而前者则是在程序运行时(run-time)通过对原始对象地<strong>包装</strong>完成。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>decorator</figcaption></figure>\n<ul>\n<li>\n<p>Component: 组件接口</p>\n<p>所有被装饰组件及装饰器对应的接口标准</p>\n</li>\n<li>\n<p>ConcreteComponent: 具体组件</p>\n<p>需要被装饰的组件，实现组件接口标准</p>\n</li>\n<li>\n<p>Decorator: 装饰器</p>\n<p>持有一个组件（Component）对象的实例，并定义一个与组件接口一致的接口。</p>\n</li>\n<li>\n<p>ConcreteDecorator: 装饰器实现</p>\n<p>继承自装饰器抽象类的具体子类装饰器，可以有多种实现，在被装饰组件对象的基础上为其添加新的特性。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 应用场景</h3>\n<ul>\n<li>当需要在不改变原有对象的结构和功能的情况下，给对象添加新的功能或者增强原有功能时。</li>\n<li>当需要根据不同的需求，灵活地组合不同的功能扩展或修改时。</li>\n<li>当需要保持原有对象的接口不变，保证了装饰后的对象和原有对象的兼容性时。</li>\n</ul>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>可以在不修改原有对象的代码的情况下，给对象添加新的功能或者增强原有功能，符合开闭原则。</li>\n<li>可以保持原有对象的接口不变，保证了装饰后的对象和原有对象的兼容性。</li>\n<li>可以根据需要灵活地组合不同的装饰器对象，实现多种功能扩展或修改。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>会增加系统的复杂度，因为需要创建多个装饰器对象和管理它们之间的关系。</li>\n<li>会增加系统的运行时开销，因为每次调用原有对象的方法时，都需要经过装饰器对象的转发和处理。</li>\n</ul>\n<h2> 总结</h2>\n<h3> 装饰器设计模式和适配器设计模式</h3>\n<p>装饰器模式和适配器模式的区别在于它们的应用场景和目的不同。装饰器模式可以应用于任何需要对对象进行功能扩展或修改的场景，例如日志记录、缓存、验证等。适配器模式主要应用于两个不兼容的接口之间的转换，例如不同类型的电源插头、不同格式的数据源等。</p>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/decorator/decorator-2x.png",
      "date_published": "2022-12-04T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "外观",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/facade.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/facade.html",
      "summary": "facade",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/facade/facade-2x.png\" alt=\"facade\" tabindex=\"0\" loading=\"lazy\"><figcaption>facade</figcaption></figure>\n<!-- more -->\n<h2> 什么是外观模式</h2>\n<p>外观模式（Facade Pattern）：又叫作门面模式，是一种通过为多个复杂的子系统提供一个一致的接口，而使这些子系统更加容易被访问的模式。该模式对外有一个统一接口，外部应用程序不用关心内部子系统的具体细节，这样会大大降低应用程序的复杂度，提高了程序的可维护性。</p>\n<figure><figcaption>外观</figcaption></figure>\n<p>外观模式经常在我们不知不觉中使用，例如：MVC架构中，Controller层对外提供简单的接口，Controller层包含多个Service层进行功能划分，每个Service层也可能包含多个Dao层进行数据操作。</p>\n<figure><figcaption>mvc</figcaption></figure>\n<h3> 包含哪些角色</h3>\n<ul>\n<li>\n<p>Facade: 外观角色</p>\n<p>定义一个简单的接口</p>\n</li>\n<li>\n<p>Subsystem：子系统角色</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<h3> 优点</h3>\n<ul>\n<li>降低了子系统与客户端之间的耦合度，使得子系统的变化不会影响调用它的客户类。</li>\n<li>对客户屏蔽了子系统组件，减少了客户处理的对象数目，并使得子系统使用起来更加容易。</li>\n<li>降低了大型软件系统中的编译依赖性，简化了系统在不同平台之间的移植过程，因为编译一个子系统不会影响其他的子系统，也不会影响外观对象。</li>\n<li>只是提供了一个访问子系统的统一入口，并不影响用户直接使用子系统类。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>不能很好地限制客户使用子系统类，如果对客户访问子系统类做太多的限制则减少了可变性和灵活性。</li>\n<li>在不引入抽象外观类的情况下，增加新的子系统可能需要修改外观类或客户端的源代码，违背了<strong>开闭原则</strong>。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/facade/facade-2x.png",
      "date_published": "2022-12-02T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "享元",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/flyweight.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/flyweight.html",
      "summary": "flyweight",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/flyweight/flyweight-zh-2x.png\" alt=\"flyweight\" tabindex=\"0\" loading=\"lazy\"><figcaption>flyweight</figcaption></figure>\n<!-- more -->\n<h2> 什么是享元模式</h2>\n<p>享元模式（Flyweight Pattern）：有效地支持大量细粒度对象的复用,通过共享已经存在的对象来大幅度减少需要创建的对象数量、避免大量相似类的开销，从而提高系统资源的利用率。</p>\n<p>享元对象能做到共享的关键是区分：内蕴状态（Internal State）和外蕴状态（External State），内蕴状态是存储在享元对象内部，并且不会随环境改变而改变，因此可以共享，外蕴状态是随着环境改变而改变，因此不可以共享。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>flyweight</figcaption></figure>\n<ul>\n<li>\n<p>Flyweight: 享元接口</p>\n<p>所有元件的高层规范，声明与外蕴状态互动的接口标准</p>\n</li>\n<li>\n<p>ConcreteFlyweight: 享元实现类</p>\n<p>自身维护着内蕴状态，且能接受并相应外蕴状态，可以有多个实现。一个享元对象可以被称作一个<strong>元</strong>。</p>\n</li>\n<li>\n<p>UnsharedFlyweight: 非享元角色</p>\n<p>是不可以共享的外部状态，它以参数的形式注入具体享元的相关方法中</p>\n</li>\n<li>\n<p>FlyweightFactory: 享元工厂</p>\n<p>用来维护享元对象的工厂，负责对享元对象实例进行创建于管理，并对外提供获取享元对象的服务。</p>\n</li>\n<li>\n<p>Client: 客户端</p>\n<p>享元的使用者，负责维护外蕴状态。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 总结</h2>\n<p>享元模式只是一种优化。在应用该模式之前，你要确定程序中存在与大量类似对象同时占用内存相关的内存消耗问题，并且确保该问题无法使用其他更好的方式来解决。</p>\n<h3> 优点</h3>\n<ul>\n<li>享元模式的优点在于它可以极大减少内存中对象的数量，使得相同对象或相似对象在内存中只保存一份。</li>\n<li>享元模式的外部状态相对独立，而且不会影响其内部状态，从而使得享元对象可以在不同的环境中被共享。</li>\n</ul>\n<h3> 缺点</h3>\n<ul>\n<li>增加系统复杂性。享元模式需要维护共享对象的状态，增加了代码的复杂度，同时也增加了系统的维护难度。</li>\n<li>内部状态和外部状态的区分。享元模式需要区分内部状态和外部状态，内部状态可以被共享，但外部状态必须通过参数传递，增加了对象的可定制性，但也增加了系统的复杂度。</li>\n</ul>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/flyweight/flyweight-zh-2x.png",
      "date_published": "2022-12-06T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "代理",
      "url": "https://Hexiaopi.github.io/design-pattern/structural/proxy.html",
      "id": "https://Hexiaopi.github.io/design-pattern/structural/proxy.html",
      "summary": "proxy",
      "content_html": "<figure><img src=\"https://refactoringguru.cn/images/patterns/content/proxy/proxy-2x.png\" alt=\"proxy\" tabindex=\"0\" loading=\"lazy\"><figcaption>proxy</figcaption></figure>\n<!-- more -->\n<h2> 什么是代理模式</h2>\n<p>代理模式(Proxy Pattern)：它的主要思想是通过一个代理对象来代替真实对象的访问，从而在不修改原目标对象的前提下，提供额外的功能操作，扩展目标对象的功能。</p>\n<h3> 包含哪些角色</h3>\n<figure><figcaption>代理模式</figcaption></figure>\n<ul>\n<li>\n<p>Subject: 抽象主题</p>\n<p>通过接口或抽象类声明真实主题和代理对象实现的业务方法</p>\n</li>\n<li>\n<p>RealSubject: 真实主题</p>\n<p>实现了抽象主题中的具体业务，是代理对象所代表的真实对象，是最终要引用的对象</p>\n</li>\n<li>\n<p>Proxy: 代理类</p>\n<p>提供了与真实主题相同的接口，其内部包含有对真实主题的引用，它可以访问、控制或扩展真实主题的功能。</p>\n</li>\n</ul>\n<h3> 代码示例</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>使用示例如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 使用场景</h2>\n<ul>\n<li>\n<p>静态代理：代理对象和目标对象在编译期就已经确定，代理对象需要实现和目标对象相同的接口，并持有目标对象的引用。静态代理的优点是简单易实现，缺点是代码冗余，每个代理类都需要重新编写。</p>\n</li>\n<li>\n<p>远程代理：为一个位于不同地址空间的对象提供一个本地的代理对象，使客户端可以通过本地代理对象来访问远程对象，屏蔽了网络通信的细节。</p>\n</li>\n<li>\n<p>虚拟代理：当一个对象的创建或者加载时需要很长时间，可以使用虚拟代理来延迟对象的加载或者创建，直到真正需要使用该对象时再进行加载或者创建。</p>\n</li>\n<li>\n<p>保护代理：当对一个对象的访问需要进行安全控制时，可以使用安全代理来控制对象的访问权限，例如在对象被访问时需要进行认证或授权等。</p>\n</li>\n<li>\n<p>缓存代理：当需要缓存一些计算结果时，可以使用缓存代理，以便在后续的访问中直接返回缓存的结果，避免重复计算。</p>\n</li>\n<li>\n<p>日志记录代理：在访问被代理对象的过程中，使用日志记录代理可以记录所有访问记录，以便于问题排查和系统优化等。</p>\n</li>\n</ul>\n<h3> 远程代理</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>通过这种方式，我们可以将客户端和远程对象之间的耦合度降低，增加了系统的可维护性和可扩展性。</p>\n<h3> 虚拟代理</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>通过这种方式，我们可以延迟 RealImage 对象的加载或者创建，直到客户端真正需要访问该对象时才进行加载或者创建，从而减少了系统的资源消耗，优化了系统的性能。</p>\n<h3> 保护代理</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们通过认证和授权等操作来控制对 RealSubject 对象的访问权限，只有认证和授权成功之后才能访问 RealSubject 对象，否则返回授权失败的提示消息。通过这种方式，我们可以对系统中的访问进行更加细粒度的控制，增加了系统的安全性和鲁棒性。</p>\n<h3> 缓存代理</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>通过这种方式，我们可以减少一些需要重复计算的操作，优化了系统的性能，并且可以快速响应客户端的请求。</p>\n<h3> 日志记录代理</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>通过这种方式，我们可以在系统中记录每一次对特定对象或方法的调用，以便后续系统调试或问题排查。</p>\n<h3> 有哪些优缺点</h3>\n<h4> 优点</h4>\n<ul>\n<li>代理模式能够协调调用者和被调用者，在一定程度上降低了系统的耦合度。</li>\n<li>远程代理使得客户端可以访问在远程机器上的对象，远程机器坑具有更好的计算性能与处理速度，可以加快相应并处理客户端请求。</li>\n<li>虚拟代理通过使用一个小对象来代表一个大对象，可以减少系统资源的消耗，对系统进行优化并提高运行速度。</li>\n<li>保护代理可以控制对真实对象的使用权限。</li>\n</ul>\n<h4> 缺点</h4>\n<ul>\n<li>由于客户端和真实主题之间增加了代理对象，因此有些类型的代理模式可能会造成请求的处理速度变慢。</li>\n<li>实现代理模式需要额外的工作，有些代理模式的实现非常复杂。</li>\n</ul>\n<h2> 总结</h2>\n<h3> 代理模式和装饰器模式</h3>\n<ul>\n<li>语义上：代理模式是为了控制对被代理对象的访问，而装饰器模式是为了增加被装饰对象的功能。</li>\n<li>使用方式上：装饰器模式需要将被装饰者作为参数传给装饰者的构造器，而被代理对象由代理对象创建，客户端不需要知道被代理类的存在。</li>\n<li>使用者角度上：被代理对象是已经确定的，而被装饰者则在使用时根据需求进行组合。</li>\n</ul>\n<h3> 代理模式和 Middleware</h3>\n<p>代理设计模式和 Middleware 之间存在相似之处，这两个模式都是为了实现对象间松耦合，增强维护性和扩展性。例如：日志记录、访问控制、速率限制等。唯一不同的地方是：代理模式是通过引入被代理类扩展其功能，而Go语言middleware是通过函数和闭包实现扩展函数功能，这归功于Go语言中函数是一等公民。</p>\n",
      "image": "https://refactoringguru.cn/images/patterns/content/proxy/proxy-2x.png",
      "date_published": "2022-12-10T00:00:00.000Z",
      "date_modified": "2023-07-31T14:52:38.000Z",
      "authors": [],
      "tags": [
        "设计模式"
      ]
    },
    {
      "title": "数组",
      "url": "https://Hexiaopi.github.io/go-language/base/array.html",
      "id": "https://Hexiaopi.github.io/go-language/base/array.html",
      "summary": "数组 一个由固定长度的特定类型组成的序列。特定类型可以是：字符串、结构体、函数、接口、通道等。 声明 var a [3]int\t\t\t\t\t\t\t\t//长度为3的int类型数组，元素为[0,0,0] var b = [...]int{1,2,3}\t\t\t//长度为3的int类型数组，元素为[1,2,3] var c = [...]int{1:2,2:3}\t\t//长度为3的int类型数组，元素为[0,2,3] var d = [...]int{0,2,2:3,4}\t//长度为4的int类型数组，元素为[0,2,3,4]",
      "content_html": "<h2> 数组</h2>\n<blockquote>\n<p>一个由固定长度的特定类型组成的序列。特定类型可以是：字符串、结构体、函数、接口、通道等。</p>\n</blockquote>\n<h3> 声明</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li>第一种定义：直接初始化长度</li>\n<li>第二种定义：直接初始化数组元素，其中<code>...</code>Go语言编译器根据初始化自动推算长度，例如数组b的长度是3</li>\n<li>第三种定义：根据索引初始化数组元素，其中未使用索引直接初始化的元素的值对应的是<strong>零值</strong>，例如c[0]</li>\n<li>第四种定义：混合使用第二种定义和第三种定义。</li>\n</ul>\n</div>\n<h3> 遍历</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li><code>for range</code>方式迭代可以保证不会出现数组越界的情况。</li>\n<li>数组的定义包含长度，因此长度不同的数组，即便类型一致，整个数组仍不是同一类型。</li>\n<li>长度为0的数组并不占用内存</li>\n</ul>\n</div>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>Go语言中数组是值类型，因此在函数传参中，如果数组比较大，建议传递指针数组，避免数据拷贝开销</p>\n</div>\n",
      "date_published": "2022-05-05T00:00:00.000Z",
      "date_modified": "2023-08-13T15:30:36.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "常量",
      "url": "https://Hexiaopi.github.io/go-language/base/constant.html",
      "id": "https://Hexiaopi.github.io/go-language/base/constant.html",
      "summary": "常量 常量（constant），顾名思义，程序运行期间，其值不能改变的量。 声明 一个常量 const &lt;constant_name&gt; [constant_type] = &lt;赋值表达式&gt;",
      "content_html": "<h2> 常量</h2>\n<blockquote>\n<p>常量（constant），顾名思义，程序运行期间，其值不能改变的量。</p>\n</blockquote>\n<h3> 声明</h3>\n<h4> 一个常量</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>例如</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 多个常量</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h4> 常量组</h4>\n<p>例如：<code>$GOROOT/src/net/http/method.go</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>👀</p>\n<blockquote>\n<p>如果不指定类型和初始化值，则默认表示使用上行的赋值表达式</p>\n</blockquote>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 初始化</h3>\n<p>规则：</p>\n<ul>\n<li>\n<p><strong>常量值必须是确定的，不能使用程序运行期间不确定的值</strong> 👀</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p><strong>常量的值在编译过程已确定，作为指令数据使用，没有内存分配</strong> ‼️</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ul>\n",
      "date_published": "2022-05-03T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "数据类型",
      "url": "https://Hexiaopi.github.io/go-language/base/data-type.html",
      "id": "https://Hexiaopi.github.io/go-language/base/data-type.html",
      "summary": "数据类型 Go语言基本数据类型（Data-types）划分方式有很多，这里按照数据类型进行划分：值类型、复合类型、引用类型 值类型 值类型即基本的数据类型，包括布尔类型（bool）、整型（int）、浮点型（float）、字节型（byte）、复数型（complex）、字符串型（string）和错误类型（error）。 值类型的变量在传递过程中，编译器对该变量的值进行一次拷贝。",
      "content_html": "<h2> 数据类型</h2>\n<blockquote>\n<p>Go语言基本数据类型（Data-types）划分方式有很多，这里按照<strong>数据类型</strong>进行划分：值类型、复合类型、引用类型</p>\n</blockquote>\n<h3> 值类型</h3>\n<blockquote>\n<p>值类型即基本的数据类型，包括布尔类型（bool）、整型（int）、浮点型（float）、字节型（byte）、复数型（complex）、字符串型（string）和错误类型（error）。</p>\n<p>值类型的变量在传递过程中，编译器对该变量的值进行一次拷贝。</p>\n</blockquote>\n<h4> 布尔型(Boolean)</h4>\n<p>**关键字定义：**bool</p>\n<p>**字节长度：**1</p>\n<p><strong>取值范围：</strong>[true、false]</p>\n<p>**零值：**false</p>\n<p>👣</p>\n<ol>\n<li>布尔类型不接受其他数据类型赋值；</li>\n<li>布尔类型不能进行强制类型转换；</li>\n</ol>\n<h4> 整型（Integer）</h4>\n<p>整型数据类型分为：有符号整型、无符号整型</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:center\">字节长度</th>\n<th style=\"text-align:center\">取值范围</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">int</td>\n<td style=\"text-align:center\">4/8</td>\n<td style=\"text-align:center\">32位系统即int32，64位系统即int64</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">int8</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>7</mn></msup></mrow><annotation encoding=\"application/x-tex\">-2^7</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span></span></span></span>~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>7</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^7-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">7</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">int16</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>15</mn></msup></mrow><annotation encoding=\"application/x-tex\">-2^{15}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">15</span></span></span></span></span></span></span></span></span></span></span></span>~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>15</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{15}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">15</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">int32</td>\n<td style=\"text-align:center\">4</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>31</mn></msup></mrow><annotation encoding=\"application/x-tex\">-2^{31}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">31</span></span></span></span></span></span></span></span></span></span></span></span>~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>31</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{31}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">31</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">int64</td>\n<td style=\"text-align:center\">8</td>\n<td style=\"text-align:center\"><span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><msup><mn>2</mn><mn>63</mn></msup></mrow><annotation encoding=\"application/x-tex\">-2^{63}</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">63</span></span></span></span></span></span></span></span></span></span></span></span>~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>63</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{63}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">63</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">uint</td>\n<td style=\"text-align:center\">4/8</td>\n<td style=\"text-align:center\">32位系统即uint32，64位系统即uint64</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">uint8</td>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\">0~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^8-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">uint16</td>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\">0~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>16</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{16}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">16</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">uint32</td>\n<td style=\"text-align:center\">4</td>\n<td style=\"text-align:center\">0~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>32</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{32}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">32</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n<tr>\n<td style=\"text-align:center\">uint64</td>\n<td style=\"text-align:center\">8</td>\n<td style=\"text-align:center\">0~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>64</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^{64}-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\"><span class=\"mord mtight\">64</span></span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span></td>\n</tr>\n</tbody>\n</table>\n<p>**零值：**对应字节长度的0</p>\n<p>👣</p>\n<ul>\n<li>由于字节范围的限制，尤其需注意“溢出”问题，可使用math包中“Max”和“Min”开头的常量帮组检查溢出；</li>\n</ul>\n<p><strong>整型数据的表示方法：</strong></p>\n<ul>\n<li>十进制，如<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mo>−</mo><mn>123</mn></mrow><annotation encoding=\"application/x-tex\">-123</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">−</span><span class=\"mord\">123</span></span></span></span>、0、256；</li>\n<li>八进制，以“0”开头的数是八进制，如0123表示八进制数123，即十进制的83；</li>\n<li>十六进制，以“0x”开头的数是十六进制数，如0x123表示十六进制数123，即十进制的291；</li>\n<li>指数形式，由数字和字母<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span>组成，如<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1</mn><mi>e</mi><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1e3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span><span class=\"mord mathnormal\">e</span><span class=\"mord\">3</span></span></span></span>或<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>10</mn><mi>e</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">10e2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">10</span><span class=\"mord mathnormal\">e</span><span class=\"mord\">2</span></span></span></span>代表十进制的1000；</li>\n</ul>\n<h4> 浮点型（Floating-point-number）</h4>\n<p>浮点型数据，也称为实数（Real-number），可存储带有小数的数值。浮点型数据在内存中的存储形式和整数不同，是按照指数形式存储的，共有三部分组成：符号、尾数和指数。</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:center\">字节长度</th>\n<th style=\"text-align:center\">精确位数</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">float32</td>\n<td style=\"text-align:center\">4</td>\n<td style=\"text-align:center\">精确小数点后7位</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">float64</td>\n<td style=\"text-align:center\">8</td>\n<td style=\"text-align:center\">精确小数点后15位</td>\n</tr>\n</tbody>\n</table>\n<p>**零值：**0</p>\n<p><strong>浮点型数据的表示方法：</strong></p>\n<ul>\n<li>十进制小数形式：由数字和小数点组成，如1.57、0.12、0.0都是十进制的小数形式；</li>\n<li>指数形式：由数字和字母<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span>组成，如<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1.23</mn><mi>e</mi><mn>3</mn></mrow><annotation encoding=\"application/x-tex\">1.23e3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1.23</span><span class=\"mord mathnormal\">e</span><span class=\"mord\">3</span></span></span></span>或<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>12.3</mn><mi>e</mi><mn>2</mn></mrow><annotation encoding=\"application/x-tex\">12.3e2</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">12.3</span><span class=\"mord mathnormal\">e</span><span class=\"mord\">2</span></span></span></span>都表示<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mn>1.23</mn><mo>×</mo><mn>1</mn><msup><mn>0</mn><mn>3</mn></msup></mrow><annotation encoding=\"application/x-tex\">1.23\\times10^3</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.7278em;vertical-align:-0.0833em;\"></span><span class=\"mord\">1.23</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">×</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.8141em;\"></span><span class=\"mord\">1</span><span class=\"mord\"><span class=\"mord\">0</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">3</span></span></span></span></span></span></span></span></span></span></span>；字母<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>e</mi></mrow><annotation encoding=\"application/x-tex\">e</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">e</span></span></span></span>之前必须有数字且后面的指数必须为整数；</li>\n</ul>\n<p>👣</p>\n<ul>\n<li>浮点型数据是由有限的存数单元组成的，能提供有效数字总是有限的，有效位以外的数字将被舍去，可能存在一些误差；</li>\n</ul>\n<h4> 复数（Complex-number）</h4>\n<blockquote>\n<p>复数是由两个浮点数构成，一个表示实部（real），一个表示虚部（imag），形式如<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi><mo>+</mo><mi>b</mi><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">a+bi</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6667em;vertical-align:-0.0833em;\"></span><span class=\"mord mathnormal\">a</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">+</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">bi</span></span></span></span>的数，这里的<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>a</mi></mrow><annotation encoding=\"application/x-tex\">a</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\">a</span></span></span></span>、<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>b</mi></mrow><annotation encoding=\"application/x-tex\">b</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6944em;\"></span><span class=\"mord mathnormal\">b</span></span></span></span>是实数，<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi></mrow><annotation encoding=\"application/x-tex\">i</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.6595em;\"></span><span class=\"mord mathnormal\">i</span></span></span></span>是虚数单位</p>\n</blockquote>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">类型</th>\n<th style=\"text-align:center\">字节长度</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">complex64</td>\n<td style=\"text-align:center\">8</td>\n<td style=\"text-align:center\">由两个float32构成，因此字节长度为4+4</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">complex128</td>\n<td style=\"text-align:center\">16</td>\n<td style=\"text-align:center\">由两个float64构成，因此字节长度为8+8</td>\n</tr>\n</tbody>\n</table>\n<p>对于一个复数<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>z</mi><mo>=</mo><mi>c</mi><mi>o</mi><mi>m</mi><mi>p</mi><mi>l</mi><mi>e</mi><mi>x</mi><mo stretchy=\"false\">(</mo><mi>x</mi><mo separator=\"true\">,</mo><mi>y</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">z=complex(x,y)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.4306em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span><span class=\"mrel\">=</span><span class=\"mspace\" style=\"margin-right:0.2778em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">co</span><span class=\"mord mathnormal\">m</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">pl</span><span class=\"mord mathnormal\">e</span><span class=\"mord mathnormal\">x</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\">x</span><span class=\"mpunct\">,</span><span class=\"mspace\" style=\"margin-right:0.1667em;\"></span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">y</span><span class=\"mclose\">)</span></span></span></span>，可以通过Go语言内置函数<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>r</mi><mi>e</mi><mi>a</mi><mi>l</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">real(z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">re</span><span class=\"mord mathnormal\">a</span><span class=\"mord mathnormal\" style=\"margin-right:0.01968em;\">l</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span>获得该复数的实部，也可以通过函数<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><mi>i</mi><mi>m</mi><mi>a</mi><mi>g</mi><mo stretchy=\"false\">(</mo><mi>z</mi><mo stretchy=\"false\">)</mo></mrow><annotation encoding=\"application/x-tex\">imag(z)</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:1em;vertical-align:-0.25em;\"></span><span class=\"mord mathnormal\">ima</span><span class=\"mord mathnormal\" style=\"margin-right:0.03588em;\">g</span><span class=\"mopen\">(</span><span class=\"mord mathnormal\" style=\"margin-right:0.04398em;\">z</span><span class=\"mclose\">)</span></span></span></span>获得该复数的虚部；</p>\n<p>**零值：**0+0i</p>\n<h4> 字节型（Byte）</h4>\n<blockquote>\n<p>字节型数据在计算机中主要是来表示和存储ASCII码，即处理字符，将一个字符存放到一个字符变量中，实际上并不是把该字符本身存放到内存单元中，而是将该字符的ASCII编码存放到内存单元中。</p>\n</blockquote>\n<p>**关键字定义：**byte</p>\n<p>**字节长度：**1</p>\n<p><strong>取值范围：</strong>[0~<span class=\"katex\"><span class=\"katex-mathml\"><math xmlns=\"http://www.w3.org/1998/Math/MathML\"><semantics><mrow><msup><mn>2</mn><mn>8</mn></msup><mo>−</mo><mn>1</mn></mrow><annotation encoding=\"application/x-tex\">2^8-1</annotation></semantics></math></span><span class=\"katex-html\" aria-hidden=\"true\"><span class=\"base\"><span class=\"strut\" style=\"height:0.8974em;vertical-align:-0.0833em;\"></span><span class=\"mord\"><span class=\"mord\">2</span><span class=\"msupsub\"><span class=\"vlist-t\"><span class=\"vlist-r\"><span class=\"vlist\" style=\"height:0.8141em;\"><span style=\"top:-3.063em;margin-right:0.05em;\"><span class=\"pstrut\" style=\"height:2.7em;\"></span><span class=\"sizing reset-size6 size3 mtight\"><span class=\"mord mtight\">8</span></span></span></span></span></span></span></span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span><span class=\"mbin\">−</span><span class=\"mspace\" style=\"margin-right:0.2222em;\"></span></span><span class=\"base\"><span class=\"strut\" style=\"height:0.6444em;\"></span><span class=\"mord\">1</span></span></span></span>]，byte本质就是uint8。</p>\n<p>**零值：**0</p>\n<h4> 字符类型（Rune）</h4>\n<p>关键字定义：rune</p>\n<blockquote>\n<p>Go语言处理Unicode字符有个专用的数据类型rune，等价于int32。</p>\n</blockquote>\n<p>Unicode编码</p>\n<blockquote>\n<p>随着计算机技术在世界范围内的广泛使用，国际标准化组织（ISO）统一制定了一种可以容纳世界上所有文字和符号的字符编码方案，即Unicode编码方案。由于涉及到不同计算机架构的大小端问题（Big Endian，Little Endian）于是存在不同的Unicode字符集转换格式（UCS Transformation Format,UTF)，例如：</p>\n<ul>\n<li>UTF-8：使用1～4B不等长方案，西方字符通常只用一个字节，中文通常需要三个字节；</li>\n<li>UTF-16：用2B无符号整数存储Unicode字符；</li>\n<li>UTF-32：用4B无符号整数存储Unicode字符；</li>\n</ul>\n</blockquote>\n<h4> uintptr类型</h4>\n<blockquote>\n<p>Go语言中，uintptr是可以保存32位或64位的指针的无符号整数类型，和int类型一样，uintptr根据操作系统决定指针位数，32位操纵系统uintptr是32位的，64位操作系统uintptr是64位的。</p>\n</blockquote>\n<h3> 复合类型</h3>\n<blockquote>\n<p>复合类型即比较复杂的数据类型，包括数组（array）、结构体（struct）。数组里存放的是一组相同类型的数据，结构体里存放的是不同类型的数据。</p>\n<p>与值类型一致，复合类型变量在传递过程也是进行值拷贝。</p>\n</blockquote>\n<h3> 引用类型</h3>\n<blockquote>\n<p>引用类型即指针类型，包括指针（pointer）、切片（silence）、字典（map）、通道（channel）、接口（interface）和函数（function）。</p>\n</blockquote>\n<p>👀</p>\n<p>值类型和引用类型的区别在于，在函数参数传递过程中</p>\n<ul>\n<li>值类型的变量的值复制一份传递</li>\n<li>引用类型的变量是把自己的内存地址传递，即拷贝地址</li>\n</ul>\n",
      "date_published": "2022-05-03T00:00:00.000Z",
      "date_modified": "2023-08-13T15:30:36.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "项目环境",
      "url": "https://Hexiaopi.github.io/go-language/base/enviroment.html",
      "id": "https://Hexiaopi.github.io/go-language/base/enviroment.html",
      "summary": "当下载完Go安装包后，需设置3个环境变量，分别是： GOROOR：Go语言安装根目录的路径，这是下载的Go语言安装路径。 GOPATH：工作区目录的路径，这是我们写代码存放的地方。 GOBIN：Go程序生成的可执行文件的路径。 可使用命令go env来查看当前的设置。 这里重点关注GOPATH，因为这是我们项目存放的地方，且需按照Go语言的源码组织方式组织我们的项目。GOPATH包含多个工作区，每个工作区包含三个文件夹，分别是： src：Go语言的源码文件（source file）。 pkg：安装后的归档文件（archive file），即程序编译后生产的静态库文件。同时会根据操作系统和计算机架构生产平台相关目录，例如是linux_amd64则表示是Linux系统，CPU是amd64架构。 bin：可执行文件（executable file）。",
      "content_html": "<p>当下载完Go安装包后，需设置3个环境变量，分别是：</p>\n<ol>\n<li>GOROOR：Go语言安装根目录的路径，这是下载的Go语言安装路径。</li>\n<li>GOPATH：工作区目录的路径，这是我们写代码存放的地方。</li>\n<li>GOBIN：Go程序生成的可执行文件的路径。</li>\n</ol>\n<p>可使用命令<code>go env</code>来查看当前的设置。</p>\n<p>这里重点关注GOPATH，因为这是我们项目存放的地方，且需按照Go语言的源码组织方式组织我们的项目。GOPATH包含多个工作区，每个工作区包含三个文件夹，分别是：</p>\n<ol>\n<li>src：Go语言的源码文件（source file）。</li>\n<li>pkg：安装后的归档文件（archive file），即程序编译后生产的静态库文件。同时会根据操作系统和计算机架构生产平台相关目录，例如是linux_amd64则表示是Linux系统，CPU是amd64架构。</li>\n<li>bin：可执行文件（executable file）。</li>\n</ol>\n<figure><figcaption>GOPATH</figcaption></figure>\n<p>此外，还有几个环境变量需要关注:</p>\n<ol>\n<li>GO111MODULE，通过设置on、off、auto来控制是否开启Go Modules特性。\n<ul>\n<li>on，代表开启Go Modules特性，会让Go编译器忽略GOPATH和vendor文件夹，只根据go.mod下载依赖；</li>\n<li>off，代表关闭，继续使用GOPATH模式；</li>\n<li>auto，Go1.14和之后的版本中都是默认值，如果源码在$GOPATH/src下，且没有包含go.mod，则关闭Go Modules特性，否则开启；</li>\n</ul>\n</li>\n<li>GOPROXY，Go包下载代理服务器，因为墙的原因，国内无法访问国外的一些网站，但一些依赖包需要从国外的网站下载，为了解决这个问题，需要设置一个代理服务器。例如：<code>GOPROXY=\"https://goproxy.cn,direct\"</code>，其中direct的作用是当遇见404错误，则直接去目标地址（比如Github）去获取，而不再使用代理服务器。</li>\n<li>GOPRIVATE，用于配置访问私有化仓库的代理，例如：<code>GOPRIVATE=git.xxx.com/</code></li>\n</ol>\n",
      "date_published": "2022-01-23T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "命名规则",
      "url": "https://Hexiaopi.github.io/go-language/base/identifier.html",
      "id": "https://Hexiaopi.github.io/go-language/base/identifier.html",
      "summary": "命名规则 Go语言中用来对符号常量、变量、函数、数组、切片、通道等数据对象命名的有效字符序列统称为标识符（Identifier）即数据对象的名字。 Go语言的命名规则： 变量名必须以字母或下划线开始； 必须使用英文字母、数字、下划线组成，不能出现空格或制表符； 不能使用Go语言内置关键字和保留字，如：go、func、break、defer等； 大小写敏感，比如x和X是两个不一样的标识符；",
      "content_html": "<h2> 命名规则</h2>\n<blockquote>\n<p>Go语言中用来对符号常量、变量、函数、数组、切片、通道等数据对象命名的有效字符序列统称为标识符（Identifier）即数据对象的名字。</p>\n</blockquote>\n<p>Go语言的命名规则：</p>\n<ul>\n<li>变量名必须以字母或下划线开始；</li>\n<li>必须使用英文字母、数字、下划线组成，不能出现空格或制表符；</li>\n<li>不能使用Go语言内置关键字和保留字，如：go、func、break、defer等；</li>\n<li>大小写敏感，比如<code>x</code>和<code>X</code>是两个不一样的标识符；</li>\n</ul>\n",
      "date_published": "2022-05-03T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "魔幻的iota枚举",
      "url": "https://Hexiaopi.github.io/go-language/base/iota.html",
      "id": "https://Hexiaopi.github.io/go-language/base/iota.html",
      "summary": "提示 iota的出现使得枚举值更加方便，但注意哦，并不简单。主要是对iota定义不理解，我整理了一些iota的使用注意事项",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>iota的出现使得枚举值更加方便，但注意哦，并不简单。主要是对iota定义不理解，我整理了一些iota的使用注意事项</p>\n</div>\n<!-- more -->\n<h2> iota</h2>\n<blockquote>\n<p>iota是Go语言的一个预定义标识符，它表示的是const声明块或声明行中每个常量所处位置的<strong>偏移值</strong>（从0开始）。</p>\n</blockquote>\n<h3> 规则：如果按行递增，可省略后续的iota关键字</h3>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这与常量的规则：<strong>如果不指定类型和初始化值，则默认表示使用上行的赋值表达式</strong>一致</p>\n<p>上面等价于</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 规则：iota只跟常量组的偏移位置有关</h3>\n<p>‼️</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>虽然c是第一次使用iota标识符定义，但在const块中位置属于第3，此时iota为2；</p>\n<p>d与e之间虽然有空行，但e的偏移位置属于第5，因此iota为4；</p>\n<h3> 规则：每遇到一个const关键字，iota就会重置为0</h3>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 规则：iota跟个数无关，即便是同一行，值也都一样</h3>\n<p>‼️</p>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>虽然g,h是两个常量，但由于在同一行，iota的值一样</p>\n<h3> 规则：如果想从1开始，则可以通过<code>_</code>忽略第一个iota</h3>\n<p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2023-02-03T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "散列map",
      "url": "https://Hexiaopi.github.io/go-language/base/map.html",
      "id": "https://Hexiaopi.github.io/go-language/base/map.html",
      "summary": "map",
      "content_html": "<figure><img src=\"http://cdn.cjhe.top/blog/map.png\" alt=\"map\" tabindex=\"0\" loading=\"lazy\"><figcaption>map</figcaption></figure>\n<!-- more -->\n<blockquote>\n<p>map是Go语言提供的一种抽象数据类型，它表示一组无序的键值对(key-value)</p>\n</blockquote>\n<h2> 声明</h2>\n<p><strong>关键字定义</strong>：<code>map</code></p>\n<p><strong>零值</strong>：<code>nil</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>map对于<code>value</code>的类型没有限制，但是对<code>key</code>的类型有严格的要求：<br>\n<code>key</code>的类型必须支持<code>==</code>和<code>!=</code>两个操作符的数据类型<br>\n因此，函数、map、切片等不能作为<code>key</code>类型。</p>\n</div>\n<h2> 初始化</h2>\n<p>字面量初始化</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>内置函数make()初始化</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h2> 操作</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>向<code>nil</code>（未初始化）的map类型里添加数据会导致<code>panic</code></p>\n</div>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<ul>\n<li>删除不存在的key不会导致panic；</li>\n<li>查询不存在的key，如果未使用<strong>comma ok</strong>语法，则会返回value类型对应的<strong>零值</strong></li>\n</ul>\n</div>\n<h2> 底层原理</h2>\n<p>参见<code>$GOROOT/src/runtime/map.go</code></p>\n<h3> map的数据结构</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> bucket的数据结构</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><figcaption>map</figcaption></figure>\n<p>key和value分开存储，目的是为了减少内存对齐带来的内存浪费，以map[int8]int64为例：</p>\n<figure><figcaption>map-memory</figcaption></figure>\n<p>每个bucket可以存储8个键值对，超过就会创建一个新的bucket，通过overflow链接</p>\n<p>当有两个或以上数量的键被<code>Hash</code>到了同一个bucket时，我们称这些键发生了冲突，Go语言使用链表解决键冲突。</p>\n<p>hash冲突并不是好事情，它降低了存取效率，好的Hash算法可以保证Hash值得随机性，但无论使用哪种Hash算法，冲突终究不可避免，当冲突较多的时候就需要采取一些措施来减少冲突。</p>\n<h3> 负载因子LoadFactor</h3>\n<blockquote>\n<p>负载因子用于衡量一个Hash表的冲突情况，计算公式如下：</p>\n<p>负载因子 = 键数量 / bucket数量</p>\n</blockquote>\n<ul>\n<li>负载因子过小，空间利用率低；</li>\n<li>负载因子过大，说明冲突严重，存取效率低；</li>\n</ul>\n<p>当Hash表的负载因子过大时需要rehash，即申请更多的bucket，并对所有的键值对重新组织，使其均匀的分布在这些bucket中。</p>\n<ul>\n<li>redis的负载因子大于1时就会触发rehash，因为redis的每个bucket只能存1个键值对；</li>\n<li>go的负载因子大于6.5时才会触发rehash，因为go的每个bucket可以存8个键值对；</li>\n</ul>\n<h3> 扩容</h3>\n<p>条件：</p>\n<ul>\n<li>负载因子大于6.5时</li>\n<li>overflow的数量大于2^15=32768</li>\n</ul>\n<p>map的扩缩容的主要区别在于hmap.B的容量大小改变，而缩容由于hmap.B压根不变，内存占用依然存在。这就导致在删除元素时，并不会释放内存，使得分配的总内存不断增加，如果不注意，内存就很容易爆了。</p>\n<h4> 增量扩容</h4>\n<blockquote>\n<p>通过将bucket数组扩大一倍实现，并搬迁键值对</p>\n</blockquote>\n<ol>\n<li>oldbuckets指向现有bucket数组；</li>\n<li>创建一个两倍现有规模的bucket数组；</li>\n<li>buckets指向新的bucket数组；</li>\n<li>将oldbuckets的键值对搬迁到新的bucket数组；</li>\n<li>释放oldbuckets；</li>\n</ol>\n<figure><figcaption>map-expand</figcaption></figure>\n<h4> 等量扩容</h4>\n<blockquote>\n<p>用于解决一个bucket链接很多bucket，overflow数量过高</p>\n<p>bucket数组大小不变，重新排列键值对，分散到不同的bucket数组中</p>\n<p>这样就提高了访问效率</p>\n</blockquote>\n<h3> 增删改查</h3>\n<h4> 查找过程</h4>\n<ul>\n<li>根据key计算hash值；</li>\n<li>取hash值低位与hmap.B取模来确定bucket的位置；</li>\n<li>取hash值高位，在tophash数组中查询；</li>\n<li>如果tophash[i]中存储的hash值与当前key的hash值相等，则获取tophash[i]的key值进行比较；</li>\n<li>当前bucket没有找到，则依次从溢出的bucket中查找；</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>如果当前map处于搬迁过程中，那么查找时从oldbuckets数组中查找，不再从新的buckets数组中查找</p>\n</div>\n<h4> 添加过程</h4>\n<ul>\n<li>根据key计算hash值；</li>\n<li>取hash值低位与hmap.B取模来确定bucket的位置；</li>\n<li>查找该key是否存在\n<ul>\n<li>如果存在，则直接更新；</li>\n<li>如果不存在，则从该bucket中寻找空余位置并插入；</li>\n</ul>\n</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>如果当前map处于搬迁过程中，那么直接添加到新的buckets数组中</p>\n</div>\n<h4> 删除过程</h4>\n<ul>\n<li>查找key是否存在\n<ul>\n<li>存在，则删除；</li>\n<li>不存在，则什么也不做；</li>\n</ul>\n</li>\n</ul>\n<h2> map注意事项</h2>\n<h3> 非并发读写安全的</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>运行报错：<code>fatal error: concurrent map iteration and map write</code></p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>Go 在 map 的实现中增加了读写检查机制，一旦发现读写冲突立即触发 panic</p>\n<p>如果想使用并发的map：</p>\n<ul>\n<li>可以使用Go 1.9版本中引入支持并发写安全的<code>sync.Map</code>类型；</li>\n<li>可以使用map时增加锁；</li>\n</ul>\n</div>\n<h3> 无法通过索引直接获取value的地址</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><br><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>这是由于map会扩容，map中的数据元素的value地址可能在扩容过程中发生变化，因此获取这个地址没有意义，Go语言为了防止出现该问题，在编译期间就检测是否有获取地址行为，避免出现问题。</p>\n</div>\n<h3> 尽量使用cap参数初始化map</h3>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>性能基准测试结果如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "image": "http://cdn.cjhe.top/blog/map.png",
      "date_published": "2023-02-06T00:00:00.000Z",
      "date_modified": "2023-08-13T15:30:36.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "运算符",
      "url": "https://Hexiaopi.github.io/go-language/base/operator.html",
      "id": "https://Hexiaopi.github.io/go-language/base/operator.html",
      "summary": "程序、表达式、运算符之间的关系 通常计算机程序是由多条表达式语句按照一定的逻辑关系所构成的，表达式（Expression）是程序算法的基本单位。 表达式 表达式由操作数（常量、变量、函数调用等）和运算符结合一起构成的式子； 运算符 运算符（Operator）用于对操作数进行运算 根据操作数的数目可分为一元运算符、二元运算符； 按照运算符的功能可分为赋值运算符、算术运算符、逻辑运算符、关系运算符、位运算符等；",
      "content_html": "<p>程序、表达式、运算符之间的关系</p>\n<blockquote>\n<p>通常计算机程序是由多条表达式语句按照一定的逻辑关系所构成的，表达式（Expression）是程序算法的基本单位。</p>\n</blockquote>\n<p>表达式</p>\n<blockquote>\n<p>表达式由操作数（常量、变量、函数调用等）和运算符结合一起构成的式子；</p>\n</blockquote>\n<p>运算符</p>\n<blockquote>\n<p>运算符（Operator）用于对操作数进行运算</p>\n<p>根据操作数的数目可分为一元运算符、二元运算符；</p>\n<p>按照运算符的功能可分为赋值运算符、算术运算符、逻辑运算符、关系运算符、位运算符等；</p>\n</blockquote>\n<h2> 运算符</h2>\n<h3> 赋值运算符</h3>\n<p>赋值运算符是把等号右边的操作数（常量、变量、函数调用等）的值赋于等号左边的变量</p>\n<p>赋值运算格式如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>也可以在定义变量时同时赋值，格式如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 算术运算符</h3>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">运算符</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>+</code></td>\n<td style=\"text-align:center\">加法运算符</td>\n<td style=\"text-align:center\">操作数可以是整数、浮点数和字符串</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>-</code></td>\n<td style=\"text-align:center\">减法运算符</td>\n<td style=\"text-align:center\">操作数可以是整数和浮点数</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>*</code></td>\n<td style=\"text-align:center\">乘法运算符</td>\n<td style=\"text-align:center\">操作数可以是整数和浮点数</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>/</code></td>\n<td style=\"text-align:center\">除法运算符</td>\n<td style=\"text-align:center\">分母不能位0，操作数为整数即是取整运算</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>%</code></td>\n<td style=\"text-align:center\">取余运算符</td>\n<td style=\"text-align:center\">操作数为整数，结果为整数</td>\n</tr>\n</tbody>\n</table>\n<p>👣</p>\n<ul>\n<li>乘除法优先级高于加减法</li>\n<li>在Go 语言中++、--是语句而非表达式</li>\n</ul>\n<h3> 关系运算符</h3>\n<p>关系运算的实质是比较，运算结果是布尔类型</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">运算符</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>&gt;</code></td>\n<td style=\"text-align:center\">大于</td>\n<td style=\"text-align:center\">a&gt;b，返回true；否则，返回false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&gt;=</code></td>\n<td style=\"text-align:center\">大于等于</td>\n<td style=\"text-align:center\">a&gt;=b，返回true；否则，返回false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&lt;</code></td>\n<td style=\"text-align:center\">小于</td>\n<td style=\"text-align:center\">a&lt;b，返回true；否则，返回false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&lt;=</code></td>\n<td style=\"text-align:center\">小于等于</td>\n<td style=\"text-align:center\">a&lt;=b，返回true；否则，返回false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>==</code></td>\n<td style=\"text-align:center\">等于</td>\n<td style=\"text-align:center\">a==b，返回true；否则，返回false</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>!=</code></td>\n<td style=\"text-align:center\">不等于</td>\n<td style=\"text-align:center\">a!=b，返回true；否则，返回false</td>\n</tr>\n</tbody>\n</table>\n<h3> 逻辑运算符</h3>\n<p>逻辑运算符的操作数是bool型</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">运算符</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>！</code></td>\n<td style=\"text-align:center\">逻辑非运算符</td>\n<td style=\"text-align:center\">一元运算符，取反</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&amp;&amp;</code></td>\n<td style=\"text-align:center\">逻辑与运算符</td>\n<td style=\"text-align:center\">逻辑与</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>||</code></td>\n<td style=\"text-align:center\">逻辑或运算符</td>\n<td style=\"text-align:center\">逻辑或</td>\n</tr>\n</tbody>\n</table>\n<h3> 位运算符</h3>\n<p>位操作运算符的操作数是整型或byte型</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">运算符</th>\n<th style=\"text-align:center\">描述</th>\n<th style=\"text-align:center\">说明</th>\n<th style=\"text-align:center\">示例</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><code>^</code></td>\n<td style=\"text-align:center\">取反运算符</td>\n<td style=\"text-align:center\">一元运算符，对操作数按位取反</td>\n<td style=\"text-align:center\">^ 0111 = 1000</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&amp;</code></td>\n<td style=\"text-align:center\">按位与运算符</td>\n<td style=\"text-align:center\">二元运算符</td>\n<td style=\"text-align:center\">0101 &amp; 0011 = 0001</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>|</code></td>\n<td style=\"text-align:center\">按位或运算符</td>\n<td style=\"text-align:center\">二元运算符</td>\n<td style=\"text-align:center\">0101 | 0011 = 0111</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>^</code></td>\n<td style=\"text-align:center\">按位异或运算符</td>\n<td style=\"text-align:center\">二元运算符</td>\n<td style=\"text-align:center\">0101 ^ 0011 = 0110</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&amp;^</code></td>\n<td style=\"text-align:center\">标志位清楚运算符</td>\n<td style=\"text-align:center\">二元运算符</td>\n<td style=\"text-align:center\">0110 &amp;^ 1011 = 0100</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&lt;&lt;</code></td>\n<td style=\"text-align:center\">左移运算符</td>\n<td style=\"text-align:center\">二元运算符</td>\n<td style=\"text-align:center\">0001 &lt;&lt; 3 = 1000</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><code>&gt;&gt;</code></td>\n<td style=\"text-align:center\">右移运算符</td>\n<td style=\"text-align:center\">二元运算符</td>\n<td style=\"text-align:center\">1010 &gt;&gt; 2 = 0010</td>\n</tr>\n</tbody>\n</table>\n<h3> 通道运算符</h3>\n<p>通道运算符使用<code>&lt;-</code>接受或者发送数据</p>\n<h2> 运算符的优先级和结合</h2>\n<p>运算符优先级共分为7级，由7-&gt;1优先级依次降低</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">优先级</th>\n<th style=\"text-align:center\">运算符</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">7</td>\n<td style=\"text-align:center\"><code>^</code> <code>!</code></td>\n<td style=\"text-align:center\">一元运算符</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">6</td>\n<td style=\"text-align:center\"><code>*</code> <code>/</code> <code>%</code> <code>&lt;&lt;</code> <code>&gt;&gt;</code> <code>&amp;</code> <code>&amp;^</code></td>\n<td style=\"text-align:center\">二元运算符</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">5</td>\n<td style=\"text-align:center\"><code>+</code> <code>-</code> <code>|</code> <code>^</code></td>\n<td style=\"text-align:center\">二元运算符</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">4</td>\n<td style=\"text-align:center\"><code>==</code> <code>!=</code> <code>&lt;</code> <code>&lt;=</code> <code>&gt;=</code> <code>&gt;</code></td>\n<td style=\"text-align:center\">关系运算符</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">3</td>\n<td style=\"text-align:center\"><code>&lt;-</code></td>\n<td style=\"text-align:center\">通道运算符</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">2</td>\n<td style=\"text-align:center\"><code>&amp;&amp;</code></td>\n<td style=\"text-align:center\">逻辑运算符</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">1</td>\n<td style=\"text-align:center\"><code>||</code></td>\n<td style=\"text-align:center\">逻辑运算符</td>\n</tr>\n</tbody>\n</table>\n",
      "date_published": "2022-01-23T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "切片slice",
      "url": "https://Hexiaopi.github.io/go-language/base/slice.html",
      "id": "https://Hexiaopi.github.io/go-language/base/slice.html",
      "summary": "slice",
      "content_html": "<figure><img src=\"http://cdn.cjhe.top/blog/slice-1.png\" alt=\"slice\" tabindex=\"0\" loading=\"lazy\"><figcaption>slice</figcaption></figure>\n<!-- more -->\n<blockquote>\n<p>切片（slice）简称动态数组，既然是动态，切片的长度可以动态伸缩。</p>\n</blockquote>\n<p>在Go语言编程过程中，我经常使用切片而非数组，因为切片相比较数组更加<strong>灵活</strong>和<strong>高效</strong>。</p>\n<h2> 声明</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container danger\">\n<p class=\"hint-container-title\">警告</p>\n<p>切片声明时未初始化，此时不能对切片进行索引操作!</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<p>但是</p>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>append可以对未初始化的切片进行操作，因为append操作会对底层数据进行扩容。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></div>\n<h2> 底层结构</h2>\n<p>切片的结构定义：<code>$GOROOT/src/runtime/slice.go</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>切片的定义包含三个字段：</p>\n<ul>\n<li><strong>array</strong>：指向数组某元素的指针（该元素也是切片的起始元素）；</li>\n<li><strong>len</strong>：表示切片的长度，即切片当前元素的个数；</li>\n<li><strong>cap</strong>：表示切片的最大容量；</li>\n</ul>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">切片与数组在函数参数传递中比较</p>\n<ul>\n<li>切片作为函数参数传递给函数时，实际传递的是runtime.slice结构体实例，无论其底层数据有多大，参数传递带来的性能损耗都是很小且恒定的。</li>\n<li>数组作为函数参数传递给函数时就不一样了，会重新拷贝整个数组，性能损耗就很大。</li>\n</ul>\n</div>\n<p>既然我们已经知道切片的底层结构是数组，那么我们就可以基于数组创建切片</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><figure><figcaption>slice底层结构</figcaption></figure>\n<h2> append扩容原理</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其执行逻辑如下图所示：</p>\n<figure><figcaption>slice扩容</figcaption></figure>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p><code>append</code>函数在当前数组容量无法满足时，会分配新的数组，新的数组容量会按一定的算法扩展（参见<code>$GOROOT/src/runtime/slice.go</code>的<code>growslice</code>函数），将旧数组中的数据复制到新数组之后，切片array指针指向新的数组，之后旧的数组就如果未被使用或其他切片引用会被垃圾回收掉。</p>\n</div>\n<h2> append的注意事项</h2>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"highlight-lines\"><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br><br><br><br><div class=\"highlight-line\">&nbsp;</div><br><br><br><br><br></div><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>第15行，由于s2需要的存储空间超过s1的存储空间，因此重新申请了一块空间，至此s1和s2不再共享同一底层数组；</li>\n<li><code>SliceRise</code>函数第一步，进行扩容，由于s1传参的底层数组不满足存储空间，因此s切片和s1将不再共享同一空间，然而s2传参的底层数组满足存储空间，因此s切片和s2共享底层数据，因此对s切片的操作会影响到底层数据，进行影响s2；</li>\n</ul>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>一旦底层数组容量无法满足某个切片的容量需求，该切片与底层数组关系就会<strong>解除绑定</strong>，例如：</p>\n<ul>\n<li>15行的s2和s1的底层数组解除绑定</li>\n<li>16行调用SliceRise(s1)，其中s和s1的底层数组解除绑定</li>\n</ul>\n</div>\n<div class=\"hint-container danger\">\n<p class=\"hint-container-title\">警告</p>\n<p>如果多个切片共用同一个底层数组,某个切片的操作对其他切片都是<strong>可见的</strong>，例如：</p>\n<ul>\n<li>17行调用SliceRise(s2)，s2和s共用底层数组，因此s的修改，s2是可见的。</li>\n</ul>\n</div>\n<p>再举一个影响是<strong>可见的</strong>例子</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>b切片共用a切片的底层数组，且append操作并未超过b切片的容量，因此会影响到a切片：<code>a[3]</code>由原来的4变为0。</p>\n<h2> append的性能</h2>\n<p>append扩容会重新分配底层数组并复制元素，当元素较多时，操作代价还是很大的。避免这种场景的方法是对切片的容量规模进行预估，并以cap参数的形式进行创建：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>我们将未预估容量的append操作与预估容量的append操作进行压测如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>其结果如下：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>不带cap的append操作的平均性能是62965 ns/op，是带cap的append操作的<code>4</code>倍左右；</li>\n<li>不带cap的append操作每次操作分配357625B内存，而带cap的append操作仅分配81920B；</li>\n<li>不带cap的append操作平均每次分配19次内存，而带cap的append操作仅需一次内存分配；</li>\n</ul>\n<h2> append的非常规操作</h2>\n<p>和数组类似，可以使用<code>len()</code>和<code>cap()</code>函数获取切片的长度和容量。此外可以使用<code>append()</code>对切片追加元素，但<code>append()</code>远不止这个功能。</p>\n<h3> 添加切片元素</h3>\n<h4> 在切片尾部追加元素</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 在切片头部追加元素</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>在切片开头追加元素会导致内存的重新分配，已有的元素会复制一份。因此从切片的头部追加元素的性能很差，也很少使用到。</p>\n</div>\n<h4> 在切片中间追加元素</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>同样，在切片中间追加元素，会创建许多临时切片，性能比较差。可以使用<code>copy()</code>函数完成类似的功能：</p>\n<p>在i的位置上插入一个元素</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><code>copy(target,source)</code>函数，将source的内容复制到target，相比较append，节省了临时切片的创建。</p>\n<p>在i的位置上插入多个元素: x</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 删除切片元素</h3>\n<h4> 在切片头部删除元素</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>或者</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这里的len和cap都为2，是因为重新分配了内存空间</p>\n<h4> 在切片中部删除元素</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 在切片尾部删除元素</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "image": "http://cdn.cjhe.top/blog/slice-1.png",
      "date_published": "2023-02-03T00:00:00.000Z",
      "date_modified": "2023-08-14T15:50:08.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "字符串",
      "url": "https://Hexiaopi.github.io/go-language/base/string.html",
      "id": "https://Hexiaopi.github.io/go-language/base/string.html",
      "summary": "声明 关键字定义： string 零值： \"\" var str string",
      "content_html": "<h2> 声明</h2>\n<p><strong>关键字定义：</strong> string</p>\n<p><strong>零值：</strong> \"\"</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h2> 操作</h2>\n<p>字符串支持一些简单的运算或操作，如下：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">操作</th>\n<th style=\"text-align:center\">含义</th>\n<th style=\"text-align:center\">示例</th>\n<th style=\"text-align:center\">结果</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">x+y</td>\n<td style=\"text-align:center\">字符串连接</td>\n<td style=\"text-align:center\">\"Go\"+\"lang\"</td>\n<td style=\"text-align:center\">\"Golang\"</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">len(x)</td>\n<td style=\"text-align:center\">计算字符串长度</td>\n<td style=\"text-align:center\">len(\"Golang\")</td>\n<td style=\"text-align:center\">6</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">str[i]</td>\n<td style=\"text-align:center\">取字符</td>\n<td style=\"text-align:center\">\"Golang\"[3]</td>\n<td style=\"text-align:center\">a</td>\n</tr>\n</tbody>\n</table>\n<h3> 比较</h3>\n<p>支持各种比较关系运算符: <code>==</code>、<code>!=</code>、<code>&gt;=</code>、<code>&lt;=</code>、<code>&gt;</code>、<code>&lt;</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 遍历</h3>\n<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>Go语言支持UTF-8格式编码，因此字符串中字符可以是<code>ASCII</code>字符，也可以是<code>Unicode</code>字符，其中：</p>\n<ul>\n<li><code>byte</code>类型来表示<code>ASCII</code>字符</li>\n<li><code>rune</code>类型来表示<code>Unicode</code>字符</li>\n</ul>\n</div>\n<h4> byte遍历</h4>\n<p>英文字符串遍历</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>中文字符串遍历</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>由于UTF-8中，大多数中文字符都使用三字节表示，因此通过rune方式遍历中文字符串是不可取的</p>\n</div>\n<h4> rune遍历</h4>\n<p>英文字符串遍历</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>rune实际上类型是int32，因此打印时展示的是数字类型，因此需要显示转换成string类型</p>\n</div>\n<p>中文字符串遍历</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>遍历中文字符索引的变化：</p>\n<ul>\n<li><code>你</code>的索引在0</li>\n<li><code>好</code>的索引在3</li>\n</ul>\n</div>\n<h2> 底层结构</h2>\n<p>参见<code>$GOROOT/src/runtime/string.go</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>str是指针，指向底层数据结构，其实是<code>[]byte</code></li>\n<li>len是字符串长度，因此len(s)是O(1)复杂度的操作</li>\n</ul>\n<p>因此传参是可以将字符串作为参数，而不必传字符串指针。</p>\n<div class=\"hint-container warning\">\n<p class=\"hint-container-title\">注意</p>\n<p>字符串的内容可以用类似数组下标的方式获取，例如str[0]，但与数组不同，字符串的内容初始化后不可修改</p>\n</div>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 高效构造方式</h2>\n<p>Go语言构造字符串的方式有：</p>\n<ul>\n<li><code>+</code></li>\n<li><code>fmt.Sprintf</code></li>\n<li><code>strings.Join</code></li>\n<li><code>strings.Build</code></li>\n<li><code>bytes.Buffer</code></li>\n</ul>\n<p>但哪种方法最为高效呢？</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>我们进行基准测试如下：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>测试结果</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>👀</p>\n<ul>\n<li>预初始化的strings.Builder构建字符串效率最高</li>\n<li>fmt.Sprintf性能最差</li>\n<li>未知字符串长度情况下使用strings.Join比较好</li>\n</ul>\n",
      "date_published": "2022-01-23T00:00:00.000Z",
      "date_modified": "2023-08-13T15:30:36.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "变量",
      "url": "https://Hexiaopi.github.io/go-language/base/variable.html",
      "id": "https://Hexiaopi.github.io/go-language/base/variable.html",
      "summary": "变量 程序运行过程中，数据常常分配在内存中，我们在编码阶段用一个易于阅读的名字来定义这块内存，这块内存上存储的数据其值可以经常改变，我们就称为变量(variable) 变量的类型决定了变量在内存的长度和存储格式 声明 一个变量 var &lt;variable_name&gt; [variable_type]",
      "content_html": "<h2> 变量</h2>\n<blockquote>\n<p>程序运行过程中，数据常常分配在内存中，我们在编码阶段用一个易于阅读的名字来定义这块内存，这块内存上存储的数据其值可以经常改变，我们就称为变量(variable)</p>\n<p>变量的类型决定了变量在内存的长度和存储格式</p>\n</blockquote>\n<h3> 声明</h3>\n<h4> 一个变量</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>例如：</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>👀</p>\n<ul>\n<li>编译器确保变量被初始化为<code>零值</code>，避免出现不可预测行为</li>\n<li>定义的变量如果未使用，会编译不通过</li>\n</ul>\n<h4> 多个变量</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 短变量</h4>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>👀</p>\n<ul>\n<li>\n<p>必须给变量相同数量的值，由编译器推断类型</p>\n</li>\n<li>\n<p>短变量声明只可存在函数中，不可全局声明</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>由于使用了<code>:=</code>，因此至少有一个<code>新声明的变量</code>出现在左值，否则编译失败</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ul>\n<h4> 匿名变量</h4>\n<blockquote>\n<p>匿名变量是以下划线<code>_</code>声明的，通常用于多值返回时忽略某个值</p>\n</blockquote>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 零值</h3>\n<blockquote>\n<p>Go语言中，当一个变量被定义为某一种数据类型后，Go语言回自动初始化其值为零值（Zero Value），零值并不等于空值，而是对应数据类型的默认值。</p>\n</blockquote>\n<ul>\n<li>整型默认值为：0</li>\n<li>浮点型默认值为：0.0</li>\n<li>布尔类型的默认值是：false</li>\n<li>字符串类型的默认值为：\"\"</li>\n<li>复数类型默认值为对应实部和虚部的零值：0+0i</li>\n<li><code>function</code>、<code>interface</code>、<code>map</code>、<code>slice</code>、<code>channel</code>等类型为nil，表示没有分配内存地址</li>\n<li><code>struct</code>和<code>array</code>则是分配了内存，其子元素对应上述的零值</li>\n</ul>\n<h3> 作用域</h3>\n<p>变量的作用（使用）范围称为变量的作用域，通常来说，一段程序代码中所用到的变量并不总是有效或可用的，而限定这个变量的可用范围即作用域，根据作用域可将变量分为两种：全局变量和局部作变量。</p>\n<p>作用域的使用提高了程序逻辑的局部性，增强了程序的可靠性，减少了命名冲突。</p>\n<h4> 全局变量</h4>\n<blockquote>\n<p>全局变量（Global Variables）是在函数外部定义的变量，它的作用范围涵盖了整个包。</p>\n</blockquote>\n<h4> 局部变量</h4>\n<blockquote>\n<p>局部变量（Local Variables）是在函数内部或<code>{}</code>内定义的变量，它的作用范围仅限域函数内部或<code>{}</code>内。</p>\n</blockquote>\n<p>👀</p>\n<p>存在变量地址变化问题，须小心使用</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 声明原则</h3>\n<blockquote>\n<p>就近原则，尽可能在靠近第一次使用变量的位置声明该变量</p>\n</blockquote>\n<p>例如：<code>$GORROT/src/net/http/request.go</code></p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2022-01-23T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "Go语言推荐博客",
      "url": "https://Hexiaopi.github.io/go-language/recommend/blog.html",
      "id": "https://Hexiaopi.github.io/go-language/recommend/blog.html",
      "summary": "提示 收集的一些关于Go语言的博客文章，前行不再迷茫",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>收集的一些关于Go语言的博客文章，前行不再迷茫</p>\n</div>\n<!-- more -->\n<h2> Go社区</h2>\n<p>Go语言官方网站<a href=\"https://golang.google.cn/\" target=\"_blank\" rel=\"noopener noreferrer\">Go官方</a></p>\n<p>GoCN社区会分享一些文章和招聘<a href=\"https://gocn.vip/\" target=\"_blank\" rel=\"noopener noreferrer\">GoCN社区</a></p>\n<p>Go语言中文网分享一些文章<a href=\"https://studygolang.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Go语言中文网</a></p>\n<p>Go夜读会定期的组织阅读Go项目源码<a href=\"https://talkgo.org/\" target=\"_blank\" rel=\"noopener noreferrer\">Go夜读</a></p>\n<p>Go的一些书籍<a href=\"https://topgoer.cn/\" target=\"_blank\" rel=\"noopener noreferrer\">地鼠文档</a></p>\n<p>腾讯云开发者社区Go教程<a href=\"https://cloud.tencent.com/developer/doc/1101\" target=\"_blank\" rel=\"noopener noreferrer\">腾讯云</a></p>\n<p>Go Blog中文翻译<a href=\"https://learnku.com/docs/go-blog\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>learnku<a href=\"https://learnku.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> Go语言规范</h2>\n<p><a href=\"https://github.com/xxjwxc/uber_go_guide_cn\" target=\"_blank\" rel=\"noopener noreferrer\">Uber公司Go语言编码规范</a></p>\n<p><a href=\"https://github.com/golang/go/wiki/CodeReviewComments\" target=\"_blank\" rel=\"noopener noreferrer\">Go代码评审常见错误清单</a></p>\n<p><a href=\"https://rakyll.org/style-packages/\" target=\"_blank\" rel=\"noopener noreferrer\">Go包规范</a></p>\n<p>稀土掘进-如何写出优雅的Golang代码<a href=\"https://juejin.cn/post/6844903976509390856\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>稀土掘进-Go语言实践：编写可维护的程序的建议<a href=\"https://juejin.cn/post/6844904035611328520\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go官方代码审查<a href=\"https://github.com/golang/go/wiki/CodeReviewComments\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> Go博客</h2>\n<p>threedots<a href=\"https://threedots.tech/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Dave Cheney<a href=\"https://dave.cheney.net/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go数据结构<a href=\"https://www.interviewcake.com/data-structures-reference\" target=\"_blank\" rel=\"noopener noreferrer\">data-structures-reference</a></p>\n<p>煎鱼，文章质量很高<a href=\"https://eddycjy.com/\" target=\"_blank\" rel=\"noopener noreferrer\">eddycjy</a></p>\n<p>峰云就她了，专注Go、Kubernetes、NoSQL、Istio<a href=\"https://xiaorui.cc/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>鸟窝<a href=\"https://colobu.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>EricZhou，有系列的Go文章<a href=\"https://mojotv.cn/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>傅小黑<a href=\"https://fuxiaohei.me/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>polarisxu<a href=\"https://polarisxu.studygolang.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>mohuishou<a href=\"https://lailin.xyz/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>一支人<a href=\"https://yizhi.ren/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>可汗学院<a href=\"https://blog.khanacademy.org/engineering/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Mark<a href=\"https://www.integralist.co.uk/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>qcrao<a href=\"https://qcrao.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>冰霜之地<a href=\"https://halfrost.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>chai2010<a href=\"https://chai2010.cn/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> Go练习</h2>\n<p>Go的一些练习项目<a href=\"https://gophercises.com/\" target=\"_blank\" rel=\"noopener noreferrer\">gophercises</a></p>\n<p>Go的示例，有上千个示例<a href=\"https://golangexample.com/\" target=\"_blank\" rel=\"noopener noreferrer\">golangexample</a></p>\n<p>Go语言一些示例<a href=\"https://gobyexample.com/\" target=\"_blank\" rel=\"noopener noreferrer\">gobyexample</a></p>\n<p>Go Web开发示例<a href=\"https://gowebexamples.com/\" target=\"_blank\" rel=\"noopener noreferrer\">gowebexamples</a></p>\n<p>ReposHub网站的Go练习<a href=\"https://reposhub.com/go\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>英文的Go练习<a href=\"https://www.golangprograms.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> Go书籍</h2>\n<p>Go高级编程<a href=\"https://books.studygolang.com/advanced-go-programming-book/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go语言设计与实现<a href=\"https://draveness.me/golang/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go语言四十二章经<a href=\"https://github.com/ffhelicopter/Go42\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Mastering Go<a href=\"https://wskdsgcf.gitbook.io/mastering-go-zh-cn/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>ApacheCN Golang 译文集<a href=\"https://go.apachecn.org/#/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go Patterns<a href=\"https://hxangel.gitbooks.io/go-patterns/content/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go语言标准库<a href=\"https://books.studygolang.com/The-Golang-Standard-Library-by-Example/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go测试驱动开发<a href=\"https://studygolang.gitbook.io/learn-go-with-tests/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go练习<a href=\"https://www.practical-go-lessons.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go语言原本<a href=\"https://golang.design/under-the-hood/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go语言编程之旅<a href=\"https://golang2.eddycjy.com/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>Go程序员面试<a href=\"https://golang.design/go-questions/\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> 知识图谱</h2>\n<p>processon<a href=\"https://www.processon.com/view/link/5a9ba4c8e4b0a9d22eb3bdf0#map\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<h2> 资料收集</h2>\n<p>简书<a href=\"https://www.jianshu.com/p/9895e6434819\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n<p>英文Go博客收集<a href=\"https://draft.dev/learn/golang-blogs\" target=\"_blank\" rel=\"noopener noreferrer\"></a></p>\n",
      "date_published": "2023-03-04T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "Go语言推荐工具",
      "url": "https://Hexiaopi.github.io/go-language/recommend/tool.html",
      "id": "https://Hexiaopi.github.io/go-language/recommend/tool.html",
      "summary": "提示 好的工具将解放我们的生产力！",
      "content_html": "<div class=\"hint-container tip\">\n<p class=\"hint-container-title\">提示</p>\n<p>好的工具将解放我们的生产力！</p>\n</div>\n<!-- more -->\n<h2> 工具</h2>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">工具</th>\n<th style=\"text-align:center\">功能</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/segmentio/golines\" target=\"_blank\" rel=\"noopener noreferrer\">golines</a></td>\n<td style=\"text-align:center\">格式化Go代码中长行变成短行</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/bradfitz/goimports\" target=\"_blank\" rel=\"noopener noreferrer\">goimports</a></td>\n<td style=\"text-align:center\">自动格式化Go代码并对所有引入的包进行管理，包括自动增删依赖的包、将依赖包按字母序排序并分类</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/golang/mock\" target=\"_blank\" rel=\"noopener noreferrer\">mockgen</a></td>\n<td style=\"text-align:center\">接口Mock工具</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/cweill/gotests\" target=\"_blank\" rel=\"noopener noreferrer\">gotests</a></td>\n<td style=\"text-align:center\">根据Go代码自动生成单元测试模板</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/jstemmer/go-junit-report\" target=\"_blank\" rel=\"noopener noreferrer\">go-junit-report</a></td>\n<td style=\"text-align:center\">将go test的输出转化为junit xml</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/kyoh86/richgo\" target=\"_blank\" rel=\"noopener noreferrer\">richgo</a></td>\n<td style=\"text-align:center\">用文本装饰丰富go test的输出</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/golangci/golangci-lint\" target=\"_blank\" rel=\"noopener noreferrer\">golangci-lint</a></td>\n<td style=\"text-align:center\">静态代码检查工具</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"github.com/galeone/rts\">rts</a></td>\n<td style=\"text-align:center\">根据服务端的响应生成Go结构体</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/favadi/protoc-go-inject-tag\" target=\"_blank\" rel=\"noopener noreferrer\">protoc-go-inject-tag</a></td>\n<td style=\"text-align:center\">往通过protoc工具生成的pb.go文件中注入自定义标签</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/Shelnutt2/db2struct\" target=\"_blank\" rel=\"noopener noreferrer\">db2struct</a></td>\n<td style=\"text-align:center\">根据数据库表一键转换Go结构体，支持自定义Tag和多种命名格式</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/arnaud-deprez/gsemver\" target=\"_blank\" rel=\"noopener noreferrer\">gsemver</a></td>\n<td style=\"text-align:center\">根据git commit规范自动生成语义化版本</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/git-chglog/git-chglog\" target=\"_blank\" rel=\"noopener noreferrer\">git-chglog</a></td>\n<td style=\"text-align:center\">根据git commit自动生成CHANGELOG</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"github.com/github-release/github-release\">github-release</a></td>\n<td style=\"text-align:center\">命令行工具，用来创建、修改github release</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/psampaz/go-mod-outdated\" target=\"_blank\" rel=\"noopener noreferrer\">go-mod-outdated</a></td>\n<td style=\"text-align:center\">检查依赖包是否有更新</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/ofabry/go-callvis\" target=\"_blank\" rel=\"noopener noreferrer\">go-callvis</a></td>\n<td style=\"text-align:center\">可视化显示Go调用关系</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/KyleBanks/depth\" target=\"_blank\" rel=\"noopener noreferrer\">depth</a></td>\n<td style=\"text-align:center\">通过分析导入的库，将某个包的依赖关系用树状结构显示出来</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/cloudflare/cfssl\" target=\"_blank\" rel=\"noopener noreferrer\">cfssl</a></td>\n<td style=\"text-align:center\">Cloudflare的PKI和TLS工具集</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/go-swagger/go-swagger/\" target=\"_blank\" rel=\"noopener noreferrer\">go-swagger</a></td>\n<td style=\"text-align:center\">自动生成Go Swagger文档</td>\n</tr>\n<tr>\n<td style=\"text-align:center\"><a href=\"https://github.com/ribice/glice\" target=\"_blank\" rel=\"noopener noreferrer\">glice</a></td>\n<td style=\"text-align:center\">分析导入的库，并打印出许可证</td>\n</tr>\n</tbody>\n</table>\n",
      "date_published": "2022-09-08T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言"
      ]
    },
    {
      "title": "Go安全指南-腾讯",
      "url": "https://Hexiaopi.github.io/go-language/reprint/tencent-secguide.html",
      "id": "https://Hexiaopi.github.io/go-language/reprint/tencent-secguide.html",
      "summary": "【转】原文链接",
      "content_html": "<p>【转】<a href=\"https://github.com/Tencent/secguide\" target=\"_blank\" rel=\"noopener noreferrer\">原文链接</a></p>\n<!-- more -->\n\n<p>Go安全指南</p>\n<h2> 通用类</h2>\n<h3> 1.1 内存管理</h3>\n<h4> 1.1.1【必须】切片长度校验</h4>\n<ul>\n<li>在对slice进行操作时，必须判断长度是否合法，防止程序panic</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.2【必须】nil指针判断</h4>\n<ul>\n<li>进行指针操作时，必须判断该指针是否为nil，防止程序panic，尤其在进行结构体Unmarshal时</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.3【必须】整数安全</h4>\n<ul>\n<li>\n<p>在进行数字运算操作时，需要做好长度限制，防止外部输入运算导致异常：</p>\n<ul>\n<li>确保无符号整数运算时不会反转</li>\n<li>确保有符号整数运算时不会出现溢出</li>\n<li>确保整型转换时不会出现截断错误</li>\n<li>确保整型转换时不会出现符号错误</li>\n</ul>\n</li>\n<li>\n<p>以下场景必须严格进行长度限制：</p>\n<ul>\n<li>作为数组索引</li>\n<li>作为对象的长度或者大小</li>\n<li>作为数组的边界（如作为循环计数器）</li>\n</ul>\n</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.4【必须】make分配长度验证</h4>\n<ul>\n<li>在进行make分配内存时，需要对外部可控的长度进行校验，防止程序panic。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.5【必须】禁止SetFinalizer和指针循环引用同时使用</h4>\n<ul>\n<li>当一个对象从被GC选中到移除内存之前，runtime.SetFinalizer()都不会执行，即使程序正常结束或者发生错误。由指针构成的“循环引用”虽然能被GC正确处理，但由于无法确定Finalizer依赖顺序，从而无法调用runtime.SetFinalizer()，导致目标对象无法变成可达状态，从而造成内存无法被回收。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.6【必须】禁止重复释放channel</h4>\n<ul>\n<li>重复释放一般存在于异常流程判断中，如果恶意攻击者构造出异常条件使程序重复释放channel，则会触发运行时panic，从而造成DoS攻击。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.7【必须】确保每个协程都能退出</h4>\n<ul>\n<li>启动一个协程就会做一个入栈操作，在系统不退出的情况下，协程也没有设置退出条件，则相当于协程失去了控制，它占用的资源无法回收，可能会导致内存泄露。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.8【推荐】不使用unsafe包</h4>\n<ul>\n<li>由于unsafe包绕过了 Golang 的内存安全原则，一般来说使用该库是不安全的，可导致内存破坏，尽量避免使用该包。若必须要使用unsafe操作指针，必须做好安全校验。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.1.9【推荐】不使用slice作为函数入参</h4>\n<ul>\n<li>slice在作为函数入参时，函数内对slice的修改可能会影响原始数据</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.2 文件操作</h3>\n<h4> 1.2.1【必须】 路径穿越检查</h4>\n<ul>\n<li>在进行文件操作时，如果对外部传入的文件名未做限制，可能导致任意文件读取或者任意文件写入，严重可能导致代码执行。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.2.2【必须】 文件访问权限</h4>\n<ul>\n<li>根据创建文件的敏感性设置不同级别的访问权限，以防止敏感数据被任意权限用户读取。例如，设置文件权限为：<code>-rw-r-----</code></li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><h3> 1.3 系统接口</h3>\n<h4> 1.3.1【必须】命令执行检查</h4>\n<ul>\n<li>使用<code>exec.Command</code>、<code>exec.CommandContext</code>、<code>syscall.StartProcess</code>、<code>os.StartProcess</code>等函数时，第一个参数（path）直接取外部输入值时，应使用白名单限定可执行的命令范围，不允许传入<code>bash</code>、<code>cmd</code>、<code>sh</code>等命令；</li>\n<li>使用<code>exec.Command</code>、<code>exec.CommandContext</code>等函数时，通过<code>bash</code>、<code>cmd</code>、<code>sh</code>等创建shell，-c后的参数（arg）拼接外部输入，应过滤\\n  $  &amp;  ;  |  '  \"  ( )  `等潜在恶意字符；</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.4 通信安全</h3>\n<h4> 1.4.1【必须】网络通信采用TLS方式</h4>\n<ul>\n<li>明文传输的通信协议目前已被验证存在较大安全风险，被中间人劫持后可能导致许多安全风险，因此必须采用至少TLS的安全通信方式保证通信安全，例如gRPC/Websocket都使用TLS1.3。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.4.2【推荐】TLS启用证书验证</h4>\n<ul>\n<li>TLS证书应当是有效的、未过期的，且配置正确的域名，生产环境的服务端应启用证书验证。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.5 敏感数据保护</h3>\n<h4> 1.5.1【必须】敏感信息访问</h4>\n<ul>\n<li>禁止将敏感信息硬编码在程序中，既可能会将敏感信息暴露给攻击者，也会增加代码管理和维护的难度</li>\n<li>使用配置中心系统统一托管密钥等敏感信息</li>\n</ul>\n<h4> 1.5.2【必须】敏感数据输出</h4>\n<ul>\n<li>只输出必要的最小数据集，避免多余字段暴露引起敏感信息泄露</li>\n<li>不能在日志保存密码（包括明文密码和密文密码）、密钥和其它敏感信息</li>\n<li>对于必须输出的敏感信息，必须进行合理脱敏展示</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>避免通过GET方法、代码注释、自动填充、缓存等方式泄露敏感信息</li>\n</ul>\n<h4> 1.5.3【必须】敏感数据存储</h4>\n<ul>\n<li>敏感数据应使用SHA2、RSA等算法进行加密存储</li>\n<li>敏感数据应使用独立的存储层，并在访问层开启访问控制</li>\n<li>包含敏感信息的临时文件或缓存一旦不再需要应立刻删除</li>\n</ul>\n<h4> 1.5.4【必须】异常处理和日志记录</h4>\n<ul>\n<li>应合理使用panic、recover、defer处理系统异常，避免出错信息输出到前端</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>对外环境禁止开启debug模式，或将程序运行日志输出到前端</li>\n</ul>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.6 加密解密</h3>\n<h4> 1.6.1【必须】不得硬编码密码/密钥</h4>\n<ul>\n<li>在进行用户登陆，加解密算法等操作时，不得在代码里硬编码密钥或密码，可通过变换算法或者配置等方式设置密码或者密钥。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.6.2【必须】密钥存储安全</h4>\n<ul>\n<li>在使用对称密码算法时，需要保护好加密密钥。当算法涉及敏感、业务数据时，可通过非对称算法协商加密密钥。其他较为不敏感的数据加密，可以通过变换算法等方式保护密钥。</li>\n</ul>\n<h4> 1.6.3【推荐】不使用弱密码算法</h4>\n<ul>\n<li>在使用加密算法时，不建议使用加密强度较弱的算法。</li>\n</ul>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.7 正则表达式</h3>\n<h4> 1.7.1【推荐】使用regexp进行正则表达式匹配</h4>\n<ul>\n<li>正则表达式编写不恰当可被用于DoS攻击，造成服务不可用，推荐使用regexp包进行正则表达式匹配。regexp保证了线性时间性能和优雅的失败：对解析器、编译器和执行引擎都进行了内存限制。但regexp不支持以下正则表达式特性，如业务依赖这些特性，则regexp不适合使用。\n<ul>\n<li>回溯引用<a href=\"https://www.regular-expressions.info/backref.html\" target=\"_blank\" rel=\"noopener noreferrer\">Backreferences</a></li>\n<li>查看<a href=\"https://www.regular-expressions.info/lookaround.html\" target=\"_blank\" rel=\"noopener noreferrer\">Lookaround</a></li>\n</ul>\n</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h2> 后台类</h2>\n<h3> 1.1 输入校验</h3>\n<h4> 1.1.1【必须】按类型进行数据校验</h4>\n<ul>\n<li>所有外部输入的参数，应使用<code>validator</code>进行白名单校验，校验内容包括但不限于数据长度、数据范围、数据类型与格式，校验不通过的应当拒绝</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>无法通过白名单校验的应使用<code>html.EscapeString</code>、<code>text/template</code>或<code>bluemonday</code>对<code>&lt;, &gt;, &amp;, ',\"</code>等字符进行过滤或编码</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.2 SQL操作</h3>\n<h4> 1.2.1【必须】SQL语句默认使用预编译并绑定变量</h4>\n<ul>\n<li>使用<code>database/sql</code>的prepare、Query或使用GORM等ORM执行SQL操作</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>使用参数化查询，禁止拼接SQL语句，另外对于传入参数用于order by或表名的需要通过校验</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.3 网络请求</h3>\n<h4> 1.3.1【必须】资源请求过滤验证</h4>\n<ul>\n<li>\n<p>使用<code>\"net/http\"</code>下的方法<code>http.Get(url)</code>、<code>http.Post(url, contentType, body)</code>、<code>http.Head(url)</code>、<code>http.PostForm(url, data)</code>、<code>http.Do(req)</code>时，如变量值外部可控（指从参数中动态获取），应对请求目标进行严格的安全校验。</p>\n</li>\n<li>\n<p>如请求资源域名归属固定的范围，如只允许<code>a.qq.com</code>和<code>b.qq.com</code>，应做白名单限制。如不适用白名单，则推荐的校验逻辑步骤是：</p>\n<ul>\n<li>\n<p>第 1 步、只允许HTTP或HTTPS协议</p>\n</li>\n<li>\n<p>第 2 步、解析目标URL，获取其HOST</p>\n</li>\n<li>\n<p>第 3 步、解析HOST，获取HOST指向的IP地址转换成Long型</p>\n</li>\n<li>\n<p>第 4 步、检查IP地址是否为内网IP，网段有：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>第 5 步、请求URL</p>\n</li>\n<li>\n<p>第 6 步、如有跳转，跳转后执行1，否则绑定经校验的ip和域名，对URL发起请求</p>\n</li>\n</ul>\n</li>\n<li>\n<p>官方库<code>encoding/xml</code>不支持外部实体引用，使用该库可避免xxe漏洞</p>\n</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.4 服务器端渲染</h3>\n<h4> 1.4.1【必须】模板渲染过滤验证</h4>\n<ul>\n<li>使用<code>text/template</code>或者<code>html/template</code>渲染模板时禁止将外部输入参数引入模板，或仅允许引入白名单内字符。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.5 Web跨域</h3>\n<h4> 1.5.1【必须】跨域资源共享CORS限制请求来源</h4>\n<ul>\n<li>CORS请求保护不当可导致敏感信息泄漏，因此应当严格设置Access-Control-Allow-Origin使用同源策略进行保护。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.6 响应输出</h3>\n<h4> 1.6.1 【必须】设置正确的HTTP响应包类型</h4>\n<ul>\n<li>响应头Content-Type与实际响应内容，应保持一致。如：API响应数据类型是json，则响应头使用<code>application/json</code>；若为xml，则设置为<code>text/xml</code>。</li>\n</ul>\n<h4> 1.6.2 【必须】添加安全响应头</h4>\n<ul>\n<li>所有接口、页面，添加响应头 <code>X-Content-Type-Options: nosniff</code>。</li>\n<li>所有接口、页面，添加响应头<code>X-Frame-Options</code>。按需合理设置其允许范围，包括：<code>DENY</code>、<code>SAMEORIGIN</code>、<code>ALLOW-FROM origin</code>。用法参考：<a href=\"https://developer.mozilla.org/zh-CN/docs/Web/HTTP/X-Frame-Options\" target=\"_blank\" rel=\"noopener noreferrer\">MDN文档</a></li>\n</ul>\n<h4> 1.6.3【必须】外部输入拼接到HTTP响应头中需进行过滤</h4>\n<ul>\n<li>应尽量避免外部可控参数拼接到HTTP响应头中，如业务需要则需要过滤掉<code>\\r</code>、<code>\\n</code>等换行符，或者拒绝携带换行符号的外部输入。</li>\n</ul>\n<h4> 1.6.4【必须】外部输入拼接到response页面前进行编码处理</h4>\n<ul>\n<li>直出html页面或使用模板生成html页面的，推荐使用<code>text/template</code>自动编码，或者使用<code>html.EscapeString</code>或<code>text/template</code>对<code>&lt;, &gt;, &amp;, ',\"</code>等字符进行编码。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.7 会话管理</h3>\n<h4> 1.7.1【必须】安全维护session信息</h4>\n<ul>\n<li>用户登录时应重新生成session，退出登录后应清理session。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.7.2【必须】CSRF防护</h4>\n<ul>\n<li>涉及系统敏感操作或可读取敏感信息的接口应校验<code>Referer</code>或添加<code>csrf_token</code>。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 1.8 访问控制</h3>\n<h4> 1.8.1【必须】默认鉴权</h4>\n<ul>\n<li>\n<p>除非资源完全可对外开放，否则系统默认进行身份认证，使用白名单的方式放开不需要认证的接口或页面。</p>\n</li>\n<li>\n<p>根据资源的机密程度和用户角色，以最小权限原则，设置不同级别的权限，如完全公开、登录可读、登录可写、特定用户可读、特定用户可写等</p>\n</li>\n<li>\n<p>涉及用户自身相关的数据的读写必须验证登录态用户身份及其权限，避免越权操作</p>\n<div class=\"language-sql line-numbers-mode\" data-ext=\"sql\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>没有独立账号体系的外网服务使用<code>QQ</code>或<code>微信</code>登录，内网服务使用<code>统一登录服务</code>登录，其他使用账号密码登录的服务需要增加验证码等二次验证</p>\n</li>\n</ul>\n<h3> 1.9 并发保护</h3>\n<h4> 1.9.1【必须】禁止在闭包中直接调用循环变量</h4>\n<ul>\n<li>在循环中启动协程，当协程中使用到了循环的索引值，由于多个协程同时使用同一个变量会产生数据竞争，造成执行结果异常。</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.9.2【必须】禁止并发写map</h4>\n<ul>\n<li>并发写map容易造成程序崩溃并异常退出，建议加锁保护</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 1.9.3【必须】确保并发安全</h4>\n<p>敏感操作如果未作并发安全限制，可导致数据读写异常，造成业务逻辑限制被绕过。可通过同步锁或者原子操作进行防护。</p>\n<p>通过同步锁共享内存</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>使用<code>sync/atomic</code>执行原子操作</li>\n</ul>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div>",
      "date_published": "2023-03-03T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言",
        "转载"
      ]
    },
    {
      "title": "Go语言编码规范-uber",
      "url": "https://Hexiaopi.github.io/go-language/reprint/uber-guide.html",
      "id": "https://Hexiaopi.github.io/go-language/reprint/uber-guide.html",
      "summary": "【转】原文链接",
      "content_html": "<p>【转】<a href=\"https://github.com/xxjwxc/uber_go_guide_cn\" target=\"_blank\" rel=\"noopener noreferrer\">原文链接</a></p>\n<!-- more -->\n<p>Uber Go 语言编码规范</p>\n<p><a href=\"https://www.uber.com/\" target=\"_blank\" rel=\"noopener noreferrer\">Uber</a> 是一家美国硅谷的科技公司，也是 Go 语言的早期 adopter。其开源了很多 golang 项目，诸如被 Gopher 圈熟知的 <a href=\"https://github.com/uber-go/zap\" target=\"_blank\" rel=\"noopener noreferrer\">zap</a>、<a href=\"https://github.com/jaegertracing/jaeger\" target=\"_blank\" rel=\"noopener noreferrer\">jaeger</a> 等。2018 年年末 Uber 将内部的 <a href=\"https://github.com/uber-go/guide\" target=\"_blank\" rel=\"noopener noreferrer\">Go 风格规范</a> 开源到 GitHub，经过一年的积累和更新，该规范已经初具规模，并受到广大 Gopher 的关注。本文是该规范的中文版本。本版本会根据原版实时更新。</p>\n<h2> 版本</h2>\n<ul>\n<li>当前更新版本：2022-10-19 版本地址：<a href=\"https://github.com/uber-go/guide/commit/4478e672bddf9d4f7ca4a561ab0779e08e469577\" target=\"_blank\" rel=\"noopener noreferrer\">commit:#158</a></li>\n<li>如果您发现任何更新、问题或改进，请随时 fork 和 PR</li>\n<li>Please feel free to fork and PR if you find any updates, issues or improvement.</li>\n</ul>\n<h2> 目录</h2>\n<ul>\n<li><a href=\"#%E7%89%88%E6%9C%AC\">版本</a></li>\n<li><a href=\"#%E7%9B%AE%E5%BD%95\">目录</a></li>\n<li><a href=\"#%E4%BB%8B%E7%BB%8D\">介绍</a></li>\n<li><a href=\"#%E6%8C%87%E5%AF%BC%E5%8E%9F%E5%88%99\">指导原则</a>\n<ul>\n<li><a href=\"#%E6%8C%87%E5%90%91-interface-%E7%9A%84%E6%8C%87%E9%92%88\">指向 interface 的指针</a></li>\n<li><a href=\"#interface-%E5%90%88%E7%90%86%E6%80%A7%E9%AA%8C%E8%AF%81\">Interface 合理性验证</a></li>\n<li><a href=\"#%E6%8E%A5%E6%94%B6%E5%99%A8-receiver-%E4%B8%8E%E6%8E%A5%E5%8F%A3\">接收器 (receiver) 与接口</a></li>\n<li><a href=\"#%E9%9B%B6%E5%80%BC-mutex-%E6%98%AF%E6%9C%89%E6%95%88%E7%9A%84\">零值 Mutex 是有效的</a></li>\n<li><a href=\"#%E5%9C%A8%E8%BE%B9%E7%95%8C%E5%A4%84%E6%8B%B7%E8%B4%9D-slices-%E5%92%8C-maps\">在边界处拷贝 Slices 和 Maps</a>\n<ul>\n<li><a href=\"#%E6%8E%A5%E6%94%B6-slices-%E5%92%8C-maps\">接收 Slices 和 Maps</a></li>\n<li><a href=\"#%E8%BF%94%E5%9B%9E-slices-%E6%88%96-maps\">返回 slices 或 maps</a></li>\n</ul>\n</li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8-defer-%E9%87%8A%E6%94%BE%E8%B5%84%E6%BA%90\">使用 defer 释放资源</a></li>\n<li><a href=\"#channel-%E7%9A%84-size-%E8%A6%81%E4%B9%88%E6%98%AF-1%E8%A6%81%E4%B9%88%E6%98%AF%E6%97%A0%E7%BC%93%E5%86%B2%E7%9A%84\">Channel 的 size 要么是 1，要么是无缓冲的</a></li>\n<li><a href=\"#%E6%9E%9A%E4%B8%BE%E4%BB%8E-1-%E5%BC%80%E5%A7%8B\">枚举从 1 开始</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8-time-%E5%A4%84%E7%90%86%E6%97%B6%E9%97%B4\">使用 time 处理时间</a>\n<ul>\n<li><a href=\"#%E4%BD%BF%E7%94%A8-timetime-%E8%A1%A8%E8%BE%BE%E7%9E%AC%E6%97%B6%E6%97%B6%E9%97%B4\">使用 <code>time.Time</code> 表达瞬时时间</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8-timeduration-%E8%A1%A8%E8%BE%BE%E6%97%B6%E9%97%B4%E6%AE%B5\">使用 <code>time.Duration</code> 表达时间段</a></li>\n<li><a href=\"#%E5%AF%B9%E5%A4%96%E9%83%A8%E7%B3%BB%E7%BB%9F%E4%BD%BF%E7%94%A8-timetime-%E5%92%8C-timeduration\">对外部系统使用 <code>time.Time</code> 和 <code>time.Duration</code></a></li>\n</ul>\n</li>\n<li><a href=\"#errors\">Errors</a>\n<ul>\n<li><a href=\"#%E9%94%99%E8%AF%AF%E7%B1%BB%E5%9E%8B\">错误类型</a></li>\n<li><a href=\"#%E9%94%99%E8%AF%AF%E5%8C%85%E8%A3%85\">错误包装</a></li>\n<li><a href=\"#%E9%94%99%E8%AF%AF%E5%91%BD%E5%90%8D\">错误命名</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%A4%84%E7%90%86%E6%96%AD%E8%A8%80%E5%A4%B1%E8%B4%A5\">处理断言失败</a></li>\n<li><a href=\"#%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-panic\">不要使用 panic</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8-gouberorgatomic\">使用 go.uber.org/atomic</a></li>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E5%8F%AF%E5%8F%98%E5%85%A8%E5%B1%80%E5%8F%98%E9%87%8F\">避免可变全局变量</a></li>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E5%9C%A8%E5%85%AC%E5%85%B1%E7%BB%93%E6%9E%84%E4%B8%AD%E5%B5%8C%E5%85%A5%E7%B1%BB%E5%9E%8B\">避免在公共结构中嵌入类型</a></li>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8%E5%86%85%E7%BD%AE%E5%90%8D%E7%A7%B0\">避免使用内置名称</a></li>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-init\">避免使用 <code>init()</code></a></li>\n<li><a href=\"#%E8%BF%BD%E5%8A%A0%E6%97%B6%E4%BC%98%E5%85%88%E6%8C%87%E5%AE%9A%E5%88%87%E7%89%87%E5%AE%B9%E9%87%8F\">追加时优先指定切片容量</a></li>\n<li><a href=\"#%E4%B8%BB%E5%87%BD%E6%95%B0%E9%80%80%E5%87%BA%E6%96%B9%E5%BC%8F-exit\">主函数退出方式 (Exit)</a>\n<ul>\n<li><a href=\"#%E4%B8%80%E6%AC%A1%E6%80%A7%E9%80%80%E5%87%BA\">一次性退出</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%9C%A8%E5%BA%8F%E5%88%97%E5%8C%96%E7%BB%93%E6%9E%84%E4%B8%AD%E4%BD%BF%E7%94%A8%E5%AD%97%E6%AE%B5%E6%A0%87%E8%AE%B0\">在序列化结构中使用字段标记</a></li>\n<li><a href=\"#%E4%B8%8D%E8%A6%81%E4%B8%80%E5%8A%B3%E6%B0%B8%E9%80%B8%E5%9C%B0%E4%BD%BF%E7%94%A8-goroutine\">不要一劳永逸地使用 goroutine</a>\n<ul>\n<li><a href=\"#%E7%AD%89%E5%BE%85-goroutines-%E9%80%80%E5%87%BA\">等待 goroutines 退出</a></li>\n<li><a href=\"#%E4%B8%8D%E8%A6%81%E5%9C%A8-init-%E4%BD%BF%E7%94%A8-goroutines\">不要在 <code>init()</code> 使用 goroutines</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E6%80%A7%E8%83%BD\">性能</a>\n<ul>\n<li><a href=\"#%E4%BC%98%E5%85%88%E4%BD%BF%E7%94%A8-strconv-%E8%80%8C%E4%B8%8D%E6%98%AF-fmt\">优先使用 strconv 而不是 fmt</a></li>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%88%B0%E5%AD%97%E8%8A%82%E7%9A%84%E8%BD%AC%E6%8D%A2\">避免字符串到字节的转换</a></li>\n<li><a href=\"#%E6%8C%87%E5%AE%9A%E5%AE%B9%E5%99%A8%E5%AE%B9%E9%87%8F\">指定容器容量</a>\n<ul>\n<li><a href=\"#%E6%8C%87%E5%AE%9Amap%E5%AE%B9%E9%87%8F%E6%8F%90%E7%A4%BA\">指定Map容量提示</a></li>\n<li><a href=\"#%E6%8C%87%E5%AE%9A%E5%88%87%E7%89%87%E5%AE%B9%E9%87%8F\">指定切片容量</a></li>\n</ul>\n</li>\n</ul>\n</li>\n<li><a href=\"#%E8%A7%84%E8%8C%83\">规范</a>\n<ul>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E8%BF%87%E9%95%BF%E7%9A%84%E8%A1%8C\">避免过长的行</a></li>\n<li><a href=\"#%E4%B8%80%E8%87%B4%E6%80%A7\">一致性</a></li>\n<li><a href=\"#%E7%9B%B8%E4%BC%BC%E7%9A%84%E5%A3%B0%E6%98%8E%E6%94%BE%E5%9C%A8%E4%B8%80%E7%BB%84\">相似的声明放在一组</a></li>\n<li><a href=\"#import-%E5%88%86%E7%BB%84\">import 分组</a></li>\n<li><a href=\"#%E5%8C%85%E5%90%8D\">包名</a></li>\n<li><a href=\"#%E5%87%BD%E6%95%B0%E5%90%8D\">函数名</a></li>\n<li><a href=\"#%E5%AF%BC%E5%85%A5%E5%88%AB%E5%90%8D\">导入别名</a></li>\n<li><a href=\"#%E5%87%BD%E6%95%B0%E5%88%86%E7%BB%84%E4%B8%8E%E9%A1%BA%E5%BA%8F\">函数分组与顺序</a></li>\n<li><a href=\"#%E5%87%8F%E5%B0%91%E5%B5%8C%E5%A5%97\">减少嵌套</a></li>\n<li><a href=\"#%E4%B8%8D%E5%BF%85%E8%A6%81%E7%9A%84-else\">不必要的 else</a></li>\n<li><a href=\"#%E9%A1%B6%E5%B1%82%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E\">顶层变量声明</a></li>\n<li><a href=\"#%E5%AF%B9%E4%BA%8E%E6%9C%AA%E5%AF%BC%E5%87%BA%E7%9A%84%E9%A1%B6%E5%B1%82%E5%B8%B8%E9%87%8F%E5%92%8C%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8_%E4%BD%9C%E4%B8%BA%E5%89%8D%E7%BC%80\">对于未导出的顶层常量和变量，使用_作为前缀</a></li>\n<li><a href=\"#%E7%BB%93%E6%9E%84%E4%BD%93%E4%B8%AD%E7%9A%84%E5%B5%8C%E5%85%A5\">结构体中的嵌入</a></li>\n<li><a href=\"#%E6%9C%AC%E5%9C%B0%E5%8F%98%E9%87%8F%E5%A3%B0%E6%98%8E\">本地变量声明</a></li>\n<li><a href=\"#nil-%E6%98%AF%E4%B8%80%E4%B8%AA%E6%9C%89%E6%95%88%E7%9A%84-slice\">nil 是一个有效的 slice</a></li>\n<li><a href=\"#%E7%BC%A9%E5%B0%8F%E5%8F%98%E9%87%8F%E4%BD%9C%E7%94%A8%E5%9F%9F\">缩小变量作用域</a></li>\n<li><a href=\"#%E9%81%BF%E5%85%8D%E5%8F%82%E6%95%B0%E8%AF%AD%E4%B9%89%E4%B8%8D%E6%98%8E%E7%A1%AE-avoid-naked-parameters\">避免参数语义不明确 (Avoid Naked Parameters)</a></li>\n<li><a href=\"#%E4%BD%BF%E7%94%A8%E5%8E%9F%E5%A7%8B%E5%AD%97%E7%AC%A6%E4%B8%B2%E5%AD%97%E9%9D%A2%E5%80%BC%E9%81%BF%E5%85%8D%E8%BD%AC%E4%B9%89\">使用原始字符串字面值，避免转义</a></li>\n<li><a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%93%E6%9E%84%E4%BD%93\">初始化结构体</a>\n<ul>\n<li><a href=\"#%E4%BD%BF%E7%94%A8%E5%AD%97%E6%AE%B5%E5%90%8D%E5%88%9D%E5%A7%8B%E5%8C%96%E7%BB%93%E6%9E%84\">使用字段名初始化结构</a></li>\n<li><a href=\"#%E7%9C%81%E7%95%A5%E7%BB%93%E6%9E%84%E4%B8%AD%E7%9A%84%E9%9B%B6%E5%80%BC%E5%AD%97%E6%AE%B5\">省略结构中的零值字段</a></li>\n<li><a href=\"#%E5%AF%B9%E9%9B%B6%E5%80%BC%E7%BB%93%E6%9E%84%E4%BD%BF%E7%94%A8-var\">对零值结构使用 <code>var</code></a></li>\n<li><a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96-struct-%E5%BC%95%E7%94%A8\">初始化 Struct 引用</a></li>\n</ul>\n</li>\n<li><a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96-maps\">初始化 Maps</a></li>\n<li><a href=\"#%E5%AD%97%E7%AC%A6%E4%B8%B2-string-format\">字符串 string format</a></li>\n<li><a href=\"#%E5%91%BD%E5%90%8D-printf-%E6%A0%B7%E5%BC%8F%E7%9A%84%E5%87%BD%E6%95%B0\">命名 Printf 样式的函数</a></li>\n</ul>\n</li>\n<li><a href=\"#%E7%BC%96%E7%A8%8B%E6%A8%A1%E5%BC%8F\">编程模式</a>\n<ul>\n<li><a href=\"#%E8%A1%A8%E9%A9%B1%E5%8A%A8%E6%B5%8B%E8%AF%95\">表驱动测试</a></li>\n<li><a href=\"#%E5%8A%9F%E8%83%BD%E9%80%89%E9%A1%B9\">功能选项</a></li>\n</ul>\n</li>\n<li><a href=\"#linting\">Linting</a>\n<ul>\n<li><a href=\"#lint-runners\">Lint Runners</a></li>\n</ul>\n</li>\n<li><a href=\"#stargazers-over-time\">Stargazers over time</a></li>\n</ul>\n<h2> 介绍</h2>\n<p>样式 (style) 是支配我们代码的惯例。术语<code>样式</code>有点用词不当，因为这些约定涵盖的范围不限于由 gofmt 替我们处理的源文件格式。</p>\n<p>本指南的目的是通过详细描述在 Uber 编写 Go 代码的注意事项来管理这种复杂性。这些规则的存在是为了使代码库易于管理，同时仍然允许工程师更有效地使用 Go 语言功能。</p>\n<p>该指南最初由 <a href=\"https://github.com/prashantv\" target=\"_blank\" rel=\"noopener noreferrer\">Prashant Varanasi</a> 和 <a href=\"https://github.com/nomis52\" target=\"_blank\" rel=\"noopener noreferrer\">Simon Newton</a> 编写，目的是使一些同事能快速使用 Go。多年来，该指南已根据其他人的反馈进行了修改。</p>\n<p>本文档记录了我们在 Uber 遵循的 Go 代码中的惯用约定。其中许多是 Go 的通用准则，而其他扩展准则依赖于下面外部的指南：</p>\n<ol>\n<li><a href=\"https://golang.org/doc/effective_go.html\" target=\"_blank\" rel=\"noopener noreferrer\">Effective Go</a></li>\n<li><a href=\"https://github.com/golang/go/wiki/CommonMistakes\" target=\"_blank\" rel=\"noopener noreferrer\">Go Common Mistakes</a></li>\n<li><a href=\"https://github.com/golang/go/wiki/CodeReviewComments\" target=\"_blank\" rel=\"noopener noreferrer\">Go Code Review Comments</a></li>\n</ol>\n<p>我们的目标是使代码示例能够准确地用于Go的两个发布版本 <a href=\"https://go.dev/doc/devel/release\" target=\"_blank\" rel=\"noopener noreferrer\">releases</a>.</p>\n<p>所有代码都应该通过<code>golint</code>和<code>go vet</code>的检查并无错误。我们建议您将编辑器设置为：</p>\n<ul>\n<li>保存时运行 <code>goimports</code></li>\n<li>运行 <code>golint</code> 和 <code>go vet</code> 检查错误</li>\n</ul>\n<p>您可以在以下 Go 编辑器工具支持页面中找到更为详细的信息：<br>\n<a href=\"https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins\" target=\"_blank\" rel=\"noopener noreferrer\">https://github.com/golang/go/wiki/IDEsAndTextEditorPlugins</a></p>\n<h2> 指导原则</h2>\n<h3> 指向 interface 的指针</h3>\n<p>您几乎不需要指向接口类型的指针。您应该将接口作为值进行传递，在这样的传递过程中，实质上传递的底层数据仍然可以是指针。</p>\n<p>接口实质上在底层用两个字段表示：</p>\n<ol>\n<li>一个指向某些特定类型信息的指针。您可以将其视为\"type\"。</li>\n<li>数据指针。如果存储的数据是指针，则直接存储。如果存储的数据是一个值，则存储指向该值的指针。</li>\n</ol>\n<p>如果希望接口方法修改基础数据，则必须使用指针传递 (将对象指针赋值给接口变量)。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> Interface 合理性验证</h3>\n<p>在编译时验证接口的符合性。这包括：</p>\n<ul>\n<li>将实现特定接口的导出类型作为接口 API 的一部分进行检查</li>\n<li>实现同一接口的 (导出和非导出) 类型属于实现类型的集合</li>\n<li>任何违反接口合理性检查的场景，都会终止编译，并通知给用户</li>\n</ul>\n<p>补充：上面 3 条是编译器对接口的检查机制，<br>\n大体意思是错误使用接口会在编译期报错。<br>\n所以可以利用这个机制让部分问题在编译期暴露。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>如果 <code>*Handler</code> 与 <code>http.Handler</code> 的接口不匹配，<br>\n那么语句 <code>var _ http.Handler = (*Handler)(nil)</code> 将无法编译通过。</p>\n<p>赋值的右边应该是断言类型的零值。<br>\n对于指针类型（如 <code>*Handler</code>）、切片和映射，这是 <code>nil</code>；<br>\n对于结构类型，这是空结构。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 接收器 (receiver) 与接口</h3>\n<p>使用值接收器的方法既可以通过值调用，也可以通过指针调用。</p>\n<p>带指针接收器的方法只能通过指针或 <a href=\"https://golang.org/ref/spec#Method_values\" target=\"_blank\" rel=\"noopener noreferrer\">addressable values</a> 调用。</p>\n<p>例如，</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>类似的，即使方法有了值接收器，也同样可以用指针接收器来满足接口。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><a href=\"https://golang.org/doc/effective_go.html\" target=\"_blank\" rel=\"noopener noreferrer\">Effective Go</a> 中有一段关于 <a href=\"https://golang.org/doc/effective_go.html#pointers_vs_values\" target=\"_blank\" rel=\"noopener noreferrer\">pointers vs. values</a> 的精彩讲解。</p>\n<p>补充：</p>\n<ul>\n<li>一个类型可以有值接收器方法集和指针接收器方法集\n<ul>\n<li>值接收器方法集是指针接收器方法集的子集，反之不是</li>\n</ul>\n</li>\n<li>规则\n<ul>\n<li>值对象只可以使用值接收器方法集</li>\n<li>指针对象可以使用 值接收器方法集 + 指针接收器方法集</li>\n</ul>\n</li>\n<li>接口的匹配 (或者叫实现)\n<ul>\n<li>类型实现了接口的所有方法，叫匹配</li>\n<li>具体的讲，要么是类型的值方法集匹配接口，要么是指针方法集匹配接口</li>\n</ul>\n</li>\n</ul>\n<p>具体的匹配分两种：</p>\n<ul>\n<li>值方法集和接口匹配\n<ul>\n<li>给接口变量赋值的不管是值还是指针对象，都 ok，因为都包含值方法集</li>\n</ul>\n</li>\n<li>指针方法集和接口匹配\n<ul>\n<li>只能将指针对象赋值给接口变量，因为只有指针方法集和接口匹配</li>\n<li>如果将值对象赋值给接口变量，会在编译期报错 (会触发接口合理性检查机制)</li>\n</ul>\n</li>\n</ul>\n<p>为啥 i = s2Val 会报错，因为值方法集和接口不匹配。</p>\n<h3> 零值 Mutex 是有效的</h3>\n<p>零值 <code>sync.Mutex</code> 和 <code>sync.RWMutex</code> 是有效的。所以指向 mutex 的指针基本是不必要的。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>如果你使用结构体指针，mutex 应该作为结构体的非指针字段。即使该结构体不被导出，也不要直接把 mutex 嵌入到结构体中。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<p><code>Mutex</code> 字段， <code>Lock</code> 和 <code>Unlock</code> 方法是 <code>SMap</code> 导出的 API 中不刻意说明的一部分。</p>\n </td><td>\n<p>mutex 及其方法是 <code>SMap</code> 的实现细节，对其调用者不可见。</p>\n </td></tr>\n </tbody></table>\n<h3> 在边界处拷贝 Slices 和 Maps</h3>\n<p>slices 和 maps 包含了指向底层数据的指针，因此在需要复制它们时要特别注意。</p>\n<h4> 接收 Slices 和 Maps</h4>\n<p>请记住，当 map 或 slice 作为函数参数传入时，如果您存储了对它们的引用，则用户可以对其进行修改。</p>\n<table>\n<thead><tr><th>Bad</th> <th>Good</th></tr></thead>\n<tbody>\n<tr>\n<td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td>\n<td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td>\n</tr>\n</tbody>\n</table>\n<h4> 返回 slices 或 maps</h4>\n<p>同样，请注意用户对暴露内部状态的 map 或 slice 的修改。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 使用 defer 释放资源</h3>\n<p>使用 defer 释放资源，诸如文件和锁。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>Defer 的开销非常小，只有在您可以证明函数执行时间处于纳秒级的程度时，才应避免这样做。使用 defer 提升可读性是值得的，因为使用它们的成本微不足道。尤其适用于那些不仅仅是简单内存访问的较大的方法，在这些方法中其他计算的资源消耗远超过 <code>defer</code>。</p>\n<h3> Channel 的 size 要么是 1，要么是无缓冲的</h3>\n<p>channel 通常 size 应为 1 或是无缓冲的。默认情况下，channel 是无缓冲的，其 size 为零。任何其他尺寸都必须经过严格的审查。我们需要考虑如何确定大小，考虑是什么阻止了 channel 在高负载下和阻塞写时的写入，以及当这种情况发生时系统逻辑有哪些变化。(翻译解释：按照原文意思是需要界定通道边界，竞态条件，以及逻辑上下文梳理)</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 枚举从 1 开始</h3>\n<p>在 Go 中引入枚举的标准方法是声明一个自定义类型和一个使用了 iota 的 const 组。由于变量的默认值为 0，因此通常应以非零值开头枚举。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>在某些情况下，使用零值是有意义的（枚举从零开始），例如，当零值是理想的默认行为时。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 使用 time 处理时间</h3>\n<p>时间处理很复杂。关于时间的错误假设通常包括以下几点。</p>\n<ol>\n<li>一天有 24 小时</li>\n<li>一小时有 60 分钟</li>\n<li>一周有七天</li>\n<li>一年 365 天</li>\n<li><a href=\"https://infiniteundo.com/post/25326999628/falsehoods-programmers-believe-about-time\" target=\"_blank\" rel=\"noopener noreferrer\">还有更多</a></li>\n</ol>\n<p>例如，<em>1</em> 表示在一个时间点上加上 24 小时并不总是产生一个新的日历日。</p>\n<p>因此，在处理时间时始终使用 <a href=\"https://golang.org/pkg/time/\" target=\"_blank\" rel=\"noopener noreferrer\"><code>\"time\"</code></a> 包，因为它有助于以更安全、更准确的方式处理这些不正确的假设。</p>\n<h4> 使用 <code>time.Time</code> 表达瞬时时间</h4>\n<p>在处理时间的瞬间时使用 <a href=\"https://golang.org/pkg/time/#Time\" target=\"_blank\" rel=\"noopener noreferrer\"><code>time.Time</code></a>，在比较、添加或减去时间时使用 <code>time.Time</code> 中的方法。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h4> 使用 <code>time.Duration</code> 表达时间段</h4>\n<p>在处理时间段时使用 <a href=\"https://golang.org/pkg/time/#Duration\" target=\"_blank\" rel=\"noopener noreferrer\"><code>time.Duration</code></a> .</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>回到第一个例子，在一个时间瞬间加上 24 小时，我们用于添加时间的方法取决于意图。如果我们想要下一个日历日 (当前天的下一天) 的同一个时间点，我们应该使用 <a href=\"https://golang.org/pkg/time/#Time.AddDate\" target=\"_blank\" rel=\"noopener noreferrer\"><code>Time.AddDate</code></a>。但是，如果我们想保证某一时刻比前一时刻晚 24 小时，我们应该使用 <a href=\"https://golang.org/pkg/time/#Time.Add\" target=\"_blank\" rel=\"noopener noreferrer\"><code>Time.Add</code></a>。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 对外部系统使用 <code>time.Time</code> 和 <code>time.Duration</code></h4>\n<p>尽可能在与外部系统的交互中使用 <code>time.Duration</code> 和 <code>time.Time</code> 例如 :</p>\n<ul>\n<li>\n<p>Command-line 标志: <a href=\"https://golang.org/pkg/flag/\" target=\"_blank\" rel=\"noopener noreferrer\"><code>flag</code></a> 通过 <a href=\"https://golang.org/pkg/time/#ParseDuration\" target=\"_blank\" rel=\"noopener noreferrer\"><code>time.ParseDuration</code></a> 支持 <code>time.Duration</code></p>\n</li>\n<li>\n<p>JSON: <a href=\"https://golang.org/pkg/encoding/json/\" target=\"_blank\" rel=\"noopener noreferrer\"><code>encoding/json</code></a> 通过其 <a href=\"https://golang.org/pkg/time/#Time.UnmarshalJSON\" target=\"_blank\" rel=\"noopener noreferrer\"><code>UnmarshalJSON</code> method</a> 方法支持将 <code>time.Time</code> 编码为 <a href=\"https://tools.ietf.org/html/rfc3339\" target=\"_blank\" rel=\"noopener noreferrer\">RFC 3339</a> 字符串</p>\n</li>\n<li>\n<p>SQL: <a href=\"https://golang.org/pkg/database/sql/\" target=\"_blank\" rel=\"noopener noreferrer\"><code>database/sql</code></a> 支持将 <code>DATETIME</code> 或 <code>TIMESTAMP</code> 列转换为 <code>time.Time</code>，如果底层驱动程序支持则返回</p>\n</li>\n<li>\n<p>YAML: <a href=\"https://godoc.org/gopkg.in/yaml.v2\" target=\"_blank\" rel=\"noopener noreferrer\"><code>gopkg.in/yaml.v2</code></a> 支持将 <code>time.Time</code> 作为 <a href=\"https://tools.ietf.org/html/rfc3339\" target=\"_blank\" rel=\"noopener noreferrer\">RFC 3339</a> 字符串，并通过 <a href=\"https://golang.org/pkg/time/#ParseDuration\" target=\"_blank\" rel=\"noopener noreferrer\"><code>time.ParseDuration</code></a> 支持 <code>time.Duration</code>。</p>\n</li>\n</ul>\n<p>当不能在这些交互中使用 <code>time.Duration</code> 时，请使用 <code>int</code> 或 <code>float64</code>，并在字段名称中包含单位。</p>\n<p>例如，由于 <code>encoding/json</code> 不支持 <code>time.Duration</code>，因此该单位包含在字段的名称中。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>当在这些交互中不能使用 <code>time.Time</code> 时，除非达成一致，否则使用 <code>string</code> 和 <a href=\"https://tools.ietf.org/html/rfc3339\" target=\"_blank\" rel=\"noopener noreferrer\">RFC 3339</a> 中定义的格式时间戳。默认情况下，<a href=\"https://golang.org/pkg/time/#Time.UnmarshalText\" target=\"_blank\" rel=\"noopener noreferrer\"><code>Time.UnmarshalText</code></a> 使用此格式，并可通过 <a href=\"https://golang.org/pkg/time/#RFC3339\" target=\"_blank\" rel=\"noopener noreferrer\"><code>time.RFC3339</code></a> 在 <code>Time.Format</code> 和 <code>time.Parse</code> 中使用。</p>\n<p>尽管这在实践中并不成问题，但请记住，<code>\"time\"</code> 包不支持解析闰秒时间戳（<a href=\"https://github.com/golang/go/issues/8728\" target=\"_blank\" rel=\"noopener noreferrer\">8728</a>），也不在计算中考虑闰秒（<a href=\"https://github.com/golang/go/issues/15190\" target=\"_blank\" rel=\"noopener noreferrer\">15190</a>）。如果您比较两个时间瞬间，则差异将不包括这两个瞬间之间可能发生的闰秒。</p>\n<!-- TODO: section on String methods for enums -->\n<h3> Errors</h3>\n<h4> 错误类型</h4>\n<p>声明错误的选项很少。<br>\n在选择最适合您的用例的选项之前，请考虑以下事项。</p>\n<ul>\n<li>调用者是否需要匹配错误以便他们可以处理它？<br>\n如果是，我们必须通过声明顶级错误变量或自定义类型来支持 <a href=\"https://golang.org/pkg/errors/#Is\" target=\"_blank\" rel=\"noopener noreferrer\"><code>errors.Is</code></a> 或 <a href=\"https://golang.org/pkg/errors/#As\" target=\"_blank\" rel=\"noopener noreferrer\"><code>errors.As</code></a> 函数。</li>\n<li>错误消息是否为静态字符串，还是需要上下文信息的动态字符串？<br>\n如果是静态字符串，我们可以使用 <a href=\"https://golang.org/pkg/errors/#New\" target=\"_blank\" rel=\"noopener noreferrer\"><code>errors.New</code></a>，但对于后者，我们必须使用 <a href=\"https://golang.org/pkg/fmt/#Errorf\" target=\"_blank\" rel=\"noopener noreferrer\"><code>fmt.Errorf</code></a> 或自定义错误类型。</li>\n<li>我们是否正在传递由下游函数返回的新错误？<br>\n如果是这样，请参阅<a href=\"#%E9%94%99%E8%AF%AF%E5%8C%85%E8%A3%85\">错误包装部分</a>。</li>\n</ul>\n<table>\n<thead>\n<tr>\n<th>错误匹配？</th>\n<th>错误消息</th>\n<th>指导</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>No</td>\n<td>static</td>\n<td><a href=\"https://golang.org/pkg/errors/#New\" target=\"_blank\" rel=\"noopener noreferrer\"><code>errors.New</code></a></td>\n</tr>\n<tr>\n<td>No</td>\n<td>dynamic</td>\n<td><a href=\"https://golang.org/pkg/fmt/#Errorf\" target=\"_blank\" rel=\"noopener noreferrer\"><code>fmt.Errorf</code></a></td>\n</tr>\n<tr>\n<td>Yes</td>\n<td>static</td>\n<td>top-level <code>var</code> with <a href=\"https://golang.org/pkg/errors/#New\" target=\"_blank\" rel=\"noopener noreferrer\"><code>errors.New</code></a></td>\n</tr>\n<tr>\n<td>Yes</td>\n<td>dynamic</td>\n<td>custom <code>error</code> type</td>\n</tr>\n</tbody>\n</table>\n<p>例如，<br>\n使用 <a href=\"https://golang.org/pkg/errors/#New\" target=\"_blank\" rel=\"noopener noreferrer\"><code>errors.New</code></a> 表示带有静态字符串的错误。<br>\n如果调用者需要匹配并处理此错误，则将此错误导出为变量以支持将其与 <code>errors.Is</code> 匹配。</p>\n<table>\n<thead><tr><th>无错误匹配</th><th>错误匹配</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>对于动态字符串的错误，<br>\n如果调用者不需要匹配它，则使用 <a href=\"https://golang.org/pkg/fmt/#Errorf\" target=\"_blank\" rel=\"noopener noreferrer\"><code>fmt.Errorf</code></a>，<br>\n如果调用者确实需要匹配它，则自定义 <code>error</code>。</p>\n<table>\n<thead><tr><th>无错误匹配</th><th>错误匹配</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>请注意，如果您从包中导出错误变量或类型，<br>\n它们将成为包的公共 API 的一部分。</p>\n<h4> 错误包装</h4>\n<p>如果调用其他方法时出现错误, 通常有三种处理方式可以选择：</p>\n<ul>\n<li>将原始错误原样返回</li>\n<li>使用 <code>fmt.Errorf</code> 搭配 <code>%w</code> 将错误添加进上下文后返回</li>\n<li>使用 <code>fmt.Errorf</code> 搭配 <code>%v</code> 将错误添加进上下文后返回</li>\n</ul>\n<p>如果没有要添加的其他上下文，则按原样返回原始错误。<br>\n这将保留原始错误类型和消息。<br>\n这非常适合底层错误消息有足够的信息来追踪它来自哪里的错误。</p>\n<p>否则，尽可能在错误消息中添加上下文<br>\n这样就不会出现诸如“连接被拒绝”之类的模糊错误，<br>\n您会收到更多有用的错误，例如“调用服务 foo：连接被拒绝”。</p>\n<p>使用 <code>fmt.Errorf</code> 为你的错误添加上下文，<br>\n根据调用者是否应该能够匹配和提取根本原因，在 <code>%w</code> 或 <code>%v</code> 动词之间进行选择。</p>\n<ul>\n<li>如果调用者应该可以访问底层错误，请使用 <code>%w</code>。<br>\n对于大多数包装错误，这是一个很好的默认值，<br>\n但请注意，调用者可能会开始依赖此行为。因此，对于包装错误是已知<code>var</code>或类型的情况，请将其作为函数契约的一部分进行记录和测试。</li>\n<li>使用 <code>%v</code> 来混淆底层错误。<br>\n调用者将无法匹配它，但如果需要，您可以在将来切换到 <code>%w</code>。</li>\n</ul>\n<p>在为返回的错误添加上下文时，通过避免使用\"failed to\"之类的短语来保持上下文简洁，当错误通过堆栈向上渗透时，它会一层一层被堆积起来：</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr><tr><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>然而，一旦错误被发送到另一个系统，应该清楚消息是一个错误（例如<code>err</code> 标签或日志中的\"Failed\"前缀）。</p>\n<p>另见 <a href=\"https://dave.cheney.net/2016/04/27/dont-just-check-errors-handle-them-gracefully\" target=\"_blank\" rel=\"noopener noreferrer\">不要只检查错误，优雅地处理它们</a>。</p>\n<h4> 错误命名</h4>\n<p>对于存储为全局变量的错误值，<br>\n根据是否导出，使用前缀 <code>Err</code> 或 <code>err</code>。<br>\n请看指南 <a href=\"#%E5%AF%B9%E4%BA%8E%E6%9C%AA%E5%AF%BC%E5%87%BA%E7%9A%84%E9%A1%B6%E5%B1%82%E5%B8%B8%E9%87%8F%E5%92%8C%E5%8F%98%E9%87%8F%E4%BD%BF%E7%94%A8_%E4%BD%9C%E4%B8%BA%E5%89%8D%E7%BC%80\">对于未导出的顶层常量和变量，使用_作为前缀</a>。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>对于自定义错误类型，请改用后缀 <code>Error</code>。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 处理断言失败</h3>\n<p><a href=\"https://golang.org/ref/spec#Type_assertions\" target=\"_blank\" rel=\"noopener noreferrer\">类型断言</a> 将会在检测到不正确的类型时，以单一返回值形式返回 panic。 因此，请始终使用“逗号 ok”习语。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<!-- TODO: There are a few situations where the single assignment form is\nfine. -->\n<h3> 不要使用 panic</h3>\n<p>在生产环境中运行的代码必须避免出现 panic。panic 是 <a href=\"https://en.wikipedia.org/wiki/Cascading_failure\" target=\"_blank\" rel=\"noopener noreferrer\">级联失败</a> 的主要根源 。如果发生错误，该函数必须返回错误，并允许调用方决定如何处理它。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>panic/recover 不是错误处理策略。仅当发生不可恢复的事情（例如：nil 引用）时，程序才必须 panic。程序初始化是一个例外：程序启动时应使程序中止的不良情况可能会引起 panic。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>即使在测试代码中，也优先使用<code>t.Fatal</code>或者<code>t.FailNow</code>而不是 panic 来确保失败被标记。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<!-- TODO: Explain how to use _test packages. -->\n<h3> 使用 <a href=\"http://go.uber.org/atomic\" target=\"_blank\" rel=\"noopener noreferrer\">go.uber.org/atomic</a></h3>\n<p>使用 <a href=\"https://golang.org/pkg/sync/atomic/\" target=\"_blank\" rel=\"noopener noreferrer\">sync/atomic</a> 包的原子操作对原始类型 (<code>int32</code>, <code>int64</code>等）进行操作，因为很容易忘记使用原子操作来读取或修改变量。</p>\n<p><a href=\"https://godoc.org/go.uber.org/atomic\" target=\"_blank\" rel=\"noopener noreferrer\">go.uber.org/atomic</a> 通过隐藏基础类型为这些操作增加了类型安全性。此外，它包括一个方便的<code>atomic.Bool</code>类型。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 避免可变全局变量</h3>\n<p>使用选择依赖注入方式避免改变全局变量。<br>\n既适用于函数指针又适用于其他值类型</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 避免在公共结构中嵌入类型</h3>\n<p>这些嵌入的类型泄漏实现细节、禁止类型演化和模糊的文档。</p>\n<p>假设您使用共享的 <code>AbstractList</code> 实现了多种列表类型，请避免在具体的列表实现中嵌入 <code>AbstractList</code>。<br>\n相反，只需手动将方法写入具体的列表，该列表将委托给抽象列表。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>Go 允许 <a href=\"https://golang.org/doc/effective_go.html#embedding\" target=\"_blank\" rel=\"noopener noreferrer\">类型嵌入</a> 作为继承和组合之间的折衷。外部类型获取嵌入类型的方法的隐式副本。默认情况下，这些方法委托给嵌入实例的同一方法。</p>\n<p>结构还获得与类型同名的字段。<br>\n所以，如果嵌入的类型是 public，那么字段是 public。为了保持向后兼容性，外部类型的每个未来版本都必须保留嵌入类型。</p>\n<p>很少需要嵌入类型。<br>\n这是一种方便，可以帮助您避免编写冗长的委托方法。</p>\n<p>即使嵌入兼容的抽象列表 <em>interface</em>，而不是结构体，这将为开发人员提供更大的灵活性来改变未来，但仍然泄露了具体列表使用抽象实现的细节。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>无论是使用嵌入结构还是嵌入接口，都会限制类型的演化。</p>\n<ul>\n<li>向嵌入接口添加方法是一个破坏性的改变。</li>\n<li>从嵌入结构体删除方法是一个破坏性改变。</li>\n<li>删除嵌入类型是一个破坏性的改变。</li>\n<li>即使使用满足相同接口的类型替换嵌入类型，也是一个破坏性的改变。</li>\n</ul>\n<p>尽管编写这些委托方法是乏味的，但是额外的工作隐藏了实现细节，留下了更多的更改机会，还消除了在文档中发现完整列表接口的间接性操作。</p>\n<h3> 避免使用内置名称</h3>\n<p>Go <a href=\"https://golang.org/ref/spec\" target=\"_blank\" rel=\"noopener noreferrer\">语言规范</a> 概述了几个内置的，<br>\n不应在 Go 项目中使用的 <a href=\"https://golang.org/ref/spec#Predeclared_identifiers\" target=\"_blank\" rel=\"noopener noreferrer\">预先声明的标识符</a>。</p>\n<p>根据上下文的不同，将这些标识符作为名称重复使用，<br>\n将在当前作用域（或任何嵌套作用域）中隐藏原始标识符，或者混淆代码。<br>\n在最好的情况下，编译器会报错；在最坏的情况下，这样的代码可能会引入潜在的、难以恢复的错误。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>注意，编译器在使用预先分隔的标识符时不会生成错误，<br>\n但是诸如<code>go vet</code>之类的工具会正确地指出这些和其他情况下的隐式问题。</p>\n<h3> 避免使用 <code>init()</code></h3>\n<p>尽可能避免使用<code>init()</code>。当<code>init()</code>是不可避免或可取的，代码应先尝试：</p>\n<ol>\n<li>无论程序环境或调用如何，都要完全确定。</li>\n<li>避免依赖于其他<code>init()</code>函数的顺序或副作用。虽然<code>init()</code>顺序是明确的，但代码可以更改，<br>\n因此<code>init()</code>函数之间的关系可能会使代码变得脆弱和容易出错。</li>\n<li>避免访问或操作全局或环境状态，如机器信息、环境变量、工作目录、程序参数/输入等。</li>\n<li>避免<code>I/O</code>，包括文件系统、网络和系统调用。</li>\n</ol>\n<p>不能满足这些要求的代码可能属于要作为<code>main()</code>调用的一部分（或程序生命周期中的其他地方），<br>\n或者作为<code>main()</code>本身的一部分写入。特别是，打算由其他程序使用的库应该特别注意完全确定性，<br>\n而不是执行“init magic”</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>考虑到上述情况，在某些情况下，<code>init()</code>可能更可取或是必要的，可能包括：</p>\n<ul>\n<li>\n<p>不能表示为单个赋值的复杂表达式。</p>\n</li>\n<li>\n<p>可插入的钩子，如<code>database/sql</code>、编码类型注册表等。</p>\n</li>\n<li>\n<p>对 <a href=\"https://cloud.google.com/functions/docs/bestpractices/tips#use_global_variables_to_reuse_objects_in_future_invocations\" target=\"_blank\" rel=\"noopener noreferrer\">Google Cloud Functions</a> 和其他形式的确定性预计算的优化。</p>\n</li>\n</ul>\n<h3> 追加时优先指定切片容量</h3>\n<p>追加时优先指定切片容量</p>\n<p>在尽可能的情况下，在初始化要追加的切片时为<code>make()</code>提供一个容量值。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 主函数退出方式 (Exit)</h3>\n<p>Go 程序使用 <a href=\"https://golang.org/pkg/os/#Exit\" target=\"_blank\" rel=\"noopener noreferrer\"><code>os.Exit</code></a> 或者 <a href=\"https://golang.org/pkg/log/#Fatal\" target=\"_blank\" rel=\"noopener noreferrer\"><code>log.Fatal*</code></a> 立即退出 (使用<code>panic</code>不是退出程序的好方法，请 <a href=\"#%E4%B8%8D%E8%A6%81%E4%BD%BF%E7%94%A8-panic\">不要使用 panic</a>。)</p>\n<p><strong>仅在<code>main()</code></strong> 中调用其中一个 <code>os.Exit</code> 或者 <code>log.Fatal*</code>。所有其他函数应将错误返回到信号失败中。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>原则上：退出的具有多种功能的程序存在一些问题：</p>\n<ul>\n<li>不明显的控制流：任何函数都可以退出程序，因此很难对控制流进行推理。</li>\n<li>难以测试：退出程序的函数也将退出调用它的测试。这使得函数很难测试，并引入了跳过 <code>go test</code> 尚未运行的其他测试的风险。</li>\n<li>跳过清理：当函数退出程序时，会跳过已经进入<code>defer</code>队列里的函数调用。这增加了跳过重要清理任务的风险。</li>\n</ul>\n<h4> 一次性退出</h4>\n<p>如果可能的话，你的<code>main（）</code>函数中 <strong>最多一次</strong> 调用 <code>os.Exit</code>或者<code>log.Fatal</code>。如果有多个错误场景停止程序执行，请将该逻辑放在单独的函数下并从中返回错误。<br>\n这会缩短 <code>main()</code> 函数，并将所有关键业务逻辑放入一个单独的、可测试的函数中。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 在序列化结构中使用字段标记</h3>\n<p>任何序列化到JSON、YAML、，<br>\n或其他支持基于标记的字段命名的格式应使用相关标记进行注释。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>理论上：<br>\n结构的序列化形式是不同系统之间的契约。<br>\n对序列化表单结构（包括字段名）的更改会破坏此约定。在标记中指定字段名使约定明确，<br>\n它还可以通过重构或重命名字段来防止意外违反约定。</p>\n<h3> 不要一劳永逸地使用 goroutine</h3>\n<p>Goroutines 是轻量级的，但它们不是免费的：<br>\n至少，它们会为堆栈和 CPU 的调度消耗内存。<br>\n虽然这些成本对于 Goroutines 的使用来说很小，但当它们在没有受控生命周期的情况下大量生成时会导致严重的性能问题。<br>\n具有非托管生命周期的 Goroutines 也可能导致其他问题，例如防止未使用的对象被垃圾回收并保留不再使用的资源。</p>\n<p>因此，不要在代码中泄漏 goroutine。<br>\n使用 <a href=\"https://pkg.go.dev/go.uber.org/goleak\" target=\"_blank\" rel=\"noopener noreferrer\">go.uber.org/goleak</a><br>\n来测试可能产生 goroutine 的包内的 goroutine 泄漏。</p>\n<p>一般来说，每个 goroutine:</p>\n<ul>\n<li>必须有一个可预测的停止运行时间； 或者</li>\n<li>必须有一种方法可以向 goroutine 发出信号它应该停止</li>\n</ul>\n<p>在这两种情况下，都必须有一种方式代码来阻塞并等待 goroutine 完成。</p>\n<p>For example:</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<p>没有办法阻止这个 goroutine。这将一直运行到应用程序退出。</p>\n</td><td>\n<p>这个 goroutine 可以用 <code>close(stop)</code>,<br>\n我们可以等待它退出 <code>&lt;-done</code>.</p>\n</td></tr>\n</tbody></table>\n<h4> 等待 goroutines 退出</h4>\n<p>给定一个由系统生成的 goroutine，<br>\n必须有一种方案能等待 goroutine 的退出。<br>\n有两种常用的方法可以做到这一点：</p>\n<ul>\n<li>\n<p>使用 <code>sync.WaitGroup</code>.<br>\n如果您要等待多个 goroutine，请执行此操作</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n<li>\n<p>添加另一个 <code>chan struct{}</code>，goroutine 完成后会关闭它。<br>\n如果只有一个 goroutine，请执行此操作。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></li>\n</ul>\n<h4> 不要在 <code>init()</code> 使用 goroutines</h4>\n<p><code>init()</code> 函数不应该产生 goroutines。<br>\n另请参阅 <a href=\"#%E9%81%BF%E5%85%8D%E4%BD%BF%E7%94%A8-init\">避免使用 init()</a>。</p>\n<p>如果一个包需要一个后台 goroutine，<br>\n它必须公开一个负责管理 goroutine 生命周期的对象。<br>\n该对象必须提供一个方法（<code>Close</code>、<code>Stop</code>、<code>Shutdown</code> 等）来指示后台 goroutine 停止并等待它的退出。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<p>当用户导出这个包时，无条件地生成一个后台 goroutine。<br>\n用户无法控制 goroutine 或停止它的方法。</p>\n</td><td>\n<p>仅当用户请求时才生成工作人员。<br>\n提供一种关闭工作器的方法，以便用户可以释放工作器使用的资源。</p>\n<p>请注意，如果工作人员管理多个 goroutine，则应使用<code>WaitGroup</code>。<br>\n请参阅 <a href=\"#%E7%AD%89%E5%BE%85-goroutines-%E9%80%80%E5%87%BA\">等待 goroutines 退出</a>。</p>\n</td></tr>\n</tbody></table>\n<h2> 性能</h2>\n<p>性能方面的特定准则只适用于高频场景。</p>\n<h3> 优先使用 strconv 而不是 fmt</h3>\n<p>将原语转换为字符串或从字符串转换时，<code>strconv</code>速度比<code>fmt</code>快。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 避免字符串到字节的转换</h3>\n<p>不要反复从固定字符串创建字节 slice。相反，请执行一次转换并捕获结果。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td>\n</tr>\n<tr><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 指定容器容量</h3>\n<p>尽可能指定容器容量，以便为容器预先分配内存。这将在添加元素时最小化后续分配（通过复制和调整容器大小）。</p>\n<h4> 指定Map容量提示</h4>\n<p>在尽可能的情况下，在使用 <code>make()</code> 初始化的时候提供容量信息</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>向<code>make()</code>提供容量提示会在初始化时尝试调整 map 的大小，这将减少在将元素添加到 map 时为 map 重新分配内存。</p>\n<p>注意，与 slices 不同。map capacity 提示并不保证完全的抢占式分配，而是用于估计所需的 hashmap bucket 的数量。<br>\n因此，在将元素添加到 map 时，甚至在指定 map 容量时，仍可能发生分配。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<p><code>m</code> 是在没有大小提示的情况下创建的； 在运行时可能会有更多分配。</p>\n</td><td>\n<p><code>m</code> 是有大小提示创建的；在运行时可能会有更少的分配。</p>\n</td></tr>\n</tbody></table>\n<h4> 指定切片容量</h4>\n<p>在尽可能的情况下，在使用<code>make()</code>初始化切片时提供容量信息，特别是在追加切片时。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>与 maps 不同，slice capacity 不是一个提示：编译器将为提供给<code>make()</code>的 slice 的容量分配足够的内存，<br>\n这意味着后续的 append()`操作将导致零分配（直到 slice 的长度与容量匹配，在此之后，任何 append 都可能调整大小以容纳其他元素）。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h2> 规范</h2>\n<h3> 避免过长的行</h3>\n<p>避免使用需要读者水平滚动或过度转动头部的代码行。</p>\n<p>我们建议将行长度限制为 <strong>99 characters</strong> (99 个字符).<br>\n作者应该在达到这个限制之前换行，<br>\n但这不是硬性限制。<br>\n允许代码超过此限制。</p>\n<h3> 一致性</h3>\n<p>本文中概述的一些标准都是客观性的评估，是根据场景、上下文、或者主观性的判断；</p>\n<p>但是最重要的是，<strong>保持一致</strong>.</p>\n<p>一致性的代码更容易维护、是更合理的、需要更少的学习成本、并且随着新的约定出现或者出现错误后更容易迁移、更新、修复 bug</p>\n<p>相反，在一个代码库中包含多个完全不同或冲突的代码风格会导致维护成本开销、不确定性和认知偏差。所有这些都会直接导致速度降低、代码审查痛苦、而且增加 bug 数量。</p>\n<p>将这些标准应用于代码库时，建议在 package（或更大）级别进行更改，子包级别的应用程序通过将多个样式引入到同一代码中，违反了上述关注点。</p>\n<h3> 相似的声明放在一组</h3>\n<p>Go 语言支持将相似的声明放在一个组内。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>这同样适用于常量、变量和类型声明：</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>仅将相关的声明放在一组。不要将不相关的声明放在一组。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>分组使用的位置没有限制，例如：你可以在函数内部使用它们：</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>例外：如果变量声明与其他变量相邻，则应将变量声明（尤其是函数内部的声明）分组在一起。对一起声明的变量执行此操作，即使它们不相关。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> import 分组</h3>\n<p>导入应该分为两组：</p>\n<ul>\n<li>标准库</li>\n<li>其他库</li>\n</ul>\n<p>默认情况下，这是 goimports 应用的分组。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 包名</h3>\n<p>当命名包时，请按下面规则选择一个名称：</p>\n<ul>\n<li>全部小写。没有大写或下划线。</li>\n<li>大多数使用命名导入的情况下，不需要重命名。</li>\n<li>简短而简洁。请记住，在每个使用的地方都完整标识了该名称。</li>\n<li>不用复数。例如<code>net/url</code>，而不是<code>net/urls</code>。</li>\n<li>不要用“common”，“util”，“shared”或“lib”。这些是不好的，信息量不足的名称。</li>\n</ul>\n<p>另请参阅 <a href=\"https://blog.golang.org/package-names\" target=\"_blank\" rel=\"noopener noreferrer\">Go 包命名规则</a> 和 <a href=\"https://rakyll.org/style-packages/\" target=\"_blank\" rel=\"noopener noreferrer\">Go 包样式指南</a>.</p>\n<h3> 函数名</h3>\n<p>我们遵循 Go 社区关于使用 <a href=\"https://golang.org/doc/effective_go.html#mixed-caps\" target=\"_blank\" rel=\"noopener noreferrer\">MixedCaps 作为函数名</a> 的约定。有一个例外，为了对相关的测试用例进行分组，函数名可能包含下划线，如：<code>TestMyFunction_WhatIsBeingTested</code>.</p>\n<h3> 导入别名</h3>\n<p>如果程序包名称与导入路径的最后一个元素不匹配，则必须使用导入别名。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>在所有其他情况下，除非导入之间有直接冲突，否则应避免导入别名。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 函数分组与顺序</h3>\n<ul>\n<li>函数应按粗略的调用顺序排序。</li>\n<li>同一文件中的函数应按接收者分组。</li>\n</ul>\n<p>因此，导出的函数应先出现在文件中，放在<code>struct</code>, <code>const</code>, <code>var</code>定义的后面。</p>\n<p>在定义类型之后，但在接收者的其余方法之前，可能会出现一个 <code>newXYZ()</code>/<code>NewXYZ()</code></p>\n<p>由于函数是按接收者分组的，因此普通工具函数应在文件末尾出现。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 减少嵌套</h3>\n<p>代码应通过尽可能先处理错误情况/特殊情况并尽早返回或继续循环来减少嵌套。减少嵌套多个级别的代码的代码量。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 不必要的 else</h3>\n<p>如果在 if 的两个分支中都设置了变量，则可以将其替换为单个 if。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 顶层变量声明</h3>\n<p>在顶层，使用标准<code>var</code>关键字。请勿指定类型，除非它与表达式的类型不同。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>如果表达式的类型与所需的类型不完全匹配，请指定类型。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 对于未导出的顶层常量和变量，使用_作为前缀</h3>\n<p>在未导出的顶级<code>vars</code>和<code>consts</code>， 前面加上前缀_，以使它们在使用时明确表示它们是全局符号。</p>\n<p>基本依据：顶级变量和常量具有包范围作用域。使用通用名称可能很容易在其他文件中意外使用错误的值。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p><strong>例外</strong>：未导出的错误值可以使用不带下划线的前缀 <code>err</code>。 参见<a href=\"#%E9%94%99%E8%AF%AF%E5%91%BD%E5%90%8D\">错误命名</a>。</p>\n<h3> 结构体中的嵌入</h3>\n<p>嵌入式类型（例如 mutex）应位于结构体内的字段列表的顶部，并且必须有一个空行将嵌入式字段与常规字段分隔开。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>内嵌应该提供切实的好处，比如以语义上合适的方式添加或增强功能。<br>\n它应该在对用户没有任何不利影响的情况下使用。（另请参见：<a href=\"#%E9%81%BF%E5%85%8D%E5%9C%A8%E5%85%AC%E5%85%B1%E7%BB%93%E6%9E%84%E4%B8%AD%E5%B5%8C%E5%85%A5%E7%B1%BB%E5%9E%8B\">避免在公共结构中嵌入类型</a>）。</p>\n<p>例外：即使在未导出类型中，Mutex 也不应该作为内嵌字段。另请参见：<a href=\"#%E9%9B%B6%E5%80%BC-mutex-%E6%98%AF%E6%9C%89%E6%95%88%E7%9A%84\">零值 Mutex 是有效的</a>。</p>\n<p>嵌入 <strong>不应该</strong>:</p>\n<ul>\n<li>纯粹是为了美观或方便。</li>\n<li>使外部类型更难构造或使用。</li>\n<li>影响外部类型的零值。如果外部类型有一个有用的零值，则在嵌入内部类型之后应该仍然有一个有用的零值。</li>\n<li>作为嵌入内部类型的副作用，从外部类型公开不相关的函数或字段。</li>\n<li>公开未导出的类型。</li>\n<li>影响外部类型的复制形式。</li>\n<li>更改外部类型的 API 或类型语义。</li>\n<li>嵌入内部类型的非规范形式。</li>\n<li>公开外部类型的实现详细信息。</li>\n<li>允许用户观察或控制类型内部。</li>\n<li>通过包装的方式改变内部函数的一般行为，这种包装方式会给用户带来一些意料之外情况。</li>\n</ul>\n<p>简单地说，有意识地和有目的地嵌入。一种很好的测试体验是，<br>\n\"是否所有这些导出的内部方法/字段都将直接添加到外部类型\"<br>\n如果答案是<code>some</code>或<code>no</code>，不要嵌入内部类型 - 而是使用字段。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 本地变量声明</h3>\n<p>如果将变量明确设置为某个值，则应使用短变量声明形式 (<code>:=</code>)。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>但是，在某些情况下，<code>var</code> 使用关键字时默认值会更清晰。例如，<a href=\"https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices\" target=\"_blank\" rel=\"noopener noreferrer\">声明空切片</a>。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> nil 是一个有效的 slice</h3>\n<p><code>nil</code> 是一个有效的长度为 0 的 slice，这意味着，</p>\n<ul>\n<li>\n<p>您不应明确返回长度为零的切片。应该返回<code>nil</code> 来代替。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n</li>\n<li>\n<p>要检查切片是否为空，请始终使用<code>len(s) == 0</code>。而非 <code>nil</code>。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n</li>\n<li>\n<p>零值切片（用<code>var</code>声明的切片）可立即使用，无需调用<code>make()</code>创建。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n</li>\n</ul>\n<p>记住，虽然 nil 切片是有效的切片，但它不等于长度为 0 的切片（一个为 nil，另一个不是），并且在不同的情况下（例如序列化），这两个切片的处理方式可能不同。</p>\n<h3> 缩小变量作用域</h3>\n<p>如果有可能，尽量缩小变量作用范围。除非它与 <a href=\"#%E5%87%8F%E5%B0%91%E5%B5%8C%E5%A5%97\">减少嵌套</a>的规则冲突。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>如果需要在 if 之外使用函数调用的结果，则不应尝试缩小范围。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 避免参数语义不明确 (Avoid Naked Parameters)</h3>\n<p>函数调用中的<code>意义不明确的参数</code>可能会损害可读性。当参数名称的含义不明显时，请为参数添加 C 样式注释 (<code>/* ... */</code>)</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>对于上面的示例代码，还有一种更好的处理方式是将上面的 <code>bool</code> 类型换成自定义类型。将来，该参数可以支持不仅仅局限于两个状态（true/false）。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h3> 使用原始字符串字面值，避免转义</h3>\n<p>Go 支持使用 <a href=\"https://golang.org/ref/spec#raw_string_lit\" target=\"_blank\" rel=\"noopener noreferrer\">原始字符串字面值</a>，也就是 \" ` \" 来表示原生字符串，在需要转义的场景下，我们应该尽量使用这种方案来替换。</p>\n<p>可以跨越多行并包含引号。使用这些字符串可以避免更难阅读的手工转义的字符串。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 初始化结构体</h3>\n<h4> 使用字段名初始化结构</h4>\n<p>初始化结构时，几乎应该始终指定字段名。目前由 <a href=\"https://golang.org/cmd/vet/\" target=\"_blank\" rel=\"noopener noreferrer\"><code>go vet</code></a> 强制执行。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>例外：当有 3 个或更少的字段时，测试表中的字段名<em>may</em>可以省略。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 省略结构中的零值字段</h4>\n<p>初始化具有字段名的结构时，除非提供有意义的上下文，否则忽略值为零的字段。<br>\n也就是，让我们自动将这些设置为零值</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>这有助于通过省略该上下文中的默认值来减少阅读的障碍。只指定有意义的值。</p>\n<p>在字段名提供有意义上下文的地方包含零值。例如，<a href=\"#%E8%A1%A8%E9%A9%B1%E5%8A%A8%E6%B5%8B%E8%AF%95\">表驱动测试</a> 中的测试用例可以受益于字段的名称，即使它们是零值的。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><h4> 对零值结构使用 <code>var</code></h4>\n<p>如果在声明中省略了结构的所有字段，请使用 <code>var</code> 声明结构。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>这将零值结构与那些具有类似于为 <a href=\"#%E5%88%9D%E5%A7%8B%E5%8C%96-maps\">初始化 Maps</a> 创建的，区别于非零值字段的结构区分开来，<br>\n并与我们更喜欢的 <a href=\"https://github.com/golang/go/wiki/CodeReviewComments#declaring-empty-slices\" target=\"_blank\" rel=\"noopener noreferrer\">声明空切片</a> 方式相匹配。</p>\n<h4> 初始化 Struct 引用</h4>\n<p>在初始化结构引用时，请使用<code>&amp;T{}</code>代替<code>new(T)</code>，以使其与结构体初始化一致。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 初始化 Maps</h3>\n<p>对于空 map 请使用 <code>make(..)</code> 初始化， 并且 map 是通过编程方式填充的。<br>\n这使得 map 初始化在表现上不同于声明，并且它还可以方便地在 make 后添加大小提示。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<p>声明和初始化看起来非常相似的。</p>\n</td><td>\n<p>声明和初始化看起来差别非常大。</p>\n</td></tr>\n</tbody></table>\n<p>在尽可能的情况下，请在初始化时提供 map 容量大小，详细请看<a href=\"#%E6%8C%87%E5%AE%9Amap%E5%AE%B9%E9%87%8F%E6%8F%90%E7%A4%BA\">指定Map容量提示</a></p>\n<p>另外，如果 map 包含固定的元素列表，则使用 map literals(map 初始化列表) 初始化映射。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>基本准则是：在初始化时使用 map 初始化列表 来添加一组固定的元素。否则使用 <code>make</code> (如果可以，请尽量指定 map 容量)。</p>\n<h3> 字符串 string format</h3>\n<p>如果你在函数外声明<code>Printf</code>-style 函数的格式字符串，请将其设置为<code>const</code>常量。</p>\n<p>这有助于<code>go vet</code>对格式字符串执行静态分析。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<h3> 命名 Printf 样式的函数</h3>\n<p>声明<code>Printf</code>-style 函数时，请确保<code>go vet</code>可以检测到它并检查格式字符串。</p>\n<p>这意味着您应尽可能使用预定义的<code>Printf</code>-style 函数名称。<code>go vet</code>将默认检查这些。有关更多信息，请参见 <a href=\"https://golang.org/cmd/vet/#hdr-Printf_family\" target=\"_blank\" rel=\"noopener noreferrer\">Printf 系列</a>。</p>\n<p>如果不能使用预定义的名称，请以 f 结束选择的名称：<code>Wrapf</code>，而不是<code>Wrap</code>。<code>go vet</code>可以要求检查特定的 Printf 样式名称，但名称必须以<code>f</code>结尾。</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>另请参阅 <a href=\"https://kuzminva.wordpress.com/2017/11/07/go-vet-printf-family-check/\" target=\"_blank\" rel=\"noopener noreferrer\">go vet: Printf family check</a>.</p>\n<h2> 编程模式</h2>\n<h3> 表驱动测试</h3>\n<p>当测试逻辑是重复的时候，通过  <a href=\"https://blog.golang.org/subtests\" target=\"_blank\" rel=\"noopener noreferrer\">subtests</a> 使用 table 驱动的方式编写 case 代码看上去会更简洁。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>很明显，使用 test table 的方式在代码逻辑扩展的时候，比如新增 test case，都会显得更加的清晰。</p>\n<p>我们遵循这样的约定：将结构体切片称为<code>tests</code>。 每个测试用例称为<code>tt</code>。此外，我们鼓励使用<code>give</code>和<code>want</code>前缀说明每个测试用例的输入和输出值。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>并行测试，比如一些专门的循环（例如，生成goroutine或捕获引用作为循环体的一部分的那些循环）<br>\n必须注意在循环的范围内显式地分配循环变量，以确保它们保持预期的值。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>在上面的例子中，由于下面使用了<code>t.Parallel()</code>，我们必须声明一个作用域为循环迭代的<code>tt</code>变量。<br>\n如果我们不这样做，大多数或所有测试都会收到一个意外的<code>tt</code>值，或者一个在运行时发生变化的值。</p>\n<h3> 功能选项</h3>\n<p>功能选项是一种模式，您可以在其中声明一个不透明 Option 类型，该类型在某些内部结构中记录信息。您接受这些选项的可变编号，并根据内部结构上的选项记录的全部信息采取行动。</p>\n<p>将此模式用于您需要扩展的构造函数和其他公共 API 中的可选参数，尤其是在这些功能上已经具有三个或更多参数的情况下。</p>\n<table>\n<thead><tr><th>Bad</th><th>Good</th></tr></thead>\n<tbody>\n<tr><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n<tr><td>\n<p>必须始终提供缓存和记录器参数，即使用户希望使用默认值。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td><td>\n<p>只有在需要时才提供选项。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div></td></tr>\n</tbody></table>\n<p>我们建议实现此模式的方法是使用一个 <code>Option</code> 接口，该接口保存一个未导出的方法，在一个未导出的 <code>options</code> 结构上记录选项。</p>\n<div class=\"language-go line-numbers-mode\" data-ext=\"go\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>注意：还有一种使用闭包实现这个模式的方法，但是我们相信上面的模式为作者提供了更多的灵活性，并且更容易对用户进行调试和测试。特别是，在不可能进行比较的情况下它允许在测试和模拟中对选项进行比较。此外，它还允许选项实现其他接口，包括 <code>fmt.Stringer</code>，允许用户读取选项的字符串表示形式。</p>\n<p>还可以参考下面资料：</p>\n<ul>\n<li>\n<p><a href=\"https://commandcenter.blogspot.com/2014/01/self-referential-functions-and-design.html\" target=\"_blank\" rel=\"noopener noreferrer\">Self-referential functions and the design of options</a></p>\n</li>\n<li>\n<p><a href=\"https://dave.cheney.net/2014/10/17/functional-options-for-friendly-apis\" target=\"_blank\" rel=\"noopener noreferrer\">Functional options for friendly APIs</a></p>\n</li>\n</ul>\n<!-- TODO: replace this with parameter structs and functional options, when to\nuse one vs other -->\n<h2> Linting</h2>\n<p>比任何 \"blessed\" linter 集更重要的是，lint 在一个代码库中始终保持一致。</p>\n<p>我们建议至少使用以下 linters，因为我认为它们有助于发现最常见的问题，并在不需要规定的情况下为代码质量建立一个高标准：</p>\n<ul>\n<li>\n<p><a href=\"https://github.com/kisielk/errcheck\" target=\"_blank\" rel=\"noopener noreferrer\">errcheck</a> 以确保错误得到处理</p>\n</li>\n<li>\n<p><a href=\"https://godoc.org/golang.org/x/tools/cmd/goimports\" target=\"_blank\" rel=\"noopener noreferrer\">goimports</a> 格式化代码和管理 imports</p>\n</li>\n<li>\n<p><a href=\"https://github.com/golang/lint\" target=\"_blank\" rel=\"noopener noreferrer\">golint</a> 指出常见的文体错误</p>\n</li>\n<li>\n<p><a href=\"https://golang.org/cmd/vet/\" target=\"_blank\" rel=\"noopener noreferrer\">govet</a> 分析代码中的常见错误</p>\n</li>\n<li>\n<p><a href=\"https://staticcheck.io/\" target=\"_blank\" rel=\"noopener noreferrer\">staticcheck</a> 各种静态分析检查</p>\n</li>\n</ul>\n<h3> Lint Runners</h3>\n<p>我们推荐 <a href=\"https://github.com/golangci/golangci-lint\" target=\"_blank\" rel=\"noopener noreferrer\">golangci-lint</a> 作为 go-to lint 的运行程序，这主要是因为它在较大的代码库中的性能以及能够同时配置和使用许多规范。这个 repo 有一个示例配置文件 <a href=\"https://github.com/uber-go/guide/blob/master/.golangci.yml\" target=\"_blank\" rel=\"noopener noreferrer\">.golangci.yml</a> 和推荐的 linter 设置。</p>\n<p>golangci-lint 有 <a href=\"https://golangci-lint.run/usage/linters/\" target=\"_blank\" rel=\"noopener noreferrer\">various-linters</a> 可供使用。建议将上述 linters 作为基本 set，我们鼓励团队添加对他们的项目有意义的任何附加 linters。</p>\n<h2> Stargazers over time</h2>\n<figure><a href=\"https://starchart.cc/xxjwxc/uber_go_guide_cn\" target=\"_blank\" rel=\"noopener noreferrer\"><img src=\"https://starchart.cc/xxjwxc/uber_go_guide_cn.svg\" alt=\"Stargazers over time\" tabindex=\"0\" loading=\"lazy\"></a><figcaption>Stargazers over time</figcaption></figure>\n",
      "image": "https://starchart.cc/xxjwxc/uber_go_guide_cn.svg",
      "date_published": "2023-03-04T00:00:00.000Z",
      "date_modified": "2023-07-30T09:20:01.000Z",
      "authors": [],
      "tags": [
        "Go语言",
        "转载"
      ]
    },
    {
      "title": "认证方案",
      "url": "https://Hexiaopi.github.io/system-design/security/auth.html",
      "id": "https://Hexiaopi.github.io/system-design/security/auth.html",
      "summary": "认证 我们有多种途径来保障应用的安全，例如：网咯隔离、设置防火墙、设置IP黑名单等。而认证是软件层面保护应用安全的一种措施。 当前有四种认证方式，分别是：Basic、Digest、OAuth和Bearer Basic认证 Basic认证（基础认证）是一种简单的认证方式。将用户名:密码进行base64编码，放到HTTP Authorization Header中。 但是base64不是加密技术，入侵者可以通过截获base64字符串，并反编码获取用户名和密码；其次即便进行了加密了用户名和密码，入侵者可以通过加重放攻击。",
      "content_html": "<h2> 认证</h2>\n<blockquote>\n<p>我们有多种途径来保障应用的安全，例如：网咯隔离、设置防火墙、设置IP黑名单等。而<strong>认证</strong>是软件层面保护应用安全的一种措施。</p>\n<p>当前有四种认证方式，分别是：<code>Basic</code>、<code>Digest</code>、<code>OAuth</code>和<code>Bearer</code></p>\n</blockquote>\n<h3> Basic认证</h3>\n<blockquote>\n<p>Basic认证（基础认证）是一种简单的认证方式。将<code>用户名:密码</code>进行base64编码，放到HTTP Authorization Header中。</p>\n<p>但是base64不是加密技术，入侵者可以通过截获base64字符串，并反编码获取用户名和密码；其次即便进行了加密了用户名和密码，入侵者可以通过加重放攻击。</p>\n</blockquote>\n<p>因此Basic认证非常不安全。在设计系统时，要遵循一个通用的原则：不要在请求参数中使用明文密码，也不要在任何存储中保存明文密码。</p>\n<h3> Digest认证</h3>\n<blockquote>\n<p>Digest认证（摘要认证）是一种HTTP认证协议，它与Basic认证兼容，但修复了Basic认证的严重缺陷。</p>\n</blockquote>\n<p><strong>特点</strong></p>\n<ul>\n<li>绝不会用明文的方式在网络上发送密码</li>\n<li>可以有效防止恶意用户进行重放攻击</li>\n<li>可以有效的防止对报文内容进行篡改</li>\n</ul>\n<p>摘要认证的过程如下图所示：<br>\n</p>\n<ol>\n<li>客户端请求服务端资源</li>\n<li>在客户端能够证明它知道密码从而确认其身份之前，服务端认证失败，返回401 Unauthorized，并返回WWW-Authenticate头，里面包含认证需要的信息。</li>\n<li>客户端根据WWW-Authenticate头中的信息，选择加密算法，并使用密码随机数<code>nonce</code>，计算出密码摘要<code>response</code>，并再次请求服务端。</li>\n<li>服务器将客户端提供的密码摘要与服务器内部计算出的摘要进行对比。如果匹配，就说明客户端知道密码，认证通过，并返回一些与授权会话相关的附加信息，放在<code>Authorization-Info</code>中。</li>\n</ol>\n<p>其中涉及到的一些参数说明：</p>\n<table>\n<thead>\n<tr>\n<th style=\"text-align:center\">参数</th>\n<th style=\"text-align:center\">说明</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td style=\"text-align:center\">WWW-Authentication</td>\n<td style=\"text-align:center\">用来定义使用何种方式（Basic、Digest、Bearer等）去进行认证以获取受保护的资源</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">username</td>\n<td style=\"text-align:center\">用户名</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">realm</td>\n<td style=\"text-align:center\">服务器返回的realm，一般是域名</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">method</td>\n<td style=\"text-align:center\">HTTP请求方法</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nonce</td>\n<td style=\"text-align:center\">服务器发给客户端的随机字符串，会经常发生变化。客户端计算密码摘要时将其附加上去，使得多次生成同一用户的密码摘要各不相同，用来防止重放攻击</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nc(nonceCount)</td>\n<td style=\"text-align:center\">16进制数值，用于记录请求的次数，用于标记、计数，防止重放攻击</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">cnonce(clientNonce)</td>\n<td style=\"text-align:center\">客户端发送给服务器的随机字符串，用于客户端对服务器的认证</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">qop</td>\n<td style=\"text-align:center\">保护质量参数，包含auth（默认）或auth-int（增加了报文完整性检测）</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">uri</td>\n<td style=\"text-align:center\">请求的uri</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">response</td>\n<td style=\"text-align:center\">客户端根据算法算出的密码摘要值</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">Authorization-Info</td>\n<td style=\"text-align:center\">用于返回一些与授权会话相关的附加信息</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">nextnonce</td>\n<td style=\"text-align:center\">下一个服务端随机数，使客户端可以预先发送正确的摘要</td>\n</tr>\n<tr>\n<td style=\"text-align:center\">rspauth</td>\n<td style=\"text-align:center\">响应摘要，用于客户端对服务端进行认证</td>\n</tr>\n</tbody>\n</table>\n<p>摘要认证可以保护密码，比基本认证要安全的多，但摘要认证并不能保护内容，所以仍然要与HTTPS配合使用。</p>\n<h3> OAuth认证</h3>\n<blockquote>\n<p>OAuth（开放授权）是一个开放的授权标准，允许用户让第三方应用访问该用户在某一Web服务上存储的私密资源（例如：照片、视频、音频等），而无需将用户名和密码提供给第三方应用。</p>\n</blockquote>\n<p>阮老师解释OAuth2.0非常形象，一看就懂<br>\n<a href=\"https://www.ruanyifeng.com/blog/2019/04/oauth_design.html\" target=\"_blank\" rel=\"noopener noreferrer\">OAuth 2.0 的一个简单解释</a></p>\n<p><a href=\"https://www.ruanyifeng.com/blog/2019/04/oauth-grant-types.html\" target=\"_blank\" rel=\"noopener noreferrer\">OAuth 2.0 的四种方式</a></p>\n<p><a href=\"https://www.ruanyifeng.com/blog/2019/04/github-oauth.html\" target=\"_blank\" rel=\"noopener noreferrer\">GitHub OAuth 第三方登录示例教程</a></p>\n<p>OAuth当前是2.0版本，分为四种授权方式：密码式、隐藏式、凭借式和授权码模式。</p>\n<h4> 密码式</h4>\n<p>流程如下：</p>\n<ol>\n<li>网站A向用户发出获取用户名和密码的请求；</li>\n<li>用户同意后，网站A凭借用户名和密码向网站B换取令牌；</li>\n<li>网站B验证用户身份后，给出网站A令牌，网站A凭借令牌可以访问网站B对应权限的资源。、</li>\n</ol>\n<p>特点：用户需要高度信任网站A</p>\n<h4> 隐藏式</h4>\n<p>流程如下：</p>\n<ol>\n<li>A网站提供一个跳转到B网站的链接，用户点击后跳转至B网站，并向用户请求授权；</li>\n<li>用户登录B网站，同意授权后，跳转回A网站指定的重定向redirect_url地址，并携带B网站返回的令牌，用户在B网站的数据给A网站使用。</li>\n</ol>\n<p>常见：适用于前端应用，例如公司内部应用集成SSO登录</p>\n<p>特点：存在中间人攻击的风险，因此只能用于一些安全性要求不高的场景，并且令牌的有效时间要非常短。</p>\n<h4> 凭借式</h4>\n<ol>\n<li>应用A在命令行向应用B请求授权，此时应用A需要携带应用B提前颁发的secretID和secretKey，其中secretKey出于安全性考虑，需在后端发送；</li>\n<li>应用B接收到secretID和secretKey，并进行身份验证，验证通过后返回给应用A令牌；</li>\n</ol>\n<p>常见：适用于没有前端的命令行应用</p>\n<h4> 授权码模式</h4>\n<p>流程如下：</p>\n<ol>\n<li>A网站提供一个跳转到B网站的链接+redirect_url，用户点击后跳转至B网站；</li>\n<li>用户携带B网站提前申请的client_id，向B网站发起身份验证请求；</li>\n<li>用户登录B网站，通过验证，授予A网站权限，此时网站跳转回redirect_url，其中会有B网站通过验证后的授权码附在该url后；</li>\n<li>网站A携带授权码向网站B请求令牌，网站B验证授权码后，返回令牌即acess_token；</li>\n</ol>\n<h3> Bearer认证</h3>\n<blockquote>\n<p>Bearer认证也称为令牌认证，是一种HTTP身份验证方法，Bearer认证的核心是bearer token。bearer token是一个加密字符串，通常由服务端根据秘钥生成。客户端在请求服务端时，必须在请求头中包含Authorization: Bearer <code>&lt;token&gt;</code>，服务端收到请求后，解析出token，并校验token的合法性。</p>\n</blockquote>\n<p>当前最流行的token编码方式是JSON Web Token(JWT)</p>\n<h4> 基于JWT的Token认证</h4>\n<blockquote>\n<p>JWT是Bearer Token的一个具体实现，由JSON数据格式组成，通过HASH散列算法生成一个字符串，该字符串可以用来进行授权和信息交换。</p>\n</blockquote>\n<p>流程如下：</p>\n<ol>\n<li>客户端使用用户名和密码请求登录。</li>\n<li>服务端收到请求后，会去验证用户名和密码。如果用户名和密码跟数据库记录不一致，则验证失败；如果一致则验证通过，服务端会签发一个 Token 返回给客户端。</li>\n<li>客户端收到请求后会将 Token 缓存起来，比如放在浏览器 Cookie 中或者 LocalStorage 中，之后每次请求都会携带该 Token。</li>\n<li>服务端收到请求后，会验证请求中的 Token，验证通过则进行业务逻辑处理，处理完后返回处理后的结果</li>\n</ol>\n<p>JWT格式由三部分组成，分别是Header、Payload和Signature，它们之间用圆点.连接，例如：</p>\n<div class=\"language-text line-numbers-mode\" data-ext=\"text\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p><strong>Header</strong></p>\n<p>包含两部分信息：一个是Token的类型，二是Token所使用的加密算法，例如：</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><ul>\n<li>typ：说明Token的类型；</li>\n<li>alg: 说明Token的加密算法；</li>\n</ul>\n<p>将Header进行base64编码：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>在某些场景下，可能还会有kid选项，用来标识一个秘钥ID，例如：</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p><strong>Payload</strong></p>\n<p>有效载荷部分，是JWT的主体内容部分，也是一个JSON对象，包含需要传递的数据。</p>\n<ul>\n<li>iss: Issuer，JWT Token的签发者</li>\n<li>exp: Expiration Time，JWT Token的过期时间</li>\n<li>sub: Subject，主题</li>\n<li>aud: Audience，一般可以为特定的App、服务或模块。服务端的安全策略再签发时和验证时，aud必须一致</li>\n<li>iat: Issued At，JWT Token签发时间</li>\n<li>nbf: Not Before，JWT Toekn生效时间</li>\n<li>jti: JWT ID，令牌的唯一标识符，通常用于一次性消费的Token</li>\n</ul>\n<p>例如：</p>\n<div class=\"language-json line-numbers-mode\" data-ext=\"json\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>将payload进行base64编码：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div><div class=\"line-number\"></div><div class=\"line-number\"></div></div></div><p>这些预定义的字段并不要求强制使用，此外，我们还可以自定义私有字段，一般会把包含用户信息的数据放到payload中。注意，不要添加敏感信息，此外私有声明是客户端和服务端所共同定义的声明。</p>\n<p><strong>Signature</strong></p>\n<p>Signature是Token的签名部分，通过如下方式生成：将 Header 和 Payload 分别 base64 编码后，用 . 连接。然后再使用 Header 中声明的加密方式，利用 secretKey 对连接后的字符串进行加密，加密后的字符串即为最终的 Signature。secretKey 是密钥，保存在服务器中，一般通过配置文件来保存。</p>\n<p>签名后服务端会返回生成的 Token，客户端下次请求会携带该 Token。服务端收到 Token 后会解析出 header.payload，然后用相同的加密算法和密钥对 header.payload 再进行一次加密，例如：</p>\n<div class=\"language-bash line-numbers-mode\" data-ext=\"sh\"><div class=\"line-numbers\" aria-hidden=\"true\"><div class=\"line-number\"></div></div></div><p>得到 Signature。并且，对比加密后的 Signature 和收到的 Signature 是否相同，如果相同则验证通过，不相同则返回 HTTP 401 Unauthorized 的错误。</p>\n",
      "date_published": "2022-09-18T00:00:00.000Z",
      "date_modified": "2023-08-14T13:05:37.000Z",
      "authors": [],
      "tags": [
        "系统设计"
      ]
    }
  ]
}